<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Menu Pengaturan</title>
<style>
body {
background: #0c0c16;
color: #0ff;
font-family: 'Courier New', monospace;
padding: 20px;
margin: 0;
}
.card {
background: rgba(0, 30, 60, 0.6);
border: 2px solid #0ff;
border-radius: 8px;
padding: 16px;
margin: 12px 0;
box-shadow: 0 0 10px #0ff;
font-size: 16px;
}
.neon-btn {
background: transparent;
color: #0ff;
border: 1px solid #0ff;
padding: 8px 16px;
margin-top: 8px;
cursor: pointer;
font-size: 16px;
text-transform: uppercase;
}
.toast {
position: fixed;
top: 20px;
right: 20px;
background: rgba(0, 0, 0, 0.8);
border: 2px solid #0f0;
color: #0f0;
padding: 12px 20px;
border-radius: 6px;
font-weight: bold;
opacity: 0;
transform: scale(0.8);
transition: all 0.4s ease;
z-index: 1000;
}
.toast.show {
opacity: 1;
transform: scale(1);
}
input, select, textarea {
width: 100%;
padding: 8px;
margin: 6px 0;
background: rgba(0,0,0,0.4);
color: #0ff;
border: 1px solid #0ff;
border-radius: 4px;
}
.popup {
position: fixed;
top: 50%; left: 50%;
transform: translate(-50%, -50%);
background: #1a1a2e;
padding: 20px;
border: 2px solid #0f0;
border-radius: 12px;
z-index: 2000;
display: none;
}
.popup.show { display: block; }
.overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1999; display: none; }
.overlay.show { display: block; }
</style>
</head>
<body>
<h1>‚öôÔ∏è MENU PENGATURAN</h1>

<div class="card">
<h3>üîß Staff Management</h3>
<input type="text" id="newUsername" placeholder="Username">
<input type="text" id="newPassword" placeholder="Password (plaintext)">
<input type="text" id="newName" placeholder="Nama">
<select id="newRole">
<option value="CS LINE">CS LINE</option>
<option value="KAPTEN">KAPTEN</option>
<option value="KASIR">KASIR</option>
</select>
<button class="neon-btn" onclick="addStaff()">Tambah Staff</button>
</div>

<div class="card">
<h3>üíº Jobdesk</h3>
<textarea id="jobdeskList" rows="4" placeholder="Satu per baris"></textarea>
<button class="neon-btn" onclick="saveJobdesk()">Simpan Jobdesk</button>
</div>

<div class="card">
<h3>üåê Whitelist IP</h3>
<textarea id="ipList" rows="4" placeholder="Contoh: 192.168.1.*"></textarea>
<button class="neon-btn" onclick="saveWhitelist()">Simpan IP</button>
</div>

<div class="card">
<h3>üì¢ Running Text</h3>
<textarea id="runningText" rows="4" placeholder="Satu per baris"></textarea>
<button class="neon-btn" onclick="saveRunningText()">Simpan Teks</button>
</div>

<div class="card">
<h3>üñºÔ∏è Background</h3>
<input type="url" id="bgUrl" placeholder="URL gambar">
<button class="neon-btn" onclick="addBackground()">Tambah Background</button>
</div>

<div class="toast" id="toast">HANYA 6 ORANG TERPILIH ‚Äì Pengaturan Disimpan!</div>

<div class="overlay" id="popupOverlay"></div>
<div class="popup" id="popupMessage">
<div id="popupContent"></div>
<button class="neon-btn" style="margin-top:15px;" onclick="hidePopup()">Tutup</button>
</div>

<script>
const GITHUB_REPO = 'davidsmb9856-star/tescatter';

function showToast() {
const toast = document.getElementById('toast');
toast.classList.add('show');
setTimeout(() => toast.classList.remove('show'), 3000);
}

function showPopup(msg) {
document.getElementById('popupContent').textContent = msg;
document.getElementById('popupOverlay').classList.add('show');
document.getElementById('popupMessage').classList.add('show');
}

function hidePopup() {
document.getElementById('popupOverlay').classList.remove('show');
document.getElementById('popupMessage').classList.remove('show');
}

// ‚úÖ FUNGSI BARU: KIRIM KE NETLIFY FUNCTION
async function saveConfig(path, content) {
try {
showPopup("üì§ Mengirim data ke GitHub...");
const response = await fetch('/api/update-data', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ path, content })
});

const result = await response.json();
if (result.success) {
showToast();
showPopup("‚úÖ Data berhasil disimpan ke GitHub!");
} else {
showPopup("‚ùå Gagal: " + (result.error || 'Unknown error'));
}
} catch (err) {
console.error(err);
showPopup("‚ö†Ô∏è Error koneksi: " + err.message);
}
}

async function addStaff() {
const username = document.getElementById('newUsername').value.trim();
const password = document.getElementById('newPassword').value.trim();
const name = document.getElementById('newName').value.trim();
const role = document.getElementById('newRole').value;

if (!username || !password || !name) {
showPopup("‚ùó Semua field wajib diisi!");
return;
}

const newStaff = {
username,
password_hash: password, // ‚ö†Ô∏è plaintext untuk demo
name,
role
};

// Ambil data staff terbaru dari GitHub
const res = await fetch(`https://raw.githubusercontent.com/${GITHUB_REPO}/main/data/staff.json`);
const staffData = await res.json();

staffData.staff.push(newStaff);
await saveConfig('data/staff.json', staffData);
}

async function saveJobdesk() {
const options = document.getElementById('jobdeskList').value.split('\n').filter(x => x.trim());
await saveConfig('data/jobdesk.json', { options });
}

async function saveWhitelist() {
const ips = document.getElementById('ipList').value.split('\n').filter(x => x.trim());
await saveConfig('data/whitelist.json', { allowed_ips: ips });
}

async function saveRunningText() {
const texts = document.getElementById('runningText').value.split('\n').filter(x => x.trim());
await saveConfig('data/running-text.json', { texts });
}

async function addBackground() {
const url = document.getElementById('bgUrl').value.trim();
if (!url) return showPopup("‚ùó Masukkan URL gambar!");

const res = await fetch(`https://raw.githubusercontent.com/${GITHUB_REPO}/main/data/backgrounds.json`);
const bgData = await res.json();

bgData.urls.push(url);
await saveConfig('data/backgrounds.json', bgData);
}

// Load data saat buka halaman
window.addEventListener('load', async () => {
try {
// Load jobdesk
const jd = await fetch(`https://raw.githubusercontent.com/${GITHUB_REPO}/main/data/jobdesk.json`).then(r => r.json());
document.getElementById('jobdeskList').value = jd.options.join('\n');

// Load IP
const ip = await fetch(`https://raw.githubusercontent.com/${GITHUB_REPO}/main/data/whitelist.json`).then(r => r.json());
document.getElementById('ipList').value = ip.allowed_ips.join('\n');

// Load running text
const rt = await fetch(`https://raw.githubusercontent.com/${GITHUB_REPO}/main/data/running-text.json`).then(r => r.json());
document.getElementById('runningText').value = rt.texts.join('\n');
} catch (e) {
console.warn("Gagal load data awal:", e);
}
});
</script>
</body>
</html>
