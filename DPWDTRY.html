<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neon Blue System - Memo & Reportan</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root {
    /* NEON BLUE PALETTE - INTENSITY REDUCED */
    --neon-cyan: #00d0e0;
    --neon-blue: #0055cc;
    --neon-deep: #002055;
    --bg-dark: #02040a;
    --bg-panel: rgba(10, 25, 50, 0.4);
    
    /* Status Colors */
    --status-online: #00cc80;
    --status-offline: #ff3366;
    
    /* Text */
    --text-main: #ffffff;
    --text-dim: #8aaacc;

    /* Effects - Less intense */
    --glow-cyan: 0 0 6px rgba(0, 208, 224, 0.4), 0 0 12px rgba(0, 208, 224, 0.2);
    --glow-blue: 0 0 10px rgba(0, 85, 204, 0.3);
    --glass-border: 1px solid rgba(0, 208, 224, 0.1);
    --glass-blur: blur(8px);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    background-color: var(--bg-dark);
    color: var(--text-main);
    font-family: 'Rajdhani', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
    background-image: 
        linear-gradient(rgba(0, 208, 224, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 208, 224, 0.03) 1px, transparent 1px);
    background-size: 50px 50px, 50px 50px;
}

/* Typography - Larger text */
h1, h2, h3, .btn, .clock-text, .date-text { font-family: 'Orbitron', sans-serif; }
h1 { font-size: 2.2rem !important; }
h3 { font-size: 1.3rem !important; }
label { font-size: 1.05rem !important; } /* larger label */
input, select, textarea { font-size: 1.1rem !important; padding: 14px !important; }

/* Scrollbar */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg-dark); }
::-webkit-scrollbar-thumb { background: var(--neon-blue); border-radius: 3px; }

/* Layout */
.app-container { display: flex; min-height: 100vh; }

/* --- SIDEBAR --- */
.sidebar {
    width: 280px;
    background: var(--bg-panel);
    backdrop-filter: var(--glass-blur);
    border-right: var(--glass-border);
    position: fixed;
    height: 100vh;
    z-index: 100;
    display: flex;
    flex-direction: column;
    box-shadow: 3px 0 15px rgba(0, 0, 0, 0.4);
    transition: transform 0.3s ease;
}

.logo-area {
    padding: 30px 20px;
    text-align: center;
    border-bottom: 1px solid rgba(0, 208, 224, 0.1);
    margin-bottom: 10px;
}

.logo-area h2 {
    font-size: 1.4rem;
    color: var(--neon-cyan);
    text-shadow: var(--glow-cyan);
    letter-spacing: 2px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.logo-area span {
    display: block;
    font-size: 0.75rem;
    color: var(--neon-blue);
    letter-spacing: 3px;
    margin-top: 6px;
    text-transform: uppercase;
}

/* Menu Items */
.menu-label {
    padding: 15px 25px 5px;
    font-size: 0.75rem;
    color: var(--neon-blue);
    text-transform: uppercase;
    letter-spacing: 2px;
    font-weight: 700;
    opacity: 0.8;
}

.nav-item {
    padding: 15px 25px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-left: 3px solid transparent;
    transition: all 0.3s ease;
    position: relative;
}

.nav-item:hover {
    background: rgba(0, 208, 224, 0.08);
    border-left-color: var(--neon-cyan);
}

.nav-item.active {
    background: rgba(0, 85, 204, 0.15);
    border-left-color: var(--neon-cyan);
    color: var(--neon-cyan);
}

.nav-content { display: flex; align-items: center; gap: 15px; font-weight: 600; font-size: 1.05rem; }

.submenu {
    display: none;
    background: rgba(0, 0, 0, 0.15);
    padding-left: 10px;
    border-bottom: 1px solid rgba(0, 208, 224, 0.05);
}

.submenu.expanded { display: block; }

.sub-item {
    padding: 12px 20px 12px 30px;
    cursor: pointer;
    color: var(--text-dim);
    font-size: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: 0.3s;
}

.sub-item:hover { 
    color: var(--text-main); 
    padding-left: 35px; 
    background: rgba(255,255,255,0.04); 
}
.sub-item.active { 
    color: var(--neon-cyan); 
    background: rgba(0, 208, 224, 0.06); 
    font-weight: 700; 
}

.badge {
    background: rgba(0, 85, 204, 0.3);
    border: 1px solid var(--neon-blue);
    color: var(--neon-cyan);
    font-size: 0.8rem;
    padding: 3px 9px;
    border-radius: 10px;
    min-width: 28px;
    text-align: center;
}

.arrow { transition: transform 0.3s; font-size: 0.85rem; opacity: 0.7; }
.arrow.rotated { transform: rotate(180deg); }

/* --- MAIN CONTENT --- */
.main-content {
    flex: 1;
    margin-left: 280px;
    padding: 30px;
    position: relative;
}

/* Header Section */
.header-section {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 30px;
    background: linear-gradient(135deg, rgba(0, 85, 204, 0.1), transparent);
    border: var(--glass-border);
    border-radius: 12px;
    padding: 25px;
    backdrop-filter: blur(5px);
}

.header-info h1 { 
    font-size: 2.2rem; 
    margin-bottom: 5px; 
    text-shadow: var(--glow-blue); 
    letter-spacing: 1px; 
}
.header-info p { 
    color: var(--text-dim); 
    letter-spacing: 1px; 
    font-size: 1rem; 
}

/* HUD Top Bar */
.hud-bar { display: flex; gap: 20px; margin-bottom: 30px; }

.hud-item {
    background: var(--bg-panel);
    backdrop-filter: var(--glass-blur);
    border: var(--glass-border);
    padding: 14px 22px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 15px;
    flex: 1;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 10px rgba(0,0,0,0.25);
}

.hud-item::after {
    content: ''; position: absolute; bottom: 0; right: 0;
    width: 0; height: 0; border-style: solid;
    border-width: 0 0 10px 10px; 
    border-color: transparent transparent var(--neon-cyan) transparent;
}

.hud-icon { font-size: 1.3rem; color: var(--neon-cyan); text-shadow: var(--glow-cyan); }
.hud-text { display: flex; flex-direction: column; }
.hud-label { font-size: 0.7rem; color: var(--neon-blue); text-transform: uppercase; letter-spacing: 1px; }
.hud-value { font-size: 1.2rem; font-weight: 600; color: var(--text-main); letter-spacing: 1px; }

/* Network Pulse */
.net-status-dot {
    width: 9px; height: 9px; border-radius: 50%; background: var(--text-dim);
    box-shadow: 0 0 5px var(--text-dim); transition: 0.3s;
}
.net-status-dot.online { 
    background: var(--status-online); 
    box-shadow: 0 0 8px var(--status-online); 
    animation: pulse-green 2s infinite; 
}
.net-status-dot.offline { 
    background: var(--status-offline); 
    box-shadow: 0 0 8px var(--status-offline); 
}
.net-status-dot.checking { 
    background: var(--neon-cyan); 
    animation: blink 0.5s infinite; 
}

@keyframes pulse-green { 
    0% { box-shadow: 0 0 0 0 rgba(0, 204, 128, 0.4); } 
    70% { box-shadow: 0 0 0 10px rgba(0, 204, 128, 0); } 
    100% { box-shadow: 0 0 0 0 rgba(0, 204, 128, 0); } 
}
@keyframes blink { 
    0%, 100% { opacity: 1; } 
    50% { opacity: 0.4; } 
}

.network-popup {
    position: absolute; top: 110%; right: 0; width: 210px;
    background: #050a14; border: 1px solid var(--neon-blue); padding: 12px;
    border-radius: 6px; display: none; z-index: 50; font-size: 0.9rem;
    box-shadow: 0 5px 18px rgba(0,0,0,0.75);
}
.network-popup.show { display: block; }

/* Cards - Smaller with clear details */
.card {
    background: var(--bg-panel);
    backdrop-filter: var(--glass-blur);
    border: var(--glass-border);
    border-radius: 12px;
    padding: 22px;
    margin-bottom: 28px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.25);
}

.card-header {
    display: flex; align-items: center; gap: 10px;
    border-bottom: 1px solid rgba(0, 208, 224, 0.1);
    padding-bottom: 14px; margin-bottom: 18px;
}
.card-header h3 { color: var(--neon-cyan); text-transform: uppercase; letter-spacing: 1px; }

.form-group { margin-bottom: 22px; }
label { 
    display: block; 
    color: var(--neon-blue); 
    margin-bottom: 10px; 
    font-weight: 600; 
    text-transform: uppercase; 
}

input, select, textarea {
    width: 100%; 
    background: rgba(0, 0, 0, 0.4); 
    border: 1px solid #1a3a6e;
    color: #fff; 
    font-family: 'Rajdhani', sans-serif;
    border-radius: 6px; 
    transition: 0.3s;
}
input:focus, select:focus, textarea:focus {
    outline: none; 
    border-color: var(--neon-cyan);
    box-shadow: 0 0 10px rgba(0, 208, 224, 0.25) inset;
}
textarea { min-height: 130px; resize: vertical; }

.btn {
    background: transparent; 
    border: 1px solid var(--neon-cyan); 
    color: var(--neon-cyan);
    padding: 11px 26px; 
    cursor: pointer; 
    font-weight: 600; 
    text-transform: uppercase;
    letter-spacing: 1px; 
    transition: 0.3s; 
    font-size: 0.95rem;
    display: inline-flex; 
    align-items: center; 
    gap: 8px;
    border-radius: 4px;
}
.btn:hover { 
    background: var(--neon-cyan); 
    color: #000; 
    box-shadow: var(--glow-cyan); 
}

/* Data Grid - Compact cards */
.data-grid { 
    display: grid; 
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); 
    gap: 22px; 
}

.data-card {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(0, 208, 224, 0.12);
    border-radius: 10px; 
    padding: 20px; 
    transition: 0.3s;
    position: relative; 
    overflow: hidden;
    font-size: 1.05rem; /* larger text */
}

.data-card:hover {
    transform: translateY(-3px);
    border-color: var(--neon-cyan);
    background: rgba(0, 208, 224, 0.04);
    box-shadow: 0 5px 12px rgba(0, 208, 224, 0.1);
}

.row-wrapper {
    display: flex; justify-content: space-between; align-items: flex-start; gap: 12px;
    margin-bottom: 12px; width: 100%;
}

.inline-actions {
    display: flex; gap: 6px; opacity: 0.35; transition: opacity 0.3s;
}
.data-card:hover .inline-actions, .row-wrapper:hover .inline-actions {
    opacity: 1;
}

.action-icon {
    color: var(--text-dim);
    font-size: 0.9rem;
    cursor: pointer;
    padding: 3px;
    transition: 0.2s;
}
.action-icon:hover {
    color: var(--neon-cyan);
    text-shadow: 0 0 6px var(--neon-cyan);
    transform: scale(1.15);
}

.text-content { word-wrap: break-word; }
.data-tag {
    font-size: 0.75rem; 
    background: rgba(0, 85, 204, 0.25); 
    color: var(--neon-cyan);
    padding: 3px 9px; 
    border-radius: 5px; 
    border: 1px solid var(--neon-blue);
    display: inline-block; 
    margin-bottom: 10px; 
    text-transform: uppercase;
}
.data-title-text { 
    font-size: 1.2rem; 
    font-weight: 700; 
    color: #fff; 
    line-height: 1.35; 
}
.data-body-text { 
    font-size: 1.05rem; 
    color: var(--text-dim); 
    line-height: 1.55; 
    max-height: 110px; 
    overflow: hidden; 
}
.data-footer { 
    font-size: 0.82rem; 
    color: var(--neon-blue); 
    display: flex; 
    align-items: center; 
    gap: 6px; 
    border-top: 1px solid rgba(255,255,255,0.06); 
    padding-top: 11px; 
    margin-top: 11px;
}

.search-bar { display: flex; gap: 12px; margin-bottom: 22px; }
.search-input { flex: 1; }

/* Mobile Toggle */
.mobile-toggle {
    display: none; position: fixed; top: 20px; right: 20px;
    background: var(--bg-panel); border: 1px solid var(--neon-cyan);
    color: var(--neon-cyan); width: 48px; height: 48px; border-radius: 50%;
    align-items: center; justify-content: center; z-index: 200; backdrop-filter: blur(6px);
    font-size: 1.3rem; cursor: pointer; box-shadow: 0 0 12px rgba(0, 208, 224, 0.3);
}

/* Notification - Smaller as requested */
.notification {
    position: fixed; top: 20px; right: 20px; z-index: 1000;
    background: rgba(2, 4, 10, 0.92); 
    border-left: 3px solid var(--neon-cyan);
    padding: 12px 20px; 
    color: #fff; 
    display: flex; 
    align-items: center; 
    gap: 12px;
    transform: translateX(220%); 
    transition: transform 0.35s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 4px 16px rgba(0,0,0,0.45); 
    backdrop-filter: blur(8px);
    font-size: 0.95rem; /* slightly smaller */
    border-radius: 0 4px 4px 0;
}
.notification.show { transform: translateX(0); }

/* --- EDIT MODAL --- */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.85); backdrop-filter: blur(6px);
    z-index: 2000; display: none; align-items: center; justify-content: center;
}
.modal-overlay.show { display: flex; }

.modal-box {
    background: #060c18; 
    border: 1px solid var(--neon-cyan);
    width: 92%; 
    max-width: 520px; 
    padding: 26px;
    border-radius: 12px; 
    box-shadow: 0 0 30px rgba(0, 208, 224, 0.25);
}

.modal-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 22px; 
    border-bottom: 1px solid rgba(255,255,255,0.12); 
    padding-bottom: 12px;
}
.modal-header h3 { color: var(--neon-cyan); font-size: 1.4rem; }
.modal-close { cursor: pointer; color: var(--status-offline); font-size: 1.3rem; }

/* Responsive */
@media (max-width: 992px) {
    .sidebar { transform: translateX(-100%); width: 260px; }
    .sidebar.show { transform: translateX(0); }
    .main-content { margin-left: 0; padding: 85px 16px 16px 16px; }
    .mobile-toggle { display: flex; }
    .hud-bar { flex-direction: column; }
    .header-section { flex-direction: column; text-align: center; gap: 22px; }
    .header-info { text-align: center; }
    .inline-actions { opacity: 1; } /* Always show on mobile */
    .data-grid { grid-template-columns: 1fr !important; }
}

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>
</head>
<body>

<div class="mobile-toggle" id="mobileToggle"><i class="fas fa-bars"></i></div>

<div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="logo-area">
            <h2><i class="fas fa-network-wired"></i> NEO SYS</h2>
            <span>Dashboard V.6</span>
        </div>

        <div class="menu-label">Main Menu</div>

        <div class="nav-item active" id="navMemo">
            <div class="nav-content"><i class="fas fa-database"></i> <span>MEMO DATA</span></div>
            <i class="fas fa-chevron-down arrow" id="memoArrow"></i>
        </div>

        <div class="submenu expanded" id="memoSubmenu">
            <div class="sub-item" data-cat="MEMO PEMBAGIAN BONUS">
                <span><i class="fas fa-gift"></i> Bonus</span>
                <span class="badge" id="cntBonus">0</span>
            </div>
            <div class="sub-item" data-cat="MEMO INFORMASI BANK">
                <span><i class="fas fa-university"></i> Bank Info</span>
                <span class="badge" id="cntBank">0</span>
            </div>
            <div class="sub-item" data-cat="MEMO KENDALA PERMAINAN">
                <span><i class="fas fa-gamepad"></i> Game Issue</span>
                <span class="badge" id="cntGame">0</span>
            </div>
            <div class="sub-item" data-cat="MEMO KENDALA SISTEM">
                <span><i class="fas fa-server"></i> Sys Error</span>
                <span class="badge" id="cntSys">0</span>
            </div>
        </div>

        <div class="menu-label">Reports</div>

        <div class="nav-item" id="navReport">
            <div class="nav-content"><i class="fas fa-file-signature"></i> <span>REPORTAN</span></div>
            <span class="badge" id="cntReport">0</span>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="header-section">
            <div class="header-info">
                <h1 id="pageTitle">MEMO SYSTEM</h1>
                <p>SECURE DATA MANAGEMENT INTERFACE</p>
            </div>
            <div style="font-size: 3.2rem; color: var(--neon-cyan); opacity: 0.45;"><i class="fas fa-microchip"></i></div>
        </header>

        <div class="hud-bar">
            <div class="hud-item">
                <i class="fas fa-calendar-alt hud-icon"></i>
                <div class="hud-text">
                    <span class="hud-label">System Date</span>
                    <span class="hud-value date-text" id="dateDisplay">...</span>
                </div>
            </div>
            <div class="hud-item">
                <i class="fas fa-clock hud-icon"></i>
                <div class="hud-text">
                    <span class="hud-label">System Time</span>
                    <span class="hud-value clock-text" id="timeDisplay">00:00:00</span>
                </div>
            </div>
            <div class="hud-item" id="netWidget" style="cursor: pointer;">
                <div class="net-status-dot" id="netDot"></div>
                <div class="hud-text">
                    <span class="hud-label">Network (Auto)</span>
                    <span class="hud-value" id="pingValue">-- ms</span>
                </div>
                <i class="fas fa-wifi hud-icon"></i>
                <div class="network-popup" id="netPopup">
                    <div style="display:flex; justify-content:space-between; margin-bottom:6px;">
                        <span style="color:#8aaacc">Status:</span>
                        <span id="netStatusText" style="font-weight:bold;">Checking...</span>
                    </div>
                    <div style="display:flex; justify-content:space-between;">
                        <span style="color:#8aaacc">Latency:</span>
                        <span id="netLatencyText">--</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="card" id="formCard">
            <div class="card-header"><i class="fas fa-edit"></i> <h3>Input New Memo</h3></div>
            <form id="inputForm">
                <div class="form-group">
                    <label>Judul Data</label>
                    <input type="text" id="inpJudul" placeholder="Masukkan judul..." required autocomplete="off">
                </div>
                <div class="form-group">
                    <label>Isi Konten</label>
                    <textarea id="inpIsi" placeholder="Tulis detail informasi..." required></textarea>
                </div>
                <div class="form-group">
                    <label>Kategori</label>
                    <select id="inpCat" required>
                        <option value="">Pilih Kategori...</option>
                        <option value="MEMO PEMBAGIAN BONUS">Bonus</option>
                        <option value="MEMO INFORMASI BANK">Bank Info</option>
                        <option value="MEMO KENDALA PERMAINAN">Game Issue</option>
                        <option value="MEMO KENDALA SISTEM">System Error</option>
                    </select>
                </div>
                <button type="submit" class="btn"><i class="fas fa-save"></i> Simpan Data</button>
            </form>
        </div>

        <div class="card" id="listCard" style="display: none;">
            <div class="card-header">
                <div style="display:flex; align-items:center; gap:10px;">
                    <i class="fas fa-list"></i> <h3 id="listTitle">Database</h3>
                </div>
            </div>
            
            <div class="search-bar">
                <input type="text" id="searchBox" class="search-input" placeholder="Cari data...">
                <button class="btn" id="btnClearSearch" style="border-color:var(--text-dim); color:var(--text-dim); padding: 11px 16px;"><i class="fas fa-times"></i></button>
            </div>

            <div class="data-grid" id="gridContainer">
                <!-- Data will be rendered here -->
            </div>
        </div>
    </main>
</div>

<!-- Notification (small) -->
<div class="notification" id="notify">
    <i class="fas fa-check-circle" style="color:var(--status-online); font-size:1.1rem;"></i>
    <span id="notifyMsg">Operasi Berhasil</span>
</div>

<!-- EDIT MODAL -->
<div class="modal-overlay" id="editModal">
    <div class="modal-box">
        <div class="modal-header">
            <h3><i class="fas fa-pen"></i> Edit Data</h3>
            <i class="fas fa-times modal-close" id="closeModal"></i>
        </div>
        <form id="editForm">
            <input type="hidden" id="editId">
            <div class="form-group">
                <label>Judul</label>
                <input type="text" id="editJudul" required>
            </div>
            <div class="form-group">
                <label>Isi</label>
                <textarea id="editIsi" style="min-height:160px;" required></textarea>
            </div>
            <div style="display:flex; gap:12px; justify-content:flex-end; margin-top:15px;">
                <button type="button" class="btn" style="border-color:var(--status-offline); color:var(--status-offline);" id="cancelEdit">Batal</button>
                <button type="submit" class="btn">Simpan Perubahan</button>
            </div>
        </form>
    </div>
</div>

<script>
// === CONFIGURASI ===
// ⚠️ GANTI DENGAN URL WEB APP ANDA DARI GOOGLE APPS SCRIPT
const SCRIPT_URL = 'https://script.google.com/macros/s/YOUR_DEPLOYED_WEB_APP_URL/exec';

// === STATE ===
let DB = [];
let currentView = 'memo';
let currentCat = '';
let searchQuery = '';

// === DOM ===
const els = {
    navMemo: document.getElementById('navMemo'),
    navReport: document.getElementById('navReport'),
    memoSub: document.getElementById('memoSubmenu'),
    arrow: document.getElementById('memoArrow'),
    formCard: document.getElementById('formCard'),
    listCard: document.getElementById('listCard'),
    pageTitle: document.getElementById('pageTitle'),
    grid: document.getElementById('gridContainer'),
    listTitle: document.getElementById('listTitle'),
    inpForm: document.getElementById('inputForm'),
    notify: document.getElementById('notify'),
    notifyMsg: document.getElementById('notifyMsg'),
    timeDisp: document.getElementById('timeDisplay'),
    dateDisp: document.getElementById('dateDisplay'),
    netDot: document.getElementById('netDot'),
    pingVal: document.getElementById('pingValue'),
    netPopup: document.getElementById('netPopup'),
    netStatTxt: document.getElementById('netStatusText'),
    netLatTxt: document.getElementById('netLatencyText'),
    netWidget: document.getElementById('netWidget'),
    editModal: document.getElementById('editModal'),
    editForm: document.getElementById('editForm'),
    editJudul: document.getElementById('editJudul'),
    editIsi: document.getElementById('editIsi'),
    closeModal: document.getElementById('closeModal'),
    cancelEdit: document.getElementById('cancelEdit'),
    searchBox: document.getElementById('searchBox'),
    btnClearSearch: document.getElementById('btnClearSearch')
};

// === UTILITIES ===
function showNotify(msg) {
    els.notifyMsg.textContent = msg;
    els.notify.classList.add('show');
    setTimeout(() => els.notify.classList.remove('show'), 2800);
}

function updateClock() {
    const now = new Date();
    els.timeDisp.textContent = now.toLocaleTimeString('id-ID', { hour12: false });
    if (now.getSeconds() === 0) {
        els.dateDisp.textContent = now.toLocaleDateString('id-ID', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
    }
}

function pingNetwork() {
    els.netDot.className = 'net-status-dot checking';
    els.pingVal.textContent = '...';
    if (!navigator.onLine) {
        updateNetUI(null, false);
        return;
    }
    const start = performance.now();
    const img = new Image();
    const timeout = setTimeout(() => {
        if (!img.complete) updateNetUI(null, false);
    }, 5000);
    img.onload = () => {
        clearTimeout(timeout);
        updateNetUI(Math.round(performance.now() - start), true);
    };
    img.onerror = () => {
        clearTimeout(timeout);
        updateNetUI(null, false);
    };
    img.src = "https://www.google.com/favicon.ico?t=" + Date.now();
}

function updateNetUI(ms, isOnline) {
    if (!isOnline) {
        els.netDot.className = 'net-status-dot offline';
        els.pingVal.textContent = 'OFF';
        els.netStatTxt.textContent = 'DISCONNECTED';
        els.netStatTxt.style.color = 'var(--status-offline)';
        els.netLatTxt.textContent = '--';
    } else {
        els.netDot.className = 'net-status-dot online';
        els.pingVal.textContent = ms + ' ms';
        els.netLatTxt.textContent = ms + ' ms';
        els.netStatTxt.textContent = (ms < 200) ? 'STABLE' : 'SLOW';
        els.netStatTxt.style.color = (ms < 200) ? 'var(--status-online)' : 'var(--neon-cyan)';
    }
}

// === GOOGLE SHEETS INTEGRATION ===
async function fetchData() {
    try {
        const res = await fetch(`${SCRIPT_URL}?action=read`);
        const text = await res.text();
        const cleanText = text.replace(/^while\(1\);/, '').trim();
        const rawData = JSON.parse(cleanText);
        DB = rawData.map(row => ({
            id: parseInt(row[0]),
            category: row[1],
            subcategory: row[2],
            judul: row[3],
            isi: row[4],
            timestamp: row[5]
        }));
        renderData();
        updateBadges();
    } catch (err) {
        console.error('Fetch error:', err);
        showNotify("Gagal memuat data dari server");
    }
}

async function saveData(data, action = 'create') {
    const formData = new FormData();
    formData.append('action', action);
    formData.append('data', JSON.stringify(data));
    try {
        const res = await fetch(SCRIPT_URL, { method: 'POST', body: formData });
        if (res.ok) {
            await fetchData();
        } else {
            throw new Error('Server error');
        }
    } catch (err) {
        showNotify("Gagal menyimpan ke server");
    }
}

// === UI ===
function updateBadges() {
    const counts = {
        'cntBonus': 'MEMO PEMBAGIAN BONUS',
        'cntBank': 'MEMO INFORMASI BANK',
        'cntGame': 'MEMO KENDALA PERMAINAN',
        'cntSys': 'MEMO KENDALA SISTEM'
    };
    for (const [id, cat] of Object.entries(counts)) {
        document.getElementById(id).textContent = DB.filter(i => i.category === 'memo' && i.subcategory === cat).length;
    }
    document.getElementById('cntReport').textContent = DB.filter(i => i.category === 'report').length;
}

function renderData() {
    let filtered = DB.filter(item => {
        let catMatch = false;
        if (currentView === 'memo' && currentCat) {
            catMatch = (item.category === 'memo' && item.subcategory === currentCat);
        } else if (currentView === 'report') {
            catMatch = (item.category === 'report');
        }
        let searchMatch = true;
        if (searchQuery) {
            const q = searchQuery.toLowerCase();
            searchMatch = item.judul.toLowerCase().includes(q) || item.isi.toLowerCase().includes(q);
        }
        return catMatch && searchMatch;
    });

    if (filtered.length === 0) {
        els.grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:45px;color:var(--text-dim);">
            <i class="fas fa-database" style="font-size:2.2rem;margin-bottom:12px;opacity:0.6;"></i><br>TIDAK ADA DATA
        </div>`;
        return;
    }

    filtered.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

    els.grid.innerHTML = filtered.map(item => {
        const date = new Date(item.timestamp).toLocaleString('id-ID');
        const tagColor = item.category === 'report' ? 'border-color:var(--status-offline);color:var(--status-offline)' : '';
        const tagText = item.category === 'report' ? 'REPORT' : 'MEMO';
        return `
        <div class="data-card">
            <span class="data-tag" style="${tagColor}">${tagText}</span>
            <div class="row-wrapper">
                <div class="text-content data-title-text">${item.judul}</div>
                <div class="inline-actions">
                    <i class="fas fa-copy action-icon" onclick="copyText('${item.judul.replace(/'/g, "\\'").replace(/\n/g, "\\n")}', 'Judul')" title="Copy Judul"></i>
                    <i class="fas fa-pen action-icon" onclick="openEdit(${item.id}, 'judul')" title="Edit Judul"></i>
                </div>
            </div>
            <div class="row-wrapper" style="align-items:flex-start;">
                <div class="text-content data-body-text">${item.isi}</div>
                <div class="inline-actions" style="margin-top:4px;">
                    <i class="fas fa-copy action-icon" onclick="copyText(\`${item.isi.replace(/`/g, "\\`").replace(/\n/g, "\\n")}\`, 'Isi')" title="Copy Isi"></i>
                    <i class="fas fa-pen action-icon" onclick="openEdit(${item.id}, 'isi')" title="Edit Isi"></i>
                </div>
            </div>
            <div class="data-footer"><i class="far fa-clock"></i> ${date}</div>
        </div>
        `;
    }).join('');
}

// === GLOBAL FUNCTIONS ===
window.copyText = function(text, type) {
    navigator.clipboard.writeText(text).then(() => {
        showNotify(`${type} Berhasil Disalin!`);
    }).catch(() => showNotify("Gagal menyalin text"));
};

window.openEdit = function(id, focusField) {
    const item = DB.find(i => i.id === id);
    if (!item) return;
    document.getElementById('editId').value = id;
    els.editJudul.value = item.judul;
    els.editIsi.value = item.isi;
    els.editModal.classList.add('show');
    setTimeout(() => {
        const field = focusField === 'judul' ? els.editJudul : els.editIsi;
        field.focus();
        field.select();
    }, 100);
};

function closeEditModal() {
    els.editModal.classList.remove('show');
    els.editForm.reset();
}

// === EVENT LISTENERS ===
document.getElementById('mobileToggle').addEventListener('click', () => {
    document.getElementById('sidebar').classList.toggle('show');
});

els.navMemo.addEventListener('click', (e) => {
    if (e.target.closest('.arrow')) {
        els.memoSub.classList.toggle('expanded');
        els.arrow.classList.toggle('rotated');
    } else {
        switchView('memo');
    }
});

document.querySelectorAll('.sub-item').forEach(item => {
    item.addEventListener('click', () => switchView('memo', item.dataset.cat));
});

els.navReport.addEventListener('click', () => switchView('report'));

els.inpForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const judul = els.inpJudul.value.trim();
    const isi = els.inpIsi.value.trim();
    const cat = els.inpCat.value;
    if (!cat) return showNotify("Pilih kategori!");
    if (!judul || !isi) return showNotify("Lengkapi semua field!");
    const newData = {
        id: Date.now(),
        category: 'memo',
        subcategory: cat,
        judul,
        isi,
        timestamp: new Date().toISOString()
    };
    await saveData(newData, 'create');
    els.inpForm.reset();
    showNotify("Data Berhasil Disimpan ke Server");
});

els.editForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const id = parseInt(document.getElementById('editId').value);
    const item = DB.find(i => i.id === id);
    if (!item) return;
    item.judul = els.editJudul.value.trim();
    item.isi = els.editIsi.value.trim();
    await saveData(item, 'update');
    closeEditModal();
    showNotify("Data Diperbarui di Server");
});

els.searchBox.addEventListener('input', (e) => {
    searchQuery = e.target.value;
    renderData();
});

els.btnClearSearch.addEventListener('click', () => {
    searchQuery = '';
    els.searchBox.value = '';
    renderData();
});

function switchView(view, subCat = '') {
    currentView = view;
    currentCat = subCat;
    searchQuery = '';
    els.searchBox.value = '';
    document.querySelectorAll('.nav-item, .sub-item').forEach(n => n.classList.remove('active'));
    if (view === 'memo' && !subCat) {
        els.navMemo.classList.add('active');
        els.memoSub.classList.add('expanded');
        els.arrow.classList.remove('rotated');
        els.pageTitle.textContent = "MEMO SYSTEM";
        els.formCard.style.display = 'block';
        els.listCard.style.display = 'none';
    } else if (view === 'memo' && subCat) {
        els.navMemo.classList.add('active');
        els.memoSub.classList.add('expanded');
        els.arrow.classList.remove('rotated');
        document.querySelector(`.sub-item[data-cat="${subCat}"]`).classList.add('active');
        els.pageTitle.textContent = subCat;
        els.formCard.style.display = 'none';
        els.listCard.style.display = 'block';
        els.listTitle.innerHTML = `<i class="fas fa-folder-open"></i> DATA: ${subCat}`;
        renderData();
    } else if (view === 'report') {
        els.navReport.classList.add('active');
        els.pageTitle.textContent = "REPORT LOGS";
        els.formCard.style.display = 'none';
        els.listCard.style.display = 'block';
        els.listTitle.innerHTML = `<i class="fas fa-file-signature"></i> REPORTAN`;
        renderData();
    }
    if (window.innerWidth <= 992) document.getElementById('sidebar').classList.remove('show');
}

// === INIT ===
els.closeModal.addEventListener('click', closeEditModal);
els.cancelEdit.addEventListener('click', closeEditModal);
els.netWidget.addEventListener('click', () => {
    els.netPopup.classList.toggle('show');
    pingNetwork();
});

setInterval(updateClock, 1000);
setInterval(pingNetwork, 30000);
updateClock();

// Load data from Google Sheets
fetchData();
</script>
</body>
</html>

