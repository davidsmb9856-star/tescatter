<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#00c6d7" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5.1.1/dist/tesseract.min.js"></script>
  <title>Aplikasi Catatan Futuristik</title>
  <style>

html {
  scroll-behavior: smooth;
}

html::-webkit-scrollbar { 
  width: 5px; 
}

*::-webkit-scrollbar-track {
  background: rgba(0, 0, 20, 0.4);
  border-radius: 5px;
}

*::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, #33FFFF, #0044FF);
  border-radius: 5px;
  box-shadow: 0 0 10px #00E5FF88;
}

*::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(180deg, #33FFFF, #0055FF);
  box-shadow: 0 0 15px #33FFFFaa;
}

body {
  margin: 0;
  padding: 30px;
  transition: background 0.8s ease-in-out;
  background-attachment: fixed;
  background-size: cover;
  font-family: 'Orbitron', 'Segoe UI', sans-serif;
}

body.bg-default,
body.bg-deepspace {
  background-repeat: no-repeat;
  background-position: center center;
  color: #33FFFF;
}

body.bg-default {
  background-image: url('https://wallpapercave.com/wp/wp9046775.jpg');
}

body.bg-deepspace {
  background-image: url('https://4kwallpapers.com/images/walls/thumbs_3t/19856.jpg');
}

body.bg-gradient {
  background-image: url('https://cdn.areabermain.club/assets/cdn/az6/2026/01/08/20260108/0e9b0ec9a88ad88a5935bc5802bc41a5/linetogel-background-07januari2026.jpg');
}

/* === CUSTOM DROPDOWN MODERN NEON === */
.custom-select {
  position: relative;
  display: block;
  width: 100%;
  margin-bottom: 18px;
}

.custom-select select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  width: 100%;
  padding: 12px 48px 12px 18px;
  font-size: 16px;
  font-weight: bold;
  color: #33FFFF;
  background: rgba(0, 10, 30, 0.85);
  border: 2px solid #00E5FF;
  border-radius: 14px;
  outline: none;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 0 10px rgba(0, 229, 255, 0.4);
  backdrop-filter: blur(8px);
  font-family: 'Orbitron', sans-serif;
}

.custom-select::after {
  content: "▼";
  position: absolute;
  top: 50%;
  right: 18px;
  transform: translateY(-50%);
  color: #33FFFF;
  font-size: 14px;
  pointer-events: none;
  text-shadow: 0 0 6px #00E5FF;
}

.custom-select select:hover {
  background: rgba(0, 20, 50, 0.9);
  border-color: #33FFFF;
  box-shadow: 0 0 18px rgba(0, 255, 255, 0.7);
  transform: translateY(-2px);
}

.custom-select select:focus {
  border-color: #00FFFF;
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.9);
  background: rgba(0, 30, 60, 0.95);
  animation: neonPulseSelect 1.5s infinite alternate;
}

@keyframes neonPulseSelect {
  0%, 100% { box-shadow: 0 0 10px rgba(0, 229, 255, 0.5); }
  50% { box-shadow: 0 0 20px rgba(0, 255, 255, 0.8); }
}

.background-switcher {
  margin: 20px;
  text-align: right;
}

.background-switcher select {
  width: 100%;
  padding: 10px 36px 10px 14px;
  margin-bottom: 18px;
  font-size: 14px;
  font-weight: bold;
  border: none;
  border-radius: 14px;
  background: rgba(0, 29, 61, 0.9);
  color: #00E5FF;
  cursor: pointer;
  appearance: none;
  box-shadow: 0 0 12px rgba(0, 229, 255, 0.4);
  backdrop-filter: blur(8px);
  border: 1px solid rgba(0, 229, 255, 0.6);
  transition: all 0.3s ease;
  background-image: url("image/svg+xml,%3Csvg fill='%2333FFFF' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Cpath d='M5.23 7.21a.75.75 0 011.06.02L10 11.292l3.71-4.06a.75.75 0 111.08 1.04l-4.25 4.65a.75.75 0 01-1.08 0L5.21 8.27a.75.75 0 01.02-1.06z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 16px;
}

.background-switcher select:focus {
  outline: none;
  border-color: #00E5FF;
  box-shadow: 0 0 15px #00E5FF;
  animation: pulse 1s infinite alternate;
}

@keyframes pulse {
  from { box-shadow: 0 0 10px #00E5FF; }
  to { box-shadow: 0 0 20px #00E5FF; }
}

:root {
  --bg-dark: #001020;
  --bg-galaxy: rgba(0, 0, 50, 0.7);
  --bg-galaxy-section: linear-gradient(135deg, rgba(0,0,40,0.7), rgba(0,30,60,0.6));
  --bg-input: rgba(0,10,30,0.8);
  --bg-input-dark: #021222;
  --txt-main: #00ffff;
  --txt-highlight: #66ffff;
  --txt-shadow: 1px 1px 2px black;
  --border-galaxy: rgba(0, 191, 255, 0.7);
  --btn-glow: #00bfff;
  --shadow-glow: rgba(0, 255, 255, 0.2);
  --accent-neon: #00ffff;
  --neon-blue: #00ffff;
  --neon-green: #00ff00;
  --neon-yellow: #ffff00;
  --neon-red: #ff0000;
  --panel-bg: rgba(0, 10, 30, 0.6);
  --panel-border: rgba(0, 229, 255, 0.4);
  --panel-shadow: rgba(0, 229, 255, 0.2);
  --text-main: #00ffff;
}

/* === RESET & BODY === */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

    .sidebar-brand {
      text-align: center;
      margin-bottom: 18px;
      position: relative;
      z-index: 2;
    }

    .sidebar-brand h2 {
      margin: 0;
      font-size: 24px;
      background: linear-gradient(90deg, #00ffff, #ff00ff, #00ffff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-size: 200% 200%;
      animation: neonTitle 3s ease infinite;
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.7);
    }

.brand-sub {
  font-size: 12px;
  color: #00E5FF;
  text-shadow: 0 0 6px #00E5FF66;
}

    .planet-icon {
      margin-bottom: 12px;
      display: flex;
      justify-content: center;
    }

    .main-container {
      display: flex;
      flex-direction: row;
      gap: 25px;
      padding: 20px;
      align-items: flex-start;
      justify-content: flex-start;
      flex-wrap: wrap;
      min-height: 100vh;
    }

    .sidebar-container {
      backdrop-filter: blur(20px);
      background: rgba(0, 10, 30, 0.75);
      border-radius: 22px;
      padding: 28px 22px;
      width: 100%;
      max-width: 290px;
      box-shadow: 0 0 45px rgba(0, 229, 255, 0.3);
      display: flex;
      flex-direction: column;
      gap: 22px;
      border: 1px solid rgba(0, 229, 255, 0.5);
      animation: fadeIn 0.8s ease-in;
      position: relative;
      overflow: hidden;
      height: fit-content;
      align-self: flex-start;
      top: 20px;
    }

        .sidebar-container::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(0, 229, 255, 0.15) 0%, transparent 70%);
      animation: rotateGalaxy 40s linear infinite;
      z-index: -1;
      opacity: 0.7;
    }

@keyframes spin {
  to { transform: rotate(360deg); }
}

    @keyframes rotateGalaxy {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .sidebar-brand {
      text-align: center;
      margin-bottom: 18px;
      position: relative;
      z-index: 2;
    }

    .sidebar-brand h2 {
      margin: 0;
      font-size: 24px;
      background: linear-gradient(90deg, #00ffff, #ff00ff, #00ffff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-size: 200% 200%;
      animation: neonTitle 3s ease infinite;
      text-shadow: 0 0 10px rgba(0, 255, 255, 0.7);
    }

    
.neon-button {
  background: linear-gradient(135deg, rgba(0,229,255,0.15), rgba(0,100,255,0.15));
  color: #33FFFF;
  border: 1px solid rgba(0,229,255,0.4);
  padding: 14px 20px;
  font-size: 15px;
  border-radius: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: flex-start;
  gap: 12px;
  box-shadow: 0 0 10px rgba(0,229,255,0.1);
  position: relative;
  overflow: hidden;
}

.neon-button::after {
  content: "";
  position: absolute;
  top: 0; left: -100%;
  width: 100%; height: 100%;
  background: linear-gradient(120deg, transparent, rgba(0,229,255,0.4), transparent);
  transition: 0.4s;
}

.neon-button:hover::after {
  left: 100%;
}

.neon-button:hover {
  background: rgba(0,229,255,0.25);
  color: #33FFFF;
  transform: translateX(5px) scale(1.03);
  box-shadow: 0 0 15px #00E5FF, 0 0 25px #00E5FF66;
}

.neon-button span {
  flex: 1;
  font-weight: 500;
}
/* === KONTEN AREA === */
    .content-area {
      flex: 1;
      min-width: 300px;
      background: rgba(0, 15, 35, 0.65);
      backdrop-filter: blur(12px);
      padding: 28px;
      border-radius: 22px;
      color: var(--text-main);
      box-shadow: 
        0 0 30px rgba(0, 229, 255, 0.3),
        0 0 50px rgba(100, 0, 255, 0.2);
      border: 1px solid rgba(0, 229, 255, 0.4);
      animation: fadeIn 0.8s ease-in;
      position: relative;
      overflow: hidden;
      min-height: calc(100vh - 40px);
    }

    .content-area::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        linear-gradient(145deg, rgba(0, 30, 60, 0.2) 0%, transparent 60%),
        radial-gradient(circle at top right, rgba(0, 200, 255, 0.1) 0%, transparent 40%),
        radial-gradient(circle at bottom left, rgba(157, 80, 255, 0.15) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }
/* === JAM DIGITAL === */
    #clock {
      color: var(--neon-blue);
      text-align: center;
      margin: 15px 0 20px;
      font-weight: bold;
      font-size: 22px;
      font-family: 'Orbitron', sans-serif;
      letter-spacing: 1.5px;
      text-shadow:
        0 0 8px var(--neon-blue),
        0 0 15px var(--neon-blue),
        0 0 25px rgba(0, 255, 255, 0.5);
      background: rgba(0, 20, 40, 0.6);
      padding: 10px;
      border-radius: 14px;
      border: 1px solid rgba(0, 229, 255, 0.6);
      box-shadow: 0 0 15px rgba(0, 229, 255, 0.4);
      animation: pulseClock 2s infinite alternate;
    }

    @keyframes pulseClock {
      0%, 100% { box-shadow: 0 0 10px rgba(0, 229, 255, 0.5), 0 0 20px rgba(0, 255, 255, 0.3); }
      50% { box-shadow: 0 0 18px rgba(0, 229, 255, 0.8), 0 0 30px rgba(0, 255, 255, 0.6); }
    }

/* === INPUT === */
input[type="text"],
input[type="number"],
textarea {
  width: 88%;
  padding: 6px;
  margin-bottom: 8px;
  border-radius: 5px;
  border: 1px solid #00E5FF;
  background: #001122;
  color: #33FFFF;
  font-size: 15px;
  font-weight: bold;
}

input:focus,
textarea:focus {
  box-shadow: 0 0 10px #00E5FF;
  outline: none;
}

textarea {
  width: 100%;
  min-height: 100px;
  padding: 8px;
  border-radius: 6px;
  border: none;
  font-weight: bold;
  resize: vertical;
}

.input-textarea,
#freespinTextarea,
.bonus-textarea {
  width: 100%;
  min-height: 140px;
  background: var(--bg-input);
  color: var(--txt-highlight);
  border: 1.5px solid #00f7ff;
  border-radius: 12px;
  padding: 15px;
  font-family: monospace;
  font-size: 15px;
  box-sizing: border-box;
  resize: vertical;
  white-space: pre-wrap;
  word-break: break-word;
  box-shadow: inset 0 0 10px #00f7ff22;
}

/* === NOTE ITEM === */
.note-item {
  white-space: pre-wrap;
  font-weight: bold;
  background: rgba(0, 0, 20, 0.55);
  padding: 20px;
  margin-bottom: 15px;
  border-radius: 14px;
  border: 1px solid #00E5FF;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 0 8px #00E5FF55, 0 0 20px #00E5FF22;
  will-change: transform, box-shadow;
}

.note-item:hover {
  background: rgba(0, 0, 50, 0.5);
  transform: translateY(-5px) scale(1.02);
  box-shadow: 0 0 12px #33FFFFaa, 0 0 28px #33FFFF55;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

    .judul-glow {
      font-size: 32px;
      text-align: center;
      padding: 15px 25px;
      color: var(--neon-blue);
      text-shadow: 
        0 0 10px var(--neon-blue),
        0 0 20px var(--neon-blue),
        0 0 35px rgba(0, 255, 255, 0.7);
      border: 2px solid rgba(0, 229, 255, 0.5);
      border-radius: 18px;
      background: rgba(0, 20, 45, 0.6);
      backdrop-filter: blur(10px);
      margin-bottom: 25px;
      position: relative;
      overflow: hidden;
      letter-spacing: 1.5px;
      font-family: 'Orbitron', sans-serif;
      font-weight: 800;
    }

    .judul-glow::after {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(0, 255, 255, 0.2), transparent);
      animation: rotateGlow 8s linear infinite;
      z-index: -1;
    }

    @keyframes rotateGlow {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

/* === PREVIEW ISI CATATAN — UKURAN LEBIH KECIL === */
.note-content-preview {
  color: var(--accent-cyan);
  font-size: 16px; /* ↓ dari 20px */
  font-weight: 600; /* ↓ dari 700 */
  line-height: 1.5;
  text-shadow:
    0 0 4px rgba(0, 198, 215, 0.7),
    0 0 10px rgba(0, 198, 215, 0.5);
  white-space: pre-wrap;
  word-break: break-word;
  letter-spacing: 0.2px;
  font-family: 'Exo 2', sans-serif;
  background: rgba(0, 30, 60, 0.3);
  padding: 3px 6px;
  border-radius: 4px;
  transition: all 0.25s ease;
}

.note-content-preview:hover {
  text-shadow:
    0 0 6px rgba(0, 198, 215, 0.9),
    0 0 16px rgba(185, 103, 255, 0.6);
}

/* === KARTU CATATAN — AUTO-WIDTH + UKURAN RINGKAS === */
.note-card {
  background: var(--panel-bg);
  padding: 22px; /* ↓ dari 32px */
  width: 100%;
  max-width: none; /* ✅ MENGISI SELURUH LEBAR TAB */
  margin: 0 0 24px; /* ↓ jarak bawah */
  color: var(--txt-main);
  border-radius: 18px; /* ↓ dari 24px */
  box-shadow:
    0 0 15px var(--panel-shadow),
    inset 0 0 8px rgba(0, 50, 100, 0.3);
  backdrop-filter: blur(12px) saturate(180%);
  -webkit-backdrop-filter: blur(12px) saturate(180%);
  word-break: break-word;
  font-weight: 500;
  transition: all 0.35s cubic-bezier(0.25, 0.8, 0.25, 1.2);
  position: relative;
  overflow: hidden;
  border: 1px solid var(--panel-border);
  font-family: 'Exo 2', sans-serif;
  box-sizing: border-box;
}

.note-card:hover {
  transform: translateY(-4px); /* ↓ dari -6px */
  box-shadow:
    0 8px 25px rgba(0, 198, 215, 0.4),
    0 0 30px rgba(185, 103, 255, 0.3),
    inset 0 0 12px rgba(0, 100, 200, 0.4);
  background: rgba(10, 20, 50, 0.9);
  cursor: pointer;
}

/* === GLOWING SIDE ACCENT — CYAN SAJA (LEBIH PROFESIONAL) === */
.note-card::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 4px; /* ↓ dari 6px */
  height: 100%;
  background: linear-gradient(to bottom, var(--accent-cyan), var(--accent-purple));
  box-shadow: 0 0 8px var(--accent-cyan), 0 0 16px var(--accent-purple);
  border-radius: 0 6px 6px 0;
  animation: cyberPulseGlow 2.5s infinite alternate;
}

@keyframes cyberPulseGlow {
  0%, 100% { opacity: 0.7; }
  50% { opacity: 1; box-shadow: 0 0 12px var(--accent-cyan), 0 0 24px var(--accent-purple); }
}

/* === JUDUL CATATAN — UKURAN LEBIH KECIL === */
.note-card .note-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 20px; /* ↓ dari 26px */
  font-weight: 800;
  color: var(--accent-cyan);
  text-shadow:
    0 0 8px rgba(0, 198, 215, 0.8),
    0 0 16px rgba(185, 103, 255, 0.6);
  margin: 0 0 16px; /* ↓ dari 22px */
  letter-spacing: 1px; /* ↓ dari 1.4px */
  text-align: center;
  padding-bottom: 12px; /* ↓ dari 16px */
  border-bottom: 1px solid rgba(0, 198, 215, 0.3);
  background: rgba(0, 30, 60, 0.2);
  position: relative;
}

.note-card .note-title::after {
  content: "";
  position: absolute;
  bottom: -3px;
  left: 30%;
  width: 40%;
  height: 2px;
  background: var(--accent-cyan);
  border-radius: 2px;
}

/* === ISI PARAGRAF — UKURAN LEBIH KECIL & RINGKAS === */
.note-detail p {
  margin-bottom: 12px; /* ↓ dari 16px */
  font-size: 14px; /* ↓ dari 16px */
  color: var(--txt-highlight);
  text-shadow: 0 0 2px rgba(0, 198, 215, 0.3);
  white-space: pre-wrap;
  word-break: break-word;
  line-height: 1.6; /* ↓ dari 1.8 */
  letter-spacing: 0.4px;
  font-weight: 500;
  transition: color 0.25s ease;
}

.note-card:hover .note-detail p {
  color: #b2ebf2;
}

/* === TOMBOL AKSI — LEBIH RAMPING === */
.note-card button,
.copy-button {
  background: rgba(0, 30, 60, 0.6);
  color: var(--txt-main);
  border: 1px solid var(--panel-border);
  padding: 8px 14px; /* ↓ dari 10px 18px */
  font-size: 13px; /* ↓ dari 14px */
  font-weight: 600;
  border-radius: 10px; /* ↓ dari 12px */
  cursor: pointer;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 6px; /* ↓ dari 8px */
  box-shadow: 0 0 6px rgba(0, 198, 215, 0.2);
  margin: 4px 4px 4px 0; /* ↓ dari 6px */
  font-family: 'Exo 2', sans-serif;
  position: relative;
  overflow: hidden;
}

.note-card button:hover,
.copy-button:hover {
  background: rgba(0, 40, 80, 0.8);
  transform: translateY(-2px);
  box-shadow:
    0 0 12px rgba(0, 198, 215, 0.6),
    0 0 20px rgba(185, 103, 255, 0.4);
  border-color: var(--accent-cyan);
}

/* === RESPONSIVE MOBILE === */
@media (max-width: 768px) {
  .note-card {
    padding: 18px 16px;
    margin: 0 8px 20px;
  }
  
  .note-card .note-title {
    font-size: 18px;
    letter-spacing: 0.8px;
  }
  
  .note-detail p {
    font-size: 13px;
    line-height: 1.5;
  }
  
  .note-card button,
  .copy-button {
    padding: 6px 12px;
    font-size: 12px;
  }
}

/* === TOMBOL DI DALAM KARTU === */
    .copy-button, .sticky-add-button {
      background: linear-gradient(145deg, rgba(0, 229, 255, 0.3), rgba(0, 100, 255, 0.3));
      color: var(--neon-blue);
      border: 1px solid rgba(0, 229, 255, 0.65);
      padding: 9px 18px;
      font-size: 14px;
      font-weight: 700;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin: 6px 4px;
      box-shadow:
        0 0 10px rgba(0, 229, 255, 0.4),
        inset 0 0 8px rgba(0, 229, 255, 0.3);
      text-shadow: 0 0 3px rgba(0, 255, 255, 0.8);
    }

    .copy-button:hover, .sticky-add-button:hover {
      background: linear-gradient(145deg, rgba(0, 255, 255, 0.5), rgba(0, 150, 255, 0.5));
      transform: translateY(-2px) scale(1.05);
      box-shadow:
        0 0 18px rgba(0, 255, 255, 0.8),
        inset 0 0 12px rgba(0, 255, 255, 0.5);
    }

/* GALERI FOTO */
  .foto-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 22px;
      padding: 10px;
    }

    .foto-card {
      background: rgba(0, 15, 35, 0.75);
      border-radius: 18px;
      overflow: hidden;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(0, 229, 255, 0.25);
      transition: all 0.4s ease;
      border: 1px solid rgba(0, 229, 255, 0.3);
      position: relative;
      display: flex;
      flex-direction: column;
    }

    .foto-card:hover {
      transform: translateY(-8px) scale(1.03);
      box-shadow: 0 12px 35px rgba(0, 255, 255, 0.45);
      border-color: var(--neon-blue);
    }

    .foto-card img {
      width: 100%;
      height: 240px;
      object-fit: contain;
      object-position: center;
      display: block;
      background-color: #000;
      transition: transform 0.5s ease;
      border-bottom: 1px solid rgba(0, 229, 255, 0.3);
    }

    .foto-card:hover img {
      transform: scale(1.05);
    }

    .foto-title {
      padding: 12px;
      text-align: center;
      font-weight: 700;
      font-size: 16px;
      color: var(--neon-blue);
      text-shadow: 0 0 6px var(--neon-blue), 0 0 12px rgba(0, 255, 255, 0.7);
      background: rgba(0, 10, 30, 0.7);
      border-top: 1px solid rgba(0, 229, 255, 0.3);
    }

/* === TAB MENU === */
.tab-menu {
  display: flex;
  background: #111;
  border-radius: 10px;
}

.tab-button {
  flex: 1;
  padding: 8px 15px;
  background: #0a0a0a;
  color: #00E5FF;
  border: none;
  font-size: 20px;
  font-weight: bold;
  cursor: pointer;
  text-transform: uppercase;
  letter-spacing: 1px;
  border-radius: 10px;
  transition: all 0.3s ease;
  box-shadow: 0 0 6px #00E5FF44, 0 0 12px #00E5FF22 inset;
}

.tab-button:hover {
  background: #001b26;
  color: #D6FFFF;
  box-shadow: 0 0 10px #33FFFF, 0 0 18px #33FFFF, 0 0 25px #33FFFF;
  transform: scale(1.03);
}

.tab-button.active {
  background: linear-gradient(to right, #005f88, #00E5FF);
  color: #33FFFF;
  box-shadow: 0 0 12px #33FFFF, 0 0 24px #33FFFF, 0 0 36px #33FFFF;
  transform: scale(1.06);
}

.tab-content {
  display: none;
  flex: 1;
}

.tab-content.active {
  display: block;
}

/* === TEKS COPYABLE === */
.copy-text {
  display: inline-block;
  margin-top: 5px;
  cursor: pointer;
  color: #33FFFF;
  background: rgba(255,255,255,0.05);
  padding: 6px 12px;
  border-radius: 6px;
  font-family: monospace;
  transition: background 0.2s;
}

.copy-text:hover {
  background: rgba(255,255,255,0.1);
}

/* === TOAST NOTIFICATION === */
#toastNotif {
  position: fixed;
  bottom: 32px;
  right: 32px;
  z-index: 9999;
  background: rgba(0, 20, 45, 0.92);
  color: var(--cyber-neon);
  padding: 16px 28px;
  border-radius: 20px;
  font-weight: 700;
  font-size: 17px;
  font-family: 'Exo 2', sans-serif;
  box-shadow: 
    0 0 25px rgba(0, 243, 255, 0.7),
    0 0 45px rgba(157, 0, 255, 0.4);
  display: none;
  border: 1.5px solid var(--cyber-neon);
  backdrop-filter: blur(10px);
  transform: translateX(200px) scale(0.9);
  animation: toastSequence 3.2s forwards;
  max-width: 380px;
  text-align: center;
}
@keyframes toastSequence {
  0% { transform: translateX(200px) scale(0.9); opacity: 0; }
  15% { transform: translateX(0) scale(1.05); opacity: 1; }
  85% { transform: translateX(0) scale(1); opacity: 1; }
  100% { transform: translateX(200px) scale(0.95); opacity: 0; }
}

/* === FAB BUTTON === */
#stickyFab {
  position: fixed;
  bottom: 28px;
  right: 28px;
  width: 64px;
  height: 64px;
  background: radial-gradient(circle at 30% 30%, #00ffff, #0077ff);
  color: #000;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  z-index: 1001;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  font-weight: bold;
  box-shadow:
    0 0 12px rgba(0, 255, 255, 0.8),
    0 0 28px rgba(0, 191, 255, 0.6),
    inset 0 0 10px rgba(255, 255, 255, 0.3);
  transition: all 0.35s cubic-bezier(0.25, 0.8, 0.25, 1.2);
  animation: cyberPulseGlow 2.8s infinite alternate;
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
}

#stickyFab:hover {
  transform: scale(1.15) rotate(12deg);
  background: radial-gradient(circle at 70% 70%, #00ffcc, #00bfff);
  box-shadow:
    0 0 20px rgba(0, 255, 255, 1),
    0 0 40px rgba(0, 191, 255, 0.8),
    inset 0 0 15px rgba(255, 255, 255, 0.5);
}

#stickyFab:active {
  transform: scale(0.95);
}

@keyframes cyberPulseGlow {
  0%, 100% {
    box-shadow:
      0 0 12px rgba(0, 255, 255, 0.8),
      0 0 28px rgba(0, 191, 255, 0.6);
  }
  50% {
    box-shadow:
      0 0 24px rgba(0, 255, 255, 1),
      0 0 50px rgba(157, 0, 255, 0.7);
  }
}

/* === CYBERPUNK STICKY PANEL === */
#stickyPanel {
  position: fixed;
  bottom: 100px;
  right: 28px;
  width: 680px;
  max-width: 92vw;
  min-width: 420px;
  min-height: 180px;
  background: rgba(4, 12, 32, 0.88);
  border: 2px solid rgba(0, 255, 255, 0.6);
  border-radius: 20px;
  padding: 24px;
  display: none;
  z-index: 1000;
  max-height: 88vh;
  overflow: auto;
  resize: both;
  animation: panelSlideIn 0.45s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
  backdrop-filter: blur(14px) saturate(180%);
  -webkit-backdrop-filter: blur(14px) saturate(180%);
  box-shadow:
    0 10px 30px rgba(0, 0, 0, 0.6),
    inset 0 0 12px rgba(0, 100, 200, 0.4);
}

@keyframes panelSlideIn {
  from {
    opacity: 0;
    transform: translateY(20px) scale(0.95);
    filter: blur(2px);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
    filter: blur(0);
  }
}

/* === INPUT & BUTTONS === */
#stickyInput {
  width: 100%;
  min-height: 60px;
  background: rgba(0, 15, 40, 0.75);
  color: #00ffff;
  border: 1.5px solid rgba(0, 255, 255, 0.5);
  border-radius: 14px;
  padding: 14px;
  margin-bottom: 16px;
  font-family: 'Exo 2', monospace;
  font-size: 15px;
  font-weight: 600;
  resize: vertical;
  transition: all 0.3s ease;
  box-shadow: inset 0 0 8px rgba(0, 100, 200, 0.3);
}

#stickyInput:focus {
  outline: none;
  border-color: #00ffff;
  box-shadow:
    inset 0 0 12px rgba(0, 200, 255, 0.6),
    0 0 15px rgba(0, 255, 255, 0.4);
  background: rgba(0, 20, 50, 0.85);
}

#stickyPanel button {
  width: auto;
  min-width: 140px;
  background: linear-gradient(145deg, rgba(0, 255, 255, 0.25), rgba(0, 150, 255, 0.25));
  color: #00ffff;
  border: 1.5px solid rgba(0, 255, 255, 0.6);
  padding: 10px 20px;
  border-radius: 14px;
  margin: 0 8px 16px 0;
  cursor: pointer;
  font-weight: 700;
  font-size: 15px;
  transition: all 0.3s ease;
  box-shadow:
    0 0 8px rgba(0, 255, 255, 0.3),
    inset 0 0 6px rgba(0, 200, 255, 0.2);
}

#stickyPanel button:hover {
  background: rgba(0, 255, 255, 0.35);
  transform: translateY(-2px) scale(1.03);
  box-shadow:
    0 0 16px rgba(0, 255, 255, 0.8),
    inset 0 0 10px rgba(0, 255, 255, 0.4);
}

/* === STICKY NOTE ITEMS === */
#stickyList div {
  position: relative;
  white-space: pre-wrap;
  background: rgba(6, 20, 50, 0.85);
  border: 1.5px solid rgba(0, 255, 255, 0.4);
  color: #66ffff;
  border-radius: 16px;
  padding: 16px 20px 16px 20px;
  margin-bottom: 14px;
  word-wrap: break-word;
  font-size: 15px;
  font-weight: 600;
  line-height: 1.6;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow:
    0 4px 12px rgba(0, 0, 0, 0.4),
    inset 0 0 8px rgba(0, 50, 100, 0.3);
}

#stickyList div:hover {
  transform: translateY(-3px);
  border-color: #00ffff;
  box-shadow:
    0 6px 18px rgba(0, 255, 255, 0.3),
    inset 0 0 12px rgba(0, 100, 200, 0.4);
  background: rgba(8, 25, 60, 0.92);
}

.sticky-delete,
.sticky-edit {
  position: absolute;
  top: 12px;
  font-size: 18px;
  font-weight: bold;
  cursor: pointer;
  opacity: 0.7;
  transition: all 0.25s ease;
}

.sticky-delete {
  right: 16px;
  color: #ff0066;
  text-shadow: 0 0 6px rgba(255, 0, 102, 0.8);
}

.sticky-edit {
  right: 48px;
  color: #00ffaa;
  text-shadow: 0 0 6px rgba(0, 255, 170, 0.8);
}

.sticky-delete:hover,
.sticky-edit:hover {
  opacity: 1;
  transform: scale(1.2);
}

/* === STICKY IMAGES === */
#stickyList img {
  display: block;
  margin: 12px auto;
  max-width: 45%;
  max-height: 140px;
  height: auto;
  object-fit: contain;
  border-radius: 12px;
  border: 1.5px solid rgba(0, 255, 255, 0.3);
  box-shadow:
    0 4px 12px rgba(0, 0, 0, 0.4),
    0 0 10px rgba(0, 200, 255, 0.2);
  transition: transform 0.3s ease;
}

#stickyList img:hover {
  transform: scale(1.04);
  box-shadow:
    0 6px 16px rgba(0, 255, 255, 0.4),
    0 0 15px rgba(0, 255, 255, 0.3);
}

/* === SELECT DROPDOWN === */
.quantum-input-card,
.quantum-card {
  background: rgba(6, 18, 45, 0.75);
  border-radius: 20px;
  padding: 24px;
  color: #00ffff;
  position: relative;
  overflow: hidden;
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
  border: 1px solid rgba(0, 243, 255, 0.3);
  box-shadow:
    0 0 16px rgba(0, 243, 255, 0.2),
    inset 0 0 10px rgba(0, 50, 100, 0.4);
  transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1.2);
}

.quantum-card:hover {
  transform: translateY(-5px) scale(1.01);
  box-shadow:
    0 12px 35px rgba(0, 243, 255, 0.4),
    0 0 30px rgba(157, 0, 255, 0.3),
    inset 0 0 18px rgba(0, 100, 200, 0.5);
  background: rgba(10, 28, 60, 0.9);
}

.quantum-card::before {
  content: "";
  position: absolute;
  top: 0; left: 0;
  width: 5px; height: 100%;
  background: linear-gradient(to bottom, #00f3ff, #9d00ff);
  box-shadow: 0 0 12px #00f3ff, 0 0 24px #9d00ff;
  animation: quantumPulse 2.4s infinite alternate;
}

@keyframes quantumPulse {
  0%, 100% { opacity: 0.7; }
  50% { opacity: 1; box-shadow: 0 0 18px #00f3ff, 0 0 36px #9d00ff; }
}

/* === HEADER CARD === */
.quantum-card-header {
  display: flex;
  align-items: center;
  gap: 14px;
  margin-bottom: 20px;
}

.quantum-icon {
  font-size: 26px;
  color: #00f3ff;
  text-shadow: 0 0 8px rgba(0, 243, 255, 0.9);
  animation: float 3s ease-in-out infinite;
}

.quantum-card-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 22px;
  font-weight: 800;
  color: #00f3ff;
  text-shadow:
    0 0 6px rgba(0, 243, 255, 0.8),
    0 0 14px rgba(0, 229, 255, 0.5);
  letter-spacing: 1.2px;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}

/* === INPUT FIELD === */
.quantum-input {
  width: 100%;
  padding: 14px 18px;
  font-size: 16px;
  font-weight: 700;
  color: #00ffff;
  background: rgba(0, 20, 50, 0.7);
  border: 1.5px solid rgba(0, 243, 255, 0.5);
  border-radius: 14px;
  outline: none;
  transition: all 0.3s ease;
  font-family: 'Exo 2', sans-serif;
  box-shadow: inset 0 0 8px rgba(0, 50, 100, 0.3);
}

.quantum-input:focus {
  border-color: #00f3ff;
  box-shadow:
    inset 0 0 12px rgba(0, 200, 255, 0.6),
    0 0 18px rgba(0, 243, 255, 0.6);
}

/* === BUTTONS === */
.quantum-btn {
  background: linear-gradient(145deg, rgba(0, 243, 255, 0.25), rgba(0, 150, 255, 0.25));
  color: #00ffff;
  border: 1.5px solid rgba(0, 243, 255, 0.6);
  padding: 12px 22px;
  font-size: 15px;
  font-weight: 700;
  border-radius: 16px;
  cursor: pointer;
  transition: all 0.35s ease;
  box-shadow:
    0 0 10px rgba(0, 243, 255, 0.4),
    inset 0 0 6px rgba(0, 243, 255, 0.2);
  text-shadow: 0 0 3px rgba(0, 255, 255, 0.8);
}

.quantum-btn:hover {
  background: rgba(0, 243, 255, 0.35);
  transform: translateY(-2px) scale(1.03);
  box-shadow:
    0 0 18px rgba(0, 243, 255, 0.8),
    inset 0 0 10px rgba(0, 255, 255, 0.4);
}

/* === DROPDOWN === */
.quantum-dropdown {
  width: 100%;
  padding: 14px 20px 14px 48px;
  font-size: 16px;
  font-weight: 700;
  color: #00ffff;
  background: rgba(0, 15, 40, 0.7);
  border: 1.5px solid rgba(0, 243, 255, 0.5);
  border-radius: 14px;
  outline: none;
  cursor: pointer;
  position: relative;
  transition: all 0.3s ease;
  font-family: 'Exo 2', sans-serif;
  backdrop-filter: blur(6px);
  box-shadow: inset 0 0 8px rgba(0, 50, 100, 0.3);
}

.quantum-dropdown::after {
  content: "▼";
  position: absolute;
  right: 20px;
  top: 50%;
  transform: translateY(-50%);
  color: #00f3ff;
  font-size: 14px;
  font-weight: bold;
  text-shadow: 0 0 6px rgba(0, 243, 255, 0.9);
}

/* === DETAIL BOX === */
.quantum-detail-box {
  background: rgba(0, 10, 30, 0.6);
  border: 1.5px solid rgba(0, 243, 255, 0.4);
  border-radius: 12px;
  padding: 18px;
  margin-top: 16px;
  font-size: 15px;
  line-height: 1.6;
  white-space: pre-wrap;
  word-break: break-word;
  color: #66ffff;
  text-shadow: 0 0 3px rgba(0, 243, 255, 0.4);
  transition: all 0.3s ease;
  font-family: 'Exo 2', monospace;
}

.quantum-detail-box:hover {
  background: rgba(0, 20, 50, 0.7);
  border-color: #00f3ff;
  box-shadow: 0 0 12px rgba(0, 243, 255, 0.3);
}

/* === DUAL GRID === */
.quantum-dual-grid {
  display: flex;
  gap: 24px;
  margin-top: 20px;
}

.quantum-subcard {
  flex: 1;
  min-width: 220px;
}

.quantum-subtitle {
  display: block;
  margin-bottom: 12px;
  font-weight: 700;
  color: #00ffff;
  font-size: 16px;
  text-shadow: 0 0 4px rgba(0, 243, 255, 0.6);
}

/* === MODAL OCR === */
.quantum-modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(2, 8, 20, 0.96);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  flex-direction: row;
  gap: 24px;
  padding: 24px;
  box-sizing: border-box;
  backdrop-filter: blur(12px);
}

.quantum-modal-close {
  position: absolute;
  top: 24px; left: 50%;
  transform: translateX(-50%);
  font-size: 32px;
  color: #00f3ff;
  cursor: pointer;
  user-select: none;
  font-weight: bold;
  text-shadow: 0 0 8px cyan;
  z-index: 10000;
  transition: all 0.3s ease;
}

.quantum-modal-close:hover {
  transform: translateX(-50%) rotate(12deg) scale(1.1);
  color: #ff0066;
  text-shadow: 0 0 12px #ff0066;
}

.quantum-modal-grid {
  display: flex;
  gap: 24px;
  max-width: 95vw;
  max-height: 90vh;
}

.quantum-modal-image-container {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
}

.quantum-modal-image {
  max-width: 95%;
  max-height: 85vh;
  border-radius: 14px;
  box-shadow: 0 0 30px rgba(0, 243, 255, 0.6);
  border: 2px solid rgba(0, 243, 255, 0.4);
}

.quantum-modal-result {
  flex: 1;
  color: #00ffff;
  font-family: 'Exo 2', monospace;
  font-weight: 600;
  white-space: pre-wrap;
  background: rgba(0, 25, 60, 0.8);
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 0 20px rgba(0, 243, 255, 0.4);
  max-height: 85vh;
  overflow-y: auto;
  font-size: 14px;
  border: 1px solid rgba(0, 243, 255, 0.3);
}

/* === HR & GROUP STYLES === */
.quantum-hr {
  margin: 32px 0;
  border: 0;
  border-top: 1px solid rgba(0, 243, 255, 0.4);
  box-shadow: 0 0 10px rgba(0, 243, 255, 0.2);
}

.quantum-nominal-group {
  display: flex;
  align-items: center;
  gap: 16px;
  flex-wrap: wrap;
}

.quantum-dropdown-group {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-top: 16px;
}

/* === RESPONSIVE === */
@media (max-width: 768px) {
  .quantum-dual-grid {
    flex-direction: column;
  }
  .quantum-modal-grid {
    flex-direction: column;
    align-items: center;
  }
  .quantum-modal-image {
    max-width: 100%;
    max-height: 50vh;
  }
}

/* === SEARCH BAR LAYOUT === */
    .search-bar {
      margin: 20px 0 25px;
      text-align: center;
    }

    #searchInput, .pasaran-search, .input-tanggal {
      width: 100%;
      max-width: 500px;
      padding: 14px 20px;
      margin: 0 auto;
      background: rgba(0, 20, 45, 0.75);
      border: 2px solid rgba(0, 229, 255, 0.6);
      border-radius: 16px;
      color: var(--neon-blue);
      font-size: 16px;
      font-weight: bold;
      text-align: center;
      box-shadow: 0 0 15px rgba(0, 229, 255, 0.4);
      transition: all 0.3s ease;
      font-family: 'Orbitron', sans-serif;
    }

    #searchInput:focus, .pasaran-search:focus, .input-tanggal:focus {
      outline: none;
      border-color: var(--neon-blue);
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.7), 0 0 35px rgba(0, 229, 255, 0.5);
      background: rgba(0, 25, 55, 0.85);
    }

/* === COMPACT DATE FORM — REPLACES .quantum-date-form === */
#formTanggal {
  display: none;
  background: rgba(6, 18, 45, 0.75);
  border-radius: 16px;
  padding: 16px;
  display: flex;
  align-items: center;
  gap: 14px;
  max-width: 420px;
  border: 1px solid rgba(0, 243, 255, 0.3);
  box-shadow:
    0 0 12px rgba(0, 243, 255, 0.2),
    inset 0 0 8px rgba(0, 50, 100, 0.4);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  transition: all 0.3s ease;
  margin-top: 12px;
}

#formTanggal:hover {
  transform: translateY(-2px);
  box-shadow:
    0 0 18px rgba(0, 243, 255, 0.4),
    inset 0 0 12px rgba(0, 100, 200, 0.5);
  background: rgba(10, 28, 60, 0.85);
}

/* === DATE-SPECIFIC INPUT === */
.quantum-date-input {
  width: 150px;
  padding: 10px 12px;
  font-size: 15px;
  color: #00ffff;
  background: rgba(0, 20, 50, 0.7);
  border: 1.5px solid rgba(0, 243, 255, 0.5);
  border-radius: 10px;
  outline: none;
  text-align: center;
  font-family: 'Exo 2', sans-serif;
  transition: all 0.3s ease;
  box-shadow: inset 0 0 6px rgba(0, 50, 100, 0.3);
}

.quantum-date-input:focus {
  border-color: #00f3ff;
  box-shadow:
    inset 0 0 10px rgba(0, 200, 255, 0.6),
    0 0 15px rgba(0, 243, 255, 0.5);
}

/* === DATE BUTTON (SMALLER) === */
.quantum-date-btn {
  background: linear-gradient(145deg, rgba(0, 243, 255, 0.25), rgba(0, 150, 255, 0.25));
  color: #00ffff;
  border: 1.5px solid rgba(0, 243, 255, 0.6);
  padding: 8px 16px;
  font-size: 14px;
  font-weight: 700;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow:
    0 0 8px rgba(0, 243, 255, 0.4),
    inset 0 0 5px rgba(0, 243, 255, 0.2);
  text-shadow: 0 0 2px rgba(0, 255, 255, 0.8);
}

.quantum-date-btn:hover {
  background: rgba(0, 243, 255, 0.35);
  transform: scale(1.05);
  box-shadow:
    0 0 14px rgba(0, 243, 255, 0.7),
    inset 0 0 8px rgba(0, 255, 255, 0.4);
}

/* === DATE LABEL === */
.quantum-date-label {
  font-size: 15px;
  font-weight: 700;
  color: #00ffff;
  white-space: nowrap;
  text-shadow: 0 0 4px rgba(0, 243, 255, 0.6);
}

/* === INPUT LINK GAMBAR — RAPI & RESPONSIF === */
#membacaIsiFoto_input {
  width: 100%;
  max-width: 600px;
  padding: 12px 16px;
  background-color: rgba(0, 20, 40, 0.6);
  color: #00ffff;
  border: 1.5px solid #00ffff;
  border-radius: 12px;
  font-size: 15px;
  font-family: 'Courier New', monospace;
  box-shadow: 0 0 10px #00ffff66;
  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1.2);
  outline: none;
}

#membacaIsiFoto_input:focus {
  background-color: rgba(0, 20, 40, 0.85);
  box-shadow: 0 0 20px #00ffffaa;
  border-color: #00ffff;
}

/* === MODAL OCR UTAMA === */
#membacaIsiFoto_modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 20, 0.92);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  z-index: 9999;
  justify-content: center;
  align-items: flex-start;
  flex-direction: row;
  gap: 24px;
  padding: 30px;
  box-sizing: border-box;
  overflow-y: auto;
  flex-wrap: wrap;
}

/* === TOMBOL TUTUP — STABIL, BULAT, RESPONSIF === */
#membacaIsiFoto_tombolTutup {
  position: absolute;
  top: 24px;
  right: 24px;
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
  color: #00ffff;
  cursor: pointer;
  user-select: none;
  font-weight: bold;
  text-shadow: 0 0 10px cyan;
  transition: all 0.25s cubic-bezier(0.25, 0.8, 0.25, 1.2);
  z-index: 10001;
  background: rgba(0, 10, 30, 0.7);
  border: 2px solid rgba(0, 255, 255, 0.6);
  border-radius: 50%;
  box-shadow: 0 0 12px #00ffff66;
}

#membacaIsiFoto_tombolTutup:hover {
  transform: scale(1.15) rotate(90deg);
  color: #ff0066;
  text-shadow: 0 0 12px #ff0099;
  background: rgba(20, 0, 40, 0.85);
  border-color: #ff0066;
  box-shadow: 0 0 20px #ff006688;
}

#membacaIsiFoto_tombolTutup:active {
  transform: scale(0.95);
}

/* === GAMBAR OCR === */
#membacaIsiFoto_gambar {
  max-width: 100%;
  max-height: 75vh;
  border-radius: 14px;
  box-shadow: 0 0 30px cyan;
  transition: transform 0.3s ease-in-out;
  object-fit: contain;
  border: 1px solid rgba(0, 255, 255, 0.3);
}

#membacaIsiFoto_gambar:hover {
  transform: scale(1.02);
}

/* === HASIL OCR === */
#membacaIsiFoto_hasil {
  color: #00ffff;
  font-family: 'Courier New', monospace;
  font-weight: bold;
  white-space: pre-wrap;
  background: rgba(0, 40, 60, 0.75);
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 0 25px #00ffff88;
  max-height: 75vh;
  overflow-y: auto;
  font-size: 15px;
  flex: 1;
  min-width: 320px;
  border: 1px solid rgba(0, 255, 255, 0.4);
  line-height: 1.6;
}

/* === ZOOMABLE IMAGE PREVIEW === */
.zoomable-image {
  width: 100%;
  max-width: 300px;
  height: auto;
  cursor: zoom-in;
  border-radius: 12px;
  transition: transform 0.25s cubic-bezier(0.25, 0.8, 0.25, 1.2);
  box-shadow: 0 0 12px rgba(0, 255, 255, 0.6);
  border: 1.5px solid rgba(0, 255, 255, 0.4);
}

.zoomable-image:hover {
  transform: scale(1.06);
}

/* === MODAL OCR — RESPONSIF === */
@media (max-width: 768px) {
  #membacaIsiFoto_modal {
    flex-direction: column;
    align-items: center;
    padding: 16px;
    gap: 16px;
  }

  #membacaIsiFoto_gambar,
  #membacaIsiFoto_hasil {
    max-height: 45vh;
    min-width: auto;
    width: 100%;
  }

  #membacaIsiFoto_tombolTutup {
    top: 16px;
    right: 16px;
    width: 44px;
    height: 44px;
    font-size: 26px;
  }
}

/* === SCATTER LIGHTBOX (CLEANUP) === */
#scatterLightbox {
  display: none;
  position: fixed;
  z-index: 9999;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 0, 0.92);
  backdrop-filter: blur(8px);
  align-items: center;
  justify-content: center;
}

#scatterLightbox img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 14px;
  box-shadow: 0 0 30px rgba(0, 255, 255, 0.7);
  border: 2px solid rgba(0, 255, 255, 0.5);
}

/* ================== BONUS SECTION — GAYA MODERN 2026 ================== */
.bonus-section {
  background: var(--bg-galaxy-section);
  padding: 25px;
  border-radius: 20px;
  box-shadow: 0 0 25px var(--panel-shadow);
  max-width: 1200px;
  margin: 50px auto;
  border: 1px solid var(--panel-border);
  backdrop-filter: blur(12px) saturate(180%);
  -webkit-backdrop-filter: blur(12px) saturate(180%);
}

.bonus-title {
  font-family: 'Orbitron', sans-serif;
  color: var(--accent-cyan);
  font-size: 22px;
  text-align: center;
  text-shadow: 
    0 0 6px rgba(0, 198, 215, 0.7),
    0 0 12px rgba(0, 198, 215, 0.4);
  margin-bottom: 20px;
  font-weight: bold;
}

/* ================== INPUT GROUP ================== */
.bonus-input-group {
  display: flex;
  flex-direction: column;
  margin-bottom: 12px;
}

.bonus-label {
  color: var(--txt-main);
  font-weight: 600;
  font-size: 13px;
  margin-bottom: 4px;
  text-shadow: 0 0 4px rgba(0, 198, 215, 0.5);
}

.bonus-input {
  padding: 10px;
  border-radius: 10px;
  border: 1px solid var(--accent-cyan);
  background-color: var(--bg-input);
  color: var(--txt-main);
  font-weight: 500;
  font-size: 14px;
  box-shadow: inset 0 0 6px rgba(0, 198, 215, 0.2);
  white-space: pre-wrap;
  word-break: break-word;
  font-family: monospace;
}

/* ================== TOMBOL AKSI — KONSISTEN DENGAN NEON-BUTTON ================== */
.bonus-button-group,
.freespin-button-group,
.action-buttons-group {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-top: 18px;
  flex-wrap: wrap;
}

/* Gunakan class yang sudah ada: .neon-button */
.bonus-btn,
.freespin-btn,
.btn-action,
.btn-copy-large,
.btn-copy-small,
.btn-save,
.btn-edit,
.btn-cancel {
  /* Hapus semua style lama — warisi dari .neon-button */
  all: unset;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 10px 18px;
  font-size: 14px;
  font-weight: 600;
  border-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
  background: linear-gradient(135deg, rgba(0, 198, 215, 0.15), rgba(0, 100, 200, 0.15));
  color: var(--txt-main);
  border: 1px solid rgba(0, 198, 215, 0.3);
  box-shadow: 0 0 8px rgba(0, 198, 215, 0.1);
  position: relative;
  overflow: hidden;
}

.bonus-btn::after,
.freespin-btn::after,
.btn-action::after,
.btn-copy-large::after,
.btn-copy-small::after,
.btn-save::after,
.btn-edit::after,
.btn-cancel::after {
  content: "";
  position: absolute;
  top: 0; left: -100%;
  width: 100%; height: 100%;
  background: linear-gradient(120deg, transparent, rgba(0, 198, 215, 0.3), transparent);
  transition: 0.4s;
}

.bonus-btn:hover::after,
.freespin-btn:hover::after,
.btn-action:hover::after,
.btn-copy-large:hover::after,
.btn-copy-small:hover::after,
.btn-save:hover::after,
.btn-edit:hover::after,
.btn-cancel:hover::after {
  left: 100%;
}

.bonus-btn:hover,
.freespin-btn:hover,
.btn-action:hover,
.btn-copy-large:hover,
.btn-copy-small:hover,
.btn-save:hover,
.btn-edit:hover,
.btn-cancel:hover {
  background: rgba(0, 198, 215, 0.25);
  transform: translateY(-2px) scale(1.03);
  box-shadow: 0 0 15px rgba(0, 198, 215, 0.6), 0 0 25px rgba(0, 198, 215, 0.3);
}

/* Tombol bahaya (hapus/batal) — tetap merah, tapi lebih halus */
.bonus-btn.danger,
.freespin-btn.danger,
.btn-action.btn-cancel {
  background: linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(204, 0, 0, 0.2));
  border-color: rgba(255, 107, 107, 0.4);
  color: #ff8a8a;
  box-shadow: 0 0 8px rgba(255, 107, 107, 0.2);
}

.bonus-btn.danger:hover,
.freespin-btn.danger:hover,
.btn-action.btn-cancel:hover {
  background: rgba(255, 107, 107, 0.3);
  color: white;
  box-shadow: 0 0 15px rgba(255, 107, 107, 0.5);
}

/* ================== BONUS RESULT ================== */
.bonus-result {
  margin-top: 20px;
  padding: 18px;
  border-radius: 16px;
  background: rgba(5, 25, 50, 0.7);
  border: 1px solid rgba(0, 198, 215, 0.25);
  box-shadow: 
    0 0 15px rgba(0, 198, 215, 0.2),
    inset 0 0 10px rgba(0, 198, 215, 0.1);
  font-family: 'Courier New', monospace;
  color: var(--txt-highlight);
  font-size: 15px;
  font-weight: 600;
  white-space: pre-wrap;
  word-break: break-word;
  text-shadow: 0 0 4px rgba(0, 198, 215, 0.5);
  backdrop-filter: blur(8px);
}

.bonus-angka {
  font-size: 22px;
  font-weight: 900;
  color: var(--accent-cyan);
  text-shadow: 
    0 0 8px rgba(0, 198, 215, 0.8),
    0 0 20px rgba(0, 198, 215, 0.5);
  display: inline-block;
  margin-left: 6px;
  transition: color 0.3s ease;
}

/* SCROLLBAR CUSTOM NEON */
#notesList::-webkit-scrollbar,
#reportLineCardContainer::-webkit-scrollbar,
#chatHistory::-webkit-scrollbar {
  width: 5px;
  height: 5px;
}

#notesList::-webkit-scrollbar-track,
#reportLineCardContainer::-webkit-scrollbar-track,
#chatHistory::-webkit-scrollbar-track {
  background: rgba(0, 0, 20, 0.3);
  border-radius: 5px;
  box-shadow: inset 0 0 6px rgba(0,255,255,0.1);
}

#notesList::-webkit-scrollbar-thumb,
#reportLineCardContainer::-webkit-scrollbar-thumb,
#chatHistory::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, #00f0ff, #0044ff);
  border-radius: 5px;
  box-shadow: 0 0 12px #00f0ff55, 0 0 18px #0044ff55;
  transition: all 0.3s ease;
}

#notesList::-webkit-scrollbar-thumb:hover,
#reportLineCardContainer::-webkit-scrollbar-thumb:hover,
#chatHistory::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(180deg, #00ffff, #0055ff);
  box-shadow: 0 0 18px #00ffffaa, 0 0 28px #0055ff55;
  transform: scaleX(1.2);
}

/* list container */
#notesList,
#reportLineCardContainer {
  max-height: 80vh;
  overflow-y: auto;
  padding-bottom: 20px;
  padding-right: 15px;
  scroll-behavior: smooth;
}

/* === PANEL UTAMA — RESPONSIVE AUTO-WIDTH === */
#pengaturanTab {
  background: 
    radial-gradient(circle at 15% 20%, rgba(0, 30, 60, 0.15), transparent 25%),
    radial-gradient(circle at 85% 80%, rgba(80, 0, 120, 0.12), transparent 25%),
    rgba(4, 12, 32, 0.92);
  color: #00f3ff;
  border-radius: 20px;
  padding: 24px;
  /* AUTO-WIDTH: sesuaikan layar, batas maksimal 1200px */
  width: 95%;
  max-width: 1200px;
  margin: 20px auto;
  overflow-x: auto;
  font-weight: 600;
  font-family: 'Exo 2', sans-serif;
  backdrop-filter: blur(12px) saturate(180%);
  -webkit-backdrop-filter: blur(12px) saturate(180%);
  position: relative;
  overflow: hidden;
  border: 1px solid rgba(0, 243, 255, 0.4);
  box-shadow:
    0 0 0 1px rgba(157, 0, 255, 0.15),
    0 8px 30px rgba(0, 0, 0, 0.7),
    inset 0 0 12px rgba(0, 50, 100, 0.4);
}

/* === SIDE GLOW DYNAMIC === */
#pengaturanTab::before {
  content: "";
  position: absolute;
  top: 0; left: 0;
  width: 4px; height: 100%;
  background: linear-gradient(to bottom, #00f3ff, #9d00ff, #00f3ff);
  box-shadow: 0 0 12px #00f3ff, 0 0 24px #9d00ff;
  animation: quantumPulseGlow 2.8s infinite alternate;
}

@keyframes quantumPulseGlow {
  0%, 100% { opacity: 0.75; }
  50% { opacity: 1; box-shadow: 0 0 18px #00f3ff, 0 0 36px #9d00ff; }
}

/* === JUDUL UTAMA — NEON ORBITRON === */
#pengaturanTab h3 {
  margin-top: 0;
  font-size: 28px;
  color: transparent;
  text-align: center;
  font-family: 'Orbitron', sans-serif;
  letter-spacing: 1.4px;
  margin-bottom: 26px;
  background: linear-gradient(90deg, #00f3ff, #9d00ff, #00f3ff);
  background-size: 300% 300%;
  -webkit-background-clip: text;
  background-clip: text;
  animation: neonTextFlow 4s ease infinite;
}

#pengaturanTab h3::after {
  content: "";
  position: absolute;
  bottom: -10px;
  left: 25%; width: 50%;
  height: 2px;
  background: linear-gradient(90deg, transparent, #00f3ff, transparent);
  border-radius: 2px;
}

@keyframes neonTextFlow {
  0%, 100% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
}

/* === ACCORDION HEADER — COMPACT CYBER === */
#pengaturanTab h4 {
  margin: 18px 0 10px 0;
  color: #66ffff;
  font-size: 20px;
  font-family: 'Orbitron', sans-serif;
  cursor: pointer;
  padding: 12px 16px 12px 42px;
  background: rgba(0, 25, 60, 0.75);
  border-radius: 14px;
  display: flex;
  align-items: center;
  gap: 12px;
  position: relative;
  border: 1px solid rgba(0, 243, 255, 0.25);
  transition: all 0.3s ease;
}

#pengaturanTab h4::before {
  content: "▶";
  position: absolute;
  left: 16px;
  font-size: 14px;
  color: #00f3ff;
  transition: transform 0.3s ease;
}

#pengaturanTab h4.active::before {
  transform: rotate(90deg);
}

#pengaturanTab h4:hover {
  background: rgba(0, 35, 80, 0.85);
  color: #00f3ff;
  border-color: rgba(0, 243, 255, 0.4);
  transform: translateX(3px);
  box-shadow: 0 0 15px rgba(0, 243, 255, 0.4);
}

/* === KENDALA ACCORDION === */
#pengaturanTab h5.kendala-accordion {
  margin: 14px 0;
  padding: 12px 16px;
  background: rgba(0, 30, 70, 0.8);
  border: 1px solid rgba(0, 243, 255, 0.35);
  border-radius: 16px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.3s ease;
  font-weight: 700;
  font-size: 16px;
}

#pengaturanTab h5.kendala-accordion::before {
  content: "";
  position: absolute;
  top: 0; left: 0;
  width: 3px; height: 100%;
  background: linear-gradient(to bottom, #00f3ff, #9d00ff);
  opacity: 0.6;
}

#pengaturanTab h5.kendala-accordion:hover {
  background: rgba(0, 45, 100, 0.92);
  transform: translateX(3px);
  border-color: #00f3ff;
  box-shadow: 0 0 18px rgba(0, 243, 255, 0.4);
}

/* === TABEL — NEON GRID === */
#pengaturanTab table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 10px;
  margin-bottom: 22px;
  background: rgba(0, 20, 50, 0.7);
  border-radius: 16px;
  overflow: hidden;
  border: 1px solid rgba(0, 243, 255, 0.25);
}

#pengaturanTab table th,
#pengaturanTab table td {
  padding: 14px 18px;
  text-align: left;
  font-weight: 600;
  font-size: 15px;
  background: rgba(0, 15, 40, 0.8);
  white-space: pre-wrap;
  word-break: break-word;
}

#pengaturanTab table th {
  color: #00f3ff;
  text-shadow: 0 0 8px rgba(0, 243, 255, 0.8);
  background: rgba(0, 25, 60, 0.85);
  font-family: 'Orbitron', sans-serif;
  font-size: 16px;
}

/* === INPUT FIELD === */
#pengaturanTab table td input,
#pengaturanTab .editable-cell,
#pengaturanTab .link-live-item {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid rgba(0, 243, 255, 0.5);
  border-radius: 10px;
  background: rgba(0, 25, 60, 0.8);
  color: #00f3ff;
  font-weight: 600;
  font-size: 14px;
  font-family: 'Exo 2', monospace;
  outline: none;
  min-height: 36px;
}

#pengaturanTab table td input:focus,
#pengaturanTab .editable-cell:focus,
#pengaturanTab .link-live-item:focus {
  border-color: #00f3ff;
  background: rgba(0, 35, 80, 0.9);
  box-shadow: 0 0 15px rgba(0, 243, 255, 0.5);
}

/* Kolom deskripsi */
#pengaturanTab table tr td:nth-child(2) input {
  min-width: 320px;
  max-width: 500px;
}

/* Kolom aksi kecil */
#pengaturanTab table tr td:nth-child(4) .editable-cell,
#pengaturanTab table tr td:nth-child(5) .editable-cell {
  min-width: 120px;
  max-width: 180px;
  font-size: 14px;
}

/* === TOMBOL AKSI — MINIMALIS & BERLABEL === */
.row-save-btn,
.settings-neon-btn {
  padding: 6px 14px;
  border-radius: 8px;
  border: 1px solid rgba(0, 243, 255, 0.5);
  background: rgba(0, 30, 60, 0.7);
  color: #00f3ff;
  font-weight: 600;
  font-size: 12px;
  cursor: pointer;
  height: 28px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  transition: all 0.25s ease;
  font-family: 'Exo 2', sans-serif;
  white-space: nowrap;
}

.row-save-btn:hover,
.settings-neon-btn:hover {
  background: rgba(0, 50, 100, 0.85);
  border-color: #00f3ff;
  transform: translateY(-1px);
  box-shadow: 0 0 8px rgba(0, 243, 255, 0.4);
}

/* === PANEL TERSEMBUNYI === */
.panel,
.kendala-panel {
  display: none;
  padding: 20px;
  margin-top: 12px;
  background: rgba(0, 20, 50, 0.75);
  border: 1px solid rgba(0, 243, 255, 0.35);
  border-radius: 0 0 18px 18px;
}

/* === RESPONSIVE MOBILE === */
@media (max-width: 768px) {
  #pengaturanTab {
    width: 95%;
    padding: 18px 14px;
    margin: 15px 10px;
    border-radius: 16px;
  }
  
  #pengaturanTab h3 {
    font-size: 24px;
    letter-spacing: 1px;
  }
  
  #pengaturanTab h4 {
    font-size: 18px;
    padding: 10px 14px 10px 38px;
  }
  
  #pengaturanTab table th,
  #pengaturanTab table td {
    padding: 10px 12px;
    font-size: 13px;
  }
  
  .row-save-btn,
  .settings-neon-btn {
    padding: 5px 12px;
    font-size: 11px;
    height: 26px;
  }
  
  #pengaturanTab table tr td:nth-child(2) input {
    min-width: 280px;
    max-width: 100%;
  }
}

/* Efek hover tombol */
.sidebar-container .neon-button:first-child:hover {
  background: rgba(0, 255, 255, 0.2);
  transform: scale(1.1);
  box-shadow: 0 0 15px #0ff, 0 0 30px #0cc;
}

/* Tooltip text */
.sidebar-container .neon-button .tooltip-text {
  visibility: hidden;
  width: 100px;
  background-color: rgba(0, 0, 50, 0.9);
  color: #0ff;
  text-align: center;
  border-radius: 6px;
  padding: 4px;
  font-size: 10px;
  font-weight: bold;
  text-shadow: 0 0 3px #0ff;
  position: absolute;
  left: 50px;
  top: 50%;
  transform: translateY(-50%);
  box-shadow: 0 0 8px #0ff77;
  z-index: 1000;
  white-space: nowrap;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.3s;
}

.sidebar-container .neon-button:first-child:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}

/* Tombol Pengaturan Togel bulat */
.sidebar-container .neon-button:first-child {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  margin: 10px 0;
  border: 2px solid #0ff;
  background: rgba(0, 0, 50, 0.7);
  color: #0ff;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 0 8px #0ff88, 0 0 15px #0ff44;
  transition: all 0.3s ease;
  position: relative;
}

.hadiah-container {
  display: flex;
  flex-direction: column;
  gap: 16px;
  margin-top: 20px;
}

.hadiah-box {
  background: rgba(0, 10, 30, 0.85);
  border: 1px solid #33ffff;
  border-radius: 12px;
  box-shadow: 0 0 20px #33ffff;
  padding: 16px;
  width: 100%;
  transition: all 0.3s ease;
}

.hadiah-box:hover {
  transform: translateY(-3px) scale(1.02);
  box-shadow: 0 0 35px #66ffff;
}

/* Details & Summary */
.hadiah-box details {
  border: 1px solid #33ffff;
  border-radius: 10px;
  margin-bottom: 8px;
  background: rgba(0,10,30,0.8);
  box-shadow: 0 0 15px #33ffff50;
  overflow: hidden;
  font-weight: bold;
  font-size: 16px;
}

.hadiah-box summary {
  list-style: none;
  cursor: pointer;
  padding: 12px 16px;
  color: #aaffff;
  text-align: center;
  text-shadow: 0 0 6px #33ffff;
  font-weight: bold;
  font-size: 18px;
}

.hadiah-box summary::-webkit-details-marker {
  display: none;
}

/* Tabel di dalam box */
.hadiah-box table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 8px;
}

.hadiah-box th, .hadiah-box td {
  border: 1px solid rgba(255,255,255,0.1);
  padding: 8px 12px;
  font-size: 15px;
  font-weight: bold;
  color: #e0f7ff;
  text-align: center;
}

.hadiah-box th {
  background: rgba(0, 50, 100, 0.6);
  text-shadow: 0 0 4px #66ffff;
}

.hadiah-box td {
  background: rgba(0, 50, 100, 0.25);
}

/* Diskon */
.hadiah-box .diskon {
  text-align: center;
  font-weight: bold;
  color: #66ffff;
  text-shadow: 0 0 2px #33ffff;
  font-size: 13px;
  font-weight: bold;
  margin-top: 4px;
}

/* Dua kolom untuk tabel dalam satu card */
.tabel-dua-kolom {
  display: flex;
  gap: 12px;
  margin-top: 12px;
  flex-wrap: wrap;
}

.tabel-dua-kolom table {
  flex: 1;
  min-width: 280px;
}

/* Pastikan tabel tetap rapi */
.tabel-dua-kolom th,
.tabel-dua-kolom td {
  padding: 6px 8px;
  font-weight: bold;
  font-size: 14px;
}

/* Di layar kecil, tumpuk jadi satu kolom */
@media (max-width: 600px) {
  .tabel-dua-kolom {
    flex-direction: column;
  }
}

.nav-button, .action-button {
  font-size: 10px;
  padding: 10px 20px;
  border: 1px solid #00ffff;
  background-color: transparent;
  color: #00ffff;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.nav-button:hover, .action-button:hover {
  background-color: #00ffff;
  color: #00FFFF;
  box-shadow: 0 0 15px #00ffff;
}

/* Gaya khusus untuk slider */
.zoom-slider-container input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  height: 8px;
  background: #001122;
  outline: none;
  border-radius: 5px;
}

.zoom-slider-container input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 20px;
  height: 20px;
  background: #00ffff;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 0 10px #00ffff;
}

.btn-add-new {
  background-color: #17a2b8;
  color: #00FFFF;
}

.btn-add-new:hover {
  background-color: #138496;
  box-shadow: 0 0 10px rgba(23, 162, 184, 0.7);
}

.btn-tambah-baris-bottom {
  background: linear-gradient(145deg, rgba(72, 61, 139, 0.6), rgba(0, 0, 139, 0.4));
  color: #00ffff;
  font-weight: bold;
  font-size: 1.1em;
  padding: 8px 18px;
  border: 2px solid #00ffff55;
  border-radius: 12px;
  cursor: pointer;
  box-shadow: 0 0 10px #8a2be288, 0 0 20px #00ffff44;
  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}

.btn-tambah-baris-bottom:hover {
  background: linear-gradient(145deg, rgba(72, 61, 139, 0.8), rgba(0, 0, 139, 0.6));
  border-color: #00ffff;
  transform: scale(1.05);
  box-shadow: 0 0 15px #8a2be2, 0 0 30px #00ffffaa;
}

.btn-tambah-baris-bottom::before {
  color: #ff00ff;
  margin-right: 8px;
  font-size: 1.2em;
  font-weight: bolder;
  text-shadow: 0 0 5px #ff00ff;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

#reportSearch {
  flex-grow: 1;
  padding: 10px 15px;
  margin-right: 15px;
  background: rgba(0, 15, 40, 0.75);
  color: var(--txt-main);
  border: 1px solid var(--accent-cyan);
  border-radius: 10px;
  font-size: 15px;
  font-weight: 600;
  transition: all 0.3s ease;
  outline: none;
  box-shadow: inset 0 0 6px rgba(0, 198, 215, 0.2);
  backdrop-filter: blur(6px);
  font-family: 'Exo 2', monospace;
}

#reportSearch:focus {
  border-color: var(--accent-cyan);
  box-shadow: 
    0 0 12px rgba(0, 198, 215, 0.6),
    inset 0 0 8px rgba(0, 198, 215, 0.4);
  background: rgba(0, 20, 50, 0.85);
}

/* === KARTU LAPORAN — GLASSMORPHISM CYAN === */
.report-card {
  border-radius: 14px;
  margin-bottom: 16px;
  overflow: hidden;
  background: var(--panel-bg);
  position: relative;
  box-shadow: 0 4px 18px var(--panel-shadow);
  transition: transform 0.25s cubic-bezier(0.25, 0.8, 0.25, 1.2), box-shadow 0.25s ease;
  border: 1px solid var(--panel-border);
}

/* Side accent bar (cyan only) */
.report-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 4px;
  height: 100%;
  background: linear-gradient(to bottom, var(--accent-cyan), var(--accent-blue));
  box-shadow: 0 0 8px var(--accent-cyan);
}

.report-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 24px rgba(0, 198, 215, 0.4);
}

/* === JUDUL AKORDION KARTU === */
.card-accordion-title {
  display: flex;
  justify-content: flex-start;
  align-items: center;
  padding: 14px 20px;
  margin: 0;
  font-size: 1.05em;
  font-weight: 700;
  color: var(--accent-cyan);
  cursor: pointer;
  background: rgba(0, 25, 60, 0.6);
  border-bottom: 1px solid rgba(0, 198, 215, 0.2);
  transition: all 0.25s ease;
  position: relative;
  z-index: 2;
  font-family: 'Exo 2', sans-serif;
}

.card-accordion-title:hover {
  background: rgba(0, 35, 80, 0.8);
  border-bottom-color: var(--accent-cyan);
  color: #b2ebf2;
  transform: translateX(2px);
}

/* === PANEL ISI KARTU === */
.card-content-panel {
  padding: 20px;
  background: rgba(0, 20, 50, 0.7);
  border-top: none;
}

/* === GRUP FIELD === */
.report-field-group {
  margin-bottom: 14px;
  padding: 10px;
  border-radius: 10px;
  background: rgba(0, 25, 60, 0.65);
  position: relative;
  overflow: hidden;
  transition: box-shadow 0.3s ease;
  border: 1px solid rgba(0, 198, 215, 0.15);
}

.report-field-group::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: linear-gradient(to right, transparent, var(--accent-cyan), transparent);
  opacity: 0.7;
}

.report-field-group label {
  display: block;
  margin-bottom: 6px;
  font-size: 0.95em;
  font-weight: 600;
  color: var(--txt-highlight);
}

/* === NILAI TAMPILAN === */
.report-display-value {
  white-space: pre-wrap;
  word-break: break-word;
  min-height: 24px;
  padding: 8px 12px;
  background: rgba(0, 30, 70, 0.7);
  border-radius: 8px;
  color: var(--txt-main);
  font-weight: 600;
  font-size: 0.95em;
  border: 1px solid rgba(0, 198, 215, 0.25);
  box-shadow: inset 0 0 6px rgba(0, 198, 215, 0.15);
  font-family: 'Exo 2', monospace;
}

.report-display-value.small-field {
  min-height: 16px;
  padding: 6px 10px;
  font-size: 0.9em;
}

/* === INPUT EDIT === */
.report-edit-input {
  width: 100%;
  box-sizing: border-box;
  padding: 10px 12px;
  background: rgba(0, 30, 70, 0.75);
  color: var(--txt-main);
  border: 1px solid rgba(0, 198, 215, 0.4);
  border-radius: 8px;
  resize: vertical;
  min-height: 50px;
  font-family: 'Exo 2', monospace;
  transition: all 0.3s ease;
  font-size: 0.95em;
  font-weight: 600;
}

.report-edit-input:focus {
  outline: none;
  border-color: var(--accent-cyan);
  box-shadow: 
    0 0 10px rgba(0, 198, 215, 0.6),
    inset 0 0 8px rgba(0, 198, 215, 0.4);
  background: rgba(0, 35, 80, 0.85);
}

.report-edit-input.small-field {
  min-height: 35px;
  font-size: 0.9em;
  padding: 8px 10px;
}

/* === PEMBATAS NEON === */
.neon-divider {
  border: none;
  height: 1px;
  background: linear-gradient(to right, transparent, #00ffff, transparent);
  box-shadow: 0 0 6px rgba(0, 255, 255, 0.5);
  margin: 20px 0;
}

/* === MODAL ZOOM GALERI — SESUAI CONTOH ANDA === */
#bonusZoomModal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.95);
  justify-content: center;
  align-items: center;
  flex-direction: column;
  padding: 20px;
}

#bonusZoomModal .zoomed-content-wrapper {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  gap: 12px;
  max-width: 90vw;
}

#bonusZoomModal .zoomed-content-wrapper img {
  flex: 1;
  max-width: none;
  height: auto;
  max-height: 85vh;
  object-fit: contain;
  border-radius: 8px;
  box-shadow: 0 0 15px rgba(0, 255, 255, 0.8), 0 0 25px rgba(0, 255, 255, 0.5);
  min-width: 0;
}

#bonusZoomModal .zoomed-userid {
  display: block;
  text-align: center;
  font-size: 2.2em;
  font-weight: bold;
  margin-bottom: 15px;
  text-shadow: 0 0 10px #ffcc00;
  color: #fff;
}

#bonusZoomModal #bonusCaption {
  color: #aaa;
  margin-top: 20px;
  text-align: center;
  font-weight: bold;
  font-size: 14px;
}

/* Tombol Navigasi Zoom - Diperindah */
.zoom-nav-button {
  background: rgba(0, 0, 0, 0.5);
  color: white;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  width: 48px;
  height: 48px;
  font-size: 20px;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.25s ease;
  flex-shrink: 0;
  margin: 0 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}

.zoom-nav-button:hover,
.zoom-nav-button:focus {
  background: rgba(0, 200, 255, 0.8);
  border-color: rgba(0, 255, 255, 0.7);
  color: #000;
  outline: none;
  transform: scale(1.05);
}

.zoom-nav-button:disabled {
  opacity: 0.4;
  cursor: not-allowed;
  transform: none;
}

/* Close button styling (opsional, agar konsisten) */
.close-btn {
  position: absolute;
  top: 20px;
  right: 20px;
  background: rgba(0, 0, 0, 0.5);
  color: white;
  width: 40px;
  height: 40px;
  border: none;
  border-radius: 50%;
  font-size: 24px;
  font-weight: bold;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s;
}

.close-btn:hover {
  background: rgba(255, 0, 0, 0.7);
}

#chatHistory {
  height: 70vh;
  overflow-y: auto;
  padding: 20px;
  border: 1px solid #00ffff;
  border-radius: 12px;
  background: rgba(0, 10, 30, 0.7);
  margin-bottom: 20px;
  scroll-behavior: smooth;
  position: relative;
  height: 75vh;
  overflow-y: auto;
  padding: 15px;
  background: rgba(0, 5, 15, 0.9);
  border: 1px solid #00ffff33;
  border-radius: 15px;
  margin-bottom: 15px;
  display: flex;
  flex-direction: column;
  scrollbar-width: thin;
  scrollbar-color: #00ffff #000a1e;
}

/* Gaya untuk setiap pesan (user & AI) */
.message {
  margin-bottom: 15px;
  display: flex;
  flex-direction: column;
  animation: fadeIn 0.3s ease-in-out;
  margin-bottom: 20px;
  display: flex;
  flex-direction: column;
  animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Posisi pesan user di kanan */
.user-message {
  align-items: flex-end;
}

/* Posisi pesan AI di kiri */
.ai-message {
  align-items: flex-start;
}

/* Gaya gelembung pesan */
.message-bubble {
  max-width: 70%;
  padding: 12px 16px;
  border-radius: 18px;
  font-weight: 500;
  line-height: 1.5;
  white-space: pre-wrap;
  word-wrap: break-word;
  position: relative;
  padding: 12px 18px;
  border-radius: 15px;
  max-width: 80%;
  word-wrap: break-word;
  font-family: 'Segoe UI', Roboto, sans-serif;
  line-height: 1.5;
  font-size: 15px;
  font-weight: bold;
}

/* Gaya khusus gelembung pesan user */
.user-message .message-bubble {
  background: rgba(0, 30, 60, 0.8);
  color: #00ffff;
  border-bottom-right-radius: 5px;
  box-shadow: 0 2px 5px rgba(0, 120, 255, 0.3);
  background: rgba(0, 74, 124, 0.4);
  color: #00ffff;
  border: 1px solid #00ffff;
  border-bottom-right-radius: 2px;
  box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
}

/* Gaya khusus gelembung pesan AI */
.ai-message .message-bubble {
  background: rgba(0, 30, 60, 0.8);
  color: #00ffff;
  border: 1px solid #00ffff44;
  border-bottom-left-radius: 5px;
  box-shadow: 0 2px 5px rgba(0, 255, 255, 0.2);
  background: rgba(0, 20, 40, 0.9);
  color: #00ffff;
  border: 1px solid #00ffff;
  border-bottom-left-radius: 2px;
  box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
}

/* == Tambahkan ini jika ingin animasi "..." saat AI mengetik == */
.typing-indicator {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  background: rgba(0, 30, 60, 0.8);
  border-radius: 18px;
  border-bottom-left-radius: 5px;
  max-width: 100px;
}

.typing-indicator span {
  height: 8px; width: 8px; background: #00ffff;
  border-radius: 50%; display: inline-block; margin: 0 2px;
  animation: typing 1.4s infinite;
}

.typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
.typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

@keyframes typing {
  0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
  30% { transform: translateY(-10px); opacity: 1; }
}

/* === NEON TOGGLE SWITCH MODERN === */
.neon-toggle {
  position: relative;
  display: inline-block;
  width: 56px;
  height: 28px;
}

.neon-toggle input {
  opacity: 0;
  width: 0;
  height: 0;
}

.neon-toggle-switch {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0;
  right: 0; bottom: 0;
  background-color: #222;
  border: 1px solid #444;
  transition: .4s;
  border-radius: 14px;
  box-shadow: inset 0 0 6px rgba(0,0,0,0.8);
}

.neon-toggle-knob {
  position: absolute;
  height: 22px;
  width: 22px;
  left: 2px;
  bottom: 3px;
  background-color: #444;
  border-radius: 50%;
  transition: .4s;
  box-shadow: 0 0 4px rgba(0,0,0,0.8);
}

.neon-toggle input:checked + .neon-toggle-switch {
  background: linear-gradient(135deg, #00bfff, #0077ff);
  border-color: #00ffff;
  box-shadow: 0 0 12px rgba(0,255,255,0.6);
}

.neon-toggle input:checked + .neon-toggle-switch .neon-toggle-knob {
  background: #00ffff;
  transform: translateX(28px);
  box-shadow: 0 0 8px #00ffff, 0 0 16px rgba(0,255,255,0.5);
}

/* === INPUT SECTION === */
.input-section {
  max-width: 1000px;
  margin: 20px auto;
  padding: 20px;
  background: #0d1b2a;
  border-radius: 12px;
  border: 1px solid #0288d1;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
}

.input-section h2 {
  color: #4fc3f7;
  text-align: center;
  margin-bottom: 20px;
  font-size: 22px;
  font-weight: bold;
  font-weight: 600;
  padding-bottom: 10px;
  border-bottom: 1px solid #1e3a5f;
}

.input-group {
  margin-bottom: 20px;
}

.input-group label {
  display: block;
  color: #81d4fa;
  margin-bottom: 8px;
  font-weight: 600;
  font-size: 14px;
}

.input-group textarea {
  width: 100%;
  min-height: 150px;
  padding: 14px;
  border: 1px solid #1e3a5f;
  border-radius: 8px;
  background: #0a1929;
  color: #e0f7fa;
  font-family: 'Courier New', monospace;
  font-size: 14px;
  font-weight: bold;
  resize: vertical;
  transition: border-color 0.3s, box-shadow 0.3s;
}

.input-group textarea:focus {
  outline: none;
  border-color: #0288d1;
  box-shadow: 0 0 0 2px rgba(2, 136, 209, 0.3);
}

/* === BUTTON === */
#btnCocokkan {
  width: 100%;
  padding: 14px 20px;
  background: linear-gradient(135deg, #0288d1, #01579b);
  color: white;
  font-size: 16px;
  font-weight: bold;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
  margin-top: 10px;
}

#btnCocokkan:hover {
  background: linear-gradient(135deg, #029ed1, #0168b3);
  transform: translateY(-2px);
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.5);
}

#btnCocokkan:active {
  transform: translateY(0);
}

/* === RESPONSIVE === */
@media (max-width: 768px) {
  .input-section {
    margin: 10px;
    padding: 15px;
    grid-template-columns: 1fr;
  }
  .input-section h2 {
    font-size: 18px;
    font-weight: bold;
  }
  .input-group textarea {
    min-height: 120px;
    font-weight: bold;
    font-size: 13px;
  }
  #chatHistory { height: 60vh; }
  .message-bubble { max-width: 90%; }
  .chat-input-container { flex-direction: column; }
  #sendButton { height: 45px; width: 100%; }
}

.btn-clear {
  margin-top: 8px;
  padding: 6px 12px;
  background: #b71c1c;
  color: white;
  border: none;
  border-radius: 5px;
  font-size: 13px;
  cursor: pointer;
  transition: background 0.2s;
}

.btn-clear:hover {
  background: #d32f2f;
}

.neon-switch-btn {
  background: rgba(0, 255, 255, 0.2);
  color: #ffffff;
  border: 1px solid #00ffff;
  border-radius: 8px;
  padding: 10px 20px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 0 10px rgba(0, 255, 255, 0.6);
  backdrop-filter: blur(2px);
  -webkit-backdrop-filter: blur(2px);
  font-size: 14px;
}

.neon-switch-btn:hover {
  background: rgba(0, 255, 255, 0.35);
  box-shadow: 0 0 15px rgba(0, 255, 255, 0.9);
  transform: scale(1.05);
}

.neon-switch-btn:active {
  transform: scale(0.98);
}

/* Tombol Aktif */
.neon-switch-btn.active {
  background: rgba(0, 255, 255, 0.4);
  box-shadow: 0 0 20px rgba(0, 255, 255, 1);
  color: #000;
}

.depo-wd-container {
  max-width: 1200px;
  margin: 20px auto;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.depo-wd-title {
  text-align: center;
  color: #4fc3f7;
  margin-bottom: 20px;
  font-size: 24px;
  font-weight: 600;
}

.summary-box {
  background: #0f2a4d;
  padding: 16px;
  border-radius: 10px;
  margin-bottom: 25px;
  color: #bbdefb;
  font-size: 14px;
  text-align: center;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3);
}

.user-card {
  background: #121f33;
  border-radius: 12px;
  margin-bottom: 20px;
  overflow: hidden;
  box-shadow: 0 6px 12px rgba(0,0,0,0.4);
  border-left: 5px solid;
  background: rgba(0, 12, 30, 0.9);
  border-radius: 14px;
  margin-bottom: 20px;
  box-shadow: 0 8px 24px rgba(0, 255, 255, 0.25);
  border: 2px solid var(--neon-blue);
  position: relative;
  min-width: 320px;
  overflow: visible;
  transition: transform 0.3s ease;
  background: rgba(0, 10, 30, 0.9);
  border: 2px solid var(--neon-blue);
  border-radius: 12px;
  margin-bottom: 20px;
  overflow: hidden;
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
  position: relative;
}

.user-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 30px rgba(0, 255, 255, 0.4);
}

.user-card::before {
  content: "";
  position: absolute;
  top: 0; left: 0; right: 0; height: 4px;
  background: linear-gradient(90deg, transparent, var(--neon-blue), transparent);
}

.user-header {
  padding: 14px 20px;
  font-weight: bold;
  font-size: 16px;
  color: white;
}

.user-header-compact {
  padding: 12px 20px;
  font-size: 16px;
  font-weight: bold;
  color: var(--neon-blue);
  background: rgba(0, 20, 50, 0.7);
  text-align: center;
  letter-spacing: 1px;
}

.user-body {
  display: flex;
  flex-wrap: wrap;
  padding: 16px;
  gap: 20px;
}

.col {
  flex: 1;
  min-width: 250px;
  display: flex;
  flex-direction: column;
  min-width: 260px;
  min-width: 100%;
}

.col-title {
  font-size: 14px;
  color: #4fc3f7;
  margin-bottom: 8px;
  font-weight: 600;
  padding-bottom: 4px;
  border-bottom: 1px solid #3498db;
  display: flex;
  justify-content: space-between;
  font-size: 14px;
  margin-bottom: 12px;
  padding-bottom: 6px;
  border-bottom: 2px solid var(--neon-blue);
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
  font-size: 14px;
  margin-bottom: 8px;
  font-weight: 600;
  padding-bottom: 4px;
  border-bottom: 1px solid #3498db;
}

.entry-list {
  list-style: none;
  padding: 0;
  margin: 0;
  flex: 1;
  max-height: 180px;
  overflow-y: auto;
  max-height: 140px;
  overflow-y: auto;
  font-size: 13px;
  padding-right: 8px;
}

.entry-list::-webkit-scrollbar {
  width: 6px;
}

.entry-list::-webkit-scrollbar-track {
  background: #0d1b2a;
  border-radius: 3px;
}

.entry-list::-webkit-scrollbar-thumb {
  background: #4fc3f7;
  border-radius: 3px;
  background: var(--neon-blue);
  border-radius: 3px;
}

.entry-list::-webkit-scrollbar-thumb:hover {
  background: #29b6f6;
}

.entry-item {
  background: #1e3a5f;
  padding: 8px 12px;
  margin-bottom: 6px;
  border-radius: 6px;
  font-family: monospace;
  color: #bbdefb;
  font-size: 13px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  background: rgba(0, 25, 50, 0.6);
  padding: 10px 14px;
  margin-bottom: 8px;
  border-radius: 8px;
  border: 1px solid rgba(0, 180, 255, 0.3);
  font-family: 'Consolas', monospace;
  color: var(--text-main);
  transition: all 0.2s;
}

.entry-item:hover {
  background: rgba(0, 40, 80, 0.7);
  border-color: var(--neon-blue);
}

.entry-item.empty {
  color: #666;
  font-style: italic;
  text-align: center;
  font-size: 11px;
}

.total-row {
  margin-top: 10px;
  padding-top: 8px;
  border-top: 1px dashed #3498db;
  font-weight: bold;
  font-family: monospace;
  color: white;
  flex-shrink: 0;
  display: flex;
  justify-content: space-between;
  margin-top: 16px;
  padding-top: 12px;
  border-top: 2px dashed var(--neon-blue);
  font-weight: bold;
  font-family: 'Consolas', monospace;
  color: var(--neon-yellow);
  font-size: 15px;
  margin-top: 16px;
  padding-top: 12px;
  border-top: 1px dashed rgba(0, 200, 255, 0.4);
  font-weight: bold;
  font-family: 'Consolas', monospace;
  color: var(--neon-yellow);
  font-size: 16px;
  margin-top: 16px;
  padding-top: 12px;
  border-top: 1px dashed rgba(0, 200, 255, 0.4);
  font-weight: bold;
  font-family: 'Consolas', monospace;
  color: var(--neon-yellow);
  font-size: 16px;
}

.total-label {
  font-size: 13px;
  color: var(--neon-blue);
  font-size: 13px;
  color: var(--neon-blue);
}

.total-value {
  font-family: 'Consolas', monospace;
  font-size: 15px;
  font-family: 'Consolas', monospace;
  font-size: 15px;
}

.status-badge {
  display: inline-block;
  padding: 6px 14px;
  border-radius: 20px;
  font-weight: bold;
  margin-top: 12px;
  font-size: 13px;
  display: block;
  margin: 20px auto;
  padding: 12px 24px;
  border-radius: 20px;
  font-weight: bold;
  font-size: 18px;
  text-transform: uppercase;
  letter-spacing: 1px;
  box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
  display: inline-block;
  padding: 6px 14px;
  border-radius: 20px;
  font-weight: bold;
  margin-top: 12px;
  font-size: 13px;
}

.status-cocok {
  background: rgba(0, 150, 0, 0.2);
  color: var(--neon-green);
  border: 1px solid var(--neon-green);
}

.status-lebih {
  background: rgba(255, 200, 0, 0.2);
  color: var(--neon-yellow);
  border: 1px solid var(--neon-yellow);
}

.status-kurang {
  background: rgba(255, 100, 100, 0.2);
  color: var(--neon-red);
  border: 1px solid var(--neon-red);
}

.diff-cocok { color: #66bb6a; }
.diff-lebih { color: #ff8f00; }
.diff-kurang { color: #ef5350; }

/* ================== GAYA UNTUK TANYA Z (TANPA SUARA) ================== */

/* Layout Pesan */

/* Blok Kode / Script / Rumus */
.code-container {
  background: #000a1e;
  color: #00ffff;
  padding: 15px;
  border-radius: 8px;
  font-family: 'Consolas', 'Courier New', monospace;
  font-size: 13.5px;
  overflow-x: auto;
  margin: 10px 0;
  border: 1px solid #00ffff;
  border-left: 4px solid #00ffff;
  white-space: pre-wrap;
  box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.1);
}

/* Input Area */
.chat-input-container {
  display: flex;
  gap: 10px;
  background: rgba(0, 15, 35, 0.9);
  padding: 10px;
  border-radius: 15px;
  border: 1px solid #00ffff44;
}

.chat-input-div {
  flex-grow: 1;
  background: rgba(0, 10, 30, 0.8);
  color: #00ffff;
  border: 1px solid #00ffff;
  border-radius: 12px;
  padding: 12px;
  font-size: 15px;
  font-weight: bold;
  min-height: 44px;
  max-height: 150px;
  overflow-y: auto;
  outline: none;
  transition: 0.3s;
}

.chat-input-div:focus { 
  box-shadow: 0 0 15px #00ffff; 
}

.chat-input-div:empty:before {
  content: attr(placeholder);
  color: rgba(0, 255, 255, 0.4);
}

/* Gaya Gambar */
.chat-input-div img, .message-bubble img {
  max-width: 100%;
  max-height: 250px;
  border-radius: 10px;
  border: 1px solid #00ffff;
  margin-top: 5px;
  max-width: 100%;
  max-height: 300px;
  border-radius: 10px;
  border: 1px solid #004466;
  margin: 8px 0;
  box-shadow: 0 0 8px rgba(0, 120, 160, 0.3);
  transition: transform 0.3s ease;
}

.message-bubble img:hover {
  transform: scale(1.02);
  box-shadow: 0 0 12px rgba(0, 120, 160, 0.5);
}

#sendButton {
  background: transparent;
  color: #00ffff;
  border: 1px solid #00ffff;
  padding: 0 20px;
  border-radius: 12px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}

#sendButton:hover {
  background: #00ffff;
  color: #000;
  box-shadow: 0 0 15px #00ffff;
}

/* === JUDUL UTAMA === */
h1,
.section-title,
.col-title,
.card-header,
.total-label,
.total-value,
.nominal,
.extract-h-title,
.label,
.mode-text,
.toggle-label {
  color: var(--neon-blue) !important;
  font-weight: bold !important;
  text-shadow: 0 0 12px rgba(0, 255, 255, 0.95) !important;
  letter-spacing: 0.8px;
}

h1 {
  text-align: center;
  margin: 20px 0 24px;
  font-size: 28px;
  text-shadow: 0 0 16px var(--neon-blue), 0 0 32px rgba(0, 255, 255, 0.7);
  font-size: 22px;
  margin: 16px 0 20px;
}

/* === PANEL UMUM === */
.common-panel,
.input-section {
  max-width: 1200px;
  margin: 0 auto 24px;
  background: var(--panel-bg);
  border: 1px solid var(--panel-border);
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 0 20px var(--panel-shadow);
  backdrop-filter: blur(10px);
  position: relative;
  overflow: visible;
}

.common-panel::before {
  content: "";
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  border-radius: 14px;
  background: linear-gradient(45deg, transparent, var(--neon-blue), transparent);
  z-index: -1;
  opacity: 0.3;
}

.section {
  background: var(--panel-bg);
  border: 1px solid var(--panel-border);
  border-radius: 10px;
  padding: 16px;
  box-shadow: 0 0 12px var(--panel-shadow);
}

/* === CARD ANALISIS (USER / BANK) === */
.bank-card {
  background: rgba(0, 12, 30, 0.9);
  border-radius: 14px;
  margin-bottom: 20px;
  box-shadow: 0 8px 24px rgba(0, 255, 255, 0.25);
  border: 2px solid var(--neon-blue);
  position: relative;
  min-width: 320px;
  overflow: visible;
  transition: transform 0.3s ease;
}

.bank-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 30px rgba(0, 255, 255, 0.4);
}

/* === BUTTON NEON === */
.neon-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 10px 20px;
  border: 2px solid var(--neon-blue);
  background: transparent;
  color: var(--neon-blue);
  border-radius: 14px;
  font-weight: bold;
  cursor: pointer;
  font-size: 14px;
  transition: all 0.3s ease;
  text-shadow: 0 0 8px rgba(0, 255, 255, 0.9);
  box-shadow: 0 0 12px rgba(0, 255, 255, 0.5);
  min-height: 42px;
  position: relative;
  overflow: hidden;
}

.neon-btn::after {
  content: "";
  position: absolute;
  top: -50%;
  left: -60%;
  width: 20px;
  height: 200%;
  background: rgba(0, 255, 255, 0.4);
  transform: rotate(25deg);
  transition: all 0.6s;
}

.neon-btn:hover {
  background: rgba(0, 255, 255, 0.15);
  box-shadow: 0 0 24px rgba(0, 255, 255, 0.9);
  transform: translateY(-3px) scale(1.02);
}

.neon-btn:hover::after {
  left: 120%;
}

.buttons {
  display: flex;
  gap: 14px;
  margin-top: 16px;
  flex-wrap: wrap;
  justify-content: center;
}

/* === CARD ANALISIS PER PENGGUNA (SESUAI FOTO) === */
.user-card-compact {
  background: rgba(0, 10, 30, 0.9);
  border: 2px solid var(--neon-blue);
  border-radius: 12px;
  margin-bottom: 20px;
  overflow: hidden;
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
  position: relative;
}

.depo-withdraw-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  padding: 16px 20px;
}

.depo-col, .with-col {
  background: rgba(0, 5, 20, 0.7);
  border: 1px solid rgba(0, 200, 255, 0.3);
  border-radius: 10px;
  padding: 16px;
  text-align: center;
}

.depo-col h3, .with-col h3 {
  font-size: 14px;
  margin: 0 0 12px 0;
  color: var(--neon-blue);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.depo-col h3::before,
.with-col h3::before {
  content: "📥";
  font-size: 16px;
}

.with-col h3::before {
  content: "📤";
}

.amount-value {
  font-size: 20px;
  font-weight: bold;
  color: var(--neon-blue);
  font-family: 'Consolas', monospace;
  margin: 10px 0;
  text-shadow: 0 0 8px rgba(0, 255, 255, 0.7);
}

.desc-text {
  font-size: 12px;
  color: #a0d0ff;
  line-height: 1.5;
  min-height: 40px;
  white-space: pre-line;
  word-break: break-word;
}

.withdraw-note {
  margin-top: 4px;
  font-size: 10px;
  padding-left: 4px;
  border-left: 2px solid #4caf50;
  color: #aaffaa;
}

/* === ANIMASI SELISIH STATUS === */
.selisih-besar {
  font-size: 18px;
  font-weight: bold;
  text-align: center;
  padding: 10px 0;
  margin: 16px 0 12px;
  animation: neonPulse 2s infinite;
  text-shadow: 0 0 14px currentColor;
  border-radius: 8px;
  background: rgba(0, 0, 0, 0.3);
}

.selisih-jumlah {
  font-size: 20px;
  font-weight: bold;
  text-align: center;
  margin-bottom: 14px;
  text-shadow: 0 0 12px currentColor;
  font-family: 'Orbitron', monospace;
}

/* === MODE TOGGLE === */
.mode-toggle {
  text-align: center;
  background: var(--panel-bg);
  padding: 16px;
  border-radius: 12px;
  border: 1px solid var(--panel-border);
  margin-bottom: 20px;
  box-shadow: 0 0 12px var(--panel-shadow);
}

.switch {
  position: relative;
  display: inline-block;
  width: 64px;
  height: 32px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #001122;
  transition: .4s;
  border-radius: 34px;
  border: 2px solid var(--neon-blue);
}

.slider:before {
  position: absolute;
  content: "";
  height: 24px;
  width: 24px;
  left: 3px;
  bottom: 3px;
  background-color: var(--neon-blue);
  transition: .4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: transparent;
}

input:checked + .slider:before {
  transform: translateX(30px);
  background-color: var(--neon-green);
}

/* === TAB SWITCH DI KANAN === */
.tab-switch {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  display: flex;
  gap: 8px;
  position: static;
  justify-content: center;
  margin-bottom: 16px;
}

.tab-btn {
  padding: 8px 16px;
  background: rgba(0, 15, 35, 0.8);
  border: 2px solid var(--neon-blue);
  color: var(--neon-blue);
  border-radius: 24px;
  font-size: 12px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.25s ease;
  text-shadow: 0 0 6px rgba(0, 255, 255, 0.8);
}

.tab-btn.active {
  background: rgba(0, 255, 255, 0.2);
  box-shadow: 0 0 16px rgba(0, 255, 255, 0.8);
  transform: scale(1.05);
}

.tab-btn:not(.active):hover {
  background: rgba(0, 50, 100, 0.7);
  transform: translateY(-2px);
}

.tab-btn[data-tab="trycari"] {
  color: var(--neon-yellow);
  border-color: var(--neon-yellow);
  text-shadow: 0 0 6px rgba(255, 255, 0, 0.8);
}

.tab-btn[data-tab="trycari"].active {
  background: rgba(255, 255, 0, 0.15);
  box-shadow: 0 0 16px rgba(255, 255, 0, 0.7);
}

/* === EXTRACTOR HORIZONTAL === */
.extract-h-container {
  display: flex;
  gap: 16px;
  overflow-x: auto;
  padding: 12px 0;
  max-height: 160px;
  background: rgba(0, 8, 25, 0.4);
  border-radius: 10px;
  padding: 14px;
  scrollbar-width: thin;
  scrollbar-color: var(--neon-blue) rgba(0,0,0,0.3);
}

.extract-h-container::-webkit-scrollbar {
  height: 10px;
}

.extract-h-container::-webkit-scrollbar-thumb {
  background: var(--neon-blue);
  border-radius: 5px;
}

.extract-h-card {
  min-width: 280px;
  background: rgba(0, 20, 45, 0.85);
  border: 1px solid rgba(0, 200, 255, 0.5);
  border-radius: 10px;
  padding: 12px;
  flex-shrink: 0;
  font-size: 12px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  box-shadow: 0 4px 12px rgba(0, 255, 255, 0.2);
}

.extract-h-card .label {
  font-size: 10px;
  opacity: 0.9;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--neon-blue);
  font-weight: bold;
}

.extract-h-card .value {
  font-family: 'Consolas', monospace;
  font-size: 13px;
  word-break: break-all;
  line-height: 1.4;
  color: var(--text-main);
}

/* === ERROR MSG === */
.error-msg {
  color: var(--neon-red);
  text-align: center;
  padding: 16px;
  font-weight: bold;
  font-size: 16px;
  background: rgba(100, 0, 0, 0.2);
  border-radius: 10px;
  border-left: 4px solid var(--neon-red);
}

.card-body {
  flex-direction: column;
  gap: 16px;
}

.user-card, .bank-card {
  min-width: 100%;
}

.diff-value {
  font-size: 24px;
  font-weight: bold;
  color: currentColor;
  font-family: 'Orbitron', sans-serif;
  margin-top: 8px;
}

.quantum-icon {
  font-size: 26px;
  color: #00c6d7; /* sesuaikan dengan --accent-cyan */
  text-shadow: 
    0 0 8px rgba(0, 198, 215, 0.9),
    0 0 16px rgba(0, 198, 215, 0.6);
  animation: float 3s ease-in-out infinite;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 32px;
  height: 32px;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-6px); }
}

.brand-accent {
  color: #00f3ff;
  text-shadow: 
    0 0 8px rgba(0, 243, 255, 0.9),
    0 0 16px rgba(185, 103, 255, 0.6);
  background: linear-gradient(90deg, #00f3ff, #b967ff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  animation: brandGlow 3s ease infinite;
}

@keyframes brandGlow {
  0%, 100% { text-shadow: 0 0 8px rgba(0, 243, 255, 0.9), 0 0 16px rgba(185, 103, 255, 0.6); }
  50% { text-shadow: 0 0 14px rgba(0, 243, 255, 1), 0 0 24px rgba(185, 103, 255, 0.8); }
}

.action-button {
    position: relative;
    z-index: 10005; /* Harus lebih tinggi dari overlay lightbox */
    pointer-events: auto; /* Memastikan bisa diklik */
}

    .tooltip-text {
      visibility: hidden;
      width: 110px;
      background-color: rgba(0, 0, 30, 0.92);
      color: var(--neon-blue);
      text-align: center;
      border-radius: 8px;
      padding: 5px;
      font-size: 11px;
      font-weight: bold;
      text-shadow: 0 0 3px var(--neon-blue);
      position: absolute;
      left: 60px;
      top: 50%;
      transform: translateY(-50%);
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
      z-index: 1000;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
      border: 1px solid rgba(0, 255, 255, 0.4);
    }

    .neon-button:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }

.nav-button {
  background: rgba(0, 255, 255, 0.1);
  border: 1px solid #00ffff;
  color: #00ffff;
  padding: 10px 20px;
  border-radius: 5px;
  cursor: pointer;
  font-family: 'Orbitron', sans-serif;
  text-transform: uppercase;
  transition: 0.3s;
}

.nav-button:hover {
  background: #00ffff;
  color: #000;
  box-shadow: 0 0 15px #00ffff;
}
/* --- MODE TOGGLE CSS --- */
.mode-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  margin-bottom: 20px;
  background: rgba(0, 255, 255, 0.05);
  padding: 10px;
  border-radius: 50px;
  border: 1px solid rgba(0, 255, 255, 0.2);
}

.mode-label {
  font-size: 13px;
  font-weight: bold;
  color: var(--neon-blue);
  text-shadow: 0 0 5px var(--neon-blue);
}

.switch-mode {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 30px;
}

.switch-mode input { opacity: 0; width: 0; height: 0; }

.slider-mode {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: #1a1a1a;
  transition: .4s;
  border-radius: 34px;
  border: 2px solid var(--neon-blue);
}

.slider-mode:before {
  position: absolute;
  content: "";
  height: 20px; width: 20px;
  left: 4px; bottom: 3px;
  background-color: var(--neon-blue);
  transition: .4s;
  border-radius: 50%;
  box-shadow: 0 0 10px var(--neon-blue);
}

input:checked + .slider-mode { background-color: rgba(0, 255, 255, 0.2); }
input:checked + .slider-mode:before { 
  transform: translateX(30px); 
  background-color: var(--neon-green);
  box-shadow: 0 0 10px var(--neon-green);
}

/* Container Vertikal */
.analysis-grid-vertical {
  display: flex;
  flex-direction: column;
  gap: 20px;
  width: 100%;
  margin-top: 20px;
}

/* Toggle Switch Styling */
.mode-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  background: rgba(0, 255, 255, 0.05);
  padding: 12px;
  border-radius: 50px;
  border: 1px solid var(--neon-blue);
  max-width: 400px;
  margin: 0 auto;
}
.mode-label { font-size: 12px; font-weight: bold; color: var(--neon-blue); }
.switch-mode { position: relative; display: inline-block; width: 50px; height: 24px; }
.switch-mode input { opacity: 0; width: 0; height: 0; }
.slider-mode {
  position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
  background-color: #1a1a1a; border: 2px solid var(--neon-blue); border-radius: 34px; transition: .4s;
}
.slider-mode:before {
  position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 2px;
  background-color: var(--neon-blue); border-radius: 50%; transition: .4s;
}
input:checked + .slider-mode:before { transform: translateX(24px); background-color: var(--neon-green); }

/* Card Styling Sesuai Foto */
.user-card-pro {
  width: 100%;
  background: #0d1117;
  border-radius: 10px;
  overflow: hidden;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 5px 15px rgba(0,0,0,0.5);
}
.user-header-solid {
  padding: 12px;
  text-align: center;
  font-weight: bold;
  font-size: 16px;
  color: #fff;
  text-transform: uppercase;
}
.user-body-split {
  display: grid;
  grid-template-columns: 1fr 1fr;
  background: #30363d; /* Garis tengah */
  gap: 1px;
}
.col-data { background: #0d1117; padding: 15px; }
.col-header { 
  font-size: 11px; font-weight: bold; margin-bottom: 10px; 
  border-bottom: 1px solid #30363d; padding-bottom: 5px;
}
.entry-item { 
  font-family: monospace; font-size: 11px; color: #8b949e; 
  padding: 3px 0; border-bottom: 1px dashed #21262d;
}
.menu-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px 16px;
  background: rgba(0, 20, 40, 0.6);
  border: 1px solid #00f3ff;
  color: #00f3ff;
  font-family: 'Orbitron', sans-serif;
  border-radius: 8px;
  margin: 8px 0;
  cursor: pointer;
}
.menu-btn:hover {
  background: rgba(0, 243, 255, 0.1);
  box-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
}
/* === NEURO-SCAN AUTH v2.6 === */
#neuroAuthOverlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: linear-gradient(135deg, #000428, #004e92);
  z-index: 99999;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  color: #0ff;
  font-family: 'Orbitron', sans-serif;
  overflow: hidden;
}
/* Neural Network Background */
#neuroAuthOverlay::before {
  content: "";
  position: absolute;
  top: 0; left: 0; width: 100%; height: 100%;
  background: 
    radial-gradient(circle at 20% 30%, rgba(0, 255, 255, 0.05), transparent 40%),
    radial-gradient(circle at 80% 70%, rgba(157, 0, 255, 0.05), transparent 40%);
  animation: pulseBG 8s infinite alternate;
}
@keyframes pulseBG {
  0% { opacity: 0.3; }
  100% { opacity: 0.7; }
}

/* Retina Scan Circle */
.retina-scan {
  position: relative;
  width: 160px;
  height: 160px;
  margin-bottom: 50px;
}
.retina-core {
  position: absolute;
  width: 100%; height: 100%;
  border-radius: 50%;
  background: radial-gradient(circle, #000, #001122);
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
}
.retina-ring {
  position: absolute;
  top: 50%; left: 50%;
  width: 120px; height: 120px;
  transform: translate(-50%, -50%);
  border: 2px solid #00f3ff;
  border-radius: 50%;
  animation: rotateRing 12s linear infinite;
}
.retina-laser {
  position: absolute;
  top: 0; left: 50%;
  width: 2px; height: 100%;
  background: linear-gradient(to bottom, transparent, #00ffff, transparent);
  transform-origin: center;
  animation: scanLaser 4s linear infinite;
}
@keyframes rotateRing {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  100% { transform: translate(-50%, -50%) rotate(360deg); }
}
@keyframes scanLaser {
  0% { transform: translateX(-50%) rotate(0deg); opacity: 0.7; }
  100% { transform: translateX(-50%) rotate(360deg); opacity: 0.3; }
}

/* Voice Wave */
.voice-wave {
  display: flex;
  gap: 4px;
  margin-top: 30px;
}
.voice-bar {
  width: 6px;
  background: #00f3ff;
  border-radius: 3px;
  animation: wavePulse 1.5s infinite ease-in-out;
}
.voice-bar:nth-child(2) { animation-delay: 0.1s; height: 20px; }
.voice-bar:nth-child(3) { animation-delay: 0.2s; height: 30px; }
.voice-bar:nth-child(4) { animation-delay: 0.3s; height: 25px; }
.voice-bar:nth-child(5) { animation-delay: 0.4s; height: 20px; }
@keyframes wavePulse {
  0%, 100% { transform: scaleY(1); opacity: 0.6; }
  50% { transform: scaleY(1.5); opacity: 1; }
}
@keyframes zoomIn {
  0% { transform: scale(0.1); opacity: 0; }
  70% { transform: scale(1.1); opacity: 1; }
  100% { transform: scale(1); opacity: 1; }
}
@keyframes glowPulse {
  0%, 100% { text-shadow: 0 0 20px rgba(0, 243, 255, 0.8); }
  50% { text-shadow: 0 0 35px rgba(157, 0, 255, 0.9), 0 0 50px rgba(0, 243, 255, 1); }
}
</style>
</head>
<body class="bg-default">
<!-- STAF ONBOARDING OVERLAY -->
<div id="stafOnboardingOverlay" style="
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: linear-gradient(135deg, #000428, #004e92);
  z-index: 999999;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  color: #00f3ff;
  font-family: 'Orbitron', sans-serif;
  overflow: hidden;
">
  <!-- Planet Icon -->
  <div style="margin-bottom: 30px;">
    <svg viewBox="0 0 64 64" width="60" height="60">
      <circle cx="32" cy="32" r="18" fill="none" stroke="#00f3ff" stroke-width="2">
        <animate attributeName="r" values="14;18;14" dur="2.5s" repeatCount="indefinite"/>
      </circle>
      <circle cx="32" cy="32" r="10" fill="#00f3ff">
        <animate attributeName="fill" values="#00f3ff;#0088ff;#00f3ff" dur="3s" repeatCount="indefinite"/>
      </circle>
    </svg>
  </div>

  <h2 style="
    font-size: 28px;
    margin-bottom: 20px;
    text-shadow: 0 0 10px rgba(0, 243, 255, 0.8);
    letter-spacing: 1.5px;
  ">👤 MASUKKAN NAMA STAF</h2>

  <input type="text"
         id="stafNamaInput"
         placeholder="Contoh: CS LINE / KAPTEN"
         maxlength="30"
         style="
           padding: 14px 24px;
           width: 320px;
           background: rgba(0, 20, 50, 0.7);
           border: 2px solid #00f3ff;
           border-radius: 14px;
           color: #00f3ff;
           font-size: 18px;
           text-align: center;
           outline: none;
           box-shadow: 0 0 15px rgba(0, 243, 255, 0.5);
           font-family: 'Orbitron', sans-serif;
         "
         autocomplete="off"
  />

  <button id="stafSubmitBtn"
          style="
            margin-top: 24px;
            padding: 12px 32px;
            background: linear-gradient(145deg, rgba(0,243,255,0.3), rgba(0,150,255,0.3));
            color: #00f3ff;
            border: 2px solid #00f3ff;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 12px rgba(0,243,255,0.4);
          "
          onclick="submitStafNama()"
  >
    ✅ LANJUT
  </button>

  <div class="hologram-branding" style="
    position: absolute;
    bottom: 20px;
    right: 20px;
    font-size: 13px;
    letter-spacing: 1.5px;
    opacity: 0.8;
  ">STAF LINETOGEL</div>
</div>

<!-- SELAMAT BEKERJA ZOOM MODAL -->
<div id="selamatBekerjaModal" style="
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0, 5, 20, 0.95);
  z-index: 999998;
  display: none;
  justify-content: center;
  align-items: center;
  flex-direction: column;
">
  <div id="selamatText" style="
    font-family: 'Orbitron', sans-serif;
    font-size: 5vw;
    color: transparent;
    background: linear-gradient(90deg, #00f3ff, #9d00ff, #00f3ff);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    background-clip: text;
    text-align: center;
    text-shadow: 0 0 20px rgba(0, 243, 255, 0.8);
    animation: glowPulse 2s ease infinite, zoomIn 1.2s forwards;
    transform: scale(0.1);
    opacity: 0;
  ">SELAMAT BEKERJA</div>
  <div id="stafNamaDisplay" style="
    margin-top: 20px;
    color: #00f3ff;
    font-size: 24px;
    text-shadow: 0 0 12px rgba(0, 243, 255, 0.7);
    font-family: 'Orbitron', sans-serif;
  "></div>
</div>
  <!-- CYBER BACKGROUND -->
<canvas id="cyberBg" style="position:fixed;top:0;left:0;width:100%;height:100%;z-index:-2;"></canvas>
<div style="position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 20% 80%, rgba(0,243,255,0.05), transparent 30%), radial-gradient(circle at 80% 20%, rgba(157,0,255,0.05), transparent 30%);z-index:-1;"></div>

  <button id="toggleSidebarBtn" style="
  position: fixed;
  top: 15px;
  left: 15px;
  z-index: 1001;
  background: rgba(0, 20, 40, 0.7);
  color: #00ffff;
  border: 1px solid #00ffff;
  border-radius: 6px;
  padding: 6px 10px;
  cursor: pointer;
  font-weight: bold;
  box-shadow: 0 0 8px rgba(0,255,255,0.5);
">💀</button>

<!-- === KONTAINER: SIDEBAR + KONTEN === -->
<div class="main-container">
<div class="neon-sidebar-glow"></div>
<!-- === SIDEBAR MENU === -->
<div class="sidebar-container">
<!-- Logo / Judul -->
<div class="sidebar-brand">
  <div class="planet-icon">
    <svg viewBox="0 0 64 64" width="52" height="52">
      <circle cx="32" cy="32" r="14" fill="none" stroke="#00f3ff" stroke-width="2">
        <animate attributeName="r" values="10;14;10" dur="2s" repeatCount="indefinite"/>
      </circle>
      <circle cx="32" cy="32" r="8" fill="#00f3ff">
        <animate attributeName="fill" values="#00f3ff;#0088ff;#00f3ff" dur="3s" repeatCount="indefinite"/>
      </circle>
      <ellipse cx="32" cy="32" rx="24" ry="10" fill="none" stroke="#00f3ff" stroke-width="1.5" stroke-dasharray="5,5">
        <animateTransform attributeName="transform" attributeType="XML" type="rotate" from="0 32 32" to="360 32 32" dur="10s" repeatCount="indefinite"/>
      </ellipse>
    </svg>
  </div>
  <h2>LINE<span class="brand-accent">TOGEL</span></h2>
</div>
<!-- Jam Digital -->
<div id="clock">00:00:00</div>

      <button class="neon-button active" onclick="loadNotes('KENDALA ALL'); showTab('catatanTab', this)">
        <i class="fas fa-headset"></i>
        <span>KENDALA ALL</span>
      </button>
      <button class="neon-button" onclick="loadNotes('FOTO'); showTab('catatanTab', this)">
        <i class="fas fa-camera"></i>
        <span>FOTO</span>
      </button>
      <button class="neon-button" onclick="loadNotes('CARA BERMAIN'); showTab('catatanTab', this)">
        <i class="fas fa-book-open"></i>
        <span>CARA BERMAIN</span>
      </button>
      <button class="neon-button" onclick="showTab('tryCariTab', this)">
        <i class="fas fa-search"></i>
        <span>TRY CARI SELISIH</span>
      </button>
      <button class="neon-button" onclick="showTab('prediksiGabungTab', this)">
        <i class="fas fa-bullseye"></i>
        <span>PREDIKSI & HITUNG</span>
      </button>
      <button class="neon-button" onclick="showTab('cekBonusEventTab', this)">
        <i class="fas fa-gem"></i>
        <span>CEK BONUS EVENT</span>
      </button>
      <button class="neon-button" onclick="showHadiahTab(); showTab('cekhadiahTab', this)">
        <i class="fas fa-medal"></i>
        <span>HADIAH TOGEL</span>
      </button>
      <button class="neon-button" onclick="loadReportLineData(); showTab('reportLineTab', this)">
        <i class="fas fa-file-alt"></i>
        <span>REPORT LINE</span>
      </button>
      <button class="neon-button" onclick="showTab('tanyaZTab', this)">
        <i class="fas fa-robot"></i>
        <span>TANYA Z (AI)</span>
      </button>
<button class="neon-button" onclick="showTab('pengaturanTab', this); openPengaturan()">
  <span class="quantum-icon">⚙️</span>
  <span>Pengaturan Togel</span>
  <span class="tooltip-text">Pengaturan Togel</span>
</button>

</div>

<!-- === TAB: TANYA Z (AI CHAT - TANPA SUARA) === -->
<div id="tanyaZTab" class="tab-content">
  <h3 class="judul-glow">🤖 Z</h3>
  <div id="chatHistory" class="chat-container"></div>

  <div class="chat-input-container">
    <div id="chatInput" contenteditable="true" class="chat-input-div" 
         placeholder="Ketik pesan atau /gambar: ..."></div>
    <button id="sendButton" onclick="sendMessage()" class="neon-button">SEND</button>
  </div>
</div>

<!-- === TAB: CATATAN UTAMA === -->
<div id="catatanTab" class="tab-content" style="display: block;">
  <div class="main">
    <h3 id="judulCatatan" class="judul-glow">💫 LINE TOGEL 💫</h3>
  </div>

  <div id="notesHeader" style="margin-bottom: 24px; font-weight: bold; font-size: 18px; color: #00ffff; text-align: center;">
    💫 <span style="text-shadow: 0 0 5px #00ffff;">Daftar Catatan:</span>
  </div>

  <!-- ✅ CONTAINER KONTEN RESPONSIF -->
  <div class="content-wrapper">
    <!-- Pencarian -->
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="🔍 Cari catatan..." oninput="searchNotes()" />
    </div>
    
    <!-- Daftar Catatan -->
    <div id="notesList">
      <strong>LINE TOGEL</strong>
    </div>
  </div>
</div>

<!-- Lightbox -->
<div id="lightbox" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); z-index: 10000; flex-direction: column; justify-content: center; align-items: center;">

<div onclick="hideLightbox()" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;"></div>

<div style="position: relative; display: flex; flex-direction: column; align-items: center; max-width: 95%; max-height: 95%;">

<span onclick="hideLightbox()" style="position: absolute; top: -30px; right: -20px; font-size: 40px; color: #00FFFF; cursor: pointer; text-shadow: 0 0 10px #00ffff;">&times;</span>

<img id="lightboxImg" src="" alt="Preview Zoom" style="max-width: 100%; max-height: 80vh; transition: transform 0.3s ease; cursor: grab;">

<div style="margin-top: 20px; display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 15px;">
<button onclick="changeLightbox(-1)" class="nav-button">Prev</button>
<button onclick="event.stopPropagation(); copyPhotoFromLightbox()" class="action-button">
    <i class="fas fa-copy"></i> Copy Foto
</button>
<button onclick="changeLightbox(1)" class="nav-button">Next</button>
</div>

<div class="zoom-slider-container" style="width: 250px; margin-top: 15px;">
<input id="zoomSlider" type="range" min="0.5" max="3" step="0.1" value="1" style="width: 100%;">
</div>

</div>
</div>
<!-- === TAB: PREDIKSI & HITUNG TOGEL (QUANTUM CORE EDITION) === -->
<div id="prediksiGabungTab" class="tab-content" style="display: none;">

  <!-- INPUT LINK GAMBAR — QUANTUM STYLING -->
  <div class="quantum-input-card">
    <div class="quantum-card-header">
      <span class="quantum-icon">🔗</span>
      <h3 class="quantum-card-title">Link Gambar OCR</h3>
    </div>
    <input type="text" id="membacaIsiFoto_input"
           placeholder="Tempel link gambar di sini..."
           oninput="membacaIsiFoto_prosesLink()"
           class="quantum-input" />
  </div>

  <!-- MODAL OCR — FULL GLASSMORPHISM + NEON FRAME -->
  <div id="membacaIsiFoto_modal" class="quantum-modal">
    <!-- Close Button -->
 <div id="membacaIsiFoto_tombolTutup" onclick="membacaIsiFoto_tutup()" class="modal-close-btn">✖</div>

    <!-- Content Grid -->
    <div class="quantum-modal-grid">
      <!-- Gambar -->
      <div class="quantum-modal-image-container">
        <img id="membacaIsiFoto_gambar" src="" alt="OCR Image"
             class="quantum-modal-image" />
      </div>

      <!-- Hasil OCR -->
      <div id="membacaIsiFoto_hasil" class="quantum-modal-result">
        <i>Menunggu gambar...</i>
      </div>
    </div>
  </div>

  <!-- HITUNGAN TOGEL — QUANTUM PANEL -->
  <div class="quantum-card">
    <div class="quantum-card-header">
      <span class="quantum-icon">🧮</span>
      <h3 class="quantum-card-title">Hitung Togel</h3>
    </div>

    <!-- Nominal Group -->
    <div class="nominal-group quantum-nominal-group">
      <label>Nominal Bettingan:</label>
      <input type="number" id="nominalInput" class="quantum-input" />
      <button onclick="updateNominalTogel()" class="quantum-btn">Simpan</button>
    </div>

    <!-- Dropdowns -->
    <div class="quantum-dropdown-group">
      <select id="kelompokDropdown" class="quantum-dropdown" onchange="isiDropdownLabel()">
        <option value="">-- Pilih Tipe Hitungan --</option>
      </select>
      <select id="labelDropdown" class="quantum-dropdown" onchange="tampilkanValueHitungan()">
        <option value="">-- Pilih Label --</option>
      </select>
    </div>

    <!-- Detail Hitungan -->
    <div id="detailHitunganDropdown" class="quantum-detail-box"></div>
  </div>

  <hr class="quantum-hr" />

  <!-- PREDIKSI & JADWAL — DUAL CARD LAYOUT -->
  <div class="quantum-card">
    <div class="quantum-card-header">
      <span class="quantum-icon">🌠</span>
      <h3 class="quantum-card-title">Prediksi & Jadwal Togel</h3>
    </div>

<!-- Search + Date Toggle -->
<div class="quantum-search-bar">
  <input type="text" id="searchPasaran" class="quantum-input" placeholder="Cari prediksi atau jadwal..." oninput="searchDropdowns()" />
  <button id="btnToggleTanggal" class="quantum-btn" onclick="toggleTanggalPasaran()">Ganti Tanggal</button>
</div>

<!-- Form Tanggal — Compact Card Style -->
<div id="formTanggal" class="quantum-date-card">
  <span class="quantum-date-label">📆 Tanggal:</span>
  <input type="date" id="tanggalPasaran" class="quantum-date-input" />
  <button onclick="simpanTanggalPasaran()" class="quantum-date-btn">Simpan</button>
</div>

    <!-- Dual Columns -->
    <div class="quantum-dual-grid">
      <!-- Prediksi -->
      <div class="quantum-subcard">
        <label class="quantum-subtitle">🌌 Prediksi Togel</label>
        <select id="dropdownPrediksi" class="quantum-dropdown" onchange="showDetail('prediksi')"></select>
        <div id="detailPrediksi" class="quantum-detail-box" onclick="copyToClipboardDetail(this)"></div>
      </div>

      <!-- Jadwal -->
      <div class="quantum-subcard">
        <label class="quantum-subtitle">🪐 Jadwal Togel</label>
        <select id="dropdownJadwal" class="quantum-dropdown" onchange="showDetail('jadwal')"></select>
        <div id="detailJadwal" class="quantum-detail-box" onclick="copyToClipboardDetail(this)"></div>
      </div>
    </div>
  </div>
</div>
<!-- ================= TAB CEK BONUS EVENT ================= -->
<div id="cekBonusEventTab" class="tab-content" style="display: none;">

  <div class="bonus-section">
    <h3 class="judul-glow">💫 LINE TOGEL 💫</h3>
    <h2 class="bonus-title">💎 BONUS EVENT 💎</h2>

    <!-- ============ 3 SWITCH MODE BUTTON (NEON TRANSPARAN) ============ -->
    <div style="display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin: 15px 0;">
      <button class="neon-switch-btn" onclick="switchBonusMode('bonusAsli')" id="btn-bonusAsli">
        💎 Cek Bonus Asli
      </button>
      <button class="neon-switch-btn" onclick="switchBonusMode('galeri')" id="btn-galeri">
        📸 Galeri Gambar
      </button>
      <button class="neon-switch-btn" onclick="switchBonusMode('inputScatter')" id="btn-inputScatter">
        📋 Input Scatter (2 Data)
      </button>
    </div>
    <!-- ============ MODE 1: CEK BONUS ASLI ============ -->
    <div id="modeBonusAsli" class="bonus-mode">
      <textarea id="bonusTextarea" class="bonus-textarea" placeholder="Tempelkan data transaksi di sini..."></textarea>
      <div class="bonus-input-group">
        <label for="bonusPatokan" class="bonus-label">Nilai Patokan:</label>
        <input type="text" id="bonusPatokan" class="bonus-input" placeholder="Contoh: 5000000">
      </div>
      <div class="bonus-input-group">
        <label for="bonusSurplus" class="bonus-label">Nilai Surplus:</label>
        <input type="text" id="bonusSurplus" class="bonus-input" placeholder="Contoh: 1500000">
      </div>
      <div class="bonus-button-group">
        <button onclick="hitungBonusEvent()" class="bonus-btn">🔍 Hitung Bonus</button>
        <button onclick="hapusBonusEvent()" class="bonus-btn danger">🧹 Bersihkan</button>
      </div>
      <div id="bonusHasil" class="bonus-result"></div>
      <label for="imageUrl" style="color:#00ffff; margin-top:10px;">🔗 Link Gambar Transaksi:</label>
      <input type="text" id="imageUrl" class="bonus-input" placeholder="Tempel link gambar di sini..." style="width: 100%;">
    </div>

    <!-- ============ MODE 2: GALERI GAMBAR ============ -->
    <div id="modeGaleri" class="bonus-mode" style="display: none;">
      <h2 class="bonus-title">📸 GALERI GAMBAR</h2>
      <p style="text-align: center; color: #3498db; margin-bottom: 12px;">
        **Tempel/Ketik** data. Format: <strong>USERID link1 link2 link3</strong>
      </p>
      <textarea id="bonusLinkInput" 
                placeholder="Tempelkan data paket di sini. Setiap baris = satu paket."
                rows="6"
                oninput="handleBonusInput()"
                onpaste="handleBonusInput()"></textarea>
      <div class="bonus-button-group">
        <button onclick="clearBonusAllData()" class="bonus-btn danger">🗑️ Hapus Semua</button>
      </div>
      <hr style="margin: 20px 0; border-color: #00ffff44;">
      <div class="gallery-container" style="display: flex; justify-content: center; margin: 20px 0;">
        <div class="combined-image-slot" id="bonusCombinedImageSlot" onclick="openBonusZoom()">
          <p class="caption-userid" id="bonusCombinedSlotUserid" style="color: #00ffff; text-align: center; margin: 0 0 10px; font-weight: bold;">USER ID</p>
          <img id="bonusImgSlot1" src="https://via.placeholder.com/180x160/0a1a2f/ffffff?text=1" style="width:110px; height:100px; object-fit:cover; border-radius:8px; margin:0 4px;">
          <img id="bonusImgSlot2" src="https://via.placeholder.com/180x160/0a1a2f/ffffff?text=2" style="width:110px; height:100px; object-fit:cover; border-radius:8px; margin:0 4px;">
          <img id="bonusImgSlot3" src="https://via.placeholder.com/180x160/0a1a2f/ffffff?text=3" style="width:110px; height:100px; object-fit:cover; border-radius:8px; margin:0 4px;">
        </div>
      </div>
      <p class="package-info" style="text-align: center; color: #00ffff; margin-top: 10px;">
        Paket: <span id="bonusCurrentPackageNum">0</span> / <span id="bonusMaxPackageNum">0</span>
      </p>
    </div>

    <!-- ============ MODE 3: INPUT SCATTER (2 DATA) ============ -->
<div id="modeInputScatter" class="bonus-mode" style="display: none;">
  <!-- WRAPPER FLEX UNTUK SUSUN KIRI-KANAN -->
  <div style="display: flex; gap: 16px; justify-content: space-between; flex-wrap: wrap;">
    
    <!-- DATA 1 -->
    <div style="flex: 1; min-width: 280px; background: rgba(0,15,30,0.5); padding: 10px; border-radius: 8px; border: 1px solid #00ffff33;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
        <h4 style="color: #00ffff; margin: 0; font-size: 15px;">DATA SCATTER 1</h4>
        <button onclick="copyData1()" class="neon-switch-btn" style="padding: 4px 10px; font-size: 12px;">📋 Copy</button>
      </div>
      <div class="bonus-input-group" style="margin: 4px 0;">
        <label class="bonus-label" style="font-size: 12px;">1. UID:</label>
        <input type="text" id="bonusUserid1" class="bonus-input" placeholder="San221" style="padding: 5px; font-size: 13px; height: 28px; width: 100%;">
      </div>
      <div class="bonus-input-group" style="margin: 4px 0;">
        <label class="bonus-label" style="font-size: 12px;">2. S1:</label>
        <input type="text" id="bonusScatter1_1" class="bonus-input" placeholder="Link..." style="padding: 5px; font-size: 13px; height: 28px; width: 100%;">
      </div>
      <div class="bonus-input-group" style="margin: 4px 0;">
        <label class="bonus-label" style="font-size: 12px;">3. S2:</label>
        <div style="display: flex; gap: 6px; align-items: center;">
          <input type="text" id="bonusScatter2_1" class="bonus-input" placeholder="Link..." style="flex:1; padding: 5px; font-size: 13px; height: 28px;">
          <button type="button" onclick="scanScatter2(1)" class="bonus-btn" style="padding: 4px 8px; font-size: 12px; white-space: nowrap;">📸</button>
        </div>
      </div>
      <div class="bonus-input-group" style="margin: 4px 0;">
        <label class="bonus-label" style="font-size: 12px;">4. S3:</label>
        <input type="text" id="bonusScatter3_1" class="bonus-input" placeholder="Link..." style="padding: 5px; font-size: 13px; height: 28px; width: 100%;">
      </div>
      <div class="bonus-input-group" style="margin: 4px 0;">
        <label class="bonus-label" style="font-size: 12px;">5. Rek:</label>
        <input type="text" id="bonusRekening1" class="bonus-input" placeholder="A SUWARSAN,085882449440" style="padding: 5px; font-size: 13px; height: 28px; width: 100%;">
      </div>
      <div class="bonus-input-group" style="margin: 4px 0;">
        <label class="bonus-label" style="font-size: 12px;">6. Kode:</label>
        <input type="text" id="bonusKodeTransaksi1" class="bonus-input" placeholder="Kode..." style="padding: 5px; font-size: 13px; height: 28px; width: 100%;">
      </div>
    </div>

    <!-- DATA 2 -->
    <div style="flex: 1; min-width: 280px; background: rgba(0,15,30,0.5); padding: 10px; border-radius: 8px; border: 1px solid #00ffff33;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
        <h4 style="color: #00ffff; margin: 0; font-size: 15px;">DATA SCATTER 2</h4>
        <button onclick="copyData2()" class="neon-switch-btn" style="padding: 4px 10px; font-size: 12px;">📋 Copy</button>
      </div>
      <div class="bonus-input-group" style="margin: 4px 0;">
        <label class="bonus-label" style="font-size: 12px;">1. UID:</label>
        <input type="text" id="bonusUserid2" class="bonus-input" placeholder="Budi123" style="padding: 5px; font-size: 13px; height: 28px; width: 100%;">
      </div>
      <div class="bonus-input-group" style="margin: 4px 0;">
        <label class="bonus-label" style="font-size: 12px;">2. S1:</label>
        <input type="text" id="bonusScatter1_2" class="bonus-input" placeholder="Link..." style="padding: 5px; font-size: 13px; height: 28px; width: 100%;">
      </div>
      <div class="bonus-input-group" style="margin: 4px 0;">
        <label class="bonus-label" style="font-size: 12px;">3. S2:</label>
        <div style="display: flex; gap: 6px; align-items: center;">
          <input type="text" id="bonusScatter2_2" class="bonus-input" placeholder="Link..." style="flex:1; padding: 5px; font-size: 13px; height: 28px;">
          <button type="button" onclick="scanScatter2(2)" class="bonus-btn" style="padding: 4px 8px; font-size: 12px; white-space: nowrap;">📸</button>
        </div>
      </div>
      <div class="bonus-input-group" style="margin: 4px 0;">
        <label class="bonus-label" style="font-size: 12px;">4. S3:</label>
        <input type="text" id="bonusScatter3_2" class="bonus-input" placeholder="Link..." style="padding: 5px; font-size: 13px; height: 28px; width: 100%;">
      </div>
      <div class="bonus-input-group" style="margin: 4px 0;">
        <label class="bonus-label" style="font-size: 12px;">5. Rek:</label>
        <input type="text" id="bonusRekening2" class="bonus-input" placeholder="BUDI,1234567890" style="padding: 5px; font-size: 13px; height: 28px; width: 100%;">
      </div>
      <div class="bonus-input-group" style="margin: 4px 0;">
        <label class="bonus-label" style="font-size: 12px;">6. Kode:</label>
        <input type="text" id="bonusKodeTransaksi2" class="bonus-input" placeholder="Kode..." style="padding: 5px; font-size: 13px; height: 28px; width: 100%;">
      </div>
    </div>
    </div>
  <!-- MENU AKSI (tetap di bawah) -->
  <div style="display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 20px;">
    <button onclick="copySemuaData()" class="neon-switch-btn" style="padding: 6px 12px; font-size: 13px;">
      📋 Copy Semua (2 Baris)
    </button>
    <button onclick="hapusSemuaData()" class="neon-switch-btn danger" style="padding: 6px 12px; font-size: 13px;">
      🧹 Hapus Semua
    </button>
  </div>
    </div> <!-- tutup #modeInputScatter -->
  </div> <!-- tutup .bonus-section -->
</div> <!-- ✅ TUTUP TAB -->
<!-- Modal Scan Scatter 2 -->
<div id="scanScatter2Modal" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); z-index: 10001; padding: 10px; box-sizing: border-box;">
  <button onclick="closeScanScatter2Modal()" style="position: absolute; top: 10px; right: 20px; font-size: 32px; color: #00ffff; background: none; border: none; cursor: pointer; z-index: 10002;">&times;</button>
  <h3 style="color: #00ffff; text-align: center; margin-bottom: 15px; font-size: 18px;">🔍 Scan Scatter 2</h3>
  <div style="display: flex; gap: 15px; max-width: 100%; width: 95vw; margin: 0 auto; height: 90vh; padding: 0 10px;">
    <div style="flex: 1; display: flex; justify-content: center; align-items: center; min-width: 500px;">
      <img id="scanScatter2Image" src="" style="max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 8px; box-shadow: 0 0 20px cyan;">
    </div>
    <div style="flex: 1; min-width: 400px; max-width: 700px; overflow-y: auto; padding: 20px; background: #001a2d; border-radius: 10px; border: 1px solid #00ffff; box-shadow: 0 0 8px rgba(0,255,255,0.2);">
      <div id="scanScatter2Result" style="color: #00ffff; font-family: monospace; font-size: 16px; line-height: 1.6;"></div>
    </div>
  </div>
</div>
<!-- Modal Zoom Galeri -->
<div id="bonusZoomModal" class="modal" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); z-index: 10000; color: #00ffff; padding: 20px; box-sizing: border-box;">
  <button class="close-btn" aria-label="Tutup zoom" onclick="closeBonusZoom()" style="position: absolute; top: 15px; right: 25px; font-size: 32px; background: none; border: none; color: #00ffff; cursor: pointer;">&times;</button>
  <span id="bonusZoomedUserid" class="zoomed-userid" style="display: block; text-align: center; font-size: 20px; margin-bottom: 15px; color: #00ffff;"></span> 
  <div class="zoomed-content-area" style="display: flex; align-items: center; justify-content: center; gap: 20px; flex-wrap: wrap;">
    <button class="zoom-nav-button" id="bonusPrevZoomBtn" onclick="navigateBonusPackage('prev')" style="background: rgba(0,255,255,0.2); border: 1px solid #00ffff; color: #00ffff; padding: 8px 16px; border-radius: 6px; cursor: pointer;">←</button>
    <div class="zoomed-content-wrapper" id="bonusZoomedContentWrapper" style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;"></div>
    <button class="zoom-nav-button" id="bonusNextZoomBtn" onclick="navigateBonusPackage('next')" style="background: rgba(0,255,255,0.2); border: 1px solid #00ffff; color: #00ffff; padding: 8px 16px; border-radius: 6px; cursor: pointer;">→</button>
  </div>
  <div id="bonusCaption" style="text-align: center; margin-top: 20px; color: #00ffff;">Gunakan tombol navigasi atau panah kiri/kanan pada keyboard.</div>
</div>

<!-- Modal Zoom Transaksi -->
<div id="zoomModal" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); z-index: 9999; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box;">
  <div id="closeZoomBtn" onclick="closeZoom()" style="position: absolute; top: 20px; right: 30px; font-size: 28px; color: #00ffff; cursor: pointer; user-select: none; font-weight: bold; text-shadow: 0 0 6px cyan;">&times;</div>
  <div style="display: flex; flex: 1; width: 100%; gap: 20px; align-items: center; justify-content: center;">
    <div style="flex: 1; display: flex; justify-content: center; align-items: center;">
      <img id="zoomedImage" src="" style="max-width: 90%; max-height: 80vh; border-radius: 10px; box-shadow: 0 0 20px cyan;">
    </div>
    <div id="kodeHasilZoom" style="flex: 1; color: #00ffff; font-family: monospace; font-weight: bold; white-space: pre-wrap; background: rgba(0,20,40,0.8); border-radius: 12px; padding: 16px; box-shadow: 0 0 15px cyan; max-height: 80vh; overflow-y: auto; font-size: 14px;"></div>
  </div>
  <div style="margin-top: 15px; width: 80%;">
    <input type="text" id="imageUrlZoom" placeholder="Tempel link gambar di sini..."
      style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid cyan; background: rgba(0,20,40,0.9); color: #00ffff; font-size: 14px; text-align: center;">
  </div>
</div>
<!-- Lightbox Modal -->
<div id="lightboxModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9998; flex-direction: column; justify-content: center; align-items: center;">
  <span onclick="closeLightbox()" style="position: absolute; top: 20px; right: 30px; font-size: 28px; color: #00FFFF; cursor: pointer; user-select: none;">&times;</span>
  <img id="lightboxImage" src="" style="max-width: 90%; max-height: 90%; border-radius: 10px; box-shadow: 0 0 20px #00FFFF;">
  <div>
    <button onclick="prevImage()" style="font-size: 16px; padding: 10px 20px; border: 1px solid #00FFFF; background: rgba(255,255,255,0.1); color: #00FFFF; cursor: pointer; border-radius: 5px; margin-top: 20px;">Prev</button>
    <button onclick="nextImage()" style="font-size: 16px; padding: 10px 20px; border: 1px solid #00FFFF; background: rgba(255,255,255,0.1); color: #00FFFF; cursor: pointer; border-radius: 5px; margin-left: 10px; margin-top: 20px;">Next</button>
  </div>
</div>
<!-- === STICKY NOTE FAB & PANEL === -->
<div id="stickyFab" onclick="toggleStickyPanel()">💀</div>
<div id="stickyPanel" style="display: none;">
<textarea id="stickyInput" placeholder="Tulis Sticky Note..." oninput="autoResize(this)"></textarea>
<button id="addStickyBtn" onclick="addSticky()">➕ Tambah Sticky</button>
<div id="stickyList"></div>
</div>
<!-- Modal pengaturan -->
<div id="pengaturanTab" class="tab-content">
  <h3>Pengaturan Line</h3>
<!-- 🎨 TEMA BACKGROUND (3 pilihan) -->
<div class="neon-toggle-container" style="margin: 15px 0; padding: 15px; background: rgba(0,15,30,0.6); border-radius: 14px; border: 1px solid rgba(0,229,255,0.5);">
  <h4 style="color:#00ffff; margin:0 0 12px; text-align:center; font-size:18px;">💀 TEMA BACKGROUND</h4>

  <!-- 💀 Darkgray -->
  <div style="display:flex; align-items:center; justify-content:space-between; padding:8px 0;">
    <span style="color:#66ffff; font-weight:bold;">💀 Darkgray</span>
    <label class="neon-toggle">
      <input type="radio" name="bgTheme" value="bg-default" onchange="setBgTheme('bg-default')">
      <span class="neon-toggle-switch">
        <span class="neon-toggle-knob"></span>
      </span>
    </label>
  </div>

  <!-- 🌌 LINE TOGEL -->
  <div style="display:flex; align-items:center; justify-content:space-between; padding:8px 0;">
    <span style="color:#00ffff; font-weight:bold;">🌌 LINE TOGEL</span>
    <label class="neon-toggle">
      <input type="radio" name="bgTheme" value="bg-gradient" onchange="setBgTheme('bg-gradient')">
      <span class="neon-toggle-switch">
        <span class="neon-toggle-knob"></span>
      </span>
    </label>
  </div>

  <!-- 🪐 GOKU -->
  <div style="display:flex; align-items:center; justify-content:space-between; padding:8px 0;">
    <span style="color:#ffcc00; font-weight:bold;">🪐 GOKU</span>
    <label class="neon-toggle">
      <input type="radio" name="bgTheme" value="bg-deepspace" onchange="setBgTheme('bg-deepspace')">
      <span class="neon-toggle-switch">
        <span class="neon-toggle-knob"></span>
      </span>
    </label>
  </div>
</div>

<!-- 🎨 WARNA TEKS GLOBAL (8 pilihan) -->
<div class="neon-toggle-container" style="margin: 15px 0; padding: 15px; background: rgba(0,15,30,0.6); border-radius: 14px; border: 1px solid rgba(0,229,255,0.5);">
  <h4 style="color:#00ffff; margin:0 0 12px; text-align:center; font-size:18px;">💀 WARNA TEKS</h4>

  <!-- 💙 Cyan Neon -->
  <div style="display:flex; align-items:center; justify-content:space-between; padding:6px 0;">
    <span style="color:#00ffff; font-weight:bold;">💀 Cyan Neon</span>
    <label class="neon-toggle">
      <input type="radio" name="textColor" value="#00ffff" onchange="setTextColor('#00ffff')">
      <span class="neon-toggle-switch">
        <span class="neon-toggle-knob"></span>
      </span>
    </label>
  </div>

  <!-- 💜 Cyber Purple -->
  <div style="display:flex; align-items:center; justify-content:space-between; padding:6px 0;">
    <span style="color:#9D00FF; font-weight:bold;">💀 Cyber Purple</span>
    <label class="neon-toggle">
      <input type="radio" name="textColor" value="#9D00FF" onchange="setTextColor('#9D00FF')">
      <span class="neon-toggle-switch">
        <span class="neon-toggle-knob"></span>
      </span>
    </label>
  </div>

  <!-- 💚 Plasma Green -->
  <div style="display:flex; align-items:center; justify-content:space-between; padding:6px 0;">
    <span style="color:#39FF14; font-weight:bold;">💀 Plasma Green</span>
    <label class="neon-toggle">
      <input type="radio" name="textColor" value="#39FF14" onchange="setTextColor('#39FF14')">
      <span class="neon-toggle-switch">
        <span class="neon-toggle-knob"></span>
      </span>
    </label>
  </div>

  <!-- 🟢 Matrix Green -->
  <div style="display:flex; align-items:center; justify-content:space-between; padding:6px 0;">
    <span style="color:#00ff88; font-weight:bold;">💀 Matrix Green</span>
    <label class="neon-toggle">
      <input type="radio" name="textColor" value="#00ff88" onchange="setTextColor('#00ff88')">
      <span class="neon-toggle-switch">
        <span class="neon-toggle-knob"></span>
      </span>
    </label>
  </div>

  <!-- 🟡 Golden Amber -->
  <div style="display:flex; align-items:center; justify-content:space-between; padding:6px 0;">
    <span style="color:#ffcc00; font-weight:bold;">💀 Golden Amber</span>
    <label class="neon-toggle">
      <input type="radio" name="textColor" value="#ffcc00" onchange="setTextColor('#ffcc00')">
      <span class="neon-toggle-switch">
        <span class="neon-toggle-knob"></span>
      </span>
    </label>
  </div>

  <!-- 💙 Sky Glow -->
  <div style="display:flex; align-items:center; justify-content:space-between; padding:6px 0;">
    <span style="color:#66ffff; font-weight:bold;">💀 Sky Glow</span>
    <label class="neon-toggle">
      <input type="radio" name="textColor" value="#66ffff" onchange="setTextColor('#66ffff')">
      <span class="neon-toggle-switch">
        <span class="neon-toggle-knob"></span>
      </span>
    </label>
  </div>

  <!-- ❤️ Laser Ruby -->
  <div style="display:flex; align-items:center; justify-content:space-between; padding:6px 0;">
    <span style="color:#FF073A; font-weight:bold;">💀 Laser Ruby</span>
    <label class="neon-toggle">
      <input type="radio" name="textColor" value="#FF073A" onchange="setTextColor('#FF073A')">
      <span class="neon-toggle-switch">
        <span class="neon-toggle-knob"></span>
      </span>
    </label>
  </div>

  <!-- ⚪ Pure White -->
  <div style="display:flex; align-items:center; justify-content:space-between; padding:6px 0;">
    <span style="color:#ffffff; font-weight:bold;">💀 Pure White</span>
    <label class="neon-toggle">
      <input type="radio" name="textColor" value="#ffffff" onchange="setTextColor('#ffffff')">
      <span class="neon-toggle-switch">
        <span class="neon-toggle-knob"></span>
      </span>
    </label>
  </div>
</div>

  <div id="contentPengaturan"></div>
</div>

<!-- Tab Hadiah Togel -->
<div id="cekhadiahTab" class="tab-content" style="display:none;">
<h3>💎 HADIAH TOGEL</h3>
<div id="hadiahContainer" class="hadiah-container"></div>
</div>

<div id="reportLineTab" class="tab-content" style="display: none;">

<h3 class="judul-glow">💫 LINE TOGEL 💫</h3>

<div class="report-controls-top">
<input type="text" id="reportSearch" class="search-input-report" placeholder="🔍 Cari di semua kolom..." oninput="searchReportLine()" />
</div>

<div class="report-controls-bottom">
<button onclick="addNewReportRow()" class="btn-tambah-baris-bottom">➕ Tambah Baris Kosong</button>

<div class="report-card-container" id="reportLineCardContainer">
<p style="text-align:center; color:#00ffff;">⏳ Memuat data...</p>
</div>
</div>
</div>
<!-- === TAB: TRY CARI (SEMUA FITUR DALAM SATU TAB) === -->
<div id="tryCariTab" class="tab-content" style="display: none;">
  <h2 style="color: var(--neon-blue); text-align: center; text-shadow: 0 0 10px rgba(0,255,255,0.9); margin: 20px 0;">
    🔍 TRY CARI & 💰 DEPOSIT-WD
  </h2>

  <!-- SUB-MODE SWITCH -->
  <div style="display: flex; justify-content: center; gap: 12px; margin: 15px 0; flex-wrap: wrap;">
    <button class="neon-button sub-mode-btn active" data-mode="tryCari">🔍 TRY CARI MANUAL</button>
    <button class="neon-button sub-mode-btn" data-mode="depoWd">💰 DEPO vs WD</button>
    <button class="neon-button sub-mode-btn" data-mode="extractor">📤 EXTRACT WITHDRAW</button>
  </div>

  <!-- === SUB-MODE 1: TRY CARI (DOCS vs ADMIN) === -->
  <div id="sub-tryCari" class="sub-mode-content" style="display: block; padding: 0 20px;">
    <div style="display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
      <div style="flex: 1; min-width: 300px;">
        <div style="display: flex; gap: 6px; margin-bottom: 10px; flex-wrap: wrap;">
          <button onclick="clearField('dataDocs'); prosesData_TRYCARI()" class="neon-btn" style="padding:5px 10px; font-size:12px;">🗑️ Hapus</button>
          <button onclick="prosesData_TRYCARI()" class="neon-btn" style="padding:5px 10px; font-size:12px;">🔄 Refresh</button>
        </div>
        <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--neon-blue);">📄 Data dari DOCS</label>
        <textarea id="dataDocs" placeholder="Paste data DOCS (4 kolom dipisah TAB)..." style="width:100%; height:150px; padding:10px; font-family:monospace; background:rgba(0,10,30,0.8); color:var(--text-main); border:1px solid var(--neon-blue); border-radius:6px; resize:vertical;"></textarea>
      </div>
      <div style="flex: 1; min-width: 300px;">
        <div style="display: flex; gap: 6px; margin-bottom: 10px; flex-wrap: wrap;">
          <button onclick="clearField('dataAdmin'); prosesData_TRYCARI()" class="neon-btn" style="padding:5px 10px; font-size:12px;">🗑️ Hapus</button>
          <button onclick="prosesData_TRYCARI()" class="neon-btn" style="padding:5px 10px; font-size:12px;">🔄 Refresh</button>
        </div>
        <label style="display: block; margin-bottom: 8px; font-weight: bold; color: var(--neon-blue);">📊 Data dari ADMIN</label>
        <textarea id="dataAdmin" placeholder="Paste data ADMIN (4 kolom dipisah TAB)..." style="width:100%; height:150px; padding:10px; font-family:monospace; background:rgba(0,10,30,0.8); color:var(--text-main); border:1px solid var(--neon-blue); border-radius:6px; resize:vertical;"></textarea>
      </div>
    </div>
    <button onclick="prosesData_TRYCARI()" style="background:linear-gradient(145deg, #0288d1, #0277bd); color:white; border:none; padding:12px 24px; font-size:16px; border-radius:6px; cursor:pointer; display:block; margin:20px auto; font-weight:bold; box-shadow:0 0 8px #00b0ff; transition:all 0.3s;">
      🔍 BANDINGKAN DATA
    </button>
    <div id="hasil_TRYCARI"></div>
  </div>

  <!-- === SUB-MODE 2: DEPOSIT vs WITHDRAW === -->
  <div id="sub-depoWd" class="sub-mode-content" style="display: none; padding: 0 20px;">
    <h3 style="color: var(--neon-blue); text-align: center; margin: 20px 0;">💰 Analisis DEPOSIT vs WITHDRAW</h3>
    <div class="mode-container">
  <span class="mode-label">👤 PER PENGGUNA</span>
  <label class="switch-mode">
    <input type="checkbox" id="toggleMode" onchange="prosesDepositWithdraw()">
    <span class="slider-mode"></span>
  </label>
  <span class="mode-label">🏦 PER BANK</span>
</div>
    <div class="input-section">
      <div class="section">
        <div class="section-title">📥 DATA DEPOSIT</div>
        <textarea id="dataDeposit" placeholder="Contoh: DEPO BCA / NAMA	10000000"></textarea>
        <div class="buttons">
          <button class="neon-btn" onclick="clearDeposit()">🗑️ Hapus</button>
          <button class="neon-btn" onclick="loadDeposit()">📥 Ambil Data</button>
        </div>
      </div>
      <div class="section">
        <div class="section-title">📤 DATA WITHDRAW</div>
        <textarea id="dataWithdraw" placeholder="Contoh: KIRIM DANA	10000000	DEPO BCA / NAMA"></textarea>
        <div class="buttons">
          <button class="neon-btn" onclick="clearWithdraw()">🗑️ Hapus</button>
          <button class="neon-btn" onclick="loadWithdraw()">📤 Ambil Data</button>
        </div>
      </div>
    </div>
    <div style="text-align: center; margin: 20px 0;">
      <button class="neon-btn" onclick="prosesDepositWithdraw()">⚡ PROSES ANALISIS</button>
    </div>
    <div id="hasilDepoWd"></div>
  </div>

  <!-- === SUB-MODE 3: EXTRACTOR === -->
  <div id="sub-extractor" class="sub-mode-content" style="display: none; padding: 0 20px;">
    <div class="common-panel">
      <div class="extract-h-title">📤 EXTRACT 100 DATA WITHDRAW (HORIZONTAL)</div>
      <textarea id="bulkExtractInput" class="extract-h-input" placeholder="Tempel data..."></textarea>
      <div class="extract-h-buttons">
        <button class="neon-btn" onclick="clearBulkExtract()">🗑️ Hapus Semua</button>
        <button class="neon-btn" onclick="processBulkExtract()">🔍 Ambil Data</button>
        <button class="neon-btn" onclick="copyBulkExtracted()">📋 Copy Semua</button>
      </div>
      <div class="extract-h-container" id="bulkResultsContainer"></div>
    </div>
  </div>
</div>
<!-- TOAST NOTIFICATION -->
<div id="toastNotif">Sistem Cyber Core berhasil dimuat ✨</div>
</body>
<script>

document.addEventListener('DOMContentLoaded', () => {
  // ================================
  // 0. FORCE HIDE PANEL YANG TIDAK BOLEH MUNCUL OTOMATIS
  // ================================
  // — Tanya Z
  const tanyaZTab = document.getElementById('tanyaZTab');
  if (tanyaZTab) {
    tanyaZTab.style.display = 'none';
  }

  // — Sticky Notes Panel
  const stickyPanel = document.getElementById('stickyPanel');
  if (stickyPanel) {
    stickyPanel.style.display = 'none';
  }

  // ================================
  // 1. Sidebar Toggle
  // ================================
  const toggleSidebarBtn = document.getElementById('toggleSidebarBtn');
  const sidebarContainer = document.querySelector('.sidebar-container');

  if (toggleSidebarBtn && sidebarContainer) {
    let sidebarVisible = localStorage.getItem('sidebarVisible') !== 'false';
    sidebarContainer.style.display = sidebarVisible ? 'flex' : 'none';
    toggleSidebarBtn.textContent = sidebarVisible ? '💀' : '💀';

    toggleSidebarBtn.addEventListener('click', () => {
      sidebarVisible = !sidebarVisible;
      sidebarContainer.style.display = sidebarVisible ? 'flex' : 'none';
      toggleSidebarBtn.textContent = sidebarVisible ? '💀' : '💀';
      localStorage.setItem('sidebarVisible', sidebarVisible); // ✅ typo diperbaiki
    });
  }

  // ================================
  // 2. Global Text Color (Picker)
  // ================================
  const picker = document.getElementById('globalTextColor');
  if (picker) {
    const savedColor = localStorage.getItem('globalTextColor') || '#00ffff';
    picker.value = savedColor;
    applyGlobalTextColor(savedColor);
    picker.addEventListener('change', (e) => {
      const newColor = e.target.value;
      applyGlobalTextColor(newColor);
      localStorage.setItem('globalTextColor', newColor);
    });
  }

  // ================================
  // 3. Sync Radio Button Themes
  // ================================
  const bgSaved = localStorage.getItem('backgroundTheme') || 'bg-default';
  const bgRadio = document.querySelector(`input[name="bgTheme"][value="${bgSaved}"]`);
  if (bgRadio) bgRadio.checked = true;
  setBgTheme(bgSaved);

  const colorSaved = localStorage.getItem('globalTextColor') || '#00ffff';
  const colorRadio = document.querySelector(`input[name="textColor"][value="${colorSaved}"]`);
  if (colorRadio) colorRadio.checked = true;
  setTextColor(colorSaved);

  // ================================
  // 4. Hasil Scatter Display
  // ================================
  const hasilScatter = document.getElementById('hasilScatter');
  if (hasilScatter) {
    hasilScatter.style.display = 'block';
  }

  // ================================
  // 6. Sticky Input (Image Paste)
  // ================================
  const stickyInput = document.getElementById('stickyInput');
  if (stickyInput) {
    stickyInput.addEventListener('paste', async (e) => {
      for (const item of e.clipboardData.items) {
        if (item.type.startsWith('image/')) {
          const blob = item.getAsFile();
          if (blob) {
            const reader = new FileReader();
            reader.onload = (ev) => {
              stickyInput.dataset.image = ev.target.result;
              stickyInput.value = '📷 Gambar siap tempel!';
              if (typeof autoResize === 'function') autoResize(stickyInput);
            };
            reader.readAsDataURL(blob);
          }
          break;
        }
      }
    });
  }

  // ================================
  // 7. Scatter Textarea Logic
  // ================================
  const scatterTextarea = document.getElementById('scatterTextarea');
  if (scatterTextarea) {
    scatterTextarea.addEventListener('paste', () => setTimeout(hitungScatter, 50));
    scatterTextarea.addEventListener('input', hitungScatter);
  }

  // ================================
  // 8. Image URL Inputs (Scan & Zoom)
  // ================================
  const imageUrl = document.getElementById('imageUrl');
  if (imageUrl) {
    imageUrl.addEventListener('input', () => {
      const url = imageUrl.value.trim();
      if (url && url.startsWith('http')) {
        if (typeof zoomAndScan === 'function') zoomAndScan(url);
      }
    });
  }

  const imageUrlZoom = document.getElementById('imageUrlZoom');
  if (imageUrlZoom) {
    imageUrlZoom.addEventListener('input', function () {
      const link = this.value.trim();
      if (link && typeof zoomAndScan === 'function') {
        zoomAndScan(link);
      }
    });
  }

  // ================================
  // 9. Modal Zoom Click Handling
  // ================================
  const zoomModal = document.getElementById('zoomModal');
  if (zoomModal) {
    zoomModal.addEventListener('click', (e) => e.stopPropagation());
    document.addEventListener('click', (e) => {
      const insideModal = zoomModal.contains(e.target);
      const input = document.getElementById('imageUrl');
      const insideInput = input && input.contains(e.target);
      if (zoomModal.style.display === 'flex' && !insideModal && !insideInput) {
        if (typeof closeZoom === 'function') closeZoom();
      }
    });
  }

  // ================================
  // 10. FORCE HIDE MENU SPESIFIK (opsional, dari akhir file)
  // ================================
  const kendalaAllContent = document.getElementById('kendalaAllContent');
  if (kendalaAllContent) kendalaAllContent.style.display = 'none';

  const fotoContent = document.getElementById('FOTOContent');
  if (fotoContent) fotoContent.style.display = 'none';
});

function removeSpecialEffects() {
  const styleIds = [
    'matrixGreenStyle', 'plasmaGreenStyle', 'laserRubyStyle', 
    'cyberPurpleStyle', 'pureWhiteStyle', 'skyGlowStyle'
  ];
  styleIds.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.remove();
  });
}
// === SET TEMA BACKGROUND ===
function setBgTheme(theme) {
  document.body.className = theme;
  localStorage.setItem('backgroundTheme', theme);
}

function applyGlobalTextColor(color) {
  // Simpan pilihan
  localStorage.setItem('globalTextColor', color);

  // 1. Ganti variabel CSS (untuk elemen yang pakai var)
  document.documentElement.style.setProperty('--txt-main', color);
  document.documentElement.style.setProperty('--txt-highlight', color);

  // 2. GANTI SEMUA TEKS DI SELURUH HALAMAN (Paksa!)
  const allTextElements = document.querySelectorAll(`
    *, 
    input, 
    textarea, 
    select, 
    option,
    .note-title,
    .note-content-preview,
    .judul-glow,
    h1, h2, h3, h4, h5,
    label,
    .bonus-title,
    .foto-title,
    .report-card *,
    .message-bubble,
    #clock,
    .neon-button,
    .copy-button,
    .btn-action,
    .report-display-value,
    .report-edit-input,
    .search-bar input,
    .pasaran-search,
    .input-tanggal,
    #searchInput,
    .chat-input-div,
    .tab-button,
    .color-scheme-picker label
  `);

  allTextElements.forEach(el => {
    // Skip elemen yang tidak boleh diubah (misal: ikon Font Awesome)
    if (el.tagName === 'I' && el.classList.contains('fas')) return;
    if (el.tagName === 'svg') return;

    // Paksa ganti warna + tambahkan text-shadow agar tetap terbaca
    el.style.setProperty('color', color, 'important');
    if (!el.style.textShadow) {
      el.style.setProperty('text-shadow', '0 0 2px rgba(0,0,0,0.7)', 'important');
    }
  });

  // 3. Terapkan efek khusus
  removeSpecialEffects();
  if (color === '#00ff80') applyMatrixEffect();
  else if (color === '#39FF14') applyPlasmaGreenEffect();
  else if (color === '#FF073A') applyLaserRubyEffect();
  else if (color === '#9D00FF') applyCyberPurpleEffect();
  else if (color === '#ffffff') applyPureWhiteEffect();
  else if (color === '#66ffff') applySkyGlowEffect();
}

function applyPureWhiteEffect() {
  if (document.getElementById('pureWhiteStyle')) return;
  const s = document.createElement('style');
  s.id = 'pureWhiteStyle';
  s.textContent = `
    body { background: #0a0a0a !important; }
    #clock, .judul-glow, .note-title {
      text-shadow: 0 0 8px #ffffff, 0 0 16px #cccccc !important;
      animation: pulseWhite 2s infinite alternate;
    }
    @keyframes pulseWhite {
      from { text-shadow: 0 0 6px #ffffff; }
      to { text-shadow: 0 0 12px #ffffff, 0 0 24px #eeeeee; }
    }
  `;
  document.head.appendChild(s);
}

function applySkyGlowEffect() {
  if (document.getElementById('skyGlowStyle')) return;
  const s = document.createElement('style');
  s.id = 'skyGlowStyle';
  s.textContent = `
    body { background: radial-gradient(circle at top right, #000033, #001122) !important; }
    #clock, .judul-glow, .note-title {
      text-shadow: 0 0 10px #66ffff, 0 0 20px #00ffff !important;
      animation: pulseSky 2s infinite alternate;
    }
    @keyframes pulseSky {
      from { text-shadow: 0 0 8px #66ffff; }
      to { text-shadow: 0 0 14px #66ffff, 0 0 28px #00ffff; }
    }
  `;
  document.head.appendChild(s);
}

// === SET WARNA TEKS + EFEK KHUSUS ===
function setTextColor(color) {
  localStorage.setItem('globalTextColor', color);
  document.documentElement.style.setProperty('--txt-main', color);
  document.documentElement.style.setProperty('--txt-highlight', color);

  // Update semua elemen teks
  const updatable = document.querySelectorAll(`
    .note-title, .note-content-preview, .judul-glow, h3, h4, label,
    .neon-button, .copy-button, .btn-action, #clock,
    input, textarea, select, .pasaran-dropdown, .hitung-dropdown,
    .report-display-value, .report-edit-input, .chat-input-div,
    .bonus-title, .foto-title, .message-bubble
  `);
  updatable.forEach(el => el.style.color = color);

  // Hapus efek lama
  ['matrixGreenStyle', 'plasmaGreenStyle', 'laserRubyStyle', 'cyberPurpleStyle'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.remove();
  });

  // Terapkan efek khusus
  if (color === '#00ff88') {
    const s = document.createElement('style');
    s.id = 'matrixGreenStyle';
    s.textContent = `
      body, .note-card, .report-card, .message-bubble {
        font-family: 'Courier New', monospace !important;
      }
      .note-card, .report-card {
        background: rgba(0,20,0,0.6) !important;
        border-color: #00ff88 !important;
      }
      #clock, .judul-glow, .note-title {
        text-shadow: 0 0 6px #00ff88, 0 0 12px #007700 !important;
      }
    `;
    document.head.appendChild(s);
  }
  else if (color === '#39FF14') {
    const s = document.createElement('style');
    s.id = 'plasmaGreenStyle';
    s.textContent = `
      body { background: radial-gradient(circle at center, #000000, #001100) !important; }
      #clock, .judul-glow, .note-title {
        text-shadow: 0 0 10px #39FF14, 0 0 20px #00ff00;
        animation: pulsePlasma 1.8s infinite alternate;
      }
      @keyframes pulsePlasma {
        from { text-shadow: 0 0 8px #39FF14, 0 0 16px #00ff00; }
        to { text-shadow: 0 0 14px #39FF14, 0 0 28px #00ff00, 0 0 40px #39FF14; }
      }
    `;
    document.head.appendChild(s);
  }
  else if (color === '#FF073A') {
    const s = document.createElement('style');
    s.id = 'laserRubyStyle';
    s.textContent = `
      body { background: radial-gradient(circle at top left, #000000, #110000) !important; }
      #clock, .judul-glow, .note-title {
        text-shadow: 0 0 8px #FF073A, 0 0 16px #CC0033;
        animation: pulseRuby 1.5s infinite alternate;
      }
      @keyframes pulseRuby {
        from { text-shadow: 0 0 6px #FF073A; }
        to { text-shadow: 0 0 12px #FF073A, 0 0 24px #FF0055; }
      }
    `;
    document.head.appendChild(s);
  }
  else if (color === '#9D00FF') {
    const s = document.createElement('style');
    s.id = 'cyberPurpleStyle';
    s.textContent = `
      body { background: radial-gradient(circle at bottom right, #000000, #0a001a) !important; }
      #clock, .judul-glow, .note-title {
        text-shadow: 0 0 8px #9D00FF, 0 0 16px #6A00B3;
        animation: pulsePurple 2s infinite alternate;
      }
      @keyframes pulsePurple {
        from { text-shadow: 0 0 6px #9D00FF; }
        to { text-shadow: 0 0 12px #9D00FF, 0 0 24px #7A00FF; }
      }
    `;
    document.head.appendChild(s);
  }
}

// ===================================
// === VARIABEL GLOBAL ===
// ===================================
let currentFolder = 'DEPOSIT';
let allNotes = [];
let allPasaranList = [];
let lastPrediksiIndex = "";
let lastJadwalIndex = "";
let kelompokData = {};
let lastKelompok = "";
let lastLabel = "";
let lightboxImages = [];
let lightboxIndex = 0;
let zoomLevel = 1;
let offsetX = 0, offsetY = 0;
let isDragging = false;
let startX = 0, startY = 0;

// ===================================
// === FUNGSI UTAMA & INISIALISASI ===
// ===================================

function setBackground(type) {
    if (type) {
        document.body.className = type;
        localStorage.setItem('backgroundTheme', type);
    }
}

window.onload = function() {
    const saved = localStorage.getItem('backgroundTheme');
    if (saved) {
        setBackground(saved);
        const select = document.querySelector('select');
        if (select) select.value = saved;
    } else {
        setBackground('bg-default');
    }
    
    // Inisialisasi event listeners setelah DOM dimuat
    initEventListeners();
    
    // Inisialisasi tanggal pasaran
    initTanggalPasaran();
};

function initEventListeners() {
    // Dropdown Prediksi
    const dropdownPrediksi = document.getElementById("dropdownPrediksi");
    if (dropdownPrediksi) {
        dropdownPrediksi.addEventListener("change", () => {
            lastPrediksiIndex = dropdownPrediksi.value;
            showDetailWithAnimation('prediksi');
        });
    }
    
    // Dropdown Jadwal
    const dropdownJadwal = document.getElementById("dropdownJadwal");
    if (dropdownJadwal) {
        dropdownJadwal.addEventListener("change", () => {
            lastJadwalIndex = dropdownJadwal.value;
            showDetailWithAnimation('jadwal');
        });
    }
    
    // Tombol Toggle Tanggal
    const btnToggleTanggal = document.getElementById("btnToggleTanggal");
    if (btnToggleTanggal) {
        btnToggleTanggal.addEventListener("click", () => {
            const form = document.getElementById("formTanggal");
            if (form) {
                form.style.display = form.style.display === "none" ? "block" : "none";
            }
        });
    }
    
    // Event listeners untuk lightbox
    const lightboxEl = document.getElementById('lightbox');
    const imgEl = document.getElementById('lightboxImg');
    const zoomSlider = document.getElementById('zoomSlider');
    
    if (lightboxEl && imgEl) {
        if (zoomSlider) {
            zoomSlider.addEventListener('input', () => {
                zoomLevel = parseFloat(zoomSlider.value);
                applyTransform();
            });
        }

        lightboxEl.addEventListener('wheel', e => {
            e.preventDefault();
            zoomLightbox(e.deltaY < 0 ? 1.1 : 0.9);
        });

        imgEl.addEventListener('mousedown', e => {
            startDrag(e.clientX, e.clientY);
            e.preventDefault();
        });
        
        imgEl.addEventListener('touchstart', e => {
            startDrag(e.touches[0].clientX, e.touches[0].clientY);
        });
        
        imgEl.addEventListener('touchmove', e => {
            moveDrag(e.touches[0].clientX, e.touches[0].clientY);
            e.preventDefault();
        });
        
        imgEl.addEventListener('touchend', endDrag);
        
        imgEl.addEventListener('dblclick', resetZoomAndPosition);
        
        lightboxEl.addEventListener('click', e => {
            if (e.target === lightboxEl) hideLightbox();
        });
    }

    // Event listener untuk keyboard
    document.addEventListener('keydown', e => {
        if (lightboxEl && lightboxEl.style.display === 'flex') {
            switch (e.key) {
                case 'ArrowLeft':
                    changeLightbox(-1);
                    break;
                case 'ArrowRight':
                    changeLightbox(1);
                    break;
                case 'Escape':
                    hideLightbox();
                    break;
                case '+':
                    zoomLightbox(1.2);
                    break;
                case '-':
                    zoomLightbox(0.8);
                    break;
            }
        }
    });

    // Event listener untuk mouse dan touch
    window.addEventListener('mousemove', e => moveDrag(e.clientX, e.clientY));
    window.addEventListener('mouseup', endDrag);
}

// ===================================
// === JAM DIGITAL ===
// ===================================

// Mengambil elemen jam sekali saja untuk efisiensi
const clockElement = document.getElementById('clock');

/**
 * Memperbarui tampilan jam dan tanggal digital.
 */
function updateClock() {
    if (!clockElement) return;
    
    const now = new Date();

    // Opsi untuk Tanggal: Hari, Tanggal, Bulan (LENGKAP)
    const dateOptions = {
        weekday: 'long',  // Hari lengkap (misal: Senin)
        day: '2-digit',   // Tanggal (misal: 13)
        month: 'long',    // Bulan lengkap (misal: Oktober)
        year: 'numeric'   // Ditambahkan: Tahun (misal: 2025)
    };
    
    // Opsi untuk Waktu: Jam, Menit, Detik (24-jam format)
    const timeOptions = {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
    };

    const dateStr = now.toLocaleDateString('id-ID', dateOptions);
    // Output: "16:38:56"
    const timeStr = now.toLocaleTimeString('id-ID', timeOptions);

    clockElement.innerHTML = `
        <span class="date-display">${dateStr}</span>
        <span class="time-display">${timeStr}</span>
    `;

    if (now.getSeconds() % 2 === 0) {
        clockElement.classList.add('active-glow');
    } else {
        clockElement.classList.remove('active-glow');
    }
}

updateClock();
setInterval(updateClock, 1000);

// ===================================
// === NOTIFIKASI TOAST ===
// ===================================
function showToast(message) {
    const existingToast = document.getElementById('toastNotif');

    if (existingToast) {
        // Jika elemen toastNotif ditemukan, gunakan itu
        existingToast.textContent = message; // Gunakan textContent untuk keamanan
        existingToast.style.display = 'block';

        // Reset timer sebelumnya dan atur timer baru
        if (existingToast.timer) clearTimeout(existingToast.timer);
        existingToast.timer = setTimeout(() => {
            existingToast.style.display = 'none';
        }, 3000); // Durasi tampil 3 detik

    } else {
        // Jika elemen toastNotif tidak ditemukan, buat elemen toast dinamis
        const toastElement = document.createElement('div');
        toastElement.className = 'toast';
        toastElement.textContent = message;
        toastElement.style.position = "fixed";
        toastElement.style.bottom = "100px";
        toastElement.style.right = "30px";
        toastElement.style.background = "#00ffff";
        toastElement.style.color = "#000";
        toastElement.style.padding = "8px 12px";
        toastElement.style.borderRadius = "6px";
        toastElement.style.boxShadow = "0 0 10px #00ffff";
        toastElement.style.fontWeight = "bold";
        toastElement.style.zIndex = 9999;
        toastElement.style.transition = "opacity 0.5s";
        toastElement.style.opacity = "1";

        document.body.appendChild(toastElement);

        // Animasi fade out dan hapus elemen
        setTimeout(() => {
            toastElement.style.opacity = "0";
            setTimeout(() => {
                if (toastElement.parentNode) {
                    toastElement.parentNode.removeChild(toastElement);
                }
            }, 500);
        }, 2000); // Durasi tampil 2 detik sebelum mulai fade out
    }
}

// ===================================
// === MANAJEMEN TAB ===
// ===================================

function hideAllTabs() {
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });
}

function showTab(tabId, button) {
    // Sembunyikan semua tab content
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });

    // Hapus class 'active' dari semua tombol
    document.querySelectorAll('.neon-button').forEach(btn => {
        btn.classList.remove('active');
    });

    // Tampilkan tab yang sesuai dengan ID
    const activeTab = document.getElementById(tabId);
    if (activeTab) {
        activeTab.style.display = 'block';
    }

    // Tambahkan class 'active' ke tombol yang diklik
    if (button) {
        button.classList.add('active');
    }

    // Aksi khusus berdasarkan tab yang ditampilkan
    if (tabId === 'prediksiGabungTab') {
        loadPasaranTogel();
        loadCaraHitungTogel();
    }
}

function capitalize(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
}

// ===================================
// === FUNGSI CATATAN & FOTO ===
// ===================================

function renderNotesList(filteredNotes) {
    const container = document.getElementById('notesList');
    if (!container) return;
    
    if (!filteredNotes || filteredNotes.length === 0) {
        container.innerHTML = '<i>Tidak ada catatan ditemukan.</i>';
        renderNoteDetail(null);
        return;
    }

    container.innerHTML = '';

    filteredNotes.forEach(note => {
        const div = document.createElement('div');
        div.className = 'note-item';

        const title = document.createElement('h3');
        title.className = 'note-title';
        title.textContent = note.judul || note.title || 'Tanpa Judul';

        const preview = document.createElement('div');
        preview.className = 'note-content-preview';
        const contentText = note.content || note.content1 || '';
        preview.textContent = contentText.length > 100 ? contentText.substring(0, 100) + '...' : contentText;

        div.onclick = () => renderNoteDetail(note);

        div.appendChild(title);
        div.appendChild(preview);
        container.appendChild(div);
    });
}

// Tambahkan penanda sedang loading
let isNotesLoading = false;

function loadNotes(folder) {
  // Hindari double call
  if (isNotesLoading && currentFolder === folder) return;
  
  currentFolder = folder;
  isNotesLoading = true;

  // Update UI segera
  const judulCatatan = document.getElementById('judulCatatan');
  const notesHeader = document.getElementById('notesHeader');
  const notesList = document.getElementById('notesList');

  if (judulCatatan) judulCatatan.textContent = `💫======: ${folder}`;
  if (notesHeader) notesHeader.innerHTML = `Menampilkan folder: ${folder}`;
  if (notesList) {
    // ✅ Loading indicator neon
    notesList.innerHTML = `
      <div style="text-align:center; padding:40px;">
        <div style="
          width:40px; height:40px; border:3px solid #00ffff;
          border-top-color:transparent; border-radius:50%;
          animation: spin 1s linear infinite;
          margin:0 auto 16px;
        "></div>
        <span style="color:#00ffff; font-weight:bold;">⏳ Memuat data...</span>
      </div>
    `;
  }

  showTab('catatanTab');

  // Jika TRY CARI, tidak perlu fetch
  if (folder === 'TRY CARI') {
    isNotesLoading = false;
    return;
  }

  // Fetch dari Google Apps Script
  google.script.run
    .withSuccessHandler(notes => {
      isNotesLoading = false;
      renderNotes(notes);
    })
    .withFailureHandler(err => {
      isNotesLoading = false;
      if (notesList) {
        notesList.innerHTML = `<div style="color:#ff6666; text-align:center; padding:20px;">
          ❌ Gagal memuat catatan.<br>
          <small>${err.message || 'Cek koneksi & izin akses.'}</small>
        </div>`;
      }
      showToast("❌ Gagal memuat catatan");
    })
    .getNotes(folder);
}

function addNoteToSticky(contents) {
    let stickies = JSON.parse(localStorage.getItem("stickies") || "[]");
    let addedCount = 0;

    contents.forEach(content => {
        // Hanya tambahkan konten yang tidak kosong
        if (content && content.trim() !== '') {
            stickies.push({
                text: content.trim(),
                image: null
            });
            addedCount++;
        }
    });

    if (addedCount > 0) {
        localStorage.setItem("stickies", JSON.stringify(stickies));
        showToast(`✅ ${addedCount} catatan ditambahkan ke Sticky Notes!`);
    } else {
        showToast("❗ Tidak ada catatan yang bisa ditambahkan.");
    }
}

async function copyPhotoFromLightbox() {
    const img = document.getElementById('lightboxImg');
    if (!img || !img.src) return showToast("❗ Gambar tidak ditemukan");

    showToast("⏳ Memproses salinan...");

    try {
        // Langkah 1: Gambar foto ke Canvas rahasia
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const tempImg = new Image();
        
        tempImg.crossOrigin = "Anonymous"; // Mencoba menembus proteksi CORS
        tempImg.src = img.src;

        tempImg.onload = async function() {
            canvas.width = tempImg.width;
            canvas.height = tempImg.height;
            ctx.drawImage(tempImg, 0, 0);

            // Langkah 2: Ubah jadi Blob PNG
            canvas.toBlob(async (blob) => {
                try {
                    const item = new ClipboardItem({ "image/png": blob });
                    await navigator.clipboard.write([item]);
                    showToast("✅ Foto berhasil disalin!");
                } catch (e) {
                    showToast("❗ Browser memblokir copy otomatis");
                }
            }, "image/png");
        };

        tempImg.onerror = () => {
            showToast("❗ Gagal: Proteksi Keamanan Gambar (CORS)");
        };

    } catch (err) {
        showToast("❗ Gagal menyalin");
    }
}

// Fungsi untuk menampilkan lightbox (mode zoom)
function showLightbox(src) {
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightboxImg');
    if (!lightbox || !lightboxImg) {
        console.error('Elemen lightbox tidak ditemukan di HTML.');
        return;
    }

    lightboxImg.src = src;
    lightbox.style.display = 'flex'; 
}

// Fungsi untuk menyembunyikan lightbox (mode zoom)
function hideLightbox() {
    const lightbox = document.getElementById('lightbox');
    if (lightbox) {
        lightbox.style.display = 'none';
    }
}

// Perbarui fungsi renderNotes
function renderNotes(notes) {
  // ✅ RESET lightboxImages di awal
  lightboxImages = [];
  
  allNotes = notes;
  const container = document.getElementById('notesList');
  if (!container) return;
  container.innerHTML = '';
  container.className = '';

  if (notes.length === 0) {
    container.innerHTML = '<p><i>Tidak ada catatan.</i></p>';
    return;
  }

  if (currentFolder === "FOTO") {
    container.className = 'foto-gallery';
    notes.forEach((note, index) => {
      lightboxImages.push(note.content); // ✅ aman karena sudah di-reset
      const card = document.createElement('div');
      card.className = 'foto-card';
      const img = document.createElement('img');
      img.src = note.content;
      img.alt = note.title;
      img.onclick = () => {
        lightboxIndex = index;
        showLightbox(note.content);
      };
      img.onerror = () => img.style.display = 'none';
      const title = document.createElement('div');
      title.className = 'foto-title';
      title.textContent = note.title;
      const copyBtn = document.createElement('button');
      copyBtn.className = 'copy-button';
      copyBtn.textContent = 'Copy Foto';
      copyBtn.onclick = (event) => {
        event.stopPropagation();
        copyImageToClipboardFromURL(note.content);
      };
      card.appendChild(img);
      card.appendChild(title);
      card.appendChild(copyBtn);
      container.appendChild(card);
    });
    return;
  }

    notes.forEach(note => {
        const div = document.createElement('div');
        div.className = 'note-card';
        
        const imageUrlMatch = note.title.match(/(https?:\/\/[^\s]+\.(jpeg|jpg|png|gif|webp))/i);
        const imageUrl = imageUrlMatch ? imageUrlMatch[1] : null;

        const title = document.createElement('h3');
        title.className = 'note-title clickable-title';
        if (imageUrl) {
            title.textContent = note.title.replace(imageUrl, '').trim() || "Catatan Foto";
        } else {
            title.textContent = note.title;
        }

        const detail = document.createElement('div');
        detail.className = 'note-detail';
        detail.style.display = 'none';

        if (imageUrl) {
            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = note.title;
            img.style.marginTop = '10px';
            img.style.maxHeight = '200px';
            img.style.objectFit = 'contain';
            img.onclick = () => showLightbox(imageUrl);
            img.onerror = () => img.style.display = 'none';
            detail.appendChild(img);

            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-button';
            copyBtn.textContent = 'Copy Foto';
            copyBtn.onclick = (event) => {
                event.stopPropagation();
                copyImageToClipboardFromURL(imageUrl);
            };
            detail.appendChild(copyBtn);
            detail.appendChild(document.createElement('hr'));
        }

        const contentsToAdd = [
            note.content,
            note.content2,
            note.content3
        ];
        
        const stickyAllBtn = document.createElement('button');
        stickyAllBtn.textContent = 'Tambahkan Sticky Notes';
        stickyAllBtn.className = 'sticky-add-button';
        stickyAllBtn.onclick = (event) => {
            event.stopPropagation();
            addNoteToSticky(contentsToAdd);
        };
        detail.appendChild(stickyAllBtn);

        const fields = [
            { label: '========', content: note.content },
            { label: '========', content: note.content2 },
            { label: '========', content: note.content3 },
        ];

        fields.forEach(({ label, content }) => {
            if (content && content.trim() !== '') {
                const p = document.createElement('p');
                p.innerHTML = `<strong>${label}:</strong><br>${content}`;

                const copyBtn = document.createElement('button');
                copyBtn.textContent = 'Copy';
                copyBtn.className = 'copy-button';
                copyBtn.onclick = (event) => {
                    event.stopPropagation();
                    copyToClipboard(content);
                };

                const stickyBtn = document.createElement('button');
                stickyBtn.textContent = 'Tambah Sticky';
                stickyBtn.className = 'copy-button';
                stickyBtn.onclick = (event) => {
                    event.stopPropagation();
                    addNoteToSticky([content]);
                };
                
                p.appendChild(document.createElement('br'));
                p.appendChild(copyBtn);
                p.appendChild(stickyBtn);

                const urls = content.match(/https?:\/\/[^\s]+/gi);
                if (urls) {
                    urls.forEach((url, index) => {
                        const linkBtn = document.createElement('button');
                        linkBtn.textContent = `Buka Link ${index + 1}`;
                        linkBtn.className = 'copy-button';
                        linkBtn.onclick = (event) => {
                            event.stopPropagation();
                            window.open(url, '_blank');
                        };
                        p.appendChild(linkBtn);
                    });
                }
                detail.appendChild(p);
            }
        });

        title.onclick = () => {
            detail.style.display = detail.style.display === 'none' ? 'block' : 'none';
        };

        div.appendChild(title);
        div.appendChild(detail);
        container.appendChild(div);
    });
}

function searchNotes() {
    const searchInput = document.getElementById("searchInput");
    if (!searchInput) return;
    
    const query = searchInput.value.trim().toLowerCase();
    const allCards = document.querySelectorAll(".note-card, .foto-card, .promo-card");

    allCards.forEach(card => {
        const title = card.querySelector(".note-title, .foto-title, .promo-title");
        const content = card.querySelector(".note-content, .foto-content, .promo-content");

        const titleText = title ? title.textContent.toLowerCase() : "";
        const contentText = content ? content.textContent.toLowerCase() : "";

        if (titleText.includes(query) || contentText.includes(query)) {
            card.style.display = "block";
        } else {
            card.style.display = "none";
        }
    });
}

async function copyImageToClipboardFromURL(imageUrl) {
    // 1. Validasi URL: Pastikan URL ada dan merupakan string.
    if (!imageUrl || typeof imageUrl !== 'string' || imageUrl.trim() === '') {
        showToast("❗ URL gambar tidak valid.");
        console.error("URL gambar tidak valid:", imageUrl);
        return;
    }

    // 2. Gunakan try-catch untuk penanganan error yang efektif.
    try {
        // Mengambil data gambar dari URL.
        const response = await fetch(imageUrl);

        // Memeriksa apakah respons berhasil (status 200-299).
        if (!response.ok) {
            throw new Error(`Gagal mengambil gambar. Status: ${response.status}`);
        }

        // Mengubah respons menjadi Blob (data biner).
        const blob = await response.blob();

        // Membuat ClipboardItem dari Blob.
        const item = new ClipboardItem({
            [blob.type]: blob
        });

        // Menyalin item ke clipboard.
        await navigator.clipboard.write([item]);

        // Memberi tahu pengguna bahwa operasi berhasil.
        showToast("✅ Foto Disalin!");

    } catch (err) {
        // Menangani error dan memberi tahu pengguna.
        console.error("Gagal menyalin gambar:", err);
        showToast(`❗ Gagal menyalin. ${err.message || 'Cek konsol untuk detail.'}`);
    }
}

// ===================================
// === LIGHTBOX & ZOOM ===
// ===================================

function changeLightbox(direction) {
    lightboxIndex += direction;
    if (lightboxIndex < 0) lightboxIndex = lightboxImages.length - 1;
    if (lightboxIndex >= lightboxImages.length) lightboxIndex = 0;
    
    const imgEl = document.getElementById('lightboxImg');
    if (imgEl) {
        imgEl.src = lightboxImages[lightboxIndex];
    }
    resetZoomAndPosition();
}

function resetZoomAndPosition() {
    zoomLevel = 1;
    offsetX = 0;
    offsetY = 0;
    applyTransform();
    
    const zoomSlider = document.getElementById('zoomSlider');
    if (zoomSlider) zoomSlider.value = zoomLevel;
}

function applyTransform() {
    const imgEl = document.getElementById('lightboxImg');
    if (!imgEl) return;
    
    imgEl.style.transform = `scale(${zoomLevel}) translate(${offsetX}px, ${offsetY}px)`;
}

function zoomLightbox(factor) {
    zoomLevel *= factor;
    zoomLevel = Math.min(Math.max(zoomLevel, 0.5), 5);
    applyTransform();
    
    const zoomSlider = document.getElementById('zoomSlider');
    if (zoomSlider) zoomSlider.value = zoomLevel;
}

function startDrag(clientX, clientY) {
    if (zoomLevel <= 1) return;
    isDragging = true;
    startX = clientX - offsetX;
    startY = clientY - offsetY;
    
    const imgEl = document.getElementById('lightboxImg');
    if (imgEl) imgEl.style.cursor = 'grabbing';
}

function moveDrag(clientX, clientY) {
    if (!isDragging) return;
    offsetX = clientX - startX;
    offsetY = clientY - startY;
    applyTransform();
}

function endDrag() {
    isDragging = false;
    
    const imgEl = document.getElementById('lightboxImg');
    if (imgEl) imgEl.style.cursor = 'grab';
}

// ===================================
// === PASARAN TOGEL ===
// ===================================

function renderPasaran(data) {
    const tbody = document.getElementById("pasaranBody");
    if (!tbody) return;
    
    tbody.innerHTML = "";
    data.forEach(row => {
        const tr = document.createElement("tr");
tr.innerHTML = `
  <td style="border: 1px solid #00c6d7; padding: 8px; cursor: pointer; color: #e0f7fa; background: rgba(0, 20, 50, 0.6); border-radius: 6px;" onclick="copyToClipboard('${row[0]}')">${row[0]}</td>
  <td style="border: 1px solid #00c6d7; padding: 8px; cursor: pointer; color: #e0f7fa; background: rgba(0, 20, 50, 0.6); border-radius: 6px;" onclick="copyToClipboard('${row[1]}')">${row[1]}</td>
`;
        tbody.appendChild(tr);
    });
}

function searchPasaran() {
    const searchInput = document.getElementById("searchPasaran");
    if (!searchInput) return;
    
    const input = searchInput.value.toLowerCase();
    const tbody = document.getElementById("pasaranBody");
    if (!tbody) return;
    
    const rows = tbody.getElementsByTagName("tr");

    for (let i = 0; i < rows.length; i++) {
        const cells = rows[i].getElementsByTagName("td");
        if (cells.length < 2) continue;
        
        const text1 = cells[0].textContent.toLowerCase();
        const text2 = cells[1].textContent.toLowerCase();

        rows[i].style.display = (text1.includes(input) || text2.includes(input)) ? "" : "none";
    }
}

function loadPasaranTogel() {
    google.script.run.withSuccessHandler(renderPasaranList).getPasaranList();
}

function renderPasaranList(list) {
    allPasaranList = list;
    const dropdownPrediksi = document.getElementById("dropdownPrediksi");
    const dropdownJadwal = document.getElementById("dropdownJadwal");
    
    if (!dropdownPrediksi || !dropdownJadwal) return;
    
    dropdownPrediksi.innerHTML = '<option value="">Pilih Prediksi...</option>';
    dropdownJadwal.innerHTML = '<option value="">Pilih Jadwal...</option>';

    list.forEach(([prediksi, jadwal], index) => {
        dropdownPrediksi.add(new Option(prediksi.split('\n')[0], index));
        dropdownJadwal.add(new Option(jadwal.split('\n')[0], index));
    });

    if (lastPrediksiIndex !== "" && dropdownPrediksi.options[lastPrediksiIndex]) {
        dropdownPrediksi.value = lastPrediksiIndex;
        showDetailWithAnimation('prediksi');
    }
    if (lastJadwalIndex !== "" && dropdownJadwal.options[lastJadwalIndex]) {
        dropdownJadwal.value = lastJadwalIndex;
        showDetailWithAnimation('jadwal');
    }
}

function showDetailWithAnimation(type) {
  const selectId = (type === 'prediksi') ? "dropdownPrediksi" : "dropdownJadwal";
  const detailId = "detail" + capitalize(type);
  const selectElement = document.getElementById(selectId);
  const detailElement = document.getElementById(detailId);
  
  if (!selectElement || !detailElement) return;
  
  const index = selectElement.value;
  if (index === "") {
    detailElement.style.opacity = 0;
    setTimeout(() => detailElement.innerText = "", 300);
    return;
  }

  const data = allPasaranList[parseInt(index)][type === 'prediksi' ? 0 : 1];
  
  // Fade out lama
  detailElement.style.transition = "opacity 0.3s ease";
  detailElement.style.opacity = 0;
  
  setTimeout(() => {
    detailElement.textContent = data; // aman dari XSS
    detailElement.style.opacity = 1;
  }, 300);

  if (type === 'prediksi') lastPrediksiIndex = index;
  else lastJadwalIndex = index;
}

let isPasaranLoading = false;

function loadPasaranTogel() {
  if (isPasaranLoading) return;
  
  isPasaranLoading = true;
  
  // ✅ Tampilkan loading indicator di area prediksi
  const pasaranContainer = document.getElementById('pasaranList');
  if (pasaranContainer) {
    pasaranContainer.innerHTML = `
      <div style="text-align:center; padding:40px;">
        <div style="
          width:40px; height:40px; border:3px solid #00ffff;
          border-top-color:transparent; border-radius:50%;
          animation: spin 1s linear infinite;
          margin:0 auto 16px;
        "></div>
        <span style="color:#00ffff; font-weight:bold;">⏳ Memuat jadwal togel...</span>
      </div>
    `;
  }

  google.script.run
    .withSuccessHandler((list) => {
      renderPasaranList(list);
      isPasaranLoading = false;
    })
    .withFailureHandler(() => {
      isPasaranLoading = false;
      if (pasaranContainer) {
        pasaranContainer.innerHTML = `<div style="color:#ff6666; text-align:center; padding:20px;">❌ Gagal memuat data pasaran.</div>`;
      }
      showToast("❌ Gagal memuat pasaran");
    })
    .getPasaranList();
}

function searchDropdowns() {
    const searchInput = document.getElementById("searchPasaran");
    if (!searchInput) return;
    
    const query = searchInput.value.toLowerCase();
    const dropdownPrediksi = document.getElementById("dropdownPrediksi");
    const dropdownJadwal = document.getElementById("dropdownJadwal");
    
    if (!dropdownPrediksi || !dropdownJadwal) return;
    
    dropdownPrediksi.innerHTML = '<option value="">Pilih Prediksi...</option>';
    dropdownJadwal.innerHTML = '<option value="">Pilih Jadwal...</option>';

    allPasaranList.forEach(([prediksi, jadwal], index) => {
        if (prediksi.toLowerCase().includes(query) || jadwal.toLowerCase().includes(query)) {
            dropdownPrediksi.add(new Option(prediksi.split('\n')[0], index));
            dropdownJadwal.add(new Option(jadwal.split('\n')[0], index));
        }
    });
}

function copyToClipboardDetail(div) {
    if (!div) return;
    
    const text = div.innerText;
    if (!text) return;
    
    navigator.clipboard.writeText(text)
        .then(() => showToast("✅ Disalin"))
        .catch(() => showToast("❗ Gagal menyalin"));
}

function simpanTanggalPasaran() {
    const tanggalInput = document.getElementById("tanggalPasaran");
    if (!tanggalInput) {
        showToast("❗ Elemen tanggal tidak ditemukan.");
        return;
    }
    
    const tanggalValue = tanggalInput.value;
    if (!tanggalValue) {
        showToast("❗ Silakan pilih tanggal terlebih dahulu.");
        return;
    }

    const [year, month, day] = tanggalValue.split("-");
    const formattedDate = `${month}/${day}/${year}`;

    google.script.run
        .withSuccessHandler(() => {
            showToast("✅ Tanggal berhasil disimpan!");
            loadPasaranTogel();
        })
        .setTanggalPasaran(formattedDate);
}

function initTanggalPasaran() {
    google.script.run.withSuccessHandler(dateStr => {
        if (!dateStr) return;
        const parts = dateStr.split("/");
        if (parts.length !== 3) return;

        const formattedForInput = `${parts[2]}-${parts[1].padStart(2, "0")}-${parts[0].padStart(2, "0")}`;
        const tanggalInput = document.getElementById("tanggalPasaran");
        if (tanggalInput) {
            tanggalInput.value = formattedForInput;
        }

        const tanggalDisplay = document.getElementById("tanggalTerpilihDisplay");
        if (tanggalDisplay) {
            tanggalDisplay.textContent = dateStr;
        }

        loadPasaranTogel();
    }).getTanggalPasaran();
}

// ===================================
// === FUNGSI CARA HITUNG TOGEL ===
// ===================================

function loadCaraHitungTogel() {
    lastKelompok = document.getElementById("kelompokDropdown")?.value || "";
    lastLabel = document.getElementById("labelDropdown")?.value || "";

    const allTabs = ['caraHitungSection', 'pasaranTab', 'cekBonusEventTab', 'catatanTab'];
    allTabs.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
    });

    const caraHitung = document.getElementById("caraHitungSection");
    if (caraHitung) caraHitung.style.display = "block";

    const kelompokDropdown = document.getElementById("kelompokDropdown");
    if (!kelompokDropdown) return;
    
    kelompokDropdown.innerHTML = `<option value="">-- Pilih Tipe Hitungan --</option>`;

    google.script.run.withSuccessHandler((res) => {
        kelompokData = res.kelompok || {};

        for (const kelompok in kelompokData) {
            const opt = document.createElement("option");
            opt.value = kelompok;
            opt.textContent = kelompok;
            kelompokDropdown.appendChild(opt);
        }

        if (lastKelompok && kelompokData[lastKelompok]) {
            kelompokDropdown.value = lastKelompok;
            isiDropdownLabel();

            const labelDropdown = document.getElementById("labelDropdown");
            if (labelDropdown && lastLabel) {
                labelDropdown.value = lastLabel;

                if ([...labelDropdown.options].some(opt => opt.value === lastLabel)) {
                    tampilkanValueHitungan(true);
                }
            }
        }
    }).getHitunganTogel();
}

function isiDropdownLabel() {
    const selectedKelompok = document.getElementById("kelompokDropdown")?.value;
    const labelDropdown = document.getElementById("labelDropdown");
    const detail = document.getElementById("detailHitunganDropdown");
    
    if (!labelDropdown || !detail) return;
    
    labelDropdown.innerHTML = `<option value="">-- Pilih Label --</option>`;
    detail.innerHTML = "";

    if (!selectedKelompok || !kelompokData[selectedKelompok]) return;

    kelompokData[selectedKelompok].forEach(item => {
        const opt = document.createElement("option");
        opt.value = item.label;
        opt.textContent = item.label;
        labelDropdown.appendChild(opt);
    });
}

function tampilkanValueHitungan(withAnimation = false) {
    const kelompok = document.getElementById("kelompokDropdown")?.value;
    const label = document.getElementById("labelDropdown")?.value;
    const detail = document.getElementById("detailHitunganDropdown");
    
    if (!detail) return;
    
    detail.innerHTML = "";

    if (!kelompok || !label || !kelompokData[kelompok]) return;

    const item = kelompokData[kelompok].find(i => i.label === label);
    if (!item) return;

    const div = document.createElement("div");
    div.className = "hitungan-value";
    div.textContent = item.value;
    div.title = "Klik untuk salin";

    if (withAnimation) {
        div.style.opacity = "0";
        div.style.transform = "scale(0.9)";
        setTimeout(() => {
            div.style.transition = "all 0.3s ease";
            div.style.opacity = "1";
            div.style.transform = "scale(1)";
        }, 10);
    }

    div.addEventListener("click", () => {
        navigator.clipboard.writeText(item.value || "").then(() => {
            showToast("✅ Disalin");
        }).catch(() => {
            showToast("❌ Gagal menyalin");
        });
    });

    detail.appendChild(div);
}

function updateNominalTogel() {
    const nominalInput = document.getElementById("nominalInput");
    if (!nominalInput) return;
    
    const nominal = nominalInput.value.trim();
    if (!nominal) {
        return showToast("❌ Nominal tidak boleh kosong");
    }

    google.script.run
        .withSuccessHandler(() => {
            showToast("✅ Nominal diperbarui");
            loadCaraHitungTogel();
        })
        .withFailureHandler(err => {
            showToast("❌ Gagal memperbarui nominal: " + err.message);
        })
        .updateNominalTogel(nominal);
}

let editIndex = null;
let imageList = [];
let currentImageIndex = 0;
let reportData = [];
let focusRowIndex = null;
window.gambarLinks = [];

// ===================================
// === FUNGSI STICKY NOTES ===
// ===================================

function toggleStickyPanel() {
    const panel = document.getElementById("stickyPanel");
    panel.style.display = panel.style.display === "block" ? "none" : "block";
    loadStickyNotes();
}

function autoResize(el) {
    el.style.height = "auto";
    el.style.height = el.scrollHeight + "px";
}

async function addSticky() {
    const input = document.getElementById("stickyInput");
    const text = input.value.trim();
    const image = input.dataset.image || null;
    if (!text && !image) return;

    let stickies = JSON.parse(localStorage.getItem("stickies") || "[]");
    if (editIndex !== null) {
        stickies[editIndex] = { text, image };
        editIndex = null;
        document.querySelector("#stickyPanel button").textContent = "➕ Tambah Sticky";
    } else {
        stickies.push({ text, image });
    }
    localStorage.setItem("stickies", JSON.stringify(stickies));

    input.value = "";
    input.dataset.image = "";
    autoResize(input);
    loadStickyNotes();
}

function loadStickyNotes() {
    const list = document.getElementById("stickyList");
    if (!list) return;
    
    list.innerHTML = "";
    const stickies = JSON.parse(localStorage.getItem("stickies") || "[]");

    stickies.forEach((note, i) => {
        const div = document.createElement("div");
        div.className = "sticky-card";
        div.dataset.index = i;

        if (note.text) {
            const p = document.createElement("p");
            p.textContent = note.text;
            div.appendChild(p);
        }
        if (note.image) {
            const img = document.createElement("img");
            img.src = note.image;
            div.appendChild(img);
        }

        div.onclick = async() => {
            try {
                const items = {};
                if (note.text) items["text/plain"] = new Blob([note.text], { type: "text/plain" });
                if (note.image) {
                    const resp = await fetch(note.image);
                    const blob = await resp.blob();
                    items[blob.type] = blob;
                }
                await navigator.clipboard.write([new ClipboardItem(items)]);
                showToast("✅ Teks + Gambar disalin!");
            } catch {
                showToast("⚠ Gagal menyalin");
            }
        };

        const del = document.createElement("span");
        del.textContent = "✖";
        del.className = "sticky-delete";
        del.onclick = e => {
            e.stopPropagation();
            deleteSticky(i);
        };
        
        const edit = document.createElement("span");
        edit.textContent = "✏️";
        edit.className = "sticky-edit";
        edit.onclick = e => {
            e.stopPropagation();
            editSticky(i);
        };
        
        div.appendChild(del);
        div.appendChild(edit);

        div.setAttribute("draggable", true);
        div.ondragstart = e => e.dataTransfer.setData("text/plain", i);
        div.ondragover = e => {
            e.preventDefault();
            div.style.border = "2px dashed #00ffff";
        };
        div.ondragleave = () => div.style.border = "1px solid #00ffff";
        div.ondrop = e => {
            e.preventDefault();
            div.style.border = "1px solid #00ffff";
            reorderSticky(e.dataTransfer.getData("text/plain"), i);
        };

        list.appendChild(div);
    });
}

function reorderSticky(from, to) {
    let stickies = JSON.parse(localStorage.getItem("stickies") || "[]");
    const moved = stickies.splice(from, 1)[0];
    stickies.splice(to, 0, moved);
    localStorage.setItem("stickies", JSON.stringify(stickies));
    loadStickyNotes();
}

function deleteSticky(i) {
    let stickies = JSON.parse(localStorage.getItem("stickies") || "[]");
    stickies.splice(i, 1);
    localStorage.setItem("stickies", JSON.stringify(stickies));
    loadStickyNotes();
}

function editSticky(i) {
    const stickies = JSON.parse(localStorage.getItem("stickies") || "[]");
    const input = document.getElementById("stickyInput");
    input.value = stickies[i].text || "";
    input.dataset.image = stickies[i].image || "";
    autoResize(input);
    editIndex = i;
    document.querySelector("#stickyPanel button").textContent = "Simpan Perubahan";
}

// ===================================
// === FUNGSI COPY & UTILITAS ===
// ===================================

function copyText(id) {
    const elem = document.getElementById(id);
    if (!elem) return;

    const text = elem.innerText || elem.textContent;
    if (!text || text.trim() === "-") {
        showToast("❗ Tidak ada data untuk disalin!");
        return;
    }

    navigator.clipboard.writeText(text)
        .then(() => showToast("✅ Disalin!"))
        .catch(() => showToast("❗ Gagal menyalin teks"));
}

function copyWithFeedback(button, text) {
    navigator.clipboard.writeText(text).then(() => {
        button.textContent = "✔ Copied!";
        button.style.background = "#00ff66";
        button.style.color = "#000";

        setTimeout(() => {
            button.textContent = "Copy";
            button.style.background = "cyan";
            button.style.color = "#000";
        }, 1500);
    });
}

async function copyPhotoFromLightbox() {
    const imgElement = document.getElementById('lightboxImage');
    if (!imgElement || !imgElement.src) {
        showToast('❗ Gagal: Gambar tidak ditemukan.');
        return;
    }
    try {
        const response = await fetch(imgElement.src);
        const blob = await response.blob();
        await navigator.clipboard.write([
            new ClipboardItem({
                [blob.type]: blob
            })
        ]);
        showToast('✅ Foto berhasil disalin!');
    } catch (err) {
        console.error('Gagal menyalin foto:', err);
        showToast('❗ Gagal menyalin foto. Pastikan URL valid.');
    }
}

// ===================================
// === FUNGSI LIGHTBOX ===
// ===================================

function openLightbox(imgElement) {
    imageList = Array.from(document.querySelectorAll(".gambar-slot img"))
        .filter(img => img.style.display !== "none")
        .map(img => img.src);

    currentImageIndex = imageList.indexOf(imgElement.src);
    const lightboxImage = document.getElementById("lightboxImage");
    if (lightboxImage) {
        lightboxImage.src = imgElement.src;
    }
    
    const lightboxModal = document.getElementById("lightboxModal");
    if (lightboxModal) {
        lightboxModal.style.display = 'flex';
    }
}

function closeLightbox() {
    const lightboxModal = document.getElementById("lightboxModal");
    if (lightboxModal) {
        lightboxModal.style.display = 'none';
    }
    
    const lightboxImage = document.getElementById("lightboxImage");
    if (lightboxImage) {
        lightboxImage.src = '';
    }
}

function nextImage() {
    if (imageList.length === 0) return;
    currentImageIndex = (currentImageIndex + 1) % imageList.length;
    const lightboxImage = document.getElementById("lightboxImage");
    if (lightboxImage) {
        lightboxImage.src = imageList[currentImageIndex];
    }
}

function prevImage() {
    if (imageList.length === 0) return;
    currentImageIndex = (currentImageIndex - 1 + imageList.length) % imageList.length;
    const lightboxImage = document.getElementById("lightboxImage");
    if (lightboxImage) {
        lightboxImage.src = imageList[currentImageIndex];
    }
}

// ===================================
// === FUNGSI ZOOM & OCR ===
// ===================================

function closeZoom() {
    const zoomModal = document.getElementById('zoomModal');
    if (zoomModal) {
        zoomModal.style.display = 'none';
    }
    
    const zoomedImage = document.getElementById('zoomedImage');
    if (zoomedImage) {
        zoomedImage.src = '';
    }
    
    const imageUrl = document.getElementById('imageUrl');
    if (imageUrl) {
        imageUrl.value = '';
    }
    
    const kodeHasilZoom = document.getElementById('kodeHasilZoom');
    if (kodeHasilZoom) {
        kodeHasilZoom.innerHTML = '';
    }
}

function zoomAndScan(url = null) {
    const imageUrl = url || document.getElementById('imageUrlZoom').value.trim();
    if (!imageUrl) return;

    const zoomedImage = document.getElementById('zoomedImage');
    const kodeOutput = document.getElementById('kodeHasilZoom');
    const modal = document.getElementById('zoomModal');

    if (zoomedImage) zoomedImage.src = imageUrl;
    if (modal) modal.style.display = "flex";
    if (kodeOutput) kodeOutput.innerHTML = `<span style="color:gray;">⏳ Memindai gambar...</span>`;

    const imageUrlZoom = document.getElementById('imageUrlZoom');
    if (imageUrlZoom) imageUrlZoom.value = "";

    Tesseract.recognize(imageUrl, 'eng', {
        logger: m => console.log(m)
    }).then(({
        data: {
            text
        }
    }) => {
        const rawLines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
        let hasilGabung = [],
            hasilLangsung = [];

        for (let i = 0; i < rawLines.length; i++) {
            const line = rawLines[i];
            const match = line.match(/\b\d{9,10}\b/);
            if (match) {
                if (i + 1 < rawLines.length) {
                    const nextLine = rawLines[i + 1].trim();
                    const nextMatch = nextLine.match(/\b\d{8,}\b/);
                    if (nextMatch) {
                        hasilGabung.push(match[0] + nextMatch[0]);
                        i++;
                        continue;
                    }
                }
                hasilGabung.push(match[0]);
            }
        }

        for (const line of rawLines) {
            const matches = line.match(/\d{8,}/g);
            if (matches) matches.forEach(m => hasilLangsung.push(m));
        }

        hasilGabung = [...new Set(hasilGabung)];
        hasilLangsung = [...new Set(hasilLangsung)];

        if (hasilGabung.length === 0 && hasilLangsung.length === 0) {
            if (kodeOutput) kodeOutput.innerHTML = `<span style="color:orange;">❌ Tidak ditemukan angka panjang.</span>`;
        } else {
            if (kodeOutput) kodeOutput.innerHTML = "";
            
            if (hasilGabung.length > 0) {
                const title1 = document.createElement("div");
                title1.innerHTML = `<b style="color:deepskyblue;">📘 Hasil Gabungan Baris:</b>`;
                title1.style.margin = "12px 0 4px";
                if (kodeOutput) kodeOutput.appendChild(title1);
                
                hasilGabung.forEach(kode => {
                    const div = document.createElement("div");
                    div.style = `
                        margin-bottom: 10px;
                        padding: 10px;
                        background: rgba(0,150,255,0.2);
                        border: 1px solid deepskyblue;
                        border-radius: 8px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    `;
                    div.innerHTML = `
                        <span style="word-break: break-all;">${kode}</span>
                        <button onclick="copyWithFeedback(this, '${kode}')" style="background: deepskyblue; color: #00FFFF; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold;">Copy</button>
                    `;
                    if (kodeOutput) kodeOutput.appendChild(div);
                });
            }
            
            if (hasilLangsung.length > 0) {
                const title2 = document.createElement("div");
                title2.innerHTML = `<b style="color:limegreen;">📗 Hasil Angka Per Baris:</b>`;
                title2.style.margin = "12px 0 4px";
                if (kodeOutput) kodeOutput.appendChild(title2);
                
                hasilLangsung.forEach(kode => {
                    const div = document.createElement("div");
                    div.style = `
                        margin-bottom: 10px;
                        padding: 10px;
                        background: rgba(0,255,0,0.15);
                        border: 1px solid limegreen;
                        border-radius: 8px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    `;
                    div.innerHTML = `
                        <span style="word-break: break-all;">${kode}</span>
                        <button onclick="copyWithFeedback(this, '${kode}')" style="background: limegreen; color: #00FFFF; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold;">Copy</button>
                    `;
                    if (kodeOutput) kodeOutput.appendChild(div);
                });
            }
        }
    }).catch(err => {
        console.error(err);
        if (kodeOutput) kodeOutput.innerHTML = `<span style="color:red;">❗ Gagal membaca gambar.</span>`;
    });
}

function membacaIsiFoto_ocr(src) {
  const hasilElement = document.getElementById("membacaIsiFoto_hasil");
  if (hasilElement) {
    hasilElement.innerHTML = '<span style="color:#00ffff;">⏳ Memindai gambar...</span>';
  }

  Tesseract.recognize(
    src,
    'eng',
    {
      logger: m => console.log(m)
    }
  ).then(({ data: { text } }) => {
    if (hasilElement) {
      const cleanText = (text || "").trim();
      hasilElement.innerText = cleanText || "Teks tidak terbaca.";
    }
  }).catch(err => {
    console.error("OCR Error:", err);
    if (hasilElement) {
      hasilElement.innerHTML = `
        <span style="color:#ff6666;">
          ❌ Gagal membaca gambar.<br>
          <small>Pastikan link publik dan format gambar valid (JPG/PNG).</small>
        </span>
      `;
    }
  });
}

function membacaIsiFoto_prosesLink() {
    const link = document.getElementById("membacaIsiFoto_input").value.trim();
    if (link) {
        const modal = document.getElementById("membacaIsiFoto_modal");
        if (modal) modal.style.display = "flex";
        
        const gambar = document.getElementById("membacaIsiFoto_gambar");
        if (gambar) gambar.src = link;
        
        const hasil = document.getElementById("membacaIsiFoto_hasil");
        if (hasil) hasil.innerHTML = "<i>Memproses gambar...</i>";
        
        membacaIsiFoto_ocr(link);
    }
}

function membacaIsiFoto_tutup() {
    const modal = document.getElementById("membacaIsiFoto_modal");
    if (modal) modal.style.display = "none";
    
    const gambar = document.getElementById("membacaIsiFoto_gambar");
    if (gambar) gambar.src = "";
    
    const hasil = document.getElementById("membacaIsiFoto_hasil");
    if (hasil) hasil.innerText = "";
    
    const input = document.getElementById("membacaIsiFoto_input");
    if (input) input.value = "";
}

// ===================================
// === FUNGSI BONUS & SCATTER ===
// ===================================

function hitungBonusEvent() {
    const isi = document.getElementById("bonusTextarea")?.value.trim();
    const patokanRaw = document.getElementById("bonusPatokan")?.value;
    const surplusRaw = document.getElementById("bonusSurplus")?.value;

    const patokan = parseInt(patokanRaw?.replace(/[^\d]/g, '')) || 0;
    const surplus = parseInt(surplusRaw?.replace(/[^\d]/g, '')) || 0;

    if (!isi) {
        showToast("❗ Tempelkan data terlebih dahulu.");
        return;
    }

    const lines = isi.split("\n");
    let total = 0;

    for (let i = 0; i < lines.length; i++) {
        if (lines[i].trim() === 'Credit') {
            const amountLine = lines[i + 1] ? lines[i + 1].trim() : '';
            const amountMatch = amountLine.match(/IDR\s([\d,]+)/i);

            if (amountMatch) {
                const amountStr = amountMatch[1].replace(/,/g, '');
                const amount = parseFloat(amountStr);

                if (!isNaN(amount)) {
                    total += amount;
                }
            }
        }
    }

    const hasilDiv = document.getElementById("bonusHasil");
    if (hasilDiv) {
        let output = `💰 Total Hitungan: <span class="bonus-angka">IDR ${total.toLocaleString("en-US")}</span>`;

        if (patokan || surplus) {
            const totalPengurang = patokan + surplus;
            const selisih = total - totalPengurang;
            const selisihColor = selisih === 0 ? '#00ff88' : '#ff6666';

            output += `<br>📦 Patokan: <span class="bonus-angka">IDR ${patokan.toLocaleString("en-US")}</span>`;
            output += `<br>📌 Surplus: <span class="bonus-angka">IDR ${surplus.toLocaleString("en-US")}</span>`;
            output += `<br>➖ Total Dikurang: <span class="bonus-angka">IDR ${totalPengurang.toLocaleString("en-US")}</span>`;
            output += `<br>📏 Selisih: <span class="bonus-angka" style="color:${selisihColor}">IDR ${Math.abs(selisih).toLocaleString("en-US")}</span>`;
        }

        hasilDiv.innerHTML = output;
    }
}

/**
 * Fungsi untuk membersihkan semua input dan hasil di menu Cek Bonus Event
 */
function hapusBonusEvent() {
    // Hapus teks di textarea
    const textarea = document.getElementById("bonusTextarea");
    if (textarea) {
        textarea.value = "";
    }

    // Hapus nilai di input patokan
    const patokanInput = document.getElementById("bonusPatokan");
    if (patokanInput) {
        patokanInput.value = "";
    }

    // Hapus nilai di input surplus
    const surplusInput = document.getElementById("bonusSurplus");
    if (surplusInput) {
        surplusInput.value = "";
    }

    // Hapus hasil perhitungan
    const hasilDiv = document.getElementById("bonusHasil");
    if (hasilDiv) {
        hasilDiv.innerHTML = ""; // Kosongkan hasil
    }

    // Hapus link gambar
    const imageUrlInput = document.getElementById("imageUrl");
    if (imageUrlInput) {
        imageUrlInput.value = "";
    }

    // Tampilkan notifikasi bahwa form sudah dibersihkan
    showToast("🧹 Form berhasil dibersihkan!");
}

// ===================================
// === FUNGSI HADIAH TOGEL ===
// ===================================

function loadHadiahTogel() {
    google.script.run.withSuccessHandler(res => {
        const container = document.getElementById("hadiahContainer");
        if (!container) return;
        container.innerHTML = "";

        if (!res?.data || !Array.isArray(res.data)) {
            container.innerHTML = "<p style='color:#ff6666;'>Tidak ada data hadiah.</p>";
            return;
        }

        res.data.forEach(group => {
            if (!group?.judul || !Array.isArray(group.items)) return;

            const validItems = group.items.filter(it =>
                it && it.hadiah && it.hadiah.trim() !== ""
            );

            if (validItems.length === 0) return;

            const box = document.createElement("div");
            box.className = "hadiah-box";

            const mid = Math.ceil(validItems.length / 2);
            const col1 = validItems.slice(0, mid);
            const col2 = validItems.slice(mid);

            const renderTable = (items) => {
                if (items.length === 0) return "";
                let html = `<table><thead><tr>
                                <th>Nama</th>
                                <th>Hadiah</th>
                                <th>Diskon</th>
                            </tr></thead><tbody>`;

                items.forEach(it => {
                    let diskonVal = "NO DISCOUNT BET";
                    let diskonClass = "no-discount";

                    // Hanya terima string yang mengandung '%'
                    if (typeof it.diskon === "string") {
                        const trimmed = it.diskon.trim();
                        if (trimmed !== "" && trimmed.includes("%")) {
                            diskonVal = trimmed;
                            diskonClass = "";
                        }
                    }
                    // Semua bentuk lain (angka, null, undefined, string tanpa %) → NO DISCOUNT BET

                    html += `<tr>
                        <td>${it.nama || "—"}</td>
                        <td>${it.hadiah}</td>
                        <td class="${diskonClass}">${diskonVal}</td>
                    </tr>`;
                });

                html += `</tbody></table>`;
                return html;
            };

            const html = `
                <details>
                    <summary>${group.judul}</summary>
                    <div class="tabel-dua-kolom">
                        ${renderTable(col1)}
                        ${renderTable(col2)}
                    </div>
                </details>
            `;

            box.innerHTML = html;
            container.appendChild(box);
        });
    }).getPengaturanTogelLengkap();
}

function showHadiahTab() {
    showTab('cekhadiah');
    loadHadiahTogel();
}

// ===================================
// === FUNGSI PENGATURAN ===
// ===================================

function attachAccordionListeners() {
    document.querySelectorAll("#contentPengaturan .accordion").forEach(a => {
        a.onclick = function() {
            const panel = this.nextElementSibling;
            panel.style.display = (panel.style.display === "block") ? "none" : "block";
        };
    });
}

function openPengaturanAfterSave(panelKey, groupIndex) {
    google.script.run
        .withSuccessHandler(res => {
            if (res.status === "error") {
                const contentPengaturan = document.getElementById("contentPengaturan");
                if (contentPengaturan) {
                    contentPengaturan.innerHTML = `<p>${res.message}</p>`;
                }
                return;
            }

            let html = "";
            
            // === Bagian 1: Pengaturan Hadiah dan Diskon ===
            res.data.forEach((k, currentGroupIndex) => {
                const isPanelOpen = panelKey === 'normal' && groupIndex === currentGroupIndex;
                html += `
                    <h4 class="accordion"
                        data-col-nama="${k.colNama}"
                        data-col-hadiah="${k.colHadiah}"
                        data-col-diskon="${k.colDiskon}">
                        ${k.judul}
                    </h4>
                    <div class="panel" style="display:${isPanelOpen ? "block" : "none"};">
                        <table border="0" cellpadding="4">
                        <thead>
                            <tr>
                            <th>Jenis Bet</th>
                            <th>Hadiah</th>
                            <th>Diskon</th>
                            <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                k.items.forEach((it, i) => {
                    const diskonVal = (it.diskon && String(it.diskon).includes("%")) ? it.diskon : "NO DISCOUNT";
                    const barisSheet = k.startRow + i;
                    html += `
                        <tr>
                            <td>${it.nama}</td>
                            <td><div contenteditable="true" class="editable-cell">${it.hadiah ?? ""}</div></td>
                            <td><div contenteditable="true" class="editable-cell">${diskonVal}</div></td>
                            <td>
                            <button class="row-save-btn"
                                    data-row="${barisSheet}"
                                    onclick="simpanBaris(${currentGroupIndex}, ${i}, this)">
                                💾 Simpan
                            </button>
                            </td>
                        </tr>
                    `;
                });
                html += `
                        </tbody>
                        </table>
                    </div>
                    <br/>
                `;
            });
            
            // === Bagian 2: Pengaturan Link Live ===
            const isLinkLiveOpen = panelKey === 'linkLive';
            html += `
                <h4 class="accordion">LINK LIVE PASARAN</h4>
                <div class="panel" style="display:${isLinkLiveOpen ? "block" : "none"};">
                    <table border="0" cellpadding="4">
                    <thead>
                        <tr>
                        <th>Link</th>
                        <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            res.linkLive.forEach((l, i) => {
                html += `
                    <tr>
                        <td>
                            <div contenteditable="true" class="link-live-item editable-cell">${l}</div>
                        </td>
                        <td>
                            <button class="row-save-btn" onclick="simpanLink(${i}, this)">
                                💾 Simpan
                            </button>
                        </td>
                    </tr>
                `;
            });
            html += `
                    </tbody>
                    </table>
                </div>
            `;
            
            // === Bagian 3: Pengaturan Jadwal Pasaran ===
            const isJadwalPasaranOpen = panelKey === 'jadwalPasaran';
            html += `
                <h4 class="accordion">JAM JADWAL PASARAN</h4>
                <div class="panel" style="display:${isJadwalPasaranOpen ? "block" : "none"};">
                    <table border="0" cellpadding="4">
                    <thead>
                        <tr>
                        <th>Jam Tutup</th>
                        <th>Nama Pasaran</th>
                        <th>Diskon</th>
                        <th>Jam Result</th>
                        <th>Link resmi</th>
                        <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            res.jadwalPasaran.forEach((j, i) => {
                const diskonValJadwal = (j.diskon && String(j.diskon).includes("%")) ? j.diskon : "NO DISCOUNT";
                html += `
                    <tr>
                        <td><div contenteditable="true" class="editable-cell">${j.jamTutup}</div></td>
                        <td><div contenteditable="true" class="editable-cell">${j.namaPasaran}</div></td>
                        <td><div contenteditable="true" class="editable-cell">${diskonValJadwal}</div></td>
                        <td><div contenteditable="true" class="editable-cell">${j.jamResult}</div></td>
                        <td><div contenteditable="true" class="editable-cell">${j.link}</div></td>
                        <td>
                        <button class="row-save-btn" onclick="simpanJadwal(${i}, this)">
                            💾 Simpan
                        </button>
                        </td>
                    </tr>
                `;
            });
            html += `
                    </tbody>
                    </table>
                </div>
            `;
            
            // === Bagian 4: Pengaturan Kendala All ===
            const isKendalaAllOpen = panelKey === 'kendalaAll';
            html += `
                <h4 class="accordion">KENDALA ALL</h4>
                <div class="panel" style="display:${isKendalaAllOpen ? "block" : "none"};">
                                    <button class="row-save-btn" style="margin-top:20px;" onclick="tambahKendalaAllRow()">
                        ➕ Tambah Baris
                    </button>
                    <div id="kendalaList">
            `;
            res.kendalaAllData.forEach(item => {
                html += `
                    <h5 class="kendala-accordion" data-row-index="${item.rowIndex}">
                        <span>${item.judul}</span>
                    </h5>
                    <div class="kendala-panel">
                        <table border="0" cellpadding="4">
                        <tbody>
                            <tr><td>Judul:</td><td><div contenteditable="true" class="editable-cell">${item.judul}</div></td></tr>
                            <tr><td>Jawaban 1:</td><td><div contenteditable="true" class="editable-cell">${item.jawaban1}</div></td></tr>
                            <tr><td>Jawaban 2:</td><td><div contenteditable="true" class="editable-cell">${item.jawaban2}</div></td></tr>
                            <tr><td>Jawaban 3:</td><td><div contenteditable="true" class="editable-cell">${item.jawaban3}</div></td></tr>
                        </tbody>
                        </table>
                        <div style="text-align: right; padding: 10px 0;">
                            <button class="row-save-btn" onclick="updateKendalaAllRow(${item.rowIndex}, this)">
                                💾 Simpan
                            </button>
                        </div>
                    </div>
                `;
            });
            html += `
                    </div>
                </div>
                <br/>
            `;

            // Render HTML ke dalam DOM
            const contentPengaturan = document.getElementById("contentPengaturan");
            if (contentPengaturan) {
                contentPengaturan.innerHTML = html;

                // Menambahkan event listener untuk accordion utama
                document.querySelectorAll("#contentPengaturan .accordion").forEach(a => {
                    a.onclick = function() {
                        const panel = this.nextElementSibling;
                        panel.style.display = (panel.style.display === "block") ? "none" : "block";
                    };
                });

                // Menambahkan event listener untuk accordion kendala
                document.querySelectorAll(".kendala-accordion").forEach(a => {
                    a.onclick = function() {
                        const panel = this.nextElementSibling;
                        panel.style.display = (panel.style.display === "block") ? "none" : "block";
                    };
                });
            }
        })
        .getPengaturanTogelLengkap();
}

function simpanBaris(groupIndex, indexItem, btn) {
    const h4Elements = document.querySelectorAll("#contentPengaturan h4");
    const h = h4Elements[groupIndex];
    if (!h) return;
    
    const colNama = h.dataset.colNama;
    const colHadiah = h.dataset.colHadiah;
    const colDiskon = h.dataset.colDiskon;
    const rowNumber = btn.dataset.row;

    const row = btn.closest('tr');
    const nama = row.cells[0].innerText.trim();
    const hadiah = row.cells[1].querySelector('.editable-cell').innerText.trim();
    let diskon = row.cells[2].querySelector('.editable-cell').innerText.trim();
    if (diskon.toUpperCase() === "NO DISCOUNT") diskon = "";

    const payload = {
        nama,
        hadiah,
        diskon,
        rangeNama: `${colNama}${rowNumber}`,
        rangeHadiah: `${colHadiah}${rowNumber}`,
        rangeDiskon: `${colDiskon}${rowNumber}`
    };

    google.script.run
        .withSuccessHandler(res => {
            showToast(res.message);
            openPengaturanAfterSave('normal', groupIndex);
        })
        .withFailureHandler(err => showToast("Gagal simpan: " + err.message))
        .updatePengaturanTogelBaris(payload);
}

function simpanLink(index, btn) {
    const row = btn.closest('tr');
    const link = row.cells[0].querySelector('.link-live-item').textContent.trim();
    
    const payload = { index, link };
    
    // Simpan info fokus
    const focusInfo = {
        type: 'linkLive',
        rowIndex: index
    };

    google.script.run
        .withSuccessHandler(res => {
            showToast(res.message);
            openPengaturanAfterSaveAndFocus('linkLive', null, focusInfo);
        })
        .withFailureHandler(err => showToast("Gagal simpan: " + err.message))
        .updateLinkPasaran(payload);
}

function simpanJadwal(index, btn) {
    const row = btn.closest('tr');
    const jamTutup = row.cells[0].querySelector('.editable-cell').textContent.trim();
    const namaPasaran = row.cells[1].querySelector('.editable-cell').textContent.trim();
    const diskon = row.cells[2].querySelector('.editable-cell').textContent.trim();
    const jamResult = row.cells[3].querySelector('.editable-cell').textContent.trim();
    const link = row.cells[4].querySelector('.editable-cell').textContent.trim();

    const payload = { index, jamTutup, namaPasaran, diskon, jamResult, link };

    // Fokus ke kolom jamTutup (index 0) setelah simpan
    const focusInfo = {
        type: 'jadwalPasaran',
        rowIndex: index,
        colIndex: 0 // ubah ke 1,2,3,4 jika ingin fokus ke kolom lain
    };

    google.script.run
        .withSuccessHandler(res => {
            showToast(res.message);
            openPengaturanAfterSaveAndFocus('jadwalPasaran', null, focusInfo);
        })
        .updateJadwalPasaran(payload);
}

function openPengaturan(panelKey, groupIndex) {
    google.script.run
        .withSuccessHandler(res => {
            if (res.status === "error") {
                const contentPengaturan = document.getElementById("contentPengaturan");
                if (contentPengaturan) {
                    contentPengaturan.innerHTML = `<p>${res.message}</p>`;
                }
                return;
            }

            let html = "";
            
            res.data.forEach((k, currentGroupIndex) => {
                const isPanelOpen = panelKey === 'normal' && groupIndex === currentGroupIndex;
                html += `
                    <h4 class="accordion" data-col-nama="${k.colNama}" data-col-hadiah="${k.colHadiah}" data-col-diskon="${k.colDiskon}">
                        ${k.judul}
                    </h4>
                    <div class="panel" style="display:${isPanelOpen ? "block" : "none"};">
                        <table border="0" cellpadding="4">
                            <thead><tr><th>Jenis Bet</th><th>Hadiah</th><th>Diskon</th><th>Aksi</th></tr></thead>
                            <tbody>
                `;
                k.items.forEach((it, i) => {
                    const diskonVal = (it.diskon && String(it.diskon).includes("%")) ? it.diskon : "NO DISCOUNT";
                    const barisSheet = k.startRow + i;
                    html += `
                        <tr>
                            <td>${it.nama}</td>
                            <td><div contenteditable="true" class="editable-cell">${it.hadiah ?? ""}</div></td>
                            <td><div contenteditable="true" class="editable-cell">${diskonVal}</div></td>
                            <td><button class="row-save-btn" data-row="${barisSheet}" onclick="simpanBaris(${currentGroupIndex}, ${i}, this)">💾 Simpan</button></td>
                        </tr>
                    `;
                });
                html += `
                            </tbody>
                        </table>
                    </div><br/>
                `;
            });
            
            const isLinkLiveOpen = panelKey === 'linkLive';
            html += `
                <h4 class="accordion">LINK LIVE PASARAN</h4>
                <div class="panel" style="display:${isLinkLiveOpen ? "block" : "none"};">
                    <table border="0" cellpadding="4">
                        <thead><tr><th>Link</th><th>Aksi</th></tr></thead>
                        <tbody>
            `;
            res.linkLive.forEach((l, i) => {
                html += `
                    <tr>
                        <td><div contenteditable="true" class="link-live-item editable-cell">${l}</div></td>
                        <td><button class="row-save-btn" onclick="simpanLink(${i}, this)">💾 Simpan</button></td>
                    </tr>
                `;
            });
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            const isJadwalPasaranOpen = panelKey === 'jadwalPasaran';
            html += `
                <h4 class="accordion">JAM JADWAL PASARAN</h4>
                <div class="panel" style="display:${isJadwalPasaranOpen ? "block" : "none"};">
                    <table border="0" cellpadding="4">
                        <thead><tr><th>Jam Tutup</th><th>Nama Pasaran</th><th>Diskon</th><th>Jam Result</th><th>Link resmi</th><th>Aksi</th></tr></thead>
                        <tbody>
            `;
            res.jadwalPasaran.forEach((j, i) => {
                const diskonValJadwal = (j.diskon && String(j.diskon).includes("%")) ? j.diskon : "NO DISCOUNT";
                html += `
                    <tr>
                        <td><div contenteditable="true" class="editable-cell">${j.jamTutup}</div></td>
                        <td><div contenteditable="true" class="editable-cell">${j.namaPasaran}</div></td>
                        <td><div contenteditable="true" class="editable-cell">${diskonValJadwal}</div></td>
                        <td><div contenteditable="true" class="editable-cell">${j.jamResult}</div></td>
                        <td><div contenteditable="true" class="editable-cell">${j.link}</div></td>
                        <td><button class="row-save-btn" onclick="simpanJadwal(${i}, this)">💾 Simpan</button></td>
                    </tr>
                `;
            });
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            const isKendalaAllOpen = panelKey === 'kendalaAll';
            html += `
                <h4 class="accordion">KENDALA ALL</h4>
                <div class="panel" style="display:${isKendalaAllOpen ? "block" : "none"};">
                                    <button class="row-save-btn" style="margin-top:20px;" onclick="tambahKendalaAllRow()">
                        ➕ Tambah Baris
                    </button>
                    <div id="kendalaList">
            `;
            res.kendalaAllData.forEach(item => {
                html += `
                    <h5 class="kendala-accordion" data-row-index="${item.rowIndex}">
                        <span>${item.judul}</span>
                    </h5>
                    <div class="kendala-panel">
                        <table border="0" cellpadding="4">
                            <tbody>
                                <tr><td>Judul:</td><td><div contenteditable="true" class="editable-cell">${item.judul}</div></td></tr>
                                <tr><td>Jawaban 1:</td><td><div contenteditable="true" class="editable-cell">${item.jawaban1}</div></td></tr>
                                <tr><td>Jawaban 2:</td><td><div contenteditable="true" class="editable-cell">${item.jawaban2}</div></td></tr>
                                <tr><td>Jawaban 3:</td><td><div contenteditable="true" class="editable-cell">${item.jawaban3}</div></td></tr>
                            </tbody>
                        </table>
                        <div style="text-align: right; padding: 10px 0;">
                            <button class="row-save-btn" onclick="updateKendalaAllRow(${item.rowIndex}, this)">💾 Simpan</button>
                        </div>
                    </div>
                `;
            });
            html += `
                    </div>
                </div><br/>
            `;

            const contentPengaturan = document.getElementById("contentPengaturan");
            if (contentPengaturan) {
                contentPengaturan.innerHTML = html;

                document.querySelectorAll("#contentPengaturan .accordion").forEach(a => {
                    a.onclick = function() {
                        const panel = this.nextElementSibling;
                        panel.style.display = (panel.style.display === "block") ? "none" : "block";
                    };
                });

                document.querySelectorAll(".kendala-accordion").forEach(a => {
                    a.onclick = function() {
                        const panel = this.nextElementSibling;
                        panel.style.display = (panel.style.display === "block") ? "none" : "block";
                    };
                });
            }
        })
        .getPengaturanTogelLengkap();
}

function tambahKendalaAllRow() {
    const kendalaList = document.getElementById("kendalaList");
    if (!kendalaList) return;
    
    const newKendalaHtml = `
        <h5 class="kendala-accordion">
            <span>BARIS BARU (BELUM DISIMPAN)</span>
        </h5>
        <div class="kendala-panel" style="display:block;">
            <table border="0" cellpadding="4">
                <tbody>
                    <tr><td>Judul:</td><td><div contenteditable="true" class="editable-cell"></div></td></tr>
                    <tr><td>Jawaban 1:</td><td><div contenteditable="true" class="editable-cell"></div></td></tr>
                    <tr><td>Jawaban 2:</td><td><div contenteditable="true" class="editable-cell"></div></td></tr>
                    <tr><td>Jawaban 3:</td><td><div contenteditable="true" class="editable-cell"></div></td></tr>
                </tbody>
            </table>
            <div style="text-align: right; padding: 10px 0;">
                <button class="row-save-btn" onclick="updateKendalaAllRow(-1, this)">
                    💾 Simpan
                </button>
            </div>
        </div>
    `;

    // Simpan posisi scroll sebelum menambahkan (opsional, tapi aman)
    const panelContainer = kendalaList.closest('.panel');
    
    // Tambahkan elemen baru
    kendalaList.insertAdjacentHTML('beforeend', newKendalaHtml);

    // Ambil elemen panel yang baru ditambahkan
    const newPanel = kendalaList.querySelector('.kendala-panel:last-of-type');

    // 🔽 SCROLL OTOMATIS KE BAWAH 🔽
    if (newPanel) {
        newPanel.scrollIntoView({ 
            behavior: "smooth",   // animasi scroll halus
            block: "nearest"      // posisi scroll minimal yang diperlukan
        });
    }

    // Tambahkan event listener ke accordion baru
    const newAccordion = kendalaList.querySelector('.kendala-accordion:last-child');
    if (newAccordion) {
        newAccordion.onclick = function() {
            const panel = this.nextElementSibling;
            panel.style.display = (panel.style.display === "block") ? "none" : "block";
        };
    }
    
    showToast("Baris kosong berhasil ditambahkan.");
}

function updateKendalaAllRow(rowIndex, btn) {
    const parent = btn.closest('.kendala-panel');
    const editableCells = parent.querySelectorAll('.editable-cell');
    
    const payload = { 
        judul: editableCells[0].innerText.trim(),
        jawaban1: editableCells[1].innerText.trim(),
        jawaban2: editableCells[2].innerText.trim(),
        jawaban3: editableCells[3].innerText.trim()
    };

    if (rowIndex === -1) {
        google.script.run
            .withSuccessHandler(res => {
                showToast(res.message);
                openPengaturan('kendalaAll'); 
            })
            .withFailureHandler(err => showToast("Gagal simpan: " + err.message))
            .addNewKendala(payload);
    } else {
        payload.rowIndex = rowIndex;
        google.script.run
            .withSuccessHandler(res => {
                showToast(res.message);
                openPengaturan('kendalaAll');
            })
            .withFailureHandler(err => showToast("Gagal simpan: " + err.message))
            .updateKendalaAll(payload);
    }
}

// ===================================
// === FUNGSI REPORT LINE ===
// ===================================

function autoResizeTextarea(element) {
    if (element) {
        element.style.height = 'auto'; 
        element.style.height = (element.scrollHeight + 5) + 'px'; 
    }
}

async function loadReportLineData() {
    const container = document.getElementById('reportLineCardContainer');
    if (container) {
        container.innerHTML = `<p style="text-align:center; color:#00ffff;">⏳ Sedang memuat data dari Google Sheet...</p>`;
    }
    
    google.script.run
        .withSuccessHandler((response) => {
            if (response.status === "error") {
                if (container) {
                    container.innerHTML = `<p style="text-align:center; color:#ff4d4d;">❗ Gagal memuat data: ${response.message}</p>`;
                }
                showError("Gagal memuat data: " + response.message); 
                return;
            }

            reportData = response.data;
            displayReportLineData(reportData);
            
            if (focusRowIndex !== null) {
                setTimeout(() => {
                    restoreFocusAndScroll(focusRowIndex);
                    focusRowIndex = null;
                }, 100); 
            }
        })
        .withFailureHandler((error) => {
            if (container) {
                container.innerHTML = `<p style="text-align:center; color:#ff4d4d;">❌ Error koneksi: ${error.message || 'Unknown error'}</p>`;
            }
            showError("Error koneksi: " + error);
        })
        .getReportLineData();
}

function displayReportLineData(data) {
    const container = document.getElementById('reportLineCardContainer');
    if (!container) return;
    
    container.innerHTML = ''; 

    if (data.length === 0) {
        container.innerHTML = `<p style="text-align:center; color:#ffc107;">Tidak ada catatan yang ditemukan.</p>`;
        return;
    }

    data.forEach((item) => {
        const rowIndex = item.rowIndex;
        const isNewRow = item.isNew || false; 
        
        const urlPattern = /^(http|https):\/\/[^ "]+$/;
        const isLink = urlPattern.test(item.colB);

        const card = document.createElement('div');
        card.id = `report-row-${rowIndex}`;
        card.className = 'report-card';
        
        // --- JUDUL ACCORDION (Kolom A) ---
        const accordionTitle = document.createElement('h4');
        accordionTitle.className = 'card-accordion-title';
        
        const titleTextSpan = document.createElement('span');
        titleTextSpan.id = `title-text-${rowIndex}`;
        titleTextSpan.textContent = item.colA || `[Baris Kosong ${rowIndex}]`;
        accordionTitle.appendChild(titleTextSpan);

        accordionTitle.onclick = function() {
            const content = document.getElementById(`content-${rowIndex}`);
            const isVisible = content.style.display === "block";
            
            document.querySelectorAll('.card-content-panel').forEach(panel => {
                 panel.style.display = "none";
            });

            content.style.display = isVisible ? "none" : "block";

            if (!isVisible) {
                card.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        };
        card.appendChild(accordionTitle);

        // --- KONTEN DETAIL CARD (A, B, C, D) ---
        const contentDiv = document.createElement('div');
        contentDiv.id = `content-${rowIndex}`;
        contentDiv.className = 'card-content-panel';
        contentDiv.style.display = isNewRow ? 'block' : 'none';

        
        contentDiv.innerHTML = `
            <div class="report-field-group field-colA">
                <label>ALL KENDALA REPORT (Judul)</label>
                <div class="field-controls">
                    <div class="report-display-value wide-input" id="display-colA-${rowIndex}">${item.colA}</div>
                    <textarea class="report-edit-input wide-input" id="input-colA-${rowIndex}" style="display:none;">${item.colA}</textarea>
                    
                    <button class="btn-action btn-copy-small" 
                            onclick="copyReportCell('${rowIndex}', 'colA')"
                            style="margin-right: 5px; margin-top: 5px;">
                            💫 Copy Judul
                    </button>
                </div>
            </div>

            <hr class="neon-divider">

            <div class="report-field-group">
                <label>MEMO/REPORT</label>
                <div class="field-controls">
                    <div class="report-display-value wide-input" id="display-colB-${rowIndex}">${item.colB}</div>
                    <textarea class="report-edit-input wide-input" id="input-colB-${rowIndex}" style="display:none;">${item.colB}</textarea>
                    
                    <div class="action-buttons-group">
                        <button class="btn-action btn-copy-large" 
                                onclick="copyReportCell('${rowIndex}', 'colB')"
                                style="margin-right: 5px;">
                                💫 Copy Catatan
                        </button>
                        
                        ${isLink ? `
                            <button class="btn-action btn-link" 
                                    onclick="window.open('${item.colB}', '_blank')">
                                    🔗 Buka Link
                            </button>
                        ` : ''}
                    </div>
                </div>
            </div>

            <hr class="neon-divider">

            <div class="report-field-group">
                <label>POST/MEMO KE ADMIN,WA,FB</label>
                <div class="field-controls">
                    <div class="report-display-value wide-input small-field" id="display-colC-${rowIndex}">${item.colC}</div>
                    <textarea class="report-edit-input wide-input small-field" id="input-colC-${rowIndex}" style="display:none;">${item.colC}</textarea>
                    
                    </div>
            </div>

            <hr class="neon-divider">

            <div class="report-field-group">
                <label>REPORT KE LINE/TELE</label>
                <div class="field-controls">
                    <div class="report-display-value wide-input small-field" id="display-colD-${rowIndex}">${item.colD}</div>
                    <textarea class="report-edit-input wide-input small-field" id="input-colD-${rowIndex}" style="display:none;">${item.colD}</textarea>
                    
                    </div>
            </div>

            <hr class="neon-divider">

            <div class="card-actions-bottom">
                <button class="btn-action btn-cancel" 
                        onclick="toggleCancelEdit(${rowIndex}, ${isNewRow})" 
                        style="display:${isNewRow ? 'inline-block' : 'none'};">❌ Batal</button>

                <button class="btn-action btn-edit" onclick="toggleEditMode(${rowIndex}, true)" style="display:${isNewRow ? 'none' : 'inline-block'};">✏️ Edit</button>
                <button class="btn-action btn-save" onclick="saveReportRow(${rowIndex})" style="display:${isNewRow ? 'inline-block' : 'none'};">💾 Simpan</button>
            </div>
        `;
        card.appendChild(contentDiv);
        container.appendChild(card);
        
        // --- AUTO RESIZE INTEGRATION (untuk A, B, C, D) ---
        const inputColA = document.getElementById(`input-colA-${rowIndex}`);
        const inputColB = document.getElementById(`input-colB-${rowIndex}`);
        const inputColC = document.getElementById(`input-colC-${rowIndex}`); 
        const inputColD = document.getElementById(`input-colD-${rowIndex}`); 
        
        if (inputColA) {
            autoResizeTextarea(inputColA); 
            inputColA.addEventListener('input', () => autoResizeTextarea(inputColA));
        }

        if (inputColB) {
            autoResizeTextarea(inputColB); 
            inputColB.addEventListener('input', () => autoResizeTextarea(inputColB));
        }

        if (inputColC) { 
            autoResizeTextarea(inputColC); 
            inputColC.addEventListener('input', () => autoResizeTextarea(inputColC));
        }
        
        if (inputColD) { 
            autoResizeTextarea(inputColD); 
            inputColD.addEventListener('input', () => autoResizeTextarea(inputColD));
        }
    });
}

function restoreFocusAndScroll(rowIndex) {
    const card = document.getElementById(`report-row-${rowIndex}`);
    const content = document.getElementById(`content-${rowIndex}`);
    
    if (card && content) {
        card.style.display = 'block';
        content.style.display = 'block'; 
        card.scrollIntoView({ behavior: 'smooth', block: 'start' });

        toggleEditMode(rowIndex, false); 
    }
}

function toggleEditMode(rowIndex, isEditMode) {
    const card = document.getElementById(`report-row-${rowIndex}`);
    const content = document.getElementById(`content-${rowIndex}`);
    const saveBtn = card.querySelector('.btn-save');
    const editBtn = card.querySelector('.btn-edit');
    const cancelBtn = card.querySelector('.btn-cancel');
    const title = card.querySelector('.card-accordion-title');
    
    // Hanya mencari tombol copy yang tersisa (di A dan B)
    const copyBtns = card.querySelectorAll('.btn-copy-large, .btn-copy-small'); 

    content.style.display = 'block'; 

    // Daftar Kolom yang Dapat Diedit (A, B, C, D)
    const editableCols = ['colA', 'colB', 'colC', 'colD']; 

    editableCols.forEach(colKey => {
        const display = document.getElementById(`display-${colKey}-${rowIndex}`);
        const input = document.getElementById(`input-${colKey}-${rowIndex}`);
        
        if (display && input) {
            if (isEditMode) {
                display.style.display = 'none';
                input.style.display = 'block';
                input.value = display.textContent.trim();
                autoResizeTextarea(input); 
            } else {
                display.textContent = input.value.trim();
                display.style.display = 'block';
                input.style.display = 'none';
            }
        }
    });

    if (isEditMode) {
        editBtn.style.display = 'none';
        saveBtn.style.display = 'inline-block';
        cancelBtn.style.display = 'inline-block';
        
        title.style.display = 'none';
        
        // Sembunyikan tombol copy di dalam detail saat edit
        copyBtns.forEach(btn => btn.style.display = 'none');

        document.getElementById(`input-colA-${rowIndex}`).focus();
    } else {
        editBtn.style.display = 'inline-block';
        saveBtn.style.display = 'none';
        cancelBtn.style.display = 'none';
        
        // Tampilkan tombol copy di dalam detail saat mode tampilan
        copyBtns.forEach(btn => btn.style.display = 'inline-block');

        title.style.display = 'flex';

        const newTitle = document.getElementById(`input-colA-${rowIndex}`).value.trim();
        const titleTextElement = document.getElementById(`title-text-${rowIndex}`);

        if (titleTextElement) {
            titleTextElement.textContent = newTitle || `[Baris Kosong ${rowIndex}]`;
        }
    }
}

async function saveReportRow(rowIndex) {
    const card = document.getElementById(`report-row-${rowIndex}`);
    const saveBtn = card.querySelector('.btn-save');
    
    // Payload LENGKAP dengan Kolom C dan D
    const payload = {
        rowIndex: rowIndex,
        colA: document.getElementById(`input-colA-${rowIndex}`).value.trim(),
        colB: document.getElementById(`input-colB-${rowIndex}`).value.trim(),
        colC: document.getElementById(`input-colC-${rowIndex}`).value.trim(),
        colD: document.getElementById(`input-colD-${rowIndex}`).value.trim()
    };
    
    focusRowIndex = rowIndex; 
    saveBtn.innerHTML = '...'; 
    saveBtn.disabled = true;

    google.script.run
        .withSuccessHandler((result) => {
            if (result.status === "success") {
                loadReportLineData(); 
                showToast(result.message); 
            } else {
                showError(result.message); 
                loadReportLineData(); 
            }
        })
        .withFailureHandler((error) => {
            showError("Gagal menyimpan: " + error);
            loadReportLineData();
        })
        .updateReportLineData(payload); 
}

function toggleCancelEdit(rowIndex, isNewRow) {
    if (isNewRow) {
        focusRowIndex = null; 
        loadReportLineData();
        showToast("❌ Pembuatan baris dibatalkan.", false);
    } else {
        focusRowIndex = rowIndex; 
        loadReportLineData(); 
        showToast("❌ Perubahan dibatalkan, kembali ke versi tersimpan.", false);
    }
}

function searchReportLine() {
    const input = document.getElementById('reportSearch')?.value.toLowerCase();
    const allCards = document.querySelectorAll('#reportLineCardContainer .report-card');

    allCards.forEach(card => {
        const textContent = card.textContent.toLowerCase();
        card.style.display = textContent.includes(input) ? 'block' : 'none';
    });
}

function addNewReportRow() {
    const lastItem = reportData[reportData.length - 1];
    const newIndex = lastItem ? lastItem.rowIndex + 1 : 2; 

    if (newIndex > 450) {
        showError("Batas maksimum baris (200) telah tercapai.");
        return;
    }
    
    const newRowItem = {
        rowIndex: newIndex,
        colA: '', colB: '', colC: '', colD: '',
        isNew: true 
    };
    
    reportData.push(newRowItem);
    displayReportLineData(reportData);
    
    const row = document.getElementById(`report-row-${newIndex}`);
    if (row) {
        row.scrollIntoView({ behavior: 'smooth', block: 'end' });
        toggleEditMode(newIndex, true); 
        document.getElementById(`input-colA-${newIndex}`).focus();
    }
    
    showToast(`Baris kosong di baris ${newIndex} ditambahkan. Silakan isi dan Simpan.`);
}

function copyReportTitle(rowIndex) {
    const textToCopy = document.getElementById(`title-text-${rowIndex}`)?.textContent.trim();
    
    navigator.clipboard.writeText(textToCopy).then(() => {
        showToast("Judul berhasil disalin (💫)!"); 
    }).catch(err => {
        showError("Gagal menyalin teks.");
    });
}

function copyReportCell(rowIndex, colKey) {
    const textToCopy = document.getElementById(`display-${colKey}-${rowIndex}`)?.textContent.trim();
    
    navigator.clipboard.writeText(textToCopy).then(() => {
        showToast("Konten berhasil disalin (💫)!"); 
    }).catch(err => {
        showError("Gagal menyalin teks.");
    });
}

function viewReportDetail(rowIndex) {
    // Fungsi ini tidak lagi digunakan, tetapi disimpan sebagai placeholder.
    const content = document.getElementById(`display-colB-${rowIndex}`)?.textContent.trim();
    showToast(`Detail Kolom B: ${content?.substring(0, 50)}...`);
}

        function hapusScatter() {
            const scatterTextarea = document.getElementById("scatterTextarea");
            if (scatterTextarea) scatterTextarea.value = "";
            
            ["UserID", "KodeTiket", "LinkBukti", "Bettingan"].forEach(id => {
                const element = document.getElementById("hasil" + id);
                if (element) element.innerText = "-";
            });
            
            for (let i = 1; i <= 3; i++) {
                const img = document.getElementById(`gambar${i}`);
                if (img) {
                    img.src = "";
                    img.style.display = "none";
                    img.removeAttribute("onclick");
                }
                
                const caption = document.getElementById(`caption${i}`);
                if (caption) caption.innerText = "-";
            }
            
            window.gambarLinks = [];
        }

        // Fungsi untuk reset zoom
        function resetZoom() {
            const zoomDisplay = document.getElementById('zoomDisplay');
            if (zoomDisplay) {
                zoomDisplay.style.left = '0px';
                zoomDisplay.style.top = '0px';
                zoomDisplay.style.transform = 'scale(1)';
            }
        }
        
 // === GALERI OTOMATIS: STATE ===
let bonusAllPackagesData = [];
let bonusCurrentPackageIndex = 0;
const bonusPackageSize = 3;
let isBonusZoomOpen = false;

// --- Input Handler ---
let bonusInputTimeout;
function handleBonusInput() {
  clearTimeout(bonusInputTimeout);
  bonusInputTimeout = setTimeout(loadBonusImages, 50);
}

// --- Muat Data dari Textarea ---
function loadBonusImages() {
  const inputEl = document.getElementById('bonusLinkInput');
  if (!inputEl) return;

  const input = inputEl.value || '';
  const lines = input
    .split('\n')
    .map(l => l.trim())
    .filter(l => l.length > 0);

  bonusAllPackagesData = [];

  lines.forEach(line => {
    const words = line.split(/\s+/).filter(w => w.length > 0);
    const urls = words.filter(w => /^https?:\/\//.test(w));
    const userid = words.length > 0 && !/^https?:\/\//.test(words[0]) ? words[0] : 'N/A';

    if (urls.length >= 1) {
      const links = [...urls.slice(0, bonusPackageSize)];
      while (links.length < bonusPackageSize) links.push('');
      bonusAllPackagesData.push({ userid, links });
    }
  });

  const maxNumEl = document.getElementById('bonusMaxPackageNum');
  if (maxNumEl) maxNumEl.textContent = bonusAllPackagesData.length;

  if (bonusAllPackagesData.length > 0) {
    bonusCurrentPackageIndex = Math.max(0, Math.min(bonusCurrentPackageIndex, bonusAllPackagesData.length - 1));
    updateBonusGallery(bonusCurrentPackageIndex);
  } else {
    updateBonusGallery(-1);
    const currentNumEl = document.getElementById('bonusCurrentPackageNum');
    if (currentNumEl) currentNumEl.textContent = '0';
  }
}

// --- Update Tampilan Galeri ---
function updateBonusGallery(index) {
  const slots = ['bonusImgSlot1', 'bonusImgSlot2', 'bonusImgSlot3'].map(id => document.getElementById(id));
  const combined = document.getElementById('bonusCombinedImageSlot');
  const useridEl = document.getElementById('bonusCombinedSlotUserid');
  const currentNumEl = document.getElementById('bonusCurrentPackageNum');

  if (index >= 0 && index < bonusAllPackagesData.length) {
    const { userid, links } = bonusAllPackagesData[index];
    if (useridEl) useridEl.textContent = `USER ID: ${userid}`;
    if (combined) {
      combined.style.opacity = '1';
      combined.style.pointerEvents = 'auto';
    }

    slots.forEach((img, i) => {
      if (!img) return;
      const src = links[i] || "https://via.placeholder.com/180x160/1a1a2e/555?text=-";
      img.src = src;
      img.style.display = 'inline-block';
    });

    if (currentNumEl) currentNumEl.textContent = index + 1;
  } else {
    if (useridEl) useridEl.textContent = 'Belum Ada Data';
    if (combined) {
      combined.style.opacity = '0.4';
      combined.style.pointerEvents = 'none';
    }

    slots.forEach((img, i) => {
      if (!img) return;
      img.src = "https://via.placeholder.com/180x160/1a1a2e/555?text=-";
      img.style.display = 'inline-block';
    });

    if (currentNumEl) currentNumEl.textContent = '0';
  }
}

// --- Navigasi & Zoom ---
function navigateBonusPackage(dir) {
  if (bonusAllPackagesData.length <= 1) return;
  const total = bonusAllPackagesData.length;
  if (dir === 'next' && bonusCurrentPackageIndex < total - 1) bonusCurrentPackageIndex++;
  else if (dir === 'prev' && bonusCurrentPackageIndex > 0) bonusCurrentPackageIndex--;
  updateBonusGallery(bonusCurrentPackageIndex);
  if (isBonusZoomOpen) {
    const pkg = bonusAllPackagesData[bonusCurrentPackageIndex];
    updateBonusZoomDisplay(pkg.userid, pkg.links);
  }
}

function updateBonusZoomDisplay(userid, links) {
  const wrapper = document.getElementById('bonusZoomedContentWrapper');
  const useridEl = document.getElementById('bonusZoomedUserid');
  if (!wrapper) return;

  wrapper.innerHTML = '';
  links.filter(Boolean).forEach(link => {
    const img = document.createElement('img');
    img.src = link;
    wrapper.appendChild(img);
  });

  if (useridEl) useridEl.textContent = userid;

  // --- Update status tombol navigasi ---
  const prevBtn = document.getElementById('bonusPrevZoomBtn');
  const nextBtn = document.getElementById('bonusNextZoomBtn');
  const index = bonusCurrentPackageIndex;
  const total = bonusAllPackagesData.length;

  if (prevBtn) prevBtn.disabled = (index <= 0);
  if (nextBtn) nextBtn.disabled = (index >= total - 1);
}

function openBonusZoom() {
  if (bonusAllPackagesData.length === 0) return;
  const current = bonusAllPackagesData[bonusCurrentPackageIndex];
  if (!current.links.some(l => l)) return;

  isBonusZoomOpen = true;
  updateBonusZoomDisplay(current.userid, current.links);
  const modal = document.getElementById('bonusZoomModal');
  if (modal) modal.style.display = 'flex';
}

function closeBonusZoom() {
  const modal = document.getElementById('bonusZoomModal');
  if (modal) modal.style.display = 'none';
  isBonusZoomOpen = false;
}

function clearBonusAllData() {
  bonusAllPackagesData = [];
  const inputEl = document.getElementById('bonusLinkInput');
  if (inputEl) inputEl.value = '';
  updateBonusGallery(-1);
  const maxNumEl = document.getElementById('bonusMaxPackageNum');
  if (maxNumEl) maxNumEl.textContent = '0';
}

// --- Keyboard Support ---
document.addEventListener('keydown', (e) => {
  if (isBonusZoomOpen && (e.key === 'ArrowLeft' || e.key === 'ArrowRight')) {
    e.preventDefault();
    if (e.key === 'ArrowLeft') navigateBonusPackage('prev');
    else if (e.key === 'ArrowRight') navigateBonusPackage('next');
  } else if (e.key === 'Escape' && isBonusZoomOpen) {
    closeBonusZoom();
  }
});

// === UTILS ===
function clearField(id) {
  const el = document.getElementById(id);
  if (el) el.value = '';
}

// === VARIABEL GLOBAL ===
const BANK_LIST = [
  'BCA', 'BRI', 'BNI', 'MANDIRI', 'CIMB', 'DANAMON', 'BSI', 'MAYBANK', 'SEABANK', 'JAGO',
  'DANA', 'OVO', 'LINKAJA', 'GOPAY', 'QRIS', 'SHOPEEPAY', 'JENIUS',
  // Variasi penulisan umum
  'BANK BCA', 'BANK BRI', 'BANK BNI', 'BANK MANDIRI',
  'BCA BANK', 'BRI BANK', 'BNI BANK', 'MANDIRI BANK',
  'DANA PAY', 'OVO PAY', 'GOPAY PAY',
  'LINK AJA', 'SHOPEE PAY'
];
let modePerBank = false;

// === FORMAT RUPIAH SESUAI STANDAR INDONESIA ===
function formatRupiah(n) {
  if (!n) return '0';
  return new Intl.NumberFormat('id-ID').format(n);
}

// === CLEAR INPUT ===
function clearDeposit() { 
  const el = document.getElementById('dataDeposit');
  if (el) el.value = ''; 
}
function clearWithdraw() { 
  const el = document.getElementById('dataWithdraw');
  if (el) el.value = ''; 
}

// === AMBIL DATA DARI GOOGLE APPS SCRIPT ===
function loadDeposit() {
  try {
    google.script.run
      .withSuccessHandler(data => {
        const el = document.getElementById('dataDeposit');
        if (el) el.value = data;
      })
      .withFailureHandler(err => {
        console.error("Gagal muat DEPOSIT:", err);
        showToast("❌ Gagal muat DEPOSIT.", "error");
      })
      .getDepositData();
  } catch (err) {
    console.error("Error loadDeposit:", err);
    showToast("❌ Error sistem: loadDeposit", "error");
  }
}

function loadWithdraw() {
  try {
    google.script.run
      .withSuccessHandler(data => {
        const el = document.getElementById('dataWithdraw');
        if (el) el.value = data;
      })
      .withFailureHandler(err => {
        console.error("Gagal muat WITHDRAW:", err);
        showToast("❌ Gagal muat WITHDRAW.", "error");
      })
      .getWithdrawData();
  } catch (err) {
    console.error("Error loadWithdraw:", err);
    showToast("❌ Error sistem: loadWithdraw", "error");
  }
}

// === EKSTRAKSI NAMA & BANK ===
function detectBank(t) {
  const u = (t || '').toUpperCase();
  for (const bank of BANK_LIST) {
    if (u.includes(bank)) {
      return bank;
    }
  }
  return 'LAINNYA';
}

function extractName(t) {
  let c = t.trim(), i = c.toUpperCase().indexOf('DEPO ');
  if (i !== -1) c = c.substring(i + 5).trim();
  const s = c.lastIndexOf('/');
  return s !== -1 ? c.substring(s + 1).trim() : c;
}

// === PARSING BARIS DATA ===
function parseLine(l, isWd = false) {
  l = l.trim();
  if (!l) return null;
  const p = l.split('\t').map(x => x.trim()).filter(x => x);
  if (p.length < 2) return null;
  if (isWd) {
    const [k, nRaw, src] = p;
    const num = parseInt(nRaw.replace(/[^0-9]/g, '')) || 0;
    return { nama: extractName(src || k), bank: detectBank(src || k), nominalRaw: formatRupiah(num), nominalClean: num, asli: l, note: k };
  } else {
    const [desc, nRaw] = p;
    const num = parseInt(nRaw.replace(/[^0-9]/g, '')) || 0;
    return { nama: extractName(desc), bank: detectBank(desc), nominalRaw: formatRupiah(num), nominalClean: num, asli: l, note: '' };
  }
}

// === PROSES ANALISIS DEPO-WD ===
function prosesDepositWithdraw() {
  const dEl = document.getElementById('dataDeposit');
  const wEl = document.getElementById('dataWithdraw');
  if (!dEl || !wEl) return;
  
  const d = dEl.value.trim();
  const w = wEl.value.trim();
  if (!d || !w) {
    showToast("⚠️ Harap isi kedua kolom!", "warning");
    return;
  }

  const depo = d.split('\n').map(l => parseLine(l, false)).filter(Boolean);
  const wd = w.split('\n').map(l => parseLine(l, true)).filter(Boolean);
  if (!depo.length || !wd.length) {
    showToast("❌ Format data tidak valid!", "error");
    return;
  }

  modePerBank ? analisisPerBank(depo, wd) : analisisPerPengguna(depo, wd);
}

// === ANALISIS PER PENGGUNA ===
function analisisPerPengguna(depo, wd) {
  const dTot = {}, wTot = {}, dDet = {}, wDet = {};
  depo.forEach(i => {
    const k = i.nama.toLowerCase().trim();
    dTot[k] = (dTot[k] || 0) + i.nominalClean;
    (dDet[k] = dDet[k] || []).push(i);
  });
  wd.forEach(i => {
    const k = i.nama.toLowerCase().trim();
    wTot[k] = (wTot[k] || 0) + i.nominalClean;
    (wDet[k] = wDet[k] || []).push(i);
  });

  const names = [...new Set([...Object.keys(dTot), ...Object.keys(wTot)])];
  const results = names.map(k => {
    const n = dDet[k] ? depo.find(x => x.nama.toLowerCase() === k)?.nama : wd.find(x => x.nama.toLowerCase() === k)?.nama || k;
    const d = dTot[k] || 0, w = wTot[k] || 0, diff = d - w;
    let selisihKet, selisihClass;
    if (d > 0 && w > 0) {
      if (diff === 0) { selisihKet = "✅ COCOK"; selisihClass = "selisih-cocok"; }
      else if (diff > 0) { selisihKet = "⚠️ KELEBIHAN DEPOSIT"; selisihClass = "selisih-lebih"; }
      else { selisihKet = "⚠️ KEKURANGAN DEPOSIT"; selisihClass = "selisih-kurang"; }
    } else {
      selisihKet = "❌ TIDAK LENGKAP"; selisihClass = "selisih-kurang";
    }
    return { nama: n, depo: d, wd: w, diff, selisihKet, selisihClass, dEntries: dDet[k] || [], wEntries: wDet[k] || [] };
  });

  renderPerPengguna(results);
}

// === ANALISIS PER BANK ===
function analisisPerBank(depo, wd) {
  const dByBank = {}, wByBank = {}, dEntries = {}, wEntries = {};
  [...BANK_LIST, 'LAINNYA'].forEach(b => {
    dByBank[b] = 0; wByBank[b] = 0; dEntries[b] = []; wEntries[b] = [];
  });
  depo.forEach(i => { dByBank[i.bank] += i.nominalClean; dEntries[i.bank].push(i); });
  wd.forEach(i => { wByBank[i.bank] += i.nominalClean; wEntries[i.bank].push(i); });

  const results = [...BANK_LIST, 'LAINNYA']
    .map(bank => {
      const d = dByBank[bank], w = wByBank[bank], diff = d - w;
      if (d === 0 && w === 0) return null;
      let selisihKet, selisihClass;
      if (d > 0 && w > 0) {
        if (diff === 0) { selisihKet = "✅ COCOK"; selisihClass = "selisih-cocok"; }
        else if (diff > 0) { selisihKet = "⚠️ KELEBIHAN DEPOSIT"; selisihClass = "selisih-lebih"; }
        else { selisihKet = "⚠️ KEKURANGAN DEPOSIT"; selisihClass = "selisih-kurang"; }
      } else {
        selisihKet = "❌ TIDAK LENGKAP"; selisihClass = "selisih-kurang";
      }
      return { bank, depo: d, wd: w, diff, selisihKet, selisihClass, dEntries: dEntries[bank], wEntries: wEntries[bank] };
    })
    .filter(Boolean);
  renderPerBank(results);
}

function renderPerPengguna(results) {
  const container = document.getElementById('hasilDepoWd');
  if (!container) return;

  let html = `<div class="depo-wd-container">`;

  results.forEach(r => {
    const depoFmt = r.depo > 0 ? formatRupiah(r.depo) : '–';
    const wdFmt = r.wd > 0 ? formatRupiah(r.wd) : '–';
    const diff = r.diff;
    const diffFmt = diff === 0 ? '0' : (diff > 0 ? `+${formatRupiah(diff)}` : `-${formatRupiah(Math.abs(diff))}`);
    
    // Status badge
    let statusClass = 'status-cocok';
    let statusText = '✅ COCOK';
    if (diff !== 0 && r.depo > 0 && r.wd > 0) {
      statusClass = diff > 0 ? 'status-lebih' : 'status-kurang';
      statusText = diff > 0 ? '⚠️ KELEBIHAN' : '⚠️ KEKURANGAN';
    } else if (r.depo === 0 || r.wd === 0) {
      statusClass = 'status-kurang';
      statusText = '❌ TIDAK LENGKAP';
    }

    // Deskripsi deposit (ambil dari entri pertama)
    const depoDesc = r.dEntries.length ? r.dEntries[0].asli.split('\t')[0] || '' : '';
    const withDesc = r.wEntries.length ? r.wEntries[0].asli.split('\t')[0] || '' : '';

    html += `
    <div class="user-card-compact">
      <div class="user-header-compact">${r.nama}</div>
      <div class="depo-withdraw-grid">
        <div class="depo-col">
          <h3>DEPOSIT</h3>
          <div class="amount-value">${depoFmt}</div>
          <div class="desc-text">${depoDesc}</div>
          <div class="total-row">TOTAL: <span>${depoFmt}</span></div>
        </div>
        <div class="with-col">
          <h3>WITHDRAW</h3>
          <div class="amount-value">${wdFmt}</div>
          <div class="desc-text">${withDesc}</div>
          <div class="total-row">TOTAL: <span>${wdFmt}</span></div>
        </div>
      </div>
      <div class="status-badge ${statusClass}">
        ${statusText}
        <div class="diff-value">${diffFmt}</div>
      </div>
    </div>`;
  });

  html += '</div>';
  container.innerHTML = html;
}

function renderPerBank(results) {
  const container = document.getElementById('hasilDepoWd');
  if (!container) return;
  
  let html = `<div class="depo-wd-container"><div class="summary-box"><strong>📊 Total Bank/Sumber:</strong> ${results.length}</div>`;
  results.forEach(r => {
    const depoFmt = r.depo > 0 ? formatRupiah(r.depo) : '–';
    const wdFmt = r.wd > 0 ? formatRupiah(r.wd) : '–';
    const selisihNum = r.diff === 0 ? '0' : (r.diff > 0 ? `+${formatRupiah(r.diff)}` : `-${formatRupiah(Math.abs(r.diff))}`);
    html += `
    <div class="bank-card">
      <div class="card-header">🏦 ${r.bank}</div>
      <div class="card-body">
        <div class="col">
          <div class="col-title"><span>📥 DEPOSIT</span></div>
          <ul class="entry-list">
            ${r.dEntries.length ? r.dEntries.map(e => `<li class="entry-item">${e.nominalRaw}</li>`).join('') : '<li class="entry-item">–</li>'}
          </ul>
          <div class="total-row">
            <span class="total-label">TOTAL:</span>
            <span class="total-value deposit-color">${depoFmt}</span>
          </div>
        </div>
        <div class="col">
          <div class="col-title"><span>📤 WITHDRAW</span></div>
          <ul class="entry-list">
            ${r.wEntries.length ? r.wEntries.map(e => `
            <li class="entry-item">
              <span class="nominal">${e.nominalRaw}</span>
              ${e.note ? `<div class="withdraw-note">${e.note}</div>` : ''}
            </li>
            `).join('') : '<li class="entry-item">–</li>'}
          </ul>
          <div class="total-row">
            <span class="total-label">TOTAL:</span>
            <span class="total-value withdraw-color">${wdFmt}</span>
          </div>
        </div>
      </div>
      <div class="selisih-besar ${r.selisihClass}">${r.selisihKet}</div>
      <div class="selisih-jumlah ${r.selisihClass}">${selisihNum}</div>
    </div>`;
  });
  html += '</div>';
  container.innerHTML = html;
}

// === EXTRACTOR LOGIC ===
const E_WALLET_CODES = {
  'DANA': '3901',
  'OVO': '39358',
  'LINKAJA': '09110',
  'GOPAY': '70001'
};

function clearBulkExtract() {
  const input = document.getElementById('bulkExtractInput');
  const container = document.getElementById('bulkResultsContainer');
  if (input) input.value = '';
  if (container) container.innerHTML = '';
}

function copyBulkExtracted() {
  const container = document.getElementById('bulkResultsContainer');
  if (!container || !container.children.length) {
    showToast("⚠️ Tidak ada data untuk disalin!", "warning");
    return;
  }

  const items = Array.from(container.querySelectorAll('.extract-h-card'));
  let text = '';
  items.forEach(card => {
    const vals = card.querySelectorAll('.value');
    if (vals.length >= 4) {
      text += `${vals[0].textContent.trim()}\t${vals[1].textContent.trim()}\t${vals[2].textContent.trim()}\t${vals[3].textContent.trim()}\n`;
    }
  });
  navigator.clipboard.writeText(text.trim()).then(() => {
    showToast("✅ Data berhasil disalin!", "success");
  }, () => {
    showToast("❌ Gagal menyalin ke clipboard.", "error");
  });
}

function splitIntoBlocks(text) {
  const lines = text.split('\n').map(l => l.trim()).filter(l => l !== '');
  const blocks = [];
  let currentBlock = [];

  for (const line of lines) {
    if (/^\d+(\s|\t|$)/.test(line)) {
      if (currentBlock.length > 0) {
        blocks.push(currentBlock);
      }
      currentBlock = [line];
    } else {
      currentBlock.push(line);
    }
  }
  if (currentBlock.length > 0) {
    blocks.push(currentBlock);
  }
  return blocks;
}

function parseSingleWithdrawBlock(lines) {
  lines = lines.map(l => l.trim()).filter(l => l !== '');
  
  let account = '–';
  let username = '–';
  let name = '–';
  let nominal = '–';
  
  // Ambil USER ID
  if (lines.length > 0) {
    const firstLine = lines[0];
    if (firstLine.includes('\t')) {
      const parts = firstLine.split('\t').filter(p => p.trim() !== '');
      if (parts.length >= 2) username = parts[1].trim();
    } else {
      const parts = firstLine.split(/\s+/);
      if (parts.length >= 2) username = parts[1].trim();
    }
  }
  
  // Ambil NOMINAL
  for (let i = 0; i < lines.length; i++) {
    if (lines[i].toUpperCase().includes('WITHDRAW')) {
      const parts = lines[i].split('\t').filter(p => p.trim() !== '');
      if (parts.length >= 3) {
        nominal = parts[2].trim().replace(/\s+/g, '');
      }
      break;
    }
  }
  
  // Ambil REKENING & NAMA
  for (let i = lines.length - 1; i >= 0; i--) {
    const line = lines[i];
    if (line.includes(',')) {
      const parts = line.split(',').map(p => p.trim());
      name = (parts.length >= 3 ? parts[2] : parts[1] || '').toUpperCase();
      const bankType = parts[0].toUpperCase();
      let accountNumber = parts.length >= 2 ? parts[1].replace(/\D/g, '') : '';
      if (E_WALLET_CODES.hasOwnProperty(bankType)) {
        account = E_WALLET_CODES[bankType] + accountNumber;
      } else {
        account = accountNumber || '–';
      }
      break;
    }
  }
  
  // Fallback cari nomor telepon
  if (account === '–') {
    for (let i = 0; i < lines.length; i++) {
      const phoneMatch = lines[i].match(/\b\d{10,13}\b/);
      if (phoneMatch) {
        account = phoneMatch[0];
        break;
      }
    }
  }
  
  // Validasi nominal
  if (nominal !== '–') {
    nominal = nominal.replace(/[^\d,.]/g, '');
    if (!nominal.includes(',') && !nominal.includes('.')) {
      const num = parseInt(nominal.replace(/\D/g, ''));
      if (!isNaN(num) && num > 0) {
        nominal = formatRupiah(num);
      }
    }
  }
  
  return {
    account: account || '–',
    username: username || '–',
    name: name || '–',
    nominal: nominal || '–'
  };
}

function processBulkExtract() {
  const input = document.getElementById('bulkExtractInput');
  if (!input || !input.value.trim()) {
    clearBulkExtract();
    return;
  }

  const blocks = splitIntoBlocks(input.value);
  const container = document.getElementById('bulkResultsContainer');
  if (!container) return;
  
  container.innerHTML = '';
  const limitedBlocks = blocks.slice(0, 100);
  limitedBlocks.forEach(block => {
    const data = parseSingleWithdrawBlock(block);
    const card = document.createElement('div');
    card.className = 'extract-h-card';
    card.innerHTML = `
      <div class="label">Kolom 1 (Rekening)</div>
      <div class="value">${data.account}</div>
      <div class="label">Kolom 2 (User ID)</div>
      <div class="value">${data.username}</div>
      <div class="label">Kolom 3 (Nama)</div>
      <div class="value">${data.name}</div>
      <div class="label">Kolom 4 (Nominal)</div>
      <div class="value">${data.nominal}</div>
    `;
    container.appendChild(card);
  });
  showToast(`✅ ${limitedBlocks.length} data berhasil diekstraksi.`, "success");
}

// === TRY CARI LOGIC ===
function parseData_TRYCARI(raw) {
  return raw
    .split('\n')
    .map(line => line.trim())
    .filter(line => line)
    .map(line => {
      const parts = line.split('\t').map(p => p.trim());
      if (parts.length >= 4) {
        return {
          jam: parts[0],
          userID: parts[1],
          nama: parts[2],
          nominal: parts[3]
        };
      }
      return null;
    })
    .filter(row => row !== null);
}

function prosesData_TRYCARI() {
  const docsEl = document.getElementById('dataDocs');
  const adminEl = document.getElementById('dataAdmin');
  if (!docsEl || !adminEl) return;
  
  const rawDataDocs = docsEl.value;
  const rawDataAdmin = adminEl.value;

  if (!rawDataDocs.trim() || !rawDataAdmin.trim()) {
    const hasil = document.getElementById('hasil_TRYCARI');
    if (hasil) hasil.innerHTML = '';
    showToast("⚠️ Harap paste data di kedua kolom!", "warning");
    return;
  }

  const dataDocs = parseData_TRYCARI(rawDataDocs);
  const dataAdmin = parseData_TRYCARI(rawDataAdmin);

  if (dataDocs.length === 0 || dataAdmin.length === 0) {
    const hasil = document.getElementById('hasil_TRYCARI');
    if (hasil) hasil.innerHTML = '';
    showToast("❌ Format data tidak valid! Pastikan tiap baris punya 4 kolom (dipisah TAB).", "error");
    return;
  }

  const adminKeyList = dataAdmin.map(row => {
    const userIDClean = String(row.userID).toLowerCase().trim();
    const nominalClean = String(row.nominal).replace(/[^0-9]/g, '');
    return `${userIDClean}|${nominalClean}`;
  });

  const adminCountMap = {};
  adminKeyList.forEach(key => {
    adminCountMap[key] = (adminCountMap[key] || 0) + 1;
  });

  const adminNominalMap = {};
  dataAdmin.forEach(row => {
    const userIDClean = String(row.userID).toLowerCase().trim();
    const nominalClean = String(row.nominal).replace(/[^0-9]/g, '');
    const key = `${userIDClean}|${nominalClean}`;
    if (!adminNominalMap[key]) {
      adminNominalMap[key] = row.nominal;
    }
  });

  const results = [];
  dataDocs.forEach(row => {
    const { jam, userID, nama, nominal } = row;
    const userIDClean = String(userID).toLowerCase().trim();
    const nominalClean = String(nominal).replace(/[^0-9]/g, '');
    const key = `${userIDClean}|${nominalClean}`;

    let status, kelas, nominalDiAdmin = '–';

    if (adminCountMap[key] > 0) {
      adminCountMap[key]--;
      status = '✅ COCOK';
      kelas = 'background-color:#2e7d32;color:white;';
      nominalDiAdmin = adminNominalMap[key] || nominal;
    } else {
      status = '❌ TIDAK COCOK';
      kelas = 'background-color:#b71c1c;color:white;';
    }

    results.push({ jam, userID, nama, nominal, nominalDiAdmin, status, kelas });
  });

  const usageCount = {};
  adminKeyList.forEach(key => {
    usageCount[key] = (usageCount[key] || 0) + 1;
  });

  for (const key in adminCountMap) {
    const used = (usageCount[key] || 0) - adminCountMap[key];
    usageCount[key] = used;
  }

  const adminRowsWithStatus = dataAdmin.map(row => {
    const userIDClean = String(row.userID).toLowerCase().trim();
    const nominalClean = String(row.nominal).replace(/[^0-9]/g, '');
    const key = `${userIDClean}|${nominalClean}`;
    const isUsed = usageCount[key] > 0;
    if (isUsed) usageCount[key]--;
    return { ...row, isUsed };
  });

  const unusedNotesAdmin = [];
  for (const key in adminCountMap) {
    if (adminCountMap[key] > 0) {
      const [userID, cleanNom] = key.split('|');
      const nominalAsli = adminNominalMap[key] || new Intl.NumberFormat('id-ID').format(parseInt(cleanNom));
      unusedNotesAdmin.push(`User <strong>${userID}</strong> dengan nominal <strong>${nominalAsli}</strong> → ${adminCountMap[key]} entri tidak digunakan.`);
    }
  }

  const unusedNotesDocs = results
    .filter(row => row.status === '❌ TIDAK COCOK')
    .map(row => `User <strong>${row.userID}</strong> dengan nominal <strong>${row.nominal}</strong> (${row.jam})`);

  const totalDocs = dataDocs.length;
  const totalAdmin = dataAdmin.length;
  const totalCocok = results.filter(r => r.status === '✅ COCOK').length;
  const totalTidakCocok = totalDocs - totalCocok;

  let html = `<div style="display:flex; gap:20px; flex-wrap:wrap;">`;

  html += `
  <div style="flex:1; min-width:300px; background:var(--panel-bg); padding:15px; border-radius:8px; border:1px solid var(--panel-border); box-shadow:0 0 8px var(--panel-shadow);">
    <h3 style="color:var(--neon-blue); text-align:center; margin-top:0; padding-bottom:8px; border-bottom:1px solid var(--panel-border); text-shadow:0 0 10px rgba(0,255,255,0.9);">
      📄 DATA DOCS (Dengan Analisis)
    </h3>
    <table style="width:100%; border-collapse:collapse; font-size:13px;">
      <thead>
        <tr>
          <th style="padding:8px; text-align:left; border:1px solid var(--panel-border); background:rgba(0,30,60,0.6); color:var(--text-title);">JAM</th>
          <th style="padding:8px; text-align:left; border:1px solid var(--panel-border); background:rgba(0,30,60,0.6); color:var(--text-title);">USER ID</th>
          <th style="padding:8px; text-align:left; border:1px solid var(--panel-border); background:rgba(0,30,60,0.6); color:var(--text-title);">NOMINAL</th>
          <th style="padding:8px; text-align:left; border:1px solid var(--panel-border); background:rgba(0,30,60,0.6); color:var(--text-title);">NOMINAL DI ADMIN</th>
          <th style="padding:8px; text-align:left; border:1px solid var(--panel-border); background:rgba(0,30,60,0.6); color:var(--text-title);">STATUS</th>
        </tr>
      </thead>
      <tbody>`;

  results.forEach(row => {
    html += `
      <tr style="${row.kelas}">
        <td style="padding:8px; text-align:left; border:1px solid var(--panel-border); font-family:monospace; color:var(--text-main);">${row.jam}</td>
        <td style="padding:8px; text-align:left; border:1px solid var(--panel-border); font-weight:bold;">${row.userID}</td>
        <td style="padding:8px; text-align:left; border:1px solid var(--panel-border); font-family:monospace;">${row.nominal}</td>
        <td style="padding:8px; text-align:left; border:1px solid var(--panel-border); font-family:monospace;">${row.nominalDiAdmin}</td>
        <td style="padding:8px; text-align:left; border:1px solid var(--panel-border);">${row.status}</td>
      </tr>`;
  });

  html += `</tbody></table>`;

  html += `
    <div style="margin-top:14px; padding:12px; background:rgba(0,15,30,0.7); border-radius:6px; color:var(--text-main); font-size:13px; line-height:1.5;">
      <strong>📊 Ringkasan:</strong><br>
      • Total entri DOCS: <strong>${totalDocs}</strong><br>
      • Total entri ADMIN: <strong>${totalAdmin}</strong><br>
      • <span style="color:var(--neon-green);">✅ COCOK: ${totalCocok}</span><br>
      • <span style="color:var(--neon-red);">❌ TIDAK COCOK: ${totalTidakCocok}</span>
    </div>`;

  if (unusedNotesDocs.length > 0) {
    html += `
      <div style="margin-top:12px; padding:12px; background:rgba(0,20,40,0.7); border-left:4px solid var(--neon-red); border-radius:4px; color:#ffebee; font-size:13px; line-height:1.5;">
        <strong>⚠️ Entri DOCS yang Tidak Terpakai:</strong><br>
        ${unusedNotesDocs.map(n => `• ${n}`).join('<br>')}
      </div>`;
  }

  if (unusedNotesAdmin.length > 0) {
    html += `
      <div style="margin-top:12px; padding:12px; background:rgba(0,20,40,0.7); border-left:4px solid var(--neon-yellow); border-radius:4px; color:var(--text-main); font-size:13px; line-height:1.5;">
        <strong>ℹ️ Entri ADMIN yang Tidak Terpakai:</strong><br>
        ${unusedNotesAdmin.map(n => `• ${n}`).join('<br>')}
      </div>`;
  }

  html += `</div>`;

  html += `
  <div style="flex:1; min-width:300px; background:var(--panel-bg); padding:15px; border-radius:8px; border:1px solid var(--panel-border); box-shadow:0 0 8px var(--panel-shadow);">
    <h3 style="color:var(--neon-blue); text-align:center; margin-top:0; padding-bottom:8px; border-bottom:1px solid var(--panel-border); text-shadow:0 0 10px rgba(0,255,255,0.9);">
      📊 DATA ADMIN (Referensi)
    </h3>
    <table style="width:100%; border-collapse:collapse; font-size:13px;">
      <thead>
        <tr>
          <th style="padding:8px; text-align:left; border:1px solid var(--panel-border); background:rgba(0,30,60,0.6); color:var(--text-title);">JAM</th>
          <th style="padding:8px; text-align:left; border:1px solid var(--panel-border); background:rgba(0,30,60,0.6); color:var(--text-title);">USER ID</th>
          <th style="padding:8px; text-align:left; border:1px solid var(--panel-border); background:rgba(0,30,60,0.6); color:var(--text-title);">NAMA</th>
          <th style="padding:8px; text-align:left; border:1px solid var(--panel-border); background:rgba(0,30,60,0.6); color:var(--text-title);">NOMINAL</th>
          <th style="padding:8px; text-align:left; border:1px solid var(--panel-border); background:rgba(0,30,60,0.6); color:var(--text-title);">STATUS</th>
        </tr>
      </thead>
      <tbody>`;

  adminRowsWithStatus.forEach(row => {
    const bgColor = row.isUsed
      ? 'rgba(46, 125, 50, 0.2)'
      : 'rgba(227, 242, 253, 0.2)';
    const textColor = row.isUsed ? 'var(--text-title)' : '#81d4fa';
    const statusText = row.isUsed ? '✅ Dipakai' : '⚪ Tidak terpakai';

    html += `
      <tr style="background-color:${bgColor}; color:${textColor};">
        <td style="padding:8px; text-align:left; border:1px solid var(--panel-border); font-family:monospace;">${row.jam}</td>
        <td style="padding:8px; text-align:left; border:1px solid var(--panel-border); font-weight:bold;">${row.userID}</td>
        <td style="padding:8px; text-align:left; border:1px solid var(--panel-border);">${row.nama}</td>
        <td style="padding:8px; text-align:left; border:1px solid var(--panel-border); font-family:monospace;">${row.nominal}</td>
        <td style="padding:8px; text-align:left; border:1px solid var(--panel-border);">${statusText}</td>
      </tr>`;
  });

  html += `</tbody></table></div></div>`;

  const hasil = document.getElementById('hasil_TRYCARI');
  if (hasil) hasil.innerHTML = html;
  showToast(`✅ Analisis selesai: ${totalCocok} cocok dari ${totalDocs} entri.`, "success");
}

// === INISIALISASI ===
document.addEventListener('DOMContentLoaded', () => {
  // Mode toggle
  const toggle = document.getElementById('modeToggle');
  const modeText = document.getElementById('modeText');
  if (toggle && modeText) {
    toggle.addEventListener('change', e => {
      modePerBank = e.target.checked;
      modeText.textContent = modePerBank ? 'Saat ini: Per Bank' : 'Saat ini: Per Pengguna';
    });
  }

  // Tab switch
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const target = btn.dataset.tab;
      document.getElementById('panel-analyzer').style.display = target === 'analyzer' ? 'block' : 'none';
      document.getElementById('panel-extractor').style.display = target === 'extractor' ? 'block' : 'none';
      document.getElementById('panel-trycari').style.display = target === 'trycari' ? 'block' : 'none';
    });
  });
});

let currentBonusMode = 'bonusAsli';

function switchBonusMode(mode) {
  // Sembunyikan semua mode
  document.getElementById('modeBonusAsli').style.display = 'none';
  document.getElementById('modeGaleri').style.display = 'none';
  document.getElementById('modeInputScatter').style.display = 'none';

  // Tampilkan mode yang dipilih
  if (mode === 'bonusAsli') {
    document.getElementById('modeBonusAsli').style.display = 'block';
  } else if (mode === 'galeri') {
    document.getElementById('modeGaleri').style.display = 'block';
  } else if (mode === 'inputScatter') {
    document.getElementById('modeInputScatter').style.display = 'block';
  }

  // Update gaya tombol aktif
  const buttons = ['bonusAsli', 'galeri', 'inputScatter'];
  buttons.forEach(id => {
    const btn = document.getElementById(`btn-${id}`);
    if (btn) {
      if (id === mode) {
        btn.classList.add('active');
      } else {
        btn.classList.remove('active');
      }
    }
  });
}

// =============== VARIABEL GLOBAL ===============
let currentDataIndex = 1; // 1 atau 2

// =============== SCAN SCATTER 2 ===============
function scanScatter2(index) {
  currentDataIndex = index;
  const link = document.getElementById(`bonusScatter2_${index}`).value.trim();
  if (!link) return showToast("❌ Masukkan link Scatter 2!");

  const img = document.getElementById('scanScatter2Image');
  const resultDiv = document.getElementById('scanScatter2Result');
  const modal = document.getElementById('scanScatter2Modal');

  if (img) img.src = link;
  if (modal) modal.style.display = 'flex';
  if (resultDiv) resultDiv.innerHTML = `<span style="color:gray;">⏳ Memindai gambar...</span>`;

  if (typeof Tesseract === 'undefined') {
    if (resultDiv) resultDiv.innerHTML = `<span style="color:red;">❗ Tesseract.js belum dimuat.</span>`;
    return;
  }

  Tesseract.recognize(link, 'eng', {
    logger: m => console.log(m)
  }).then(({ data: { text } }) => {
    const rawLines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
    let hasilGabung = [], hasilLangsung = [];

    // Pola gabungan: 9-10 digit + baris berikutnya 8+ digit
    for (let i = 0; i < rawLines.length; i++) {
      const line = rawLines[i];
      const match = line.match(/\b\d{9,10}\b/);
      if (match) {
        if (i + 1 < rawLines.length) {
          const nextLine = rawLines[i + 1].trim();
          const nextMatch = nextLine.match(/\b\d{8,}\b/);
          if (nextMatch) {
            hasilGabung.push(match[0] + nextMatch[0]);
            i++;
            continue;
          }
        }
        hasilGabung.push(match[0]);
      }
    }

    // Semua angka ≥8 digit per baris
    for (const line of rawLines) {
      const matches = line.match(/\d{8,}/g);
      if (matches) matches.forEach(m => hasilLangsung.push(m));
    }

    hasilGabung = [...new Set(hasilGabung)];
    hasilLangsung = [...new Set(hasilLangsung)];

    if (hasilGabung.length === 0 && hasilLangsung.length === 0) {
      if (resultDiv) resultDiv.innerHTML = `<span style="color:orange;">❌ Tidak ditemukan angka panjang.</span>`;
    } else {
      if (resultDiv) resultDiv.innerHTML = "";

      if (hasilGabung.length > 0) {
        const title1 = document.createElement("div");
        title1.innerHTML = `<b style="color:deepskyblue;">📘 Hasil Gabungan Baris:</b>`;
        title1.style.margin = "12px 0 4px";
        if (resultDiv) resultDiv.appendChild(title1);

        hasilGabung.forEach(kode => {
          const div = document.createElement("div");
          div.style = `
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(0,150,255,0.2);
            border: 1px solid deepskyblue;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
          `;
          div.innerHTML = `
            <span style="word-break: break-all;">${kode}</span>
            <div style="display:flex; gap:6px;">
              <button onclick="copyWithFeedback(this, '${kode}')" 
                style="background: deepskyblue; color: #00FFFF; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold;">
                Copy
              </button>
              <button onclick="pilihKodeTransaksi('${kode}')" 
                style="background: #00ff88; color: #000; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold;">
                Pilih
              </button>
            </div>
          `;
          if (resultDiv) resultDiv.appendChild(div);
        });
      }

      if (hasilLangsung.length > 0) {
        const title2 = document.createElement("div");
        title2.innerHTML = `<b style="color:limegreen;">📗 Hasil Angka Per Baris:</b>`;
        title2.style.margin = "12px 0 4px";
        if (resultDiv) resultDiv.appendChild(title2);

        hasilLangsung.forEach(kode => {
          const div = document.createElement("div");
          div.style = `
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(0,255,0,0.15);
            border: 1px solid limegreen;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
          `;
          div.innerHTML = `
            <span style="word-break: break-all;">${kode}</span>
            <div style="display:flex; gap:6px;">
              <button onclick="copyWithFeedback(this, '${kode}')" 
                style="background: limegreen; color: #00FFFF; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold;">
                Copy
              </button>
              <button onclick="pilihKodeTransaksi('${kode}')" 
                style="background: #00ff88; color: #000; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold;">
                Pilih
              </button>
            </div>
          `;
          if (resultDiv) resultDiv.appendChild(div);
        });
      }
    }
  }).catch(err => {
    console.error(err);
    if (resultDiv) resultDiv.innerHTML = `<span style="color:red;">❗ Gagal membaca gambar.</span>`;
  });
}

// --- Fungsi Pendukung (pastikan sudah ada) ---
function copyWithFeedback(btn, text) {
  navigator.clipboard.writeText(text).then(() => {
    const original = btn.innerHTML;
    btn.innerHTML = '✓';
    btn.style.background = '#00ff00';
    setTimeout(() => {
      btn.innerHTML = original;
      btn.style.background = ''; // reset ke warna asli
    }, 1000);
  }).catch(() => {
    showToast("❌ Gagal menyalin");
  });
}

function pilihKodeTransaksi(kode) {
  document.getElementById(`bonusKodeTransaksi${currentDataIndex}`).value = kode;
  closeScanScatter2Modal();
  showToast(`✅ Kode untuk Data ${currentDataIndex} dipilih: ${kode}`);
}

function closeScanScatter2Modal() {
  const modal = document.getElementById('scanScatter2Modal');
  if (modal) modal.style.display = 'none';
}

// =============== COPY FUNCTIONS ===============
function prosesRekening(rek) {
  const parts = rek.split(',').map(p => p.trim());
  const nama = parts[0] || '';
  const nomor = parts.slice(1).join(',') || '';
  return { nomor, nama };
}

// --- Ambil Data 1 sebagai kolom tab-separated (hanya yang terisi) ---
function getData1As7Columns() {
  const userid = document.getElementById('bonusUserid1').value.trim();
  const s1 = document.getElementById('bonusScatter1_1').value.trim();
  const s2 = document.getElementById('bonusScatter2_1').value.trim();
  const s3 = document.getElementById('bonusScatter3_1').value.trim();
  const rek = document.getElementById('bonusRekening1').value.trim();
  const kode = document.getElementById('bonusKodeTransaksi1').value.trim();

  let parts = [];

  if (userid) parts.push(userid);
  if (s1) parts.push(s1);
  if (s2) parts.push(s2);
  if (s3) parts.push(s3);

  // Proses rekening hanya jika ada isinya
  if (rek) {
    const { nomor, nama } = prosesRekening(rek);
    if (nomor) parts.push(nomor);
    if (nama) parts.push(nama);
  }

  if (kode) parts.push(kode);

  return parts.join('\t');
}

// --- Ambil Data 2 sebagai kolom tab-separated (hanya yang terisi) ---
function getData2As7Columns() {
  const userid = document.getElementById('bonusUserid2').value.trim();
  const s1 = document.getElementById('bonusScatter1_2').value.trim();
  const s2 = document.getElementById('bonusScatter2_2').value.trim();
  const s3 = document.getElementById('bonusScatter3_2').value.trim();
  const rek = document.getElementById('bonusRekening2').value.trim();
  const kode = document.getElementById('bonusKodeTransaksi2').value.trim();

  let parts = [];

  if (userid) parts.push(userid);
  if (s1) parts.push(s1);
  if (s2) parts.push(s2);
  if (s3) parts.push(s3);

  if (rek) {
    const { nomor, nama } = prosesRekening(rek);
    if (nomor) parts.push(nomor);
    if (nama) parts.push(nama);
  }

  if (kode) parts.push(kode);

  return parts.join('\t');
}

// --- Copy Data 1 (boleh sebagian) ---
function copyData1() {
  const data = getData1As7Columns();
  copyToClipboard(data || '', "Data 1");
  if (data) {
    showToast("✅ Data 1 disalin!");
  } else {
    showToast("ℹ️ Data 1 kosong, tapi tetap disalin.");
  }
}

// --- Copy Data 2 (boleh sebagian) ---
function copyData2() {
  const data = getData2As7Columns();
  copyToClipboard(data || '', "Data 2");
  if (data) {
    showToast("✅ Data 2 disalin!");
  } else {
    showToast("ℹ️ Data 2 kosong, tapi tetap disalin.");
  }
}

// --- Copy Semua Data (gabung Data 1 + Data 2, tiap baris opsional) ---
function copySemuaData() {
  const data1 = getData1As7Columns();
  const data2 = getData2As7Columns();

  let lines = [];
  if (data1 !== '') lines.push(data1);
  if (data2 !== '') lines.push(data2);

  const teks = lines.join('\n');
  copyToClipboard(teks, "Semua Data");

  if (teks) {
    showToast("✅ Semua data valid disalin!");
  } else {
    showToast("ℹ️ Tidak ada data terisi, clipboard dikosongkan.");
  }
}

function hapusSemuaData() {
  const inputs = [
    'bonusUserid1', 'bonusScatter1_1', 'bonusScatter2_1', 'bonusScatter3_1', 'bonusRekening1', 'bonusKodeTransaksi1',
    'bonusUserid2', 'bonusScatter1_2', 'bonusScatter2_2', 'bonusScatter3_2', 'bonusRekening2', 'bonusKodeTransaksi2'
  ];
  inputs.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = '';
  });
  showToast("🧹 Semua data dihapus.");
}

// =============== UTILITAS ===============
function copyToClipboard(text, label = "Teks") {
    // Gunakan label default jika tidak diberikan
    const feedbackLabel = label || "Teks";

    // Pastikan `text` adalah string
    if (typeof text !== 'string') {
        showToast(`❌ Tidak dapat menyalin: Bukan teks (${typeof text})`);
        return;
    }

    // Cek apakah API Clipboard didukung dan lingkungan aman (HTTPS)
    if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(text)
            .then(() => {
                // Berhasil menggunakan Clipboard API
                showToast(`✅ ${feedbackLabel} disalin!`);
            })
            .catch((err) => {
                console.error("Gagal menyalin via Clipboard API:", err);
                // Jika gagal, coba fallback
                fallbackCopy(text, feedbackLabel);
            });
    } else {
        // Lingkungan tidak mendukung Clipboard API, gunakan fallback
        console.warn("Clipboard API tidak tersedia, menggunakan fallback.");
        fallbackCopy(text, feedbackLabel);
    }
}

function fallbackCopy(text, label) {
    // Validasi input
    if (typeof text !== 'string') {
        showToast(`❌ Gagal menyalin: Input bukan teks.`);
        return;
    }
    const feedbackLabel = label || "Teks";

    // Buat elemen textarea sementara
    const textarea = document.createElement('textarea');
    textarea.value = text;

    // Sembunyikan elemen secara visual dan aksesibilitas
    textarea.style.position = 'fixed';
    textarea.style.left = '-9999px';
    textarea.style.top = '-9999px';
    textarea.style.width = '1px';
    textarea.style.height = '1px';
    textarea.style.opacity = '0';
    textarea.style.pointerEvents = 'none';

    document.body.appendChild(textarea);

    // Pilih dan salin teks
    textarea.focus();
    textarea.select();
    // Untuk kompatibilitas mobile dan beberapa browser lama
    textarea.setSelectionRange(0, 99999);

    let success = false;
    try {
        // Jalankan perintah copy
        success = document.execCommand('copy');
        if (success) {
            showToast(`📋 ${feedbackLabel} disalin (fallback)!`);
        } else {
            // execCommand kembali 'false'
            showToast(`❌ Gagal menyalin ${feedbackLabel} (fallback gagal).`);
        }
    } catch (err) {
        // execCommand melempar error
        console.error("Fallback execCommand gagal:", err);
        showToast(`❌ Gagal menyalin ${feedbackLabel} (fallback error).`);
    }

    // Pastikan elemen sementara dihapus
    if (textarea.parentNode) {
        textarea.parentNode.removeChild(textarea);
    }

    // Logika fallback mungkin bisa ditambahkan di sini jika diperlukan
    // misalnya, meminta pengguna untuk memilih teks dan menggunakan Ctrl+C
}

function clearDeposit() {
    document.getElementById('dataDeposit').value = '';
    document.getElementById('dataDeposit').focus();
}

function clearWithdraw() {
    document.getElementById('dataWithdraw').value = '';
    document.getElementById('dataWithdraw').focus();
}

function prosesDepositWithdraw() {
    const rawDeposit = document.getElementById('dataDeposit').value;
    const rawWithdraw = document.getElementById('dataWithdraw').value;

    if (!rawDeposit.trim() || !rawWithdraw.trim()) {
        document.getElementById('hasilDepoWd').innerHTML = '<p style="color:#ff6b6b; font-weight:bold; text-align:center;">⚠️ Harap isi kedua kolom DEPOSIT dan WITHDRAW!</p>';
        return;
    }

function parseLine(line, isWithdraw = false) {
    line = line.trim();
    if (!line) return null;

    // Coba split by tab (harus dipastikan data di-paste dengan tab)
    const parts = line.split('\t').map(p => p.trim()).filter(p => p);

    if (parts.length >= 2) {
        if (isWithdraw) {
            // Format Withdraw: [KETERANGAN] [NOMINAL] [SUMBER_DEPO]
            const keterangan = parts[0];
            const nominalRaw = parts[1];
            // Ambil nama dari bagian ketiga (SUMBER_DEPO), jika ada
            const sourceDesc = parts.length >= 3 ? parts[2] : keterangan; // fallback ke keterangan jika tidak ada kolom ke-3
            const nama = extractNameFromText(sourceDesc);
            const nominalClean = parseInt(String(nominalRaw).replace(/[^0-9]/g, '')) || 0;
            return { nama, nominalRaw, nominalClean, asli: line, note: keterangan };
        } else {
            // Format Deposit: [DESKRIPSI] [NOMINAL]
            const desc = parts[0];
            const nominalRaw = parts[1];
            const nama = extractNameFromText(desc);
            const nominalClean = parseInt(String(nominalRaw).replace(/[^0-9]/g, '')) || 0;
            return { nama, nominalRaw, nominalClean, asli: line, note: '' };
        }
    }

    // Jika tidak pakai tab, coba regex (opsional, tapi kurang akurat untuk kasus ini)
    // Karena format Withdraw Anda kompleks, lebih aman pakai TAB
    if (isWithdraw) {
        // Contoh: "KET 16,300,000 Depo BCA / NAMA"
        const match = line.match(/^(.+?)\s+([0-9,.]+)\s+(.+)$/);
        if (match) {
            const keterangan = match[1].trim();
            const nominalRaw = match[2].trim();
            const sourceDesc = match[3].trim();
            const nama = extractNameFromText(sourceDesc);
            const nominalClean = parseInt(String(nominalRaw).replace(/[^0-9]/g, '')) || 0;
            return { nama, nominalRaw, nominalClean, asli: line, note: keterangan };
        }
    } else {
        const match = line.match(/(.+?)\s+([0-9,.]+)$/);
        if (match) {
            const desc = match[1].trim();
            const nominalRaw = match[2].trim();
            const nama = extractNameFromText(desc);
            const nominalClean = parseInt(String(nominalRaw).replace(/[^0-9]/g, '')) || 0;
            return { nama, nominalRaw, nominalClean, asli: line, note: '' };
        }
    }

    return null;
}

function extractNameFromText(text) {
    let cleaned = text.trim();
    const depoIndex = cleaned.indexOf('DEPO ');
    if (depoIndex !== -1) {
        cleaned = cleaned.substring(depoIndex + 5).trim();
    }
    const lastSlash = cleaned.lastIndexOf('/');
    if (lastSlash !== -1) {
        return cleaned.substring(lastSlash + 1).trim();
    }
    return cleaned;
}

    const depositList = rawDeposit
        .split('\n')
        .map(line => parseLine(line, false))
        .filter(item => item);

    const withdrawList = rawWithdraw
        .split('\n')
        .map(line => parseLine(line, true))
        .filter(item => item);

    if (depositList.length === 0 || withdrawList.length === 0) {
        // ... error format ...
        return;
    }

    // --- Agregasi ---
    const depositTotal = {};
    const withdrawTotal = {};
    const depositDetails = {};
    const withdrawDetails = {};

    depositList.forEach(item => {
        const key = item.nama.toLowerCase().trim();
        depositTotal[key] = (depositTotal[key] || 0) + item.nominalClean;
        if (!depositDetails[key]) depositDetails[key] = [];
        depositDetails[key].push({ raw: item.nominalRaw, clean: item.nominalClean, asli: item.asli });
    });

    withdrawList.forEach(item => {
        const key = item.nama.toLowerCase().trim();
        withdrawTotal[key] = (withdrawTotal[key] || 0) + item.nominalClean;
        if (!withdrawDetails[key]) withdrawDetails[key] = [];
        withdrawDetails[key].push({
            raw: item.nominalRaw,
            clean: item.nominalClean,
            asli: item.asli,
            note: item.note || ''
        });
    });

    // --- Hasil per nama ---
    const allNames = new Set([...Object.keys(depositTotal), ...Object.keys(withdrawTotal)]);
    const results = [];
    let totalCocok = 0;

    allNames.forEach(key => {
        const namaAsli = depositDetails[key] 
            ? depositList.find(d => d.nama.toLowerCase().trim() === key)?.nama
            : withdrawList.find(w => w.nama.toLowerCase().trim() === key)?.nama
            || key;

        const depo = depositTotal[key] || 0;
        const wd = withdrawTotal[key] || 0;
        const diff = depo - wd;

        let status, bgColor, borderColor;
        if (depo > 0 && wd > 0) {
            if (diff === 0) {
                status = '✅ COCOK';
                bgColor = '#2e7d32';
                borderColor = '#1b5e20';
                totalCocok++;
            } else {
                status = '⚠️ BEDA TOTAL';
                bgColor = '#ff8f00';
                borderColor = '#ff6f00';
            }
        } else {
            status = '❌ TIDAK LENGKAP';
            bgColor = '#b71c1c';
            borderColor = '#7f0000';
        }

        const depoFmt = depo > 0 ? new Intl.NumberFormat('id-ID').format(depo) : '–';
        const wdFmt = wd > 0 ? new Intl.NumberFormat('id-ID').format(wd) : '–';
        const selisih = diff === 0 ? '0' : (diff > 0 ? `+${new Intl.NumberFormat('id-ID').format(diff)}` : new Intl.NumberFormat('id-ID').format(diff));

        results.push({
            nama: namaAsli,
            depoFmt,
            wdFmt,
            selisih,
            status,
            bgColor,
            borderColor,
            diff,
            depositEntries: depositDetails[key] || [],
            withdrawEntries: withdrawDetails[key] || []
        });
    });

    // --- Bangun HTML dengan desain kartu ---
let html = `<div class="analysis-grid">`;

    results.forEach(row => {
        const isCocok = row.diff === 0 && row.depositEntries.length > 0 && row.withdrawEntries.length > 0;
        const color = isCocok ? '#2e7d32' : (row.diff > 0 ? '#ff8f00' : '#b71c1c');
        const diffColor = row.diff === 0 ? 'var(--neon-green)' : (row.diff > 0 ? 'var(--neon-yellow)' : 'var(--neon-red)');
        
        html += `
        <div class="user-card">
          <div class="user-header" style="background: ${color};">
             ${row.nama}
          </div>
          
          <div class="user-body">
            <div class="col">
              <div class="col-title">📥 DEPOSIT (${row.depositEntries.length} entri)</div>
              <ul class="entry-list">
                ${row.depositEntries.length > 0 
                  ? row.depositEntries.map(e => `<li class="entry-item">${e.raw}</li>`).join('')
                  : '<li class="entry-item" style="color:#555;">(Kosong)</li>'
                }
              </ul>
              <div class="total-row">Total: <span style="color:var(--neon-blue);">${row.depoFmt}</span></div>
            </div>

            <div class="col">
              <div class="col-title">📤 WITHDRAW (${row.withdrawEntries.length} entri)</div>
              <ul class="entry-list">
                ${row.withdrawEntries.length > 0 
                  ? row.withdrawEntries.map(e => `
                      <li class="entry-item">
                        ${e.raw}
                        ${e.note ? `<br><span style="color:#4caf50;font-size:10px;">💬 ${e.note}</span>` : ''}
                      </li>`).join('')
                  : '<li class="entry-item" style="color:#555;">(Kosong)</li>'
                }
              </ul>
              <div class="total-row">Total: <span style="color:#ab47bc;">${row.wdFmt}</span></div>
            </div>
          </div>

          <div class="card-footer">
            <div class="footer-top">
               <div style="font-size:13px; color:#aaa;">SELISIH: 
                  <span style="color:${diffColor}; font-weight:bold; font-family:monospace; font-size:18px;">
                    ${row.selisih}
                  </span>
               </div>
               <div class="status-badge" style="background: ${color};">
                  ${row.status}
               </div>
            </div>
          </div>
        </div>`;
    });

    html += `</div>`;
    document.getElementById('hasilDepoWd').innerHTML = html;
}

document.querySelectorAll('.sub-mode-btn').forEach(button => {
    button.addEventListener('click', function() {
        const mode = this.getAttribute('data-mode');
        
        // Hapus class 'active' dari semua tombol
        document.querySelectorAll('.sub-mode-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        // Tambahkan class 'active' ke tombol yang diklik
        this.classList.add('active');
        
        // Sembunyikan semua sub-mode
        document.querySelectorAll('.sub-mode-content').forEach(el => {
            el.style.display = 'none';
        });
        // Tampilkan sub-mode yang dipilih
        document.getElementById('sub-' + mode).style.display = 'block';
    });
});

function clearField(id) {
    document.getElementById(id).value = '';
}

// ====================================================================
// === TANYA Z: AI SERBA BISA (TEKS + GAMBAR + UPLOAD + PERINTAH) ===
// ====================================================================
let conversationHistory = [];
const MAX_HISTORY = 20; // Lebih panjang untuk konteks mendalam

// === UTILITAS ===
function sanitizeHTML(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

// === ZOOM GAMBAR STABIL (BISA DITUTUP VIA KLIK OVERLAY) ===
function showZoomModal(imgSrc) {
  const modal = document.createElement('div');
  modal.style.cssText = `
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(0, 0, 0, 0.92);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    cursor: pointer;
    animation: fadeIn 0.3s ease;
  `;

  const img = document.createElement('img');
  img.src = imgSrc;
  img.alt = "Zoomed";
  img.style.cssText = `
    max-width: 90vw;
    max-height: 85vh;
    border-radius: 12px;
    box-shadow: 0 0 20px #66ccff;
    cursor: default;
  `;

  modal.appendChild(img);
  document.body.appendChild(modal);

  // 🔥 TUTUP SAAT KLIK DI MANA SAJA (TERMASUK GAMBAR)
  modal.onclick = () => {
    document.body.removeChild(modal);
  };

  // ESC juga menutup
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
      if (modal.parentNode) document.body.removeChild(modal);
    }
  }, { once: true });
}

// === TAMPILKAN PESAN ===
function displayMessage(sender, text, isImage = false, imageSrcs = []) {
  const chatHistory = document.getElementById('chatHistory');
  if (!chatHistory) return;

  const messageDiv = document.createElement('div');
  messageDiv.className = `message ${sender}-message`;
  messageDiv.style.cssText = `
    margin: 12px 0;
    display: flex;
    justify-content: ${sender === 'user' ? 'flex-end' : 'flex-start'};
  `;

  const bubbleDiv = document.createElement('div');
  bubbleDiv.className = 'message-bubble';
  bubbleDiv.style.cssText = `
    padding: 14px 18px;
    border-radius: 16px;
    max-width: 85%;
    word-wrap: break-word;
    font-size: 1.1em;
    line-height: 1.5;
    box-shadow: 0 4px 10px rgba(102, 204, 255, 0.3);
    backdrop-filter: blur(4px);
    position: relative;
  `;

  if (sender === 'user') {
    bubbleDiv.style.backgroundColor = 'rgba(60, 180, 255, 0.15)';
    bubbleDiv.style.border = '1px solid #66ccff';
    bubbleDiv.style.color = '#e0f0ff';
  } else {
    bubbleDiv.style.backgroundColor = 'rgba(40, 40, 60, 0.8)';
    bubbleDiv.style.border = '1px solid #66ccff';
    bubbleDiv.style.color = '#e0f0ff';
  }

  if (isImage && Array.isArray(imageSrcs) && imageSrcs.length > 0) {
    imageSrcs.forEach(src => {
      const img = document.createElement('img');
      img.src = src;
      img.alt = "Gambar";
      img.style.cssText = `
        max-width: 100%;
        max-height: 300px;
        border-radius: 10px;
        border: 1px solid #66ccff;
        margin: 6px 0;
        box-shadow: 0 0 6px rgba(102, 204, 255, 0.3);
        cursor: zoom-in;
      `;
      img.addEventListener('click', () => showZoomModal(src));
      bubbleDiv.appendChild(img);
    });
  } else {
    let formatted = sanitizeHTML(text)
      .replace(/\*\*(.*?)\*\*/g, '<b style="color:#66ccff">$1</b>')
      .replace(/\*(.*?)\*/g, '<i>$1</i>')
      .replace(/```([\s\S]*?)```/g, '<div class="code-container" style="background:rgba(20,40,60,0.6);padding:12px;border-radius:8px;margin:8px 0;overflow-x:auto;font-family:monospace;color:#a0d0ff;border-left:3px solid #66ccff;">$1</div>')
      .replace(/\n/g, '<br>');

    bubbleDiv.innerHTML = formatted;

    // 🔁 IKON REGENERATE KECIL
    if (sender === 'ai') {
      const regenBtn = document.createElement('span');
      regenBtn.innerHTML = '$';
      regenBtn.title = 'Regenerate respons';
      regenBtn.style.cssText = `
        position: absolute;
        bottom: 4px;
        right: 4px;
        font-size: 1.3em;
        color: #88ddff;
        cursor: pointer;
        opacity: 0.7;
        transition: all 0.25s ease;
        text-shadow: 0 0 4px rgba(136, 221, 255, 0.6);
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10;
      `;
      regenBtn.addEventListener('mouseenter', () => {
        regenBtn.style.opacity = '1';
        regenBtn.style.textShadow = '0 0 8px rgba(136, 221, 255, 0.9)';
        regenBtn.style.transform = 'scale(1.2)';
      });
      regenBtn.addEventListener('mouseleave', () => {
        regenBtn.style.opacity = '0.7';
        regenBtn.style.textShadow = '0 0 4px rgba(136, 221, 255, 0.6)';
        regenBtn.style.transform = 'scale(1)';
      });
      regenBtn.onclick = (e) => {
        e.stopPropagation();
        regenerateLastResponse();
      };
      bubbleDiv.appendChild(regenBtn);
    }
  }

  messageDiv.appendChild(bubbleDiv);
  chatHistory.appendChild(messageDiv);
  chatHistory.scrollTop = chatHistory.scrollHeight;
}

// === KIRIM PESAN ===
async function sendMessage() {
  const inputDiv = document.getElementById('chatInput');
  if (!inputDiv) return;

  const userText = inputDiv.innerText.trim();
  const imageElements = inputDiv.querySelectorAll('img');
  const savedImages = [];

  imageElements.forEach(img => {
    if (img.src.startsWith('data:image')) {
      savedImages.push(img.src);
    }
  });

  if (!userText && savedImages.length === 0) {
    inputDiv.innerHTML = '';
    return;
  }

  inputDiv.innerHTML = '';
  disableInputs();

  if (savedImages.length > 0) {
    displayMessage('user', '', true, savedImages);
  } else {
    displayMessage('user', userText);
  }

  const imageParts = savedImages.map(src => ({
    inline_data: { mime_type: "image/png", data: src.split(',')[1] }
  }));

  showTypingIndicator();

  // Perintah khusus: /gambar:
  if (userText.toLowerCase().startsWith('/gambar:')) {
    const prompt = userText.substring(8).trim();
    if (!prompt) {
      hideTypingIndicator(); enableInputs();
      displayMessage('ai', '❌ Prompt tidak boleh kosong setelah `/gambar:`');
      return;
    }

    google.script.run
      .withSuccessHandler(res => {
        hideTypingIndicator(); enableInputs();
        if (res && typeof res === 'string' && res.startsWith('data:image')) {
          displayMessage('ai', '', true, [res]);
        } else {
          displayMessage('ai', res || '⚠️ Gagal menghasilkan gambar.');
        }
      })
      .withFailureHandler(err => {
        hideTypingIndicator(); enableInputs();
        displayMessage('ai', `❌ Error gambar: ${err.message || err}`);
      })
      .generateImageWithGemini(prompt);
    return;
  }

  // Kirim ke AI biasa — ini yang memberi akses ke SEMUA KEMAMPUAN Z
  const userMessage = {
    role: "user",
    parts: [{ text: userText || "Analisis gambar ini" }, ...imageParts]
  };

  conversationHistory.push(userMessage);
  if (conversationHistory.length > MAX_HISTORY) conversationHistory.shift();

  google.script.run
    .withSuccessHandler(res => {
      hideTypingIndicator(); enableInputs();
      if (typeof res === 'string') {
        conversationHistory.push({ role: "model", parts: [{ text: res }] });
        displayMessage('ai', res);
      } else {
        displayMessage('ai', '⚠️ Respons tidak valid dari AI.');
      }
    })
    .withFailureHandler(err => {
      hideTypingIndicator(); enableInputs();
      displayMessage('ai', `❌ Error: ${err.message || JSON.stringify(err)}`);
    })
    .callGeminiAdvanced([...conversationHistory]); // <-- INI AKSES KE SEMUA FITUR Z
}

// === REGENERATE ===
function regenerateLastResponse() {
  if (conversationHistory.length < 2) {
    displayMessage('ai', '⚠️ Tidak ada riwayat untuk diregenerasi.');
    return;
  }

  if (conversationHistory[conversationHistory.length - 1].role === 'model') {
    conversationHistory.pop();
  }

  disableInputs();
  showTypingIndicator();

  google.script.run
    .withSuccessHandler(res => {
      hideTypingIndicator(); enableInputs();
      if (typeof res === 'string') {
        conversationHistory.push({ role: 'model', parts: [{ text: res }] });

        const chatHistory = document.getElementById('chatHistory');
        const msgs = chatHistory.querySelectorAll('.message');
        if (msgs.length > 0) {
          const last = msgs[msgs.length - 1];
          if (last.classList.contains('ai-message')) last.remove();
        }

        displayMessage('ai', res);
      } else {
        displayMessage('ai', '⚠️ Respons tidak valid.');
      }
    })
    .withFailureHandler(err => {
      hideTypingIndicator(); enableInputs();
      displayMessage('ai', `❌ Gagal regenerate: ${err.message || err}`);
    })
    .callGeminiAdvanced([...conversationHistory]);
}

// === PASTE GAMBAR ===
document.getElementById('chatInput')?.addEventListener('paste', e => {
  const items = (e.clipboardData || e.originalEvent.clipboardData)?.items;
  if (!items) return;

  for (const item of items) {
    if (item.type.startsWith('image/')) {
      e.preventDefault();
      const file = item.getAsFile();
      if (file) {
        const reader = new FileReader();
        reader.onload = ev => {
          const img = document.createElement('img');
          img.src = ev.target.result;
          img.style.cssText = `
            max-width: 140px;
            max-height: 140px;
            margin: 4px;
            border-radius: 8px;
            border: 1px solid #66ccff;
            box-shadow: 0 0 6px rgba(102, 204, 255, 0.3);
            vertical-align: middle;
            cursor: zoom-in;
          `;
          img.addEventListener('click', () => showZoomModal(img.src));
          document.getElementById('chatInput').appendChild(img);
        };
        reader.readAsDataURL(file);
      }
    }
  }
});

// === KEYBOARD ===
document.getElementById('chatInput')?.addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});
document.getElementById('sendButton')?.addEventListener('click', sendMessage);

// === UI HELPER ===
function showTypingIndicator() {
  const chatHistory = document.getElementById('chatHistory');
  const loader = document.createElement('div');
  loader.id = 'z-loader';
  loader.className = 'message ai-message';
  loader.style.cssText = `display: flex; justify-content: flex-start; margin: 10px 0;`;
  loader.innerHTML = `<div class="message-bubble" style="
    background: rgba(40, 40, 60, 0.7);
    border: 1px solid #66ccff;
    color: #c0e0ff;
    padding: 12px 16px;
    border-radius: 16px;
    font-style: italic;
  ">Z sedang berpikir... 🤖</div>`;
  chatHistory?.appendChild(loader);
  chatHistory?.scrollTo({ top: chatHistory.scrollHeight, behavior: 'smooth' });
}

function hideTypingIndicator() {
  const el = document.getElementById('z-loader');
  if (el) el.remove();
}

function disableInputs() {
  const btn = document.getElementById('sendButton');
  const inp = document.getElementById('chatInput');
  if (btn) btn.disabled = true;
  if (inp) inp.contentEditable = false;
}

function enableInputs() {
  const btn = document.getElementById('sendButton');
  const inp = document.getElementById('chatInput');
  if (btn) btn.disabled = false;
  if (inp) {
    inp.contentEditable = true;
    inp.focus();
  }
}

// === ANIMASI TAMBAHAN ===
(function injectStyles() {
  const style = document.createElement('style');
  style.textContent = `
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .message-bubble::after {
      content: '';
      position: absolute;
      top: -2px; left: -2px; right: -2px; bottom: -2px;
      border-radius: 18px;
      background: linear-gradient(45deg, #66ccff, #4499ff, #66ccff);
      z-index: -1;
      opacity: 0.2;
      filter: blur(6px);
      animation: pulseGlow 4s infinite alternate;
    }
    @keyframes pulseGlow {
      0% { opacity: 0.1; }
      100% { opacity: 0.3; }
    }
  `;
  document.head.appendChild(style);
})();

document.querySelectorAll('#pengaturanTab h4').forEach(h => {
  h.addEventListener('click', () => {
    h.classList.toggle('active');
    const panel = h.nextElementSibling;
    if (panel && panel.classList.contains('panel')) {
      panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
    }
  });
});
// === CYBER BACKGROUND DENGAN PARTIKEL & GRID ===
(function initCyberBg() {
  const canvas = document.getElementById('cyberBg');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  window.addEventListener('resize', () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  });

  // Partikel
  const particles = [];
  for (let i = 0; i < 50; i++) {
    particles.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      size: Math.random() * 2 + 0.5,
      speedX: (Math.random() - 0.5) * 0.3,
      speedY: (Math.random() - 0.5) * 0.3
    });
  }

  function animate() {
    ctx.fillStyle = 'rgba(0, 10, 30, 0.1)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Gambar partikel
    particles.forEach(p => {
      p.x += p.speedX;
      p.y += p.speedY;
      if (p.x < 0 || p.x > canvas.width) p.speedX *= -1;
      if (p.y < 0 || p.y > canvas.height) p.speedY *= -1;

      ctx.fillStyle = '#00f3ff';
      ctx.globalAlpha = 0.7;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      ctx.fill();
    });

    // Grid tipis
    ctx.strokeStyle = 'rgba(0, 243, 255, 0.05)';
    ctx.lineWidth = 1;
    for (let x = 0; x < canvas.width; x += 40) {
      ctx.beginPath();
      ctx.moveTo(x, 0);
      ctx.lineTo(x, canvas.height);
      ctx.stroke();
    }
    for (let y = 0; y < canvas.height; y += 40) {
      ctx.beginPath();
      ctx.moveTo(0, y);
      ctx.lineTo(canvas.width, y);
      ctx.stroke();
    }

    requestAnimationFrame(animate);
  }
  animate();
})();
// === STAF ONBOARDING ===
(function initStafOnboarding() {
  // Cek apakah sudah pernah isi nama di sesi ini
  if (sessionStorage.getItem('stafNama') && sessionStorage.getItem('neuroUnlocked')) {
    // Jika sudah login & isi nama → langsung sembunyikan overlay
    document.getElementById('stafOnboardingOverlay')?.remove();
    return;
  }

  // Tampilkan overlay onboarding
  const overlay = document.getElementById('stafOnboardingOverlay');
  const input = document.getElementById('stafNamaInput');
  if (!overlay || !input) return;

  overlay.style.display = 'flex';
  input.focus();

  // Enter → submit
  input.addEventListener('keypress', e => {
    if (e.key === 'Enter') submitStafNama();
  });
})();

function submitStafNama() {
  const input = document.getElementById('stafNamaInput');
  const nama = (input?.value || '').trim();

  if (!nama) {
    input.placeholder = '❌ Nama tidak boleh kosong!';
    setTimeout(() => input.placeholder = 'Contoh: CS LINE / KAPTEN', 1500);
    return;
  }

  // Simpan nama di sessionStorage
  sessionStorage.setItem('stafNama', nama);

  // Sembunyikan onboarding
  const overlay = document.getElementById('stafOnboardingOverlay');
  if (overlay) overlay.style.display = 'none';

  // Tampilkan animasi "SELAMAT BEKERJA"
  tampilkanSelamatBekerja(nama);
}

function tampilkanSelamatBekerja(nama) {
  const modal = document.getElementById('selamatBekerjaModal');
  const namaEl = document.getElementById('stafNamaDisplay');
  const textEl = document.getElementById('selamatText');

  if (modal && namaEl && textEl) {
    namaEl.textContent = nama;
    modal.style.display = 'flex';

    // Setelah 2.5 detik → lanjut ke aplikasi utama
    setTimeout(() => {
      modal.style.display = 'none';
      // Jika belum login → tampilkan lock screen
      if (!sessionStorage.getItem('neuroUnlocked')) {
        // Lock screen sudah ada di file Anda → cukup pastikan konten utama disembunyikan
        document.querySelectorAll('.main-container, #stickyFab, .sidebar-container, #tanyaZTab, #toggleSidebarBtn')
          .forEach(el => el.style.visibility = 'hidden');
      } else {
        // Jika sudah login → tampilkan semua
        document.querySelectorAll('.main-container, #stickyFab, .sidebar-container, #tanyaZTab, #toggleSidebarBtn')
          .forEach(el => el.style.visibility = 'visible');
      }
    }, 2500);
  }
}
</script>
</body>
</html>
