<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üé∞ Catatan Togel - Read Only</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* === CYBERPUNK THEME VARIABLES === */
    :root {
      --bg-dark: #0a0a1a;
      --bg-panel: rgba(20, 20, 40, 0.9);
      --neon-cyan: #00ffff;
      --neon-blue: #00ccff;
      --neon-purple: #9d00ff;
      --neon-pink: #ff00aa;
      --neon-green: #00ff88;
      --neon-red: #ff3366;
      --neon-yellow: #ffcc00;
      --text-main: #e0f0ff;
      --text-dim: #88aacc;
      --border-glow: 0 0 10px rgba(0, 255, 255, 0.5);
      --card-shadow: 0 0 20px rgba(0, 200, 255, 0.3);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-dark);
      color: var(--text-main);
      min-height: 100vh;
      background-image: 
        radial-gradient(circle at 20% 80%, rgba(157, 0, 255, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
        linear-gradient(135deg, #0a0a1a 0%, #1a1a3a 100%);
      background-attachment: fixed;
      overflow-x: hidden;
    }

    /* === HEADER === */
    .app-header {
      background: linear-gradient(90deg, rgba(0,20,40,0.95), rgba(20,20,50,0.95));
      padding: 15px 20px;
      border-bottom: 2px solid var(--neon-cyan);
      box-shadow: var(--border-glow);
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .app-title {
      font-size: 1.4rem;
      font-weight: bold;
      color: var(--neon-cyan);
      text-shadow: 0 0 10px var(--neon-cyan);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #clock {
      font-family: 'Courier New', monospace;
      font-size: 0.95rem;
      color: var(--neon-green);
      text-shadow: 0 0 8px var(--neon-green);
      text-align: right;
    }

    .date-display { display: block; font-size: 0.85em; }
    .time-display { display: block; }

    /* === TAB NAVIGATION === */
    .tab-nav {
      display: flex;
      gap: 5px;
      padding: 10px 20px;
      background: rgba(15, 15, 35, 0.9);
      border-bottom: 1px solid var(--neon-purple);
      overflow-x: auto;
      flex-wrap: wrap;
    }

    .tab-btn {
      padding: 8px 16px;
      background: transparent;
      border: 1px solid var(--neon-cyan);
      color: var(--neon-cyan);
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s;
      white-space: nowrap;
    }

    .tab-btn:hover, .tab-btn.active {
      background: var(--neon-cyan);
      color: #000;
      box-shadow: 0 0 15px var(--neon-cyan);
    }

    /* === CONTENT AREA === */
    .tab-content {
      display: none;
      padding: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .tab-content.active { display: block; }

    /* === CARDS & PANELS === */
    .card {
      background: var(--bg-panel);
      border: 1px solid var(--neon-cyan);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: var(--card-shadow);
      transition: transform 0.2s;
    }

    .card:hover {
      transform: translateY(-2px);
      border-color: var(--neon-blue);
    }

    .card-title {
      color: var(--neon-cyan);
      font-size: 1.1rem;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px dashed var(--neon-purple);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* === NOTES LIST === */
    .notes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 12px;
    }

    .note-card {
      background: rgba(30, 30, 60, 0.8);
      border: 1px solid var(--neon-purple);
      border-radius: 10px;
      padding: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .note-card:hover {
      border-color: var(--neon-cyan);
      box-shadow: 0 0 12px rgba(0, 255, 255, 0.4);
    }

    .note-title {
      color: var(--neon-green);
      font-weight: bold;
      margin-bottom: 6px;
      font-size: 1rem;
    }

    .note-preview {
      color: var(--text-dim);
      font-size: 0.9rem;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .note-date {
      font-size: 0.75rem;
      color: var(--neon-pink);
      margin-top: 8px;
      font-family: monospace;
    }

    .note-detail {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed var(--neon-purple);
    }

    /* === FOTO GALLERY === */
    .foto-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 10px;
    }

    .foto-card {
      position: relative;
      border-radius: 8px;
      overflow: hidden;
      border: 2px solid var(--neon-cyan);
      cursor: pointer;
      transition: transform 0.2s;
    }

    .foto-card:hover {
      transform: scale(1.03);
      box-shadow: 0 0 15px var(--neon-cyan);
    }

    .foto-card img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      display: block;
    }

    .foto-title {
      padding: 6px;
      background: rgba(0,0,0,0.7);
      font-size: 0.8rem;
      text-align: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* === TABLES === */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }

    th {
      background: rgba(0, 100, 150, 0.3);
      color: var(--neon-cyan);
      padding: 10px;
      text-align: left;
      border: 1px solid var(--neon-purple);
    }

    td {
      padding: 10px;
      border: 1px solid rgba(0, 255, 255, 0.2);
      color: var(--text-main);
    }

    tr:hover {
      background: rgba(0, 255, 255, 0.05);
    }

    /* === SEARCH & INPUTS === */
    .search-bar {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .search-bar input, .search-bar select {
      flex: 1;
      min-width: 150px;
      padding: 10px 14px;
      background: rgba(10, 20, 40, 0.9);
      border: 1px solid var(--neon-cyan);
      border-radius: 8px;
      color: var(--text-main);
      font-size: 1rem;
    }

    .search-bar input:focus, .search-bar select:focus {
      outline: none;
      border-color: var(--neon-green);
      box-shadow: 0 0 10px var(--neon-green);
    }

    /* === BUTTONS === */
    .btn {
      padding: 8px 16px;
      background: linear-gradient(135deg, var(--neon-purple), var(--neon-pink));
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 15px var(--neon-purple);
    }

    .copy-button {
      background: var(--neon-cyan);
      color: #000;
      padding: 4px 10px;
      font-size: 0.8rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      margin: 4px 4px 4px 0;
    }

    .copy-button:hover {
      box-shadow: 0 0 10px var(--neon-cyan);
    }

    /* === LIGHTBOX/ZOOM === */
    #lightbox {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.95);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 20px;
    }

    #lightboxImg {
      max-width: 95vw;
      max-height: 85vh;
      border-radius: 12px;
      border: 3px solid var(--neon-cyan);
      box-shadow: 0 0 30px var(--neon-cyan);
      cursor: zoom-in;
      transition: transform 0.2s;
    }

    .lightbox-controls {
      margin-top: 15px;
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    /* === TOAST NOTIFICATION === */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, var(--neon-green), #00cc88);
      color: #000;
      padding: 12px 20px;
      border-radius: 10px;
      font-weight: bold;
      box-shadow: 0 0 20px var(--neon-green);
      z-index: 9999;
      animation: slideIn 0.3s, fadeOut 0.3s 2.7s forwards;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    /* === LOADING SPINNER === */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--neon-cyan);
    }

    .spinner {
      width: 40px; height: 40px;
      border: 3px solid var(--neon-cyan);
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* === DETAILS/SUMMARY === */
    details {
      margin-bottom: 12px;
      background: rgba(20, 20, 40, 0.6);
      border-radius: 8px;
      padding: 8px 12px;
      border: 1px solid var(--neon-purple);
    }

    summary {
      color: var(--neon-cyan);
      cursor: pointer;
      font-weight: bold;
      padding: 8px 0;
    }

    summary:hover {
      color: var(--neon-green);
    }

    /* === DEPO/WD === */
    .depo-wd-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .depo-wd-container pre {
      background: rgba(0, 30, 20, 0.6);
      padding: 12px;
      border-radius: 8px;
      font-size: 0.85rem;
      overflow-x: auto;
      max-height: 400px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    /* === REPORT CARDS === */
    .report-card {
      background: rgba(30, 30, 60, 0.8);
      border: 1px solid var(--neon-purple);
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 10px;
    }

    .card-accordion-title {
      color: var(--neon-green);
      font-weight: bold;
      cursor: pointer;
      padding: 8px 0;
      border-bottom: 1px dashed var(--neon-purple);
      margin-bottom: 8px;
    }

    .card-content-panel {
      display: none;
      padding-top: 8px;
    }

    .report-field-group {
      margin: 10px 0;
    }

    .report-field-group label {
      color: var(--neon-cyan);
      font-size: 0.85rem;
      display: block;
      margin-bottom: 4px;
    }

    .report-display-value {
      background: rgba(0, 40, 60, 0.4);
      padding: 8px;
      border-radius: 6px;
      margin-bottom: 8px;
      word-wrap: break-word;
    }

    .neon-divider {
      border: none;
      border-top: 1px dashed var(--neon-purple);
      margin: 12px 0;
    }

    /* === KENDALA === */
    .kendala-card {
      background: rgba(30, 30, 60, 0.8);
      border: 1px solid var(--neon-purple);
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 10px;
    }

    .kendala-judul {
      color: var(--neon-cyan);
      font-weight: bold;
      margin-bottom: 8px;
    }

    .kendala-jawaban {
      margin: 6px 0;
      padding-left: 12px;
      border-left: 2px solid var(--neon-purple);
      color: var(--text-dim);
    }

    /* === RESPONSIVE === */
    @media (max-width: 768px) {
      .app-title { font-size: 1.1rem; }
      #clock { font-size: 0.85rem; text-align: left; }
      .tab-btn { padding: 6px 12px; font-size: 0.85rem; }
      .card { padding: 12px; }
      .depo-wd-container { grid-template-columns: 1fr; }
      .notes-grid { grid-template-columns: 1fr; }
      .foto-gallery { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); }
    }

    /* === SCROLLBAR === */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.3);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--neon-cyan);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--neon-green);
    }
  </style>
</head>
<body>

  <!-- === HEADER === -->
  <header class="app-header">
    <div class="app-title">
      <i class="fas fa-dice"></i>
      <span>üé∞ CATATAN TOGEL</span>
      <span style="font-size:0.8em; color:var(--neon-pink);">(Read Only)</span>
    </div>
    <div id="clock">‚è≥ Loading...</div>
  </header>

  <!-- === TAB NAVIGATION === -->
  <nav class="tab-nav">
    <button class="tab-btn active" data-tab="catatan">üìù Catatan</button>
    <button class="tab-btn" data-tab="foto">üì∑ Foto</button>
    <button class="tab-btn" data-tab="pasaran">üé∞ Pasaran</button>
    <button class="tab-btn" data-tab="hitungan">üî¢ Hitungan</button>
    <button class="tab-btn" data-tab="pengaturan">‚öôÔ∏è Pengaturan</button>
    <button class="tab-btn" data-tab="kendala">üö® Kendala</button>
    <button class="tab-btn" data-tab="report">üìã Report</button>
    <button class="tab-btn" data-tab="depo">üí∞ Depo/WD</button>
  </nav>

  <!-- === TAB: CATATAN === -->
  <section id="catatan" class="tab-content active">
    <div class="card">
      <div class="card-title"><i class="fas fa-folder"></i> Pilih Folder</div>
      <div class="search-bar">
        <select id="folderSelect">
          <option value="DEPOSIT">üí∞ DEPOSIT</option>
          <option value="WITHDRAW">üí∏ WITHDRAW</option>
          <option value="KENDALA_ALL">üö® KENDALA ALL</option>
          <option value="CARA_BERMAIN">üéÆ CARA BERMAIN</option>
        </select>
        <input type="text" id="searchNotes" placeholder="üîç Cari catatan...">
      </div>
    </div>
    <div id="notesList" class="notes-grid">
      <div class="loading">
        <div class="spinner"></div>
        <p>Memuat data...</p>
      </div>
    </div>
  </section>

  <!-- === TAB: FOTO === -->
  <section id="foto" class="tab-content">
    <div class="card">
      <div class="card-title"><i class="fas fa-images"></i> Galeri Foto</div>
      <div class="search-bar">
        <input type="text" id="searchFoto" placeholder="üîç Cari foto...">
      </div>
    </div>
    <div id="fotoList" class="foto-gallery">
      <div class="loading">
        <div class="spinner"></div>
        <p>Memuat foto...</p>
      </div>
    </div>
  </section>

  <!-- === TAB: PASARAN === -->
  <section id="pasaran" class="tab-content">
    <div class="card">
      <div class="card-title"><i class="fas fa-list"></i> Daftar Pasaran Togel</div>
      <div class="search-bar">
        <input type="text" id="searchPasaran" placeholder="üîç Cari pasaran...">
        <span id="tanggalPasaran" style="color:var(--neon-green); font-weight:bold;"></span>
      </div>
      <div style="overflow-x:auto;">
        <table>
          <thead>
            <tr><th>Prediksi</th><th>Jadwal</th></tr>
          </thead>
          <tbody id="pasaranBody">
            <tr><td colspan="2" class="loading">Memuat...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- === TAB: HITUNGAN === -->
  <section id="hitungan" class="tab-content">
    <div class="card">
      <div class="card-title"><i class="fas fa-calculator"></i> Hitungan Hadiah</div>
      <div class="search-bar">
        <select id="kelompokDropdown">
          <option value="">-- Pilih Tipe Hitungan --</option>
        </select>
        <select id="labelDropdown">
          <option value="">-- Pilih Label --</option>
        </select>
      </div>
      <div id="detailHitungan" style="min-height:60px; padding:10px; background:rgba(0,30,60,0.5); border-radius:8px;">
        <p style="color:var(--text-dim);">Pilih kelompok dan label untuk melihat hasil hitungan.</p>
      </div>
    </div>
  </section>

  <!-- === TAB: PENGATURAN === -->
  <section id="pengaturan" class="tab-content">
    <div class="card">
      <div class="card-title"><i class="fas fa-cog"></i> Pengaturan (View Only)</div>
      <div id="pengaturanContent">
        <div class="loading">
          <div class="spinner"></div>
          <p>Memuat pengaturan...</p>
        </div>
      </div>
    </div>
  </section>

  <!-- === TAB: KENDALA === -->
  <section id="kendala" class="tab-content">
    <div class="card">
      <div class="card-title"><i class="fas fa-exclamation-triangle"></i> Kendala & Solusi</div>
      <div id="kendalaList">
        <div class="loading">
          <div class="spinner"></div>
          <p>Memuat data kendala...</p>
        </div>
      </div>
    </div>
  </section>

  <!-- === TAB: REPORT === -->
  <section id="report" class="tab-content">
    <div class="card">
      <div class="card-title"><i class="fas fa-clipboard-list"></i> Report Line</div>
      <div class="search-bar">
        <input type="text" id="searchReport" placeholder="üîç Cari report...">
      </div>
      <div id="reportList">
        <div class="loading">
          <div class="spinner"></div>
          <p>Memuat report...</p>
        </div>
      </div>
    </div>
  </section>

  <!-- === TAB: DEPO/WD === -->
  <section id="depo" class="tab-content">
    <div class="card">
      <div class="card-title"><i class="fas fa-exchange-alt"></i> Data Deposit & Withdraw</div>
      <div class="depo-wd-container">
        <div>
          <h4 style="color:var(--neon-green); margin-bottom:8px;">üì• Deposit</h4>
          <pre id="depositData">Memuat...</pre>
        </div>
        <div>
          <h4 style="color:var(--neon-pink); margin-bottom:8px;">üì§ Withdraw</h4>
          <pre id="withdrawData">Memuat...</pre>
        </div>
      </div>
    </div>
  </section>

  <!-- === LIGHTBOX === -->
  <div id="lightbox">
    <img id="lightboxImg" src="" alt="Zoom">
    <div class="lightbox-controls">
      <button class="btn" onclick="closeLightbox()">‚ùå Tutup</button>
      <button class="btn copy-button" onclick="copyLightboxImage()">üìã Copy Foto</button>
      <span style="color:var(--text-dim); font-size:0.9rem;">üí° Klik gambar untuk zoom, Esc untuk tutup</span>
    </div>
  </div>

  <!-- === JAVASCRIPT === -->
  <script>
    // ============================================
    // ‚ö†Ô∏è GANTI URL INI DENGAN WEB APP ANDA
    // ============================================
    const API_URL = 'https://script.google.com/macros/s/YOUR_WEB_APP_ID/exec';
    // ============================================

    // === GLOBAL STATE ===
    let appData = null;
    let lightboxImages = [];
    let lightboxIndex = 0;
    let zoomLevel = 1;
    let offsetX = 0, offsetY = 0;
    let isDragging = false;
    let startX = 0, startY = 0;
    let currentFolder = 'DEPOSIT';
    let kelompokData = {};

    // ============================================
    // === UTILITIES ===
    // ============================================

    function showToast(msg) {
      const existing = document.getElementById('toastNotif');
      if (existing) existing.remove();
      
      const toast = document.createElement('div');
      toast.id = 'toastNotif';
      toast.className = 'toast';
      toast.textContent = msg;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    function copyToClipboard(text, label = 'Teks') {
      if (!text) {
        showToast('‚ùå Tidak ada data untuk disalin');
        return;
      }
      navigator.clipboard.writeText(text).then(() => {
        showToast(`‚úÖ ${label} disalin!`);
      }).catch(() => {
        // Fallback
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.left = '-9999px';
        document.body.appendChild(textarea);
        textarea.select();
        try {
          document.execCommand('copy');
          showToast(`‚úÖ ${label} disalin (fallback)!`);
        } catch {
          showToast('‚ùå Gagal menyalin');
        }
        document.body.removeChild(textarea);
      });
    }

    // ============================================
    // === CLOCK ===
    // ============================================

    function updateClock() {
      const el = document.getElementById('clock');
      if (!el) return;
      const now = new Date();
      const dateStr = now.toLocaleDateString('id-ID', {
        weekday: 'long',
        day: '2-digit',
        month: 'long',
        year: 'numeric'
      });
      const timeStr = now.toLocaleTimeString('id-ID', {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
      });
      el.innerHTML = `<span class="date-display">${dateStr}</span><span class="time-display">${timeStr}</span>`;
    }

    updateClock();
    setInterval(updateClock, 1000);

    // ============================================
    // === API FETCH (SINGLE CALL) ===
    // ============================================

    async function loadAllData() {
      try {
        const res = await fetch(API_URL, {
          method: 'GET',
          redirect: 'follow'
        });
        
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}: ${res.statusText}`);
        }
        
        const result = await res.json();
        
        if (result.status !== 'success') {
          throw new Error(result.message || 'Unknown error');
        }
        
        appData = result.data;
        renderAllTabs();
        
      } catch (err) {
        console.error('Load error:', err);
        showToast('‚ùå Gagal memuat data: ' + err.message);
        document.querySelectorAll('.loading').forEach(el => {
          el.innerHTML = `<p style="color:var(--neon-red)">‚ùå ${err.message}</p>`;
        });
      }
    }

    // ============================================
    // === RENDER ALL TABS ===
    // ============================================

    function renderAllTabs() {
      if (!appData) return;

      // Notes
      renderNotesList(appData.notes?.['DEPOSIT'] || [], 'DEPOSIT');

      // Foto
      renderFotoGallery(appData.notes?.['FOTO'] || []);

      // Pasaran
      if (appData.pasaran) {
        document.getElementById('tanggalPasaran').textContent = `üìÖ ${appData.pasaran.tanggal || ''}`;
        renderPasaranTable(appData.pasaran.list || []);
      }

      // Hitungan
      if (appData.hitungan?.kelompok) {
        kelompokData = appData.hitungan.kelompok;
        const dropdown = document.getElementById('kelompokDropdown');
        dropdown.innerHTML = '<option value="">-- Pilih Tipe Hitungan --</option>';
        Object.keys(kelompokData).forEach(k => {
          dropdown.add(new Option(k, k));
        });
      }

      // Pengaturan
      renderPengaturan(appData.pengaturan);

      // Kendala
      renderKendala(appData.kendala || []);

      // Report
      renderReport(appData.report || []);

      // Depo/WD
      document.getElementById('depositData').textContent = appData.depoWd?.deposit || 'Tidak ada data';
      document.getElementById('withdrawData').textContent = appData.depoWd?.withdraw || 'Tidak ada data';
    }

    // ============================================
    // === NOTES ===
    // ============================================

    function renderNotesList(notes, folder) {
      const container = document.getElementById('notesList');
      if (!container) return;
      
      if (!notes || notes.length === 0) {
        container.innerHTML = '<p style="text-align:center; color:var(--text-dim);">Tidak ada catatan.</p>';
        return;
      }

      container.className = 'notes-grid';
      container.innerHTML = notes.map(note => {
        const imageUrlMatch = note.content?.match(/(https?:\/\/[^\s]+\.(jpeg|jpg|png|gif|webp))/i);
        const imageUrl = imageUrlMatch ? imageUrlMatch[1] : null;

        return `
          <div class="note-card" onclick="toggleNoteDetail(this)">
            <h3 class="note-title">${note.title || note.judul || 'Tanpa Judul'}</h3>
            <div class="note-preview">${(note.content || '').substring(0, 100)}${(note.content?.length > 100) ? '...' : ''}</div>
            <div class="note-date">üïê ${note.date || ''}</div>
            ${imageUrl ? `<div class="note-detail" style="display:none;"><img src="${imageUrl}" style="max-width:100%; border-radius:8px; margin-top:8px;" onclick="event.stopPropagation(); showLightbox('${imageUrl}')"></div>` : ''}
            <div class="note-detail" style="display:none; margin-top:10px;">
              ${note.content2 ? `<p><strong>========:</strong><br>${note.content2}</p>` : ''}
              ${note.content3 ? `<p><strong>========:</strong><br>${note.content3}</p>` : ''}
              <button class="copy-button" onclick="event.stopPropagation(); copyToClipboard('${(note.content || '').replace(/'/g, "\\'")}', 'Catatan')">üìã Copy</button>
            </div>
          </div>
        `;
      }).join('');
    }

    function toggleNoteDetail(card) {
      const detail = card.querySelector('.note-detail:last-child');
      if (detail) {
        detail.style.display = detail.style.display === 'none' ? 'block' : 'none';
      }
    }

    // ============================================
    // === FOTO GALLERY ===
    // ============================================

    function renderFotoGallery(fotos) {
      const container = document.getElementById('fotoList');
      if (!container) return;
      
      lightboxImages = [];
      
      if (!fotos || fotos.length === 0) {
        container.innerHTML = '<p style="text-align:center; color:var(--text-dim);">Tidak ada foto.</p>';
        return;
      }

      container.className = 'foto-gallery';
      container.innerHTML = fotos.map((foto, i) => {
        lightboxImages.push(foto.content);
        return `
          <div class="foto-card" onclick="openLightbox('${foto.content}', ${i})">
            <img src="${foto.content}" alt="${foto.title || 'Foto'}" onerror="this.parentElement.style.display='none'">
            <div class="foto-title">${foto.title || 'Tanpa judul'}</div>
          </div>
        `;
      }).join('');
    }

    // ============================================
    // === PASARAN ===
    // ============================================

    function renderPasaranTable(list) {
      const tbody = document.getElementById('pasaranBody');
      if (!tbody) return;
      
      if (!list || list.length === 0) {
        tbody.innerHTML = '<tr><td colspan="2">Tidak ada data</td></tr>';
        return;
      }

      tbody.innerHTML = list.map(row => `
        <tr>
          <td onclick="copyToClipboard('${(row[0] || '').replace(/'/g, "\\'")}', 'Prediksi')" style="cursor:pointer">üìã ${row[0] || '‚Äî'}</td>
          <td onclick="copyToClipboard('${(row[1] || '').replace(/'/g, "\\'")}', 'Jadwal')" style="cursor:pointer">üïê ${row[1] || '‚Äî'}</td>
        </tr>
      `).join('');
    }

    // ============================================
    // === HITUNGAN ===
    // ============================================

    document.getElementById('kelompokDropdown')?.addEventListener('change', function() {
      const labelDropdown = document.getElementById('labelDropdown');
      labelDropdown.innerHTML = '<option value="">-- Pilih Label --</option>';
      
      if (kelompokData[this.value]) {
        kelompokData[this.value].forEach(item => {
          labelDropdown.add(new Option(item.label, item.label));
        });
      }
    });

    document.getElementById('labelDropdown')?.addEventListener('change', function() {
      const kelompok = document.getElementById('kelompokDropdown').value;
      const label = this.value;
      const detail = document.getElementById('detailHitungan');
      
      if (kelompok && label && kelompokData[kelompok]) {
        const item = kelompokData[kelompok].find(i => i.label === label);
        if (item) {
          detail.innerHTML = `
            <div style="font-size:1.3rem; color:var(--neon-green); font-weight:bold; cursor:pointer" 
                 onclick="copyToClipboard('${(item.value || '').replace(/'/g, "\\'")}', 'Hasil')">
              ${item.value || '‚Äî'}
            </div>
          `;
        }
      }
    });

    // ============================================
    // === PENGATURAN ===
    // ============================================

    function renderPengaturan(data) {
      const container = document.getElementById('pengaturanContent');
      if (!container || !data?.data) {
        container.innerHTML = '<p style="color:var(--neon-red)">Tidak ada data pengaturan.</p>';
        return;
      }

      container.innerHTML = data.data.map(group => `
        <details>
          <summary>${group.judul}</summary>
          <div style="margin-top:10px; overflow-x:auto;">
            <table>
              <thead><tr><th>Nama</th><th>Hadiah</th><th>Diskon</th></tr></thead>
              <tbody>
                ${group.items.map(it => `
                  <tr>
                    <td>${it.nama || '‚Äî'}</td>
                    <td style="color:var(--neon-green)">${it.hadiah || '‚Äî'}</td>
                    <td>${(it.diskon && String(it.diskon).includes('%')) ? it.diskon : 'NO DISCOUNT'}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        </details>
      `).join('');
    }

    // ============================================
    // === KENDALA ===
    // ============================================

    function renderKendala(items) {
      const container = document.getElementById('kendalaList');
      if (!container) return;
      
      if (!items || items.length === 0) {
        container.innerHTML = '<p>Tidak ada data kendala.</p>';
        return;
      }

      container.innerHTML = items.map(item => `
        <div class="kendala-card">
          <div class="kendala-judul">${item.judul || 'Tanpa judul'}</div>
          ${item.jawaban1 ? `<div class="kendala-jawaban">${item.jawaban1}</div>` : ''}
          ${item.jawaban2 ? `<div class="kendala-jawaban">${item.jawaban2}</div>` : ''}
          ${item.jawaban3 ? `<div class="kendala-jawaban">${item.jawaban3}</div>` : ''}
        </div>
      `).join('');
    }

    // ============================================
    // === REPORT ===
    // ============================================

    function renderReport(items) {
      const container = document.getElementById('reportList');
      if (!container) return;
      
      if (!items || items.length === 0) {
        container.innerHTML = '<p>Tidak ada report.</p>';
        return;
      }

      container.innerHTML = items.map(item => `
        <div class="report-card">
          <div class="card-accordion-title" onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'">
            ${item.colA || '‚Äî'}
          </div>
          <div class="card-content-panel" style="display:none;">
            ${item.colB ? `<div class="report-field-group"><label>MEMO/REPORT</label><div class="report-display-value">${item.colB}</div><button class="copy-button" onclick="copyToClipboard('${(item.colB || '').replace(/'/g, "\\'")}', 'Memo')">üìã Copy</button></div>` : ''}
            ${item.colC ? `<div class="report-field-group"><label>POST/MEMO</label><div class="report-display-value">${item.colC}</div></div>` : ''}
            ${item.colD ? `<div class="report-field-group"><label>REPORT KE LINE</label><div class="report-display-value">${item.colD}</div></div>` : ''}
          </div>
        </div>
      `).join('');
    }

    // ============================================
    // === LIGHTBOX ===
    // ============================================

    function openLightbox(src, index) {
      const lb = document.getElementById('lightbox');
      const img = document.getElementById('lightboxImg');
      img.src = src;
      lb.style.display = 'flex';
      lightboxIndex = index || 0;
      resetZoomAndPosition();
    }

    function closeLightbox() {
      document.getElementById('lightbox').style.display = 'none';
      document.getElementById('lightboxImg').src = '';
    }

    async function copyLightboxImage() {
      const img = document.getElementById('lightboxImg');
      if (!img || !img.src) {
        showToast('‚ùå Tidak ada gambar');
        return;
      }
      try {
        const res = await fetch(img.src);
        const blob = await res.blob();
        await navigator.clipboard.write([new ClipboardItem({ [blob.type]: blob })]);
        showToast('‚úÖ Foto disalin!');
      } catch {
        showToast('‚ùå Gagal menyalin (CORS)');
      }
    }

    document.getElementById('lightbox')?.addEventListener('click', (e) => {
      if (e.target.id === 'lightbox') closeLightbox();
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') closeLightbox();
      if (e.key === 'ArrowLeft' && lightboxImages.length > 0) {
        lightboxIndex = (lightboxIndex - 1 + lightboxImages.length) % lightboxImages.length;
        openLightbox(lightboxImages[lightboxIndex], lightboxIndex);
      }
      if (e.key === 'ArrowRight' && lightboxImages.length > 0) {
        lightboxIndex = (lightboxIndex + 1) % lightboxImages.length;
        openLightbox(lightboxImages[lightboxIndex], lightboxIndex);
      }
    });

    // ============================================
    // === TAB SWITCHING ===
    // ============================================

    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });

    // ============================================
    // === FOLDER SELECT ===
    // ============================================

    document.getElementById('folderSelect')?.addEventListener('change', function() {
      if (appData?.notes) {
        currentFolder = this.value;
        renderNotesList(appData.notes[this.value] || [], this.value);
      }
    });

    // ============================================
    // === SEARCH ===
    // ============================================

    document.getElementById('searchNotes')?.addEventListener('input', function() {
      const q = this.value.toLowerCase();
      document.querySelectorAll('.note-card').forEach(card => {
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(q) ? 'block' : 'none';
      });
    });

    document.getElementById('searchFoto')?.addEventListener('input', function() {
      const q = this.value.toLowerCase();
      document.querySelectorAll('.foto-card').forEach(card => {
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(q) ? 'block' : 'none';
      });
    });

    document.getElementById('searchPasaran')?.addEventListener('input', function() {
      const q = this.value.toLowerCase();
      document.querySelectorAll('#pasaranBody tr').forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(q) ? '' : 'none';
      });
    });

    document.getElementById('searchReport')?.addEventListener('input', function() {
      const q = this.value.toLowerCase();
      document.querySelectorAll('.report-card').forEach(card => {
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(q) ? 'block' : 'none';
      });
    });

    // ============================================
    // === INIT ===
    // ============================================

    document.addEventListener('DOMContentLoaded', () => {
      loadAllData();
    });
  </script>
</body>
</html>
