<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha512-1ycn6IcaQQ40wR2fV9K5o7sFh0x8J6m4J2b5t0yPj0z3wz9Ea9uS8y3r5eL+6I/g1k/S5w8V7r+zO5R0yO6w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<title>Aplikasi Catatan</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@6.0.1/dist/tesseract.min.js"></script>
<style>

body {
    margin: 0;
    padding: 30px;
    transition: background 0.8s ease-in-out;
    background-attachment: fixed;
    background-size: cover;
    font-family: 'Orbitron', 'Segoe UI', sans-serif;
    font-weight: bold;
}

body.bg-default,
body.bg-deepspace {
    background-repeat: no-repeat;
    background-position: center center;
    color: #33FFFF; /* UPDATED: Warna teks utama (Azure Terang) */
}

body.bg-default {
    background-image: url('https://i.imgur.com/WsOflkW.png');
}

body.bg-deepspace {
    background-image: url('https://4kwallpapers.com/images/walls/thumbs_3t/19856.jpg');
}

body.bg-gradient {
    background-image: url('https://wallpapercave.com/wp/wp9046775.jpg');
}

.background-switcher {
    margin: 20px;
    text-align: right;
}

.background-switcher select {
    width: 100%;
    padding: 10px 36px 10px 14px;
    margin-bottom: 18px;
    font-size: 14px;
    font-weight: bold;
    border: none;
    border-radius: 14px;
    background: rgba(0, 29, 61, 0.9); /* UPDATED: Warna latar belakang lebih gelap */
    color: #00E5FF; /* UPDATED: Warna teks select (Cyan Elektrik) */
    cursor: pointer;
    appearance: none;
    box-shadow: 0 0 12px rgba(0, 229, 255, 0.4); /* UPDATED: Efek shadow baru */
    backdrop-filter: blur(8px);
    border: 1px solid rgba(0, 229, 255, 0.6); /* UPDATED: Border baru */
    transition: all 0.3s ease;
    background-image: url("data:image/svg+xml,%3Csvg fill='%2333FFFF' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3E%3Cpath d='M5.23 7.21a.75.75 0 011.06.02L10 11.292l3.71-4.06a.75.75 0 111.08 1.04l-4.25 4.65a.75.75 0 01-1.08 0L5.21 8.27a.75.75 0 01.02-1.06z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 16px;
}

.sidebar-brand {
    text-align: center;
    margin-bottom: 15px;
}

.sidebar-brand h2 {
    margin: 0;
    font-size: 22px;
    color: #33FFFF; /* UPDATED */
    text-shadow: 0 0 10px #00E5FF; /* UPDATED */
}

.brand-sub {
    font-size: 12px;
    color: #00E5FF; /* UPDATED */
    text-shadow: 0 0 6px #00E5FF66; /* UPDATED */
}

.planet-icon {
    margin-bottom: 10px;
}

.background-switcher select:focus {
    outline: none;
    border-color: #00E5FF; /* UPDATED */
    box-shadow: 0 0 15px #00E5FF; /* UPDATED */
    animation: pulse 1s infinite alternate;
}

@keyframes pulse {
    from {
        box-shadow: 0 0 10px #00E5FF; /* UPDATED */
    }
    to {
        box-shadow: 0 0 20px #00E5FF; /* UPDATED */
    }
}

*::-webkit-scrollbar {
    width: 10px;
}

*::-webkit-scrollbar-track {
    background: rgba(0, 0, 20, 0.4);
    border-radius: 10px;
}

*::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, #33FFFF, #0044FF); /* UPDATED: Gradient awal lebih terang */
    border-radius: 10px;
    box-shadow: 0 0 10px #00E5FF88; /* UPDATED */
}

*::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, #33FFFF, #0055FF); /* UPDATED: Gradient hover lebih terang */
    box-shadow: 0 0 15px #33FFFFaa; /* UPDATED */
}

html {
    scroll-behavior: smooth;
}

.main-container {
    display: flex;
    flex-direction: row;
    gap: 25px;
    padding: 20px;
    align-items: flex-start;
    justify-content: flex-start;
    flex-wrap: wrap;
}

.sidebar-container {
    backdrop-filter: blur(20px);
    background: rgba(0, 10, 30, 0.6);
    border-radius: 20px;
    padding: 25px 20px;
    width: 100%;
    max-width: 280px;
    box-shadow: 0 0 40px rgba(0, 229, 255, 0.2); /* UPDATED */
    display: flex;
    flex-direction: column;
    gap: 20px;
    border: 1px solid rgba(0,229,255,0.4); /* UPDATED */
    animation: fadeIn 0.8s ease-in;
}

.neon-button {
    background: linear-gradient(135deg, rgba(0,229,255,0.15), rgba(0,100,255,0.15)); /* UPDATED */
    color: #33FFFF; /* UPDATED */
    border: 1px solid rgba(0,229,255,0.4); /* UPDATED */
    padding: 14px 20px;
    font-size: 15px;
    border-radius: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 12px;
    box-shadow: 0 0 10px rgba(0,229,255,0.1); /* UPDATED */
    position: relative;
    overflow: hidden;
}

.neon-button::after {
    content: "";
    position: absolute;
    top: 0; left: -100%;
    width: 100%; height: 100%;
    background: linear-gradient(120deg, transparent, rgba(0,229,255,0.4), transparent); /* UPDATED */
    transition: 0.4s;
}

.neon-button:hover::after {
    left: 100%;
}

.neon-button:hover {
    background: rgba(0,229,255,0.25); /* UPDATED */
    color: #33FFFF; /* UPDATED */
    transform: translateX(5px) scale(1.03);
    box-shadow: 0 0 15px #00E5FF, 0 0 25px #00E5FF66; /* UPDATED */
}

.neon-button span {
    flex: 1;
    font-weight: 500;
}

/* === KONTEN AREA === */
.content-area {
    flex: 1;
    min-width: 300px;
    background: rgba(0, 15, 30, 0.5);
    padding: 25px;
    border-radius: 20px;
    color: #33FFFF; /* UPDATED */
    box-shadow: 0 0 25px rgba(0,229,255,0.2); /* UPDATED */
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px,1fr));
    grid-gap: 20px;
    animation: fadeIn 0.8s ease-in;
}

/* === JAM DIGITAL === */
#clock {
    color: #33FFFF; /* UPDATED */
    text-align: center;
    margin-bottom: 20px;
    font-weight: bold;
    font-size: 24px;
    font-family: 'Orbitron', sans-serif;
    letter-spacing: 2px;
    text-shadow: 
        0 0 8px #00E5FF, 
        0 0 12px #00ccff, 
        0 0 20px #0099cc;
    background: linear-gradient(90deg, rgba(0,229,255,0.1), rgba(0,229,255,0.03)); /* UPDATED */
    padding: 10px 20px;
    border: 1px solid rgba(0, 229, 255, 0.5); /* UPDATED */
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0, 229, 255, 0.3); /* UPDATED */
    display: inline-block;
}

/* === INPUT === */
input[type="text"],
textarea,
input[type="number"] {
    width: 88%;
    padding: 6px;
    margin-bottom: 8px;
    border-radius: 5px;
    border: 1px solid #00E5FF; /* UPDATED */
    background: #001122;
    color: #33FFFF; /* UPDATED */
    font-size: 15px;
    font-weight: bold;
}

input:focus,
textarea:focus {
    box-shadow: 0 0 10px #00E5FF; /* UPDATED */
    outline: none;
}

textarea {
    width: 100%;
    min-height: 100px;
    padding: 8px;
    border-radius: 6px;
    border: none;
    font-weight: bold;
    resize: vertical;
}

/* === NOTE ITEM === */
.note-item {
    white-space: pre-wrap;
    font-weight: bold;
    background: rgba(0, 0, 20, 0.55);
    padding: 20px;
    margin-bottom: 15px;
    border-radius: 14px;
    border: 1px solid #00E5FF; /* UPDATED */
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 0 8px #00E5FF55, 0 0 20px #00E5FF22; /* UPDATED */
    will-change: transform, box-shadow;
}

.note-item:hover {
    background: rgba(0, 0, 50, 0.5);
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 0 12px #33FFFFaa, 0 0 28px #33FFFF55; /* UPDATED */
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* === JUDUL CATATAN === */
.note-title {
    font-size: 22px;
    font-weight: bold;
    color: #33FFFF; /* UPDATED */
    text-shadow: 0 0 4px #00E5FF, 0 0 10px #00ccff; /* UPDATED */
    margin-bottom: 8px;
}

/* === PREVIEW ISI CATATAN === */
.note-content-preview {
    color: #33FFFF; /* UPDATED */
    font-size: 18px;
    font-weight: 500;
    line-height: 1.6;
    text-shadow: 0 0 2px rgba(51, 255, 255, 0.6); /* UPDATED */
    white-space: pre-wrap;
    word-break: break-word;
    letter-spacing: normal;
}

/* === KARTU CATATAN === */
.note-card {
    background: linear-gradient(
        145deg,
        rgba(0, 0, 40, 0.9),
        rgba(0, 15, 60, 0.85)
    );
    padding: 20px;
    max-width: 900px;
    width: 92%;
    margin: 0 auto 18px;
    color: #33FFFF; /* UPDATED */
    border-radius: 16px;
    box-shadow:
        0 0 8px rgba(51, 255, 255, 0.3), /* UPDATED */
        0 0 20px rgba(51, 255, 255, 0.15); /* UPDATED */
    backdrop-filter: blur(8px) saturate(140%);
    word-break: break-word;
    font-weight: 500;
    transition: all 0.3s ease-in-out;
}

.note-card:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow:
        0 0 14px rgba(51, 255, 255, 0.6), /* UPDATED */
        0 0 28px rgba(51, 255, 255, 0.3); /* UPDATED */
    cursor: pointer;
}

/* === DETAIL TEKS === */
.note-detail p {
    margin-bottom: 8px;
    font-size: 15px;
    color: #33FFFF; /* UPDATED */
    text-shadow: 0 0 1px rgba(51, 255, 255, 0.4); /* UPDATED */
    white-space: pre-wrap;
    word-break: break-word;
}

/* === TOMBOL DALAM KARTU === */
.note-card button {
    background: linear-gradient(145deg, rgba(51, 255, 255, 0.2), rgba(0, 100, 255, 0.2)); /* UPDATED */
    color: #33FFFF; /* UPDATED */
    border: 1px solid rgba(51, 255, 255, 0.4); /* UPDATED */
    padding: 10px 16px;
    font-size: 14px;
    font-weight: 600;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.25s ease;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 0 12px rgba(51, 255, 255, 0.2); /* UPDATED */
    text-shadow: 0 0 4px #33FFFF88; /* UPDATED */
    backdrop-filter: blur(3px);
}

.note-card button:hover {
    background: linear-gradient(145deg, rgba(51, 255, 255, 0.35), rgba(0, 100, 255, 0.35)); /* UPDATED */
    transform: translateY(-2px);
    box-shadow: 0 0 15px rgba(51, 255, 255, 0.4); /* UPDATED */
}

/* GALERI FOTO */
#notesList.foto-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 20px;
    padding: 20px;
}

/* KARTU FOTO */
.foto-card {
    position: relative;
    border-radius: 16px;
    overflow: hidden;
    cursor: pointer;
    background: rgba(0, 17, 34, 0.7);
    box-shadow: 0 8px 20px rgba(0,229,255,0.15); /* UPDATED */
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.foto-card:hover {
    transform: scale(1.02);
    box-shadow: 0 0 25px #00E5FF55; /* UPDATED */
}

/* FOTO SELALU UTUH (TIDAK TERPOTONG) */
.foto-card img {
    width: 100%;
    height: 300px;
    object-fit: contain;
    object-position: center;
    display: block;
    background-color: #000000;
    transition: transform 0.4s ease;
}

.foto-card:hover img {
    transform: scale(1.01);
}

/* AREA TEKS */
.foto-overlay {
    padding: 8px 12px;
    text-align: center;
    background: rgba(0,17,34,0.6);
}

/* TULISAN KECIL DAN JELAS */
.foto-title {
    font-weight: 600;
    font-size: 0.95rem;
    margin-bottom: 5px;
    color: #33FFFF; /* UPDATED */
    text-shadow: 0 0 4px #00E5FF, 0 0 8px #001122; /* UPDATED */
}

.copy-button {
    background: transparent;
    border: 1px solid #00E5FF; /* UPDATED */
    padding: 5px 10px;
    border-radius: 6px;
    color: #33FFFF; /* UPDATED */
    cursor: pointer;
    font-size: 13px;
    transition: all 0.3s ease;
}

.copy-button:hover {
    background: #00E5FF; /* UPDATED */
    color: #001122;
    box-shadow: 0 0 8px #00E5FF, 0 0 16px #00E5FF55; /* UPDATED */
}

/* === TAB MENU === */
.tab-menu {
    display: flex;
    background: #111;
    border-radius: 10px;
}
.tab-button {
    flex: 1;
    padding: 8px 15px;
    background: #0a0a0a;
    color: #00E5FF; /* UPDATED */
    border: none;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    text-transform: uppercase;
    letter-spacing: 1px;
    border-radius: 10px;
    transition: all 0.3s ease;
    box-shadow: 0 0 6px #00E5FF44, 0 0 12px #00E5FF22 inset; /* UPDATED */
}
.tab-button:hover {
    background: #001b26;
    color: #D6FFFF; /* UPDATED: Lebih terang */
    box-shadow: 0 0 10px #33FFFF, 0 0 18px #33FFFF, 0 0 25px #33FFFF; /* UPDATED */
    transform: scale(1.03);
}
.tab-button.active {
    background: linear-gradient(to right, #005f88, #00E5FF); /* UPDATED */
    color: #33FFFF; /* UPDATED */
    box-shadow: 0 0 12px #33FFFF, 0 0 24px #33FFFF, 0 0 36px #33FFFF; /* UPDATED */
    transform: scale(1.06);
}
.tab-content {
    display: none;
    flex: 1;
}
.tab-content.active {
    display: block;
}

/* === TEKS COPYABLE === */
.copy-text {
    display: inline-block;
    margin-top: 5px;
    cursor: pointer;
    color: #33FFFF; /* UPDATED */
    background: rgba(255,255,255,0.05);
    padding: 6px 12px;
    border-radius: 6px;
    font-family: monospace;
    transition: background 0.2s;
}
.copy-text:hover {
    background: rgba(255,255,255,0.1);
}

/* === TOAST === */
.toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: #00E5FF; /* UPDATED */
    color: #001D3D; /* UPDATED: Warna teks gelap untuk kontras */
    padding: 10px 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px #00E5FF; /* UPDATED */
    z-index: 9999;
    animation: fadein 0.3s ease;
}

/* === ANIMASI === */
@keyframes fadein {
    from { opacity: 0; transform: translateX(-50%) translateY(20px); }
    to { opacity: 1; transform: translateX(-50%) translateY(0); }
}

.judul-glow {
    font-size: 28px;
    text-align: center;
    padding: 12px 20px;
    color: #00E5FF; /* UPDATED */
    text-shadow: 0 0 12px #00E5FF, 0 0 20px #0088ff; /* UPDATED */
    border: 2px solid #00E5FF44; /* UPDATED */
    border-radius: 15px;
    background: rgba(0, 10, 30, 0.5);
    backdrop-filter: blur(10px);
    margin-bottom: 20px;
    animation: pulseText 2s infinite alternate;
}

@keyframes pulseText {
    from { text-shadow: 0 0 5px #00E5FF, 0 0 10px #00E5FF; color: #00E5FF; } /* UPDATED */
    to { text-shadow: 0 0 10px #33FFFF, 0 0 20px #33FFFF; color: #ccffff; } /* UPDATED */
}

/* === FAB BUTTON === */
#stickyFab {
position: fixed;
bottom: 20px;
right: 20px;
font-size: 26px;
font-weight: bold;
background: #00ffff;
color: #000;
border-radius: 50%;
padding: 16px;
cursor: pointer;
z-index: 1000;
box-shadow:
0 0 10px #00ffff,
0 0 20px #00ffff,
0 0 30px #00ffff;
transition: all 0.3s ease;
animation: pulseNeon 2.5s infinite ease-in-out;
}

#stickyFab:hover {
transform: scale(1.1);
background: #66ffff;
box-shadow:
0 0 15px #00ffff,
0 0 30px #00ffff,
0 0 45px #00ffff;
}

#stickyPanel {
position: fixed;
bottom: 80px;
right: 20px;
width: 500px;
max-width: 90vw;
min-width: 300px;
min-height: 150px;
background: rgba(0, 0, 50, 0.85);
border: 2px solid #00ffff;
border-radius: 12px;
padding: 16px;
display: none;
z-index: 999;
max-height: 80vh;
overflow: auto;
resize: both;
animation: fadeInPanel 0.4s ease-in;
}

#stickyInput {
white-space: pre-wrap;
width: 100%;
min-height: 50px;
background: transparent;
color: #00ffff;
border: 1px solid #00ffff;
border-radius: 8px;
padding: 6px;
resize: none;
overflow: hidden;
margin-bottom: 10px;
font-family: inherit;
font-size: 14px;
font-weight: bold;
}

#stickyPanel button {
width: 100%;
background: #00ffff;
color: #000;
border: none;
padding: 6px;
border-radius: 6px;
margin-bottom: 10px;
cursor: pointer;
font-weight: bold;
}

#stickyList div {
white-space: pre-wrap;
background: rgba(0, 10, 40, 0.9);
border: 1px solid #00ffff;
color: #00ffff;
border-radius: 6px;
padding: 8px 12px;
margin-bottom: 8px;
position: relative;
word-wrap: break-word;
font-size: 14px;
font-weight: bold;
line-height: 1.4;
cursor: pointer;
}

.sticky-add-button {
    background-color: #00ffff;
    color: #000;
    border: none;
    padding: 8px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    margin: 10px 0;
    transition: background-color 0.3s ease;
}

.sticky-add-button:hover {
    background-color: #00FFFF;
}

.sticky-delete {
position: absolute;
top: 4px;
right: 8px;
color: red;
cursor: pointer;
font-weight: bold;
font-size: 16px;
}

#notesList strong,
.glow-text {
color: white;
font-weight: bold;
text-shadow: 0 0 5px #00ccff, 0 0 10px #00ccff;
}

.sticky-edit {
position: absolute;
top: 4px;
right: 30px;
color: #00ff00;
cursor: pointer;
font-size: 16px;
font-weight: bold;
}

#stickyList img {
  display: block;           /* supaya auto center */
  margin: 6px auto;
  width: auto;
  max-width: 40%;           /* dari sebelumnya 50% → 40% */
  max-height: 120px;        /* lebih kecil dari default */
  height: auto;
  object-fit: contain;
  border-radius: 6px;
}

@keyframes pulseNeon {
0%, 100% {
box-shadow:
0 0 10px #00ffff,
0 0 20px #00ffff,
0 0 30px #00ffff;
}
50% {
box-shadow:
0 0 20px #00ffff,
0 0 35px #00ffff,
0 0 50px #00ffff;
}
}

:root {
  /* Backgrounds */
  --bg-dark: #001020;
  --bg-galaxy: rgba(0, 0, 50, 0.7);
  --bg-galaxy-section: linear-gradient(135deg, rgba(0,0,40,0.7), rgba(0,30,60,0.6));
  --bg-input: rgba(0,10,30,0.8);
  --bg-input-dark: #021222;

  /* Texts */
  --txt-main: #00ffff;
  --txt-highlight: #00ffee;
  --txt-shadow: 1px 1px 2px black;

  /* Borders & Buttons */
  --border-galaxy: rgba(0, 191, 255, 0.7);
  --btn-glow: #00bfff;

  /* Shadows & Effects */
  --shadow-glow: rgba(0, 255, 255, 0.2);
  --accent-neon: #00ffff;
}

/* === SELECT DROPDOWN === */
.pasaran-dropdown,
.hitung-dropdown {
  background: var(--bg-galaxy);
  color: var(--txt-main);
  font-weight: bold;
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid var(--border-galaxy);
  font-size: 16px;
  cursor: pointer;
  text-shadow: var(--txt-shadow);
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  white-space: pre-wrap;
  word-break: break-word;
  position: relative;
}

/* Custom arrow for dropdown */
.pasaran-dropdown::after,
.hitung-dropdown::after {
  content: "▼";
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
  color: #00ffff;
  text-shadow: var(--txt-shadow);
  font-size: 12px;
}

.pasaran-dropdown option,
.hitung-dropdown option {
  background: var(--bg-galaxy);
  color: #00ffff;
  font-weight: bold;
  text-shadow: 1px 1px 1px black;
  white-space: pre-wrap;
  word-break: break-word;
}

.pasaran-dropdown::-ms-expand,
.hitung-dropdown::-ms-expand {
  display: none;
}

/* === DETAIL DROPDOWN === */
.dropdown-detail,
.cara-hitung-section {
  margin-top: 10px;
  background: var(--bg-galaxy);
  color: #00ffff;
  padding: 15px;
  border-radius: 12px;
  border: 1.5px solid rgba(0, 191, 255, 0.6);
  min-height: 80px;
  white-space: pre-wrap;
  word-break: break-word;
  font-size: 16px;
  font-weight: bold;
  box-shadow: 0 0 12px rgba(0, 191, 255, 0.4);
  cursor: pointer;
  transition: background-color 0.3s ease;
  text-shadow: var(--txt-shadow);
}

.dropdown-detail:hover {
  background: var(--bg-galaxy);
}

/* === SEARCH BOX === */
.pasaran-search,
.input-tanggal {
  width: 20%;
  padding: 8px;
  margin-bottom: 16px;
  border: 1px solid var(--border-galaxy);
  border-radius: 6px;
  background: rgba(0, 255, 255, 0.2);
  color: #80dfff;
  font-size: 16px;
  font-weight: bold;
  text-shadow: var(--txt-shadow);
  white-space: pre-wrap;
  word-break: break-word;
}

/* === BUTTONS === */
.btn-toggle-tanggal,
.btn-simpan-tanggal {
  background: var(--btn-glow);
  color: #001f3f;
  padding: 8px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  margin-bottom: 12px;
  box-shadow: 0 0 8px var(--btn-glow);
  font-weight: 700;
  text-shadow: 1px 1px 1px white;
}

.btn-simpan-tanggal {
  background: #00ffff;
  box-shadow: 0 0 8px #00ffff;
  margin-left: 12px;
}

.form-tanggal {
  display: none;
  margin-bottom: 20px;
}

/* === NOMINAL INPUT & BUTTON === */
.nominal-group {
  margin-bottom: 20px;
}

.nominal-group input {
  padding: 6px;
  width: 150px;
  border-radius: 6px;
  border: 1px solid var(--txt-main);
  background: #111;
  color: var(--txt-main);
  margin-left: 10px;
}

.nominal-group button {
  padding: 6px 14px;
  border: none;
  background: #000;
  color: var(--txt-main);
  border-radius: 6px;
  cursor: pointer;
  margin-left: 10px;
}

/* === HITUNGAN VALUE / LABEL === */
.hitungan-value,
.hitungan-label {
  font-weight: bold;
  color: var(--txt-main);
  background: rgba(0, 0, 50, 0.6);
  padding: 8px;
  border: 1px solid var(--txt-main);
  border-radius: 6px;
  text-align: center;
  cursor: pointer;
  margin-bottom: 20px;
  white-space: pre-wrap;
  word-break: break-word;
}

.hitungan-label {
  padding: 4px 8px;
  display: inline-block;
  margin-bottom: 6px;
}

.ping-glow {
  animation: pingGlowSlow 2s infinite;
}

/* Heading in cara-hitung */
.cara-hitung-section h2 {
  color: var(--txt-main);
  text-shadow: 0 0 5px #00bfff;
}

/* === ANIMATION === */
@keyframes pingGlowSlow {
  0%, 100% { box-shadow: 0 0 5px #00ffff; }
  50% { box-shadow: 0 0 20px #00ffff; }
}

#membacaIsiFoto_input {
  background-color: rgba(0, 20, 40, 0.6);
  color: #00ffff;
  border: 1px solid #00ffff;
  box-shadow: 0 0 10px #00ffff66;
  transition: 0.3s;
}

#membacaIsiFoto_input:focus {
  outline: none;
  background-color: rgba(0, 20, 40, 0.9);
  box-shadow: 0 0 20px #00ffffaa;
}

#membacaIsiFoto_modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0, 0, 20, 0.95);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  flex-direction: row;
  gap: 20px;
  padding: 20px;
  box-sizing: border-box;
  overflow-y: auto;
  flex-wrap: wrap;
}

#membacaIsiFoto_modal div[onclick*="tutup"] {
  position: absolute;
  top: 15px;
  right: 25px;
  font-size: 32px;
  color: #00ffff;
  cursor: pointer;
  user-select: none;
  font-weight: bold;
  text-shadow: 0 0 10px cyan;
  transition: 0.2s;
}

#membacaIsiFoto_modal div[onclick*="tutup"]:hover {
  transform: scale(1.2);
  color: #ff0066;
  text-shadow: 0 0 10px #ff0099;
}

#membacaIsiFoto_gambar {
  max-width: 100%;
  max-height: 80vh;
  border-radius: 12px;
  box-shadow: 0 0 30px cyan;
  transition: transform 0.3s ease-in-out;
}

#membacaIsiFoto_gambar:hover {
  transform: scale(1.02);
}

#membacaIsiFoto_hasil {
  color: #00ffff;
  font-family: 'Courier New', monospace;
  font-weight: bold;
  white-space: pre-wrap;
  background: rgba(0, 40, 60, 0.85);
  border-radius: 12px;
  padding: 18px;
  box-shadow: 0 0 25px #00ffff88;
  max-height: 80vh;
  overflow-y: auto;
  font-size: 15px;
  flex: 1;
  min-width: 300px;
}

@media (max-width: 768px) {
  #membacaIsiFoto_modal {
    flex-direction: column;
    gap: 10px;
    padding: 10px;
  }

  #membacaIsiFoto_hasil {
    font-size: 15px;
    max-height: 40vh;
  }

  #membacaIsiFoto_gambar {
    max-height: 40vh;
  }
}

.zoomable-image {
  width: 100%;
  max-width: 300px;
  height: auto;
  cursor: zoom-in;
  border-radius: 8px;
  transition: transform 0.2s ease-in-out;
  box-shadow: 0 0 10px cyan;
}

.zoomable-image:hover {
  transform: scale(1.05);
}

#lightbox {
  display: none;
  position: fixed;
  z-index: 9999;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  background: rgba(0,0,0,0.9);
  align-items: center;
  justify-content: center;
}

#lightbox img {
  max-width: 90%;
  max-height: 90%;
  border-radius: 12px;
  box-shadow: 0 0 30px cyan;
}

/* ================== VARIABEL WARNA ================== */
:root {
  --txt-main: #00ffff;
  --txt-highlight: #66ffff;
  --bg-input: #000f1a;
  --bg-input-dark: #000c1f;
  --bg-galaxy-section: rgba(0, 20, 40, 0.8);
  --shadow-glow: #00f7ff44;
  
  /* Background utama (digunakan di body, dropdown, dll) */
  --bg-galaxy: #001428;
}

/* ================== TEXTAREAS ================== */
.input-textarea,
#freespinTextarea,
.bonus-textarea {
  width: 100%;
  min-height: 140px;
  background: var(--bg-input);
  color: var(--txt-highlight);
  border: 1.5px solid #00f7ff;
  border-radius: 12px;
  padding: 15px;
  font-family: monospace;
  font-size: 15px;
  box-sizing: border-box;
  resize: vertical;
  white-space: pre-wrap;
  word-break: break-word;
  box-shadow: inset 0 0 10px #00f7ff22;
}

/* ================== BONUS SECTION ================== */
.bonus-section {
  background: var(--bg-galaxy-section);
  padding: 25px;
  border-radius: 20px;
  box-shadow: 0 0 25px var(--shadow-glow);
  max-width: 720px;
  margin: 30px auto;
  border: 1px solid rgba(0, 255, 255, 0.2);
  backdrop-filter: blur(10px);
}

.bonus-title {
  font-family: 'Orbitron', sans-serif;
  color: var(--txt-main);
  font-size: 22px;
  text-align: center;
  text-shadow: 0 0 6px #00ffffaa;
  margin-bottom: 20px;
  font-weight: bold;
}

/* ================== INPUT GROUP ================== */
.bonus-input-group {
  display: flex;
  flex-direction: column;
  margin-bottom: 12px;
}

.bonus-label {
  color: var(--txt-main);
  font-weight: 600;
  font-size: 13px;
  margin-bottom: 4px;
  text-shadow: 0 0 4px #00bcd4aa;
}

.bonus-input {
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #00bcd4;
  background-color: var(--bg-input-dark);
  color: #e0ffff;
  font-weight: bold;
  font-size: 13px;
  box-shadow: inset 0 0 5px #00ffff55;
  white-space: pre-wrap;
  word-break: break-word;
}

/* ================== BUTTONS ================== */
.bonus-button-group {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-top: 18px;
  flex-wrap: wrap;
}

.bonus-btn {
  padding: 10px 18px;
  border-radius: 8px;
  background-color: var(--txt-main);
  color: #000000;
  font-weight: bold;
  border: none;
  cursor: pointer;
  transition: all 0.25s ease;
  font-size: 13px;
  box-shadow: 0 0 10px #00ffff88;
}

.bonus-btn:hover {
  background-color: #00cccc;
  transform: scale(1.05);
}

.bonus-btn.danger {
  background-color: #ff4444;
  color: #000000;
  box-shadow: 0 0 10px #ff4444aa;
}

.bonus-btn.danger:hover {
  background-color: #cc0000;
}

/* ================== BONUS RESULT ================== */
.bonus-result {
  margin-top: 20px;
  padding: 18px;
  border-radius: 14px;
  background: radial-gradient(circle at top left, rgba(0, 255, 255, 0.1), rgba(0, 20, 40, 0.9));
  border: 2px solid var(--txt-main);
  box-shadow: 0 0 15px rgba(0, 255, 255, 0.3),
              inset 0 0 10px rgba(0, 255, 255, 0.1);
  font-family: 'Courier New', monospace;
  color: #66ffff;
  font-size: 15px;
  font-weight: 600;
  white-space: pre-wrap;
  word-break: break-word;
  text-shadow: 0 0 4px #00bcd4aa;
}

.bonus-angka {
  font-size: 22px;
  font-weight: 900;
  color: var(--txt-highlight);
  text-shadow: 0 0 8px #00ffffcc, 0 0 20px #00ffff88;
  display: inline-block;
  margin-left: 6px;
  transition: color 0.3s ease;
}

.foto-gallery {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  padding: 20px;
  background-color: #1a1a2e; 
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
}

/* Kartu Foto */
.foto-card {
  display: flex;
  flex-direction: column;
  justify-content: flex-end; /* Menempatkan tombol di bawah */
  background-color: #2b2b45;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  cursor: pointer;
  border: 1px solid rgba(0, 255, 255, 0.2);
  padding: 10px; /* Jarak di dalam kartu */
}

.foto-card:hover {
  transform: translateY(-5px) scale(1.03);
  box-shadow: 0 8px 25px rgba(0, 255, 255, 0.3);
}

/* Bingkai Gambar */
.foto-card .image-container {
    width: 100%;
    height: 180px; /* Tinggi bingkai yang tetap */
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #0d0d1a; /* Latar belakang untuk mengisi ruang kosong */
    border-radius: 8px;
    margin-bottom: 10px;
}

/* Gambar di dalam Kartu */
.foto-card img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain; /* PENTING: Menampilkan seluruh gambar */
  display: block;
}

/* Judul Foto */
.foto-card .foto-title {
  padding: 0 5px 10px 5px;
  text-align: center;
  font-size: 14px;
  font-weight: bold;
  color: #e0f7ff;
  text-shadow: 0 0 5px #00ffff;
}

/* === SCROLLBAR CUSTOM NEON === */
#notesList::-webkit-scrollbar {
  width: 10px;
}

#notesList::-webkit-scrollbar-track {
  background: rgba(0, 0, 20, 0.3);
  border-radius: 10px;
  box-shadow: inset 0 0 6px rgba(0,255,255,0.1);
}

#notesList::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, #00f0ff, #0044ff);
  border-radius: 10px;
  box-shadow: 0 0 12px #00f0ff55, 0 0 18px #0044ff55;
  transition: all 0.3s ease;
}

#notesList::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(180deg, #00ffff, #0055ff);
  box-shadow: 0 0 18px #00ffffaa, 0 0 28px #0055ff55;
  transform: scaleX(1.2);
}

/* list container */
#notesList {
  max-height: 100vh;
  overflow-y: auto;
  padding-bottom: 20px;
  padding-right: 15px;
  scroll-behavior: smooth; /* animasi scroll halus */
}

/* === KONTAINER PENGATURAN === */
#pengaturanTab {
  background: rgba(0, 0, 50, 0.85);
  color: #00ffff;
  border: 2px solid #00ffff33;
  border-radius: 16px;
  box-shadow: 0 0 30px #00ffff44, 0 0 60px #00ccff22;
  padding: 20px;
  max-width: 1100px;
  margin: 30px auto;
  overflow-x: auto;
  font-weight: bold;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  transition: all 0.3s ease;
}

/* Judul utama */
#pengaturanTab h3 {
  margin-top: 0;
  font-size: 26px;
  color: #00FFFF;
  text-shadow: 0 0 6px #00ffff, 0 0 20px #00ccff;
  font-weight: bold;
  text-align: center;
  animation: neonPulse 2.5s infinite alternate;
}

/* Judul panel / accordion */
#pengaturanTab h4 {
  margin: 15px 0 5px 0;
  color: #80ffff;
  font-size: 20px;
  text-shadow: 0 0 6px #00ffff, 0 0 15px #00ccff;
  cursor: pointer;
  transition: all 0.3s ease;
  padding-left: 10px;
  border-left: 3px solid #00ffff44;
  border-radius: 6px;
}
#pengaturanTab h4:hover {
  color: #00ffff;
  text-shadow: 0 0 12px #00ffff, 0 0 28px #00ccff;
  border-left: 3px solid #00ffff;
  transform: translateX(2px);
  animation: neonPulse 1.5s infinite alternate;
}

/* Judul Kendala All */
#pengaturanTab h5.kendala-accordion {
  margin: 10px 0;
  padding: 10px 15px;
  background: rgba(0, 0, 0, 0.2);
  border: 1px solid #00ffff33;
  border-radius: 8px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.3s ease;
}

#pengaturanTab h5.kendala-accordion:hover {
  background: rgba(0, 0, 0, 0.4);
  transform: translateX(2px);
  box-shadow: 0 0 10px #00ffff22;
}

/* Panel tabel */
#pengaturanTab table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 6px;
  margin-bottom: 10px;
  background: rgba(0, 0, 50, 0.15);
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 0 6px #00ffff22 inset;
  transition: all 0.3s ease;
}

/* Table header & cells */
#pengaturanTab table th,
#pengaturanTab table td {
  padding: 10px;
  text-align: left;
  font-weight: bold;
  font-size: 14px;
  background: rgba(0, 0, 0, 0.2);
}

#pengaturanTab table th {
  color: #00ffff;
  text-shadow: 0 0 5px #00ccff;
  background: rgba(0, 0, 70, 0.25);
}

/* KOTAK TULISAN SESUAI ISI */
#pengaturanTab table td input {
  padding: 5px 8px;
  border: 1px solid #00ffff33;
  border-radius: 6px;
  background: rgba(0, 0, 50, 0.65);
  color: #00ffff;
  font-weight: bold;
  box-shadow: 0 0 4px #00ffff33 inset;
  word-wrap: break-word;
  white-space: normal; /* Normal untuk input satu baris */
  transition: all 0.3s ease;
  width: 100%;
  box-sizing: border-box;
}

#pengaturanTab table td input:focus {
  outline: none;
  box-shadow: 0 0 12px #00ffff88 inset, 0 0 8px #00ccff55;
  background: rgba(0, 0, 60, 0.85);
  animation: neonPulse 1.2s infinite alternate;
}

/* GAYA KHUSUS UNTUK DIV CONTENTEDITABLE */
.kendala-panel .editable-cell {
  width: 100%;
  min-height: 40px;
  padding: 8px;
  box-sizing: border-box;
  border: 1px solid #00ffff33;
  border-radius: 6px;
  background: rgba(0, 0, 50, 0.65);
  color: #00ffff;
  font-weight: bold;
  box-shadow: 0 0 4px #00ffff33 inset;
  cursor: text;
  word-wrap: break-word;
  white-space: pre-wrap; /* Solusi untuk mempertahankan format */
  transition: all 0.3s ease;
}

.kendala-panel .editable-cell:focus {
  outline: none;
  box-shadow: 0 0 12px #00ffff88 inset, 0 0 8px #00ccff55;
  background: rgba(0, 0, 60, 0.85);
  animation: neonPulse 1.2s infinite alternate;
}

#pengaturanTab table tr td:nth-child(2) input {
  min-width: 300px;
  max-width: 500px;
  width: auto;
  font-weight: bold;
  white-space: normal;
  overflow: visible;
  text-overflow: clip;
  white-space: pre-wrap;
}

#pengaturanTab table tr td:nth-child(1),td:nth-child(4),td:nth-child(5) input {
  min-width: 100px;
  max-width: 200px;
  width: auto;
  font-weight: bold;
  white-space: normal;
  overflow: visible;
  text-overflow: clip;
}

/* Tombol neon */
.row-save-btn {
  padding: 5px 12px;
  border-radius: 6px;
  border: none;
  background: linear-gradient(145deg, rgba(0, 255, 255, 0.4), rgba(0, 150, 255, 0.3));
  color: #00ffff;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 0 6px #00ffff66, 0 0 12px #00ccff44;
  transition: all 0.3s ease;
}
.row-save-btn:hover {
  background: rgba(0, 255, 255, 0.25);
  transform: scale(1.08);
  box-shadow: 0 0 18px #00ffffaa, 0 0 24px #00ccff88;
  animation: neonPulse 1.5s infinite alternate;
}

/* Panel tersembunyi */
.panel {
  display: none;
  padding: 6px 0;
  border-left: 2px solid #00ffff33;
  border-right: 2px solid #00ffff33;
  border-bottom: 2px solid #00ffff33;
  border-radius: 0 0 10px 10px;
  box-shadow: inset 0 0 6px #00ffff22;
  transition: all 0.3s ease;
  flex-wrap: nowrap;
}
.panel {
  flex-wrap: nowrap;
}
.panel table tr {
  flex-wrap: nowrap;
}
/* Panel kendala */
.kendala-panel {
  display: none;
  padding: 6px 0;
  margin-top: -10px;
  background: rgba(0, 0, 0, 0.1);
  border: 1px solid #00ffff1a;
  border-radius: 0 0 10px 10px;
  border-top: none;
  box-shadow: inset 0 0 6px #00ffff11;
  transition: all 0.3s ease;
}

@keyframes neonPulse {
  0% { text-shadow: 0 0 4px #00ffff, 0 0 10px #00ccff; }
  50% { text-shadow: 0 0 12px #00ffff, 0 0 20px #00ccff; }
  100% { text-shadow: 0 0 8px #00ffff, 0 0 18px #00ccff; }
}

/* Efek hover tombol */
.sidebar-container .neon-button:first-child:hover {
  background: rgba(0, 255, 255, 0.2);
  transform: scale(1.1);
  box-shadow: 0 0 15px #0ff, 0 0 30px #0cc;
}

/* Tooltip text */
.sidebar-container .neon-button .tooltip-text {
  visibility: hidden;
  width: 100px;
  background-color: rgba(0, 0, 50, 0.9);
  color: #0ff;
  text-align: center;
  border-radius: 6px;
  padding: 4px;
  font-size: 10px;
  font-weight: bold;
  text-shadow: 0 0 3px #0ff;
  position: absolute;
  left: 50px;
  top: 50%;
  transform: translateY(-50%);
  box-shadow: 0 0 8px #0ff77;
  z-index: 1000;
  white-space: nowrap;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.3s;
}
.sidebar-container .neon-button:first-child:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}

/* Tombol Pengaturan Togel bulat */
.sidebar-container .neon-button:first-child {
  width: 40px;          /* lebih kecil dari 60px */
  height: 40px;         /* lebih kecil dari 60px */
  border-radius: 50%;   /* tetap bulat */
  margin: 10px 0;       /* sedikit lebih rapat */
  border: 2px solid #0ff;
  background: rgba(0, 0, 50, 0.7);
  color: #0ff;
  font-size: 16px;      /* lebih kecil dari 24px */
  font-weight: bold;
  cursor: pointer;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 0 8px #0ff88, 0 0 15px #0ff44; /* sesuaikan efek neon */
  transition: all 0.3s ease;
  position: relative;
}
/* Container untuk tabel hadiah */
.hadiah-container {
  display: flex;
  flex-direction: column; /* setiap box muncul 1 di bawah 1 */
  gap: 16px;
  margin-top: 20px;
}

.hadiah-box {
  background: rgba(0, 10, 30, 0.85); /* gelap biru transparan */
  border: 1px solid #33ffff; /* biru neon */
  border-radius: 12px;
  box-shadow: 0 0 20px #33ffff; /* glow neon */
  padding: 16px;
  width: 100%; /* full lebar container */
  transition: all 0.3s ease;
}

.hadiah-box:hover {
  transform: translateY(-3px) scale(1.02);
  box-shadow: 0 0 35px #66ffff;
}

/* Details & Summary */
.hadiah-box details {
  border: 1px solid #33ffff;
  border-radius: 10px;
  margin-bottom: 8px;
  background: rgba(0,10,30,0.8);
  box-shadow: 0 0 15px #33ffff50;
  overflow: hidden;
  font-size: 16px; /* lebih besar */
}

.hadiah-box summary {
  list-style: none;
  cursor: pointer;
  padding: 12px 16px;
  color: #aaffff;
  text-align: center;
  text-shadow: 0 0 6px #33ffff;
  font-weight: bold;
  font-size: 18px; /* judul lebih besar */
}

.hadiah-box summary::-webkit-details-marker {
  display: none; /* hilangkan panah default */
}

/* Tabel di dalam box */
.hadiah-box table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 8px;
}

.hadiah-box th, .hadiah-box td {
  border: 1px solid rgba(255,255,255,0.1);
  padding: 8px 12px; /* lebih besar */
  font-size: 15px;
  color: #e0f7ff;
  text-align: center;
}

.hadiah-box th {
  background: rgba(0, 50, 100, 0.6);
  text-shadow: 0 0 4px #66ffff;
}

.hadiah-box td {
  background: rgba(0, 50, 100, 0.25);
}

/* Diskon */
.hadiah-box .diskon {
  text-align: center;
  font-weight: bold;
  color: #66ffff; /* biru neon */
  text-shadow: 0 0 2px #33ffff;
  font-size: 13px;
  margin-top: 4px;
}

.nav-button, .action-button {
    font-size: 16px;
    padding: 10px 20px;
    border: 1px solid #00ffff;
    background-color: transparent;
    color: #00ffff;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.nav-button:hover, .action-button:hover {
    background-color: #00ffff;
    color: #00FFFF;
    box-shadow: 0 0 15px #00ffff;
}

/* Gaya khusus untuk slider */
.zoom-slider-container input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    height: 8px;
    background: #001122;
    outline: none;
    border-radius: 5px;
}

.zoom-slider-container input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    background: #00ffff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 10px #00ffff;
}

/* ================== SCATTER / FREESPIN ================== */
.scatter-section {
  padding: 25px;
  max-width: 900px;
  margin: 40px auto;
  border-radius: 16px;
  border: 2px solid #00f7ff;
  box-shadow: 0 0 25px #00f7ff33;
  background: linear-gradient(145deg, #000a1f, #001a33);
  color: #00f7ff;
}

.scatter-section h2,
.scatter-section h3 {
  color: #00f7ff;
  text-shadow: 0 0 10px #00f7ff;
}

/* ================== BUTTON GROUP ================== */
.button-group {
  margin: 15px 0;
}

.btn {
  background-color: #1a1a1a;
  color: #00f7ff;
  border: 1px solid #00f7ff;
  padding: 10px 18px;
  margin-right: 10px;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.3s;
}

.btn:hover {
  background-color: #00f7ff;
  color: #00FFFF;
}

.btn.danger {
  border-color: #ff4d4d;
  color: #ff4d4d;
}

.btn.danger:hover {
  background-color: #ff4d4d;
  color: #00FFFF;
}

/* ================= FREESPIN / BUYSPIN ================= */
.freespin-section {
  background: rgba(0, 20, 40, 0.9);
  padding: 30px;
  border-radius: 20px;
  max-width: 750px;
  margin: 40px auto;
  border: 1px solid #00f7ff44;
  box-shadow: 0 0 30px #00f7ff33;
  transition: all 0.3s ease;
}

.freespin-title {
  text-align: center;
  font-size: 22px;
  font-weight: bold;
  color: #00ffff;
  text-shadow: 0 0 10px #00ffffaa, 0 0 20px #00ffff66;
  margin-bottom: 20px;
}

.freespin-textarea {
  width: 100%;
  min-height: 150px;
  background: #00122b;
  color: #00f7ff;
  border: 1.5px solid #00f7ff;
  border-radius: 14px;
  padding: 15px;
  font-family: monospace;
  font-size: 15px;
  box-shadow: inset 0 0 12px #00f7ff33;
  resize: vertical;
  transition: all 0.3s ease;
}

.freespin-textarea:focus {
  border-color: #00d4ff;
  box-shadow: 0 0 20px #00d4ff;
  outline: none;
}

.freespin-button-group {
  display: flex;
  justify-content: center;
  margin: 20px 0;
}

.freespin-btn {
  padding: 12px 22px;
  border-radius: 12px;
  font-weight: bold;
  font-size: 14px;
  cursor: pointer;
  border: none;
  background-color: #00ffff;
  color: #00FFFF;
  box-shadow: 0 0 12px #00ffff77;
  transition: all 0.3s ease;
}

.freespin-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px #00ffffaa;
}

.freespin-btn.danger {
  background-color: #ff4444;
  color: #00FFFF;
  box-shadow: 0 0 12px #ff4444aa;
}

.freespin-btn.danger:hover {
  background-color: #cc0000;
  box-shadow: 0 0 20px #ff4444aa;
}

.freespin-result {
  margin-top: 25px;
  padding: 20px;
  background: radial-gradient(circle at top left, rgba(0, 255, 255, 0.1), rgba(0, 20, 40, 0.9));
  border-radius: 16px;
  border: 2px solid #00ffff;
  box-shadow: inset 0 0 15px rgba(0, 255, 255, 0.15), 0 0 20px rgba(0, 255, 255, 0.25);
}

.freespin-result .hasil-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 14px;
}

.freespin-result label {
  width: 140px;
  font-weight: 600;
  color: #00ffffcc;
}

.freespin-result .hasil-text {
  flex: 1;
  background: #001528;
  color: #00f7ff;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid #00f7ff44;
  font-family: monospace;
  font-size: 15px;
  box-shadow: inset 0 0 6px #00f7ff33;
}

.freespin-image-preview {
  display: flex;
  gap: 20px;
  margin-top: 25px;
  padding: 16px;
  background: #00122b;
  border-radius: 16px;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
}

.gambar-slot {
  flex: 0 0 auto;
  width: 160px;
  text-align: center;
  background: #000c1f;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #00f7ff33;
  box-shadow: 0 0 12px #00f7ff33;
  scroll-snap-align: start;
}

.gambar-slot img {
  width: 100%;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 0 10px #00f7ff33;
}

.gambar-slot img:hover {
  transform: scale(1.08);
  box-shadow: 0 0 20px #00ffffaa;
}

.freespin-caption {
  font-size: 13px;
  color: #00f7ff;
  background: #001e2a;
  padding: 6px 10px;
  border-radius: 8px;
  text-shadow: 0 0 6px #00f7ff88;
  box-shadow: inset 0 0 6px #00f7ff22;
}
/* ================== HASIL WRAPPER ================== */
.hasil-wrapper,
.freespin-result {
  margin-top: 20px;
  padding: 15px;
  background: #000f22;
  border-radius: 12px;
  box-shadow: inset 0 0 10px #00f7ff22;
}

.hasil-item {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
}

.hasil-item label {
  flex: 0 0 130px;
  color: #00FFFFcc;
  font-weight: 600;
}

.hasil-text {
  flex: 1;
  background: #001e2a;
  color: #00f7ff;
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid #00f7ff44;
  font-family: monospace;
  font-size: 15px;
  box-shadow: inset 0 0 5px #00f7ff;
  word-break: break-word;
}

/* ================== COPY BUTTON ================== */
.copy-btn {
  background-color: #222;
  border: 1px solid #00f7ff;
  color: #00f7ff;
  border-radius: 6px;
  cursor: pointer;
  padding: 5px 10px;
  font-size: 14px;
  transition: 0.3s;
}

.copy-btn:hover {
  background-color: #00f7ff;
  color: #00FFFF;
}

/* ================== GAMBAR SLOT ================== */
.gambar-container,
.freespin-image-preview {
  display: flex;
  gap: 18px;
  margin-top: 25px;
  padding: 14px;
  background: var(--bg-input-dark);
  border-radius: 12px;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  box-shadow: 0 0 18px #00f7ff22;
}

.gambar-slot {
  flex: 0 0 auto;
  width: 150px;
  text-align: center;
  background: #00FFFF;
  padding: 10px;
  border: 1.5px solid #00f7ff55;
  border-radius: 10px;
  box-shadow: 0 0 10px #00f7ff33;
  scroll-snap-align: start;
}

.gambar-slot h4 {
  margin-bottom: 5px;
  font-size: 15px;
  color: #00f7ff;
}

.gambar-slot img {
  width: 100%;
  border-radius: 8px;
  display: block;
  margin-bottom: 6px;
  cursor: pointer;
  box-shadow: 0 0 10px #00f7ff33;
  transition: 0.3s;
}

.gambar-slot img:hover {
  transform: scale(1.05);
  box-shadow: 0 0 16px #00f7ffcc;
}

.freespin-caption,
#caption1, #caption2, #caption3 {
  font-size: 13px;
  background: #001e2a;
  color: #00f7ff;
  padding: 5px 8px;
  border-radius: 6px;
  text-shadow: 0 0 6px #00f7ff88;
  box-shadow: inset 0 0 4px #00f7ff22;
}

.nav-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 32px;
  color: #00f7ff;
  background: none;
  border: none;
  cursor: pointer;
  padding: 10px;
}

 .lightbox-caption {
            color: #ccc;
            font-size: 1.2em;
            text-align: center;
            padding: 10px 0;
            height: 150px; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; 
        }
        
        .btn-add-new {
    background-color: #17a2b8; 
    color: #00FFFF;
}
.btn-add-new:hover {
    background-color: #138496;
    box-shadow: 0 0 10px rgba(23, 162, 184, 0.7);
}

.btn-tambah-baris-bottom {
    /* Dimensi & Tata Letak */
    background: linear-gradient(145deg, rgba(72, 61, 139, 0.6), rgba(0, 0, 139, 0.4)); /* Gradasi dasar ungu/biru gelap */
    color: #00ffff; /* Warna teks Biru Muda Neon */
    font-weight: bold;
    font-size: 1.1em;
    padding: 12px 25px; /* Padding lebih besar */
    border: 2px solid #00ffff55; /* Border tipis neon */
    border-radius: 12px; /* Sudut lebih melengkung */
    cursor: pointer;
    
    /* Efek Neon */
    box-shadow: 0 0 10px #8a2be288, 0 0 20px #00ffff44; /* Gabungan ungu dan cyan glow */
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
}

.btn-tambah-baris-bottom:hover {
    background: linear-gradient(145deg, rgba(72, 61, 139, 0.8), rgba(0, 0, 139, 0.6));
    border-color: #00ffff;
    transform: scale(1.05); /* Sedikit membesar saat dihover */
    box-shadow: 0 0 15px #8a2be2, 0 0 30px #00ffffaa; /* Glow lebih kuat */
}

.btn-tambah-baris-bottom::before {
    /* Pastikan ikon plus (+) terlihat neon */
    color: #ff00ff; /* Warna ungu/pink untuk ikon, seperti di gambar */
    margin-right: 8px;
    font-size: 1.2em;
    font-weight: bolder;
    text-shadow: 0 0 5px #ff00ff;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}
#reportSearch {
    flex-grow: 1;
    padding: 10px 15px;
    margin-right: 15px;
    background-color: #2c2c2c;
    color: #f0f0f0;
    border: 1px solid #00ffff; 
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.3s, box-shadow 0.3s;
}
#reportSearch:focus {
    outline: none;
    border-color: #00ffaa;
    box-shadow: 0 0 10px rgba(0, 255, 170, 0.5);
}

.report-card {
    background-color: #242424; 
    border-radius: 12px;
    margin-bottom: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    overflow: hidden;
    border: 1px solid #333; 
    transition: all 0.2s ease-in-out;
}

.report-card:hover {
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6), 0 0 15px rgba(0, 255, 255, 0.1);
}

.card-accordion-title {
    display: flex;
    justify-content: flex-start; 
    align-items: center;
    padding: 15px 20px;
    margin: 0;
    font-size: 1.1em;
    font-weight: 600;
    color: #00FFFF;
    cursor: pointer;
    background-color: #2c2c2c;
    border-bottom: 1px solid #333;
    transition: background-color 0.2s;
    font-weight: bold;
}

.card-accordion-title:hover {
    background-color: #383838;
    font-weight: bold;
}

.card-content-panel {
    padding: 20px;
    border-top: none;
    background-color: #242424;
}

/* Grup Field (Label + Control) */
.report-field-group {
    margin-bottom: 15px;
    padding: 10px;
    border: 1px solid #333;
    border-radius: 8px;
    background-color: #1e1e1e;
}
.report-field-group label {
    display: block;
    margin-bottom: 5px;
    font-size: 0.9em;
    font-weight: bold;
    color: #00ffff; /* Label warna neon */
}

.report-display-value {
    white-space: pre-wrap;
    word-break: break-word;
    min-height: 25px;
    padding: 8px 10px;
    background-color: #2c2c2c;
    border-radius: 5px;
    border: 1px solid #444;
    color: #00FFFF;
    font-size: 0.95em;
    font-weight: bold;
}

.report-edit-input {
    width: 100%;
    box-sizing: border-box;
    padding: 10px;
    background-color: #2c2c2c;
    color: #00FFFF;
    border: 1px solid #00ffff; 
    border-radius: 5px;
    resize: none; 
    min-height: 50px;
}
.report-edit-input:focus {
    outline: none;
    border-color: #00ffaa;
    box-shadow: 0 0 5px rgba(0, 255, 170, 0.7);
}

.neon-divider {
    border: none;
    height: 1px;
    background-color: #00ffff; 
    box-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
    margin: 20px 0;
}

.report-display-value.small-field {
    min-height: 15px; 
    padding: 6px 10px; 
    font-size: 0.9em;
    font-weight: bold;
}

.report-edit-input.small-field {
    min-height: 35px; 
    font-size: 0.9em; 
    padding: 8px;
}

.btn-action {
    padding: 8px 15px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.2s, color 0.2s, box-shadow 0.2s;
    margin-top: 5px;
}
.action-buttons-group {
    display: flex;
    flex-wrap: wrap;
    margin-top: 10px;
}

.btn-copy-large, .btn-copy-small {
    padding: 8px 15px;
    border-radius: 5px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
    background-color: #1a1a1a; 
    color: #00ffff; 
    border: 1px solid #00ffff;
    
    box-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
}

.btn-copy-large:hover, .btn-copy-small:hover {
    background-color: #00ffff; 
    color: #1a1a1a; 
    box-shadow: 0 0 15px #00ffff; 
    transform: translateY(-1px);
}

.btn-save {
    background-color: #007bff; 
    color: #00FFFF;
}
.btn-save:hover {
    background-color: #0056b3;
    box-shadow: 0 0 10px rgba(0, 123, 255, 0.7);
}

.btn-edit {
    background-color: #ffc107; 
    color: #1a1a1a;
}
.btn-edit:hover {
    background-color: #e0a800;
    box-shadow: 0 0 10px rgba(255, 193, 7, 0.7);
}

/* Button Cancel */
.btn-cancel {
    background-color: #dc3545; 
    color: #00FFFF;
}
.btn-cancel:hover {
    background-color: #c82333;
    box-shadow: 0 0 10px rgba(220, 53, 69, 0.7);
}

#reportLineCardContainer {
  max-height: 100vh;
  overflow-y: auto;
  padding-bottom: 20px;
  padding-right: 15px;
  scroll-behavior: smooth; /* animasi scroll halus */
}

#reportLineCardContainer::-webkit-scrollbar {
  width: 10px;
}

#reportLineCardContainer::-webkit-scrollbar-track {
  background: rgba(0, 0, 20, 0.3);
  border-radius: 10px;
  box-shadow: inset 0 0 6px rgba(0,255,255,0.1);
}

#reportLineCardContainer::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, #00f0ff, #0044ff);
  border-radius: 10px;
  box-shadow: 0 0 12px #00f0ff55, 0 0 18px #0044ff55;
  transition: all 0.3s ease;
}

#reportLineCardContainer::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(180deg, #00ffff, #0055ff);
  box-shadow: 0 0 18px #00ffffaa, 0 0 28px #0055ff55;
  transform: scaleX(1.2);
}

</style>
</head>
<body class="bg-default">
<!-- === KONTAINER: SIDEBAR + KONTEN === -->
<div class="main-container">

  <!-- === SIDEBAR MENU === -->
  <div class="sidebar-container">

<!-- Tombol Pengaturan Togel -->
<button class="neon-button" onclick="showTab('pengaturanTab', this); openPengaturan()">
  ⚙️
  <span class="tooltip-text">Pengaturan Togel</span>
</button>
    <!-- Logo / Judul -->
  <div class="sidebar-brand">
    <div class="planet-icon">
      <svg viewBox="0 0 64 64" width="48" height="48">
        <circle cx="32" cy="32" r="12" fill="#0ff" />
        <ellipse cx="32" cy="32" rx="20" ry="8" fill="none" stroke="#0ff" stroke-width="2">
          <animateTransform attributeName="transform" attributeType="XML" type="rotate" from="0 32 32" to="360 32 32" dur="8s" repeatCount="indefinite"/>
        </ellipse>
      </svg>
    </div>
    <h2>LINE<span style="color:#0ff;">TOGEL</span></h2>
  </div>
    <!-- Pilih Background -->
    <div class="background-switcher">
      <select onchange="setBackground(this.value)">
        <option value="bg-default">🌌 LINE TOGEL</option>
        <option value="bg-gradient">💀 Darkgray</option>
        <option value="bg-deepspace">🪐 GOKU</option>
      </select>
    </div>
    <!-- Jam Digital -->
    <div id="clock">00:00:00</div>

  <!-- Pencarian -->
  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="🔍 Cari catatan..." oninput="searchNotes()" />
  </div>

    <!-- Tombol Navigasi Folder -->
<button class="neon-button" onclick="loadNotes('DEPOSIT'); showTab('catatanTab', this)">
  <i class="fas fa-rocket"></i>
  <span>DEPOSIT</span>
</button>
<button class="neon-button" onclick="loadNotes('WITHDRAW'); showTab('catatanTab', this)">
  <i class="fas fa-wallet"></i>
  <span>WITHDRAW</span>
</button>
<button class="neon-button" onclick="loadNotes('GANGGUAN'); showTab('catatanTab', this)">
  <i class="fas fa-exclamation-triangle"></i>
  <span>GANGGUAN</span>
</button>
<button class="neon-button" onclick="loadNotes('KENDALA ALL'); showTab('catatanTab', this)">
  <i class="fas fa-headset"></i>
  <span>KENDALA ALL</span>
</button>
<button class="neon-button" onclick="loadNotes('FOTO'); showTab('catatanTab', this)">
  <i class="fas fa-camera"></i>
  <span>FOTO</span>
</button>
<button class="neon-button" onclick="loadNotes('CARA BERMAIN'); showTab('catatanTab', this)">
  <i class="fas fa-book-open"></i>
  <span>CARA BERMAIN</span>
</button>
<button class="neon-button" onclick="loadNotes('PROMO'); showTab('catatanTab', this)">
  <i class="fas fa-gift"></i>
  <span>PROMO</span>
</button>
<button class="neon-button" onclick="loadPasaranTogel(); loadCaraHitungTogel(); showTab('prediksiGabungTab', this)">
  <i class="fas fa-bullseye"></i>
  <span>PREDIKSI & HITUNG TOGEL</span>
</button>
<button class="neon-button" onclick="showTab('cekBonusEventTab', this)">
  <i class="fas fa-gem"></i>
  <span>CEK BONUS EVENT</span>
</button>
<button class="neon-button" onclick="showHadiahTab(); showTab('cekhadiahTab', this)">
  <i class="fas fa-medal"></i>
  <span>HADIAH TOGEL</span>
</button>
<button class="neon-button" onclick="loadReportLineData(); showTab('reportLineTab', this)">
    <i class="fas fa-file-alt"></i>
    <span>REPORT LINE</span>
</button>

  </div>

<!-- === TAB: CATATAN UTAMA === -->
<div id="catatanTab" class="tab-content" style="display: block;">
  <div class="main">
    <h3 id="judulCatatan" class="judul-glow">💫 LINE TOGEL 💫</h3>
  </div>

  <div id="notesHeader" style="margin-bottom: 50px; font-weight: bold; font-size: 16px; color: #00ffff;">
    💫 <span style="text-shadow: 0 0 5px #00ffff;">Daftar Catatan:</span>
  </div>

  <div id="notesList"><strong>LINE TOGEL</strong></div>
</div>

<!-- Lightbox -->
<div id="lightbox" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); z-index: 10000; flex-direction: column; justify-content: center; align-items: center;">

    <div onclick="hideLightbox()" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: pointer;"></div>

    <div style="position: relative; display: flex; flex-direction: column; align-items: center; max-width: 95%; max-height: 95%;">

        <span onclick="hideLightbox()" style="position: absolute; top: -30px; right: -20px; font-size: 40px; color: #00FFFF; cursor: pointer; text-shadow: 0 0 10px #00ffff;">&times;</span>

        <img id="lightboxImg" src="" alt="Preview Zoom" style="max-width: 100%; max-height: 80vh; transition: transform 0.3s ease; cursor: grab;">

        <div style="margin-top: 20px; display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 15px;">
            <button onclick="changeLightbox(-1)" class="nav-button">Prev</button>
            <button onclick="copyPhotoFromLightbox()" class="action-button">Copy Foto</button>
            <button onclick="changeLightbox(1)" class="nav-button">Next</button>
        </div>

        <div class="zoom-slider-container" style="width: 250px; margin-top: 15px;">
            <input id="zoomSlider" type="range" min="0.5" max="3" step="0.1" value="1" style="width: 100%;">
        </div>
        
    </div>
</div>
  <!-- === TAB: PREDIKSI & HITUNG TOGEL (GABUNGAN) === -->
  <div id="prediksiGabungTab" class="tab-content" style="display: none;">
          <h3 id="judulCatatan" class="judul-glow">💫 LINE TOGEL 💫</h3>
    <!-- Input Link Gambar -->
    <div style="margin-top: 30px; background-color: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px;">
      <label for="membacaIsiFoto_input" style="color:#00ffff;">🔗 Link Gambar:</label>
      <input type="text" id="membacaIsiFoto_input" placeholder="Tempel link gambar di sini..." 
             oninput="membacaIsiFoto_prosesLink()" 
             style="width: 100%; margin-bottom: 10px; padding: 8px; border-radius: 8px;">
    </div>

    <!-- Modal -->
    <div id="membacaIsiFoto_modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.95); z-index:9999; justify-content:center; align-items:center; flex-direction:row; gap:20px; padding:20px; box-sizing: border-box;">
      <!-- Tombol Close -->
      <div id="membacaIsiFoto_tombolTutup" onclick="membacaIsiFoto_tutup()" 
           style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
                  font-size: 28px; color: #00ffff; cursor: pointer; user-select: none;
                  font-weight: bold; text-shadow: 0 0 6px cyan; z-index: 10000;">
        ✖
      </div>
      <!-- Gambar -->
      <div style="flex: 1; display: flex; justify-content: center; align-items: center;">
        <img id="membacaIsiFoto_gambar" src="" style="max-width: 90%; max-height: 90vh; border-radius: 10px; box-shadow: 0 0 20px cyan;">
      </div>
      <!-- Hasil OCR -->
      <div id="membacaIsiFoto_hasil" style="flex: 1; color:#00ffff; font-family:monospace; font-weight:bold; white-space:pre-wrap; background:rgba(0,20,40,0.8); border-radius:12px; padding:16px; box-shadow:0 0 15px cyan; max-height:90vh; overflow-y:auto; font-size:14px;">
        <i>Menunggu gambar...</i>
      </div>
    </div>

    <!-- Bagian Hitungan -->
    <h2>🧮 Hitung Togel</h2>

    <div class="nominal-group">
      <label>Nominal Bettingan:</label>
      <input type="number" id="nominalInput" />
      <button onclick="updateNominalTogel()">Simpan</button>
    </div>

    <select id="kelompokDropdown" class="hitung-dropdown" onchange="isiDropdownLabel()">
      <option value="">-- Pilih Tipe Hitungan --</option>
    </select>

    <select id="labelDropdown" class="hitung-dropdown" onchange="tampilkanValueHitungan()">
      <option value="">-- Pilih Label --</option>
    </select>

    <div id="detailHitunganDropdown"></div>

    <hr style="margin: 30px 0; border-color: #00ffff;">

    <!-- Bagian Prediksi -->
    <div class="pasaran-container">
      <h2 class="pasaran-title">🌠 PREDIKSI TOGEL</h2>

      <input type="text" id="searchPasaran" class="pasaran-search" placeholder="Cari prediksi atau jadwal..." oninput="searchDropdowns()" />
      <button id="btnToggleTanggal" class="btn-toggle-tanggal" onclick="toggleTanggalPasaran()">Ganti Tanggal</button>

      <div id="formTanggal" class="form-tanggal">
        <input type="date" id="tanggalPasaran" class="input-tanggal" />
        <button onclick="simpanTanggalPasaran()" class="btn-simpan-tanggal">Simpan</button>
      </div>

      <div style="display: flex; justify-content: space-between; gap: 20px; margin-top: 20px;">
        <div style="flex: 1;">
          <label class="pasaran-title" style="color: #00ffff;">🌌 PREDIKSI TOGEL</label>
          <select id="dropdownPrediksi" class="pasaran-dropdown" onchange="showDetail('prediksi')"></select>
          <div id="detailPrediksi" class="dropdown-detail" onclick="copyToClipboardDetail(this)"></div>
        </div>
        <div style="flex: 1;">
          <label class="pasaran-title" style="color: #00ffff;">🪐 JADWAL TOGEL</label>
          <select id="dropdownJadwal" class="pasaran-dropdown" onchange="showDetail('jadwal')"></select>
          <div id="detailJadwal" class="dropdown-detail" onclick="copyToClipboardDetail(this)"></div>
        </div>
      </div>
    </div>
  </div>

<!-- ================= TAB CEK BONUS EVENT ================= -->
<div id="cekBonusEventTab" class="tab-content" style="display: none;">

  <!-- ================= BONUS EVENT ================= -->
  <div class="bonus-section">
    <h2 class="bonus-title">💎 CEK BONUS EVENT</h2>

    <textarea id="bonusTextarea" class="bonus-textarea" placeholder="Tempelkan data transaksi di sini..."></textarea>

    <div class="bonus-input-group">
      <label for="bonusPatokan" class="bonus-label">Nilai Patokan:</label>
      <input type="text" id="bonusPatokan" class="bonus-input" placeholder="Contoh: 5000000">
    </div>

    <div class="bonus-input-group">
      <label for="bonusSurplus" class="bonus-label">Nilai Surplus:</label>
      <input type="text" id="bonusSurplus" class="bonus-input" placeholder="Contoh: 1500000">
    </div>

    <div class="bonus-button-group">
      <button onclick="hitungBonusEvent()" class="bonus-btn">🔍 Hitung Bonus</button>
      <button onclick="hapusBonusEvent()" class="bonus-btn danger">🧹 Bersihkan</button>
    </div>

    <div id="bonusHasil" class="bonus-result"></div>

    <label for="imageUrl" style="color:#00ffff; margin-top:10px;">🔗 Link Gambar Transaksi:</label>
    <input type="text" id="imageUrl" class="bonus-input" placeholder="Tempel link gambar di sini..." style="width: 100%;">
  </div>

  <!-- ================= MODAL ZOOM ================= -->
  <div id="zoomModal" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.95); z-index: 9999; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box;">
    
    <div id="closeZoomBtn" onclick="closeZoom()" style="position: absolute; top: 20px; right: 30px; font-size: 28px; color: #00ffff; cursor: pointer; user-select: none; font-weight: bold; text-shadow: 0 0 6px cyan;">&times;</div>

    <div style="display: flex; flex: 1; width: 100%; gap: 20px; align-items: center; justify-content: center;">
      <div style="flex: 1; display: flex; justify-content: center; align-items: center;">
        <img id="zoomedImage" src="" style="max-width: 90%; max-height: 80vh; border-radius: 10px; box-shadow: 0 0 20px cyan;">
      </div>

      <div id="kodeHasilZoom" style="flex: 1; color: #00ffff; font-family: monospace; font-weight: bold; white-space: pre-wrap; background: rgba(0,20,40,0.8); border-radius: 12px; padding: 16px; box-shadow: 0 0 15px cyan; max-height: 80vh; overflow-y: auto; font-size: 14px;"></div>
    </div>

    <div style="margin-top: 15px; width: 80%;">
      <input type="text" id="imageUrlZoom" placeholder="Tempel link gambar di sini..." 
             style="width: 100%; padding: 8px; border-radius: 6px; border: 1px solid cyan; background: rgba(0,20,40,0.9); color: #00ffff; font-size: 14px; text-align: center;">
    </div>
  </div>
<div id="lightboxModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9998; flex-direction: column; justify-content: center; align-items: center;">
  <span onclick="closeLightbox()" style="position: absolute; top: 20px; right: 30px; font-size: 28px; color: #00FFFF; cursor: pointer; user-select: none;">&times;</span>
  <img id="lightboxImage" src="" style="max-width: 90%; max-height: 90%; border-radius: 10px; box-shadow: 0 0 20px #00FFFF;">
  <div>
    <button onclick="prevImage()" style="font-size: 16px; padding: 10px 20px; border: 1px solid #00FFFF; background: rgba(255,255,255,0.1); color: #00FFFF; cursor: pointer; border-radius: 5px; margin-top: 20px;">Prev</button>
    <button onclick="nextImage()" style="font-size: 16px; padding: 10px 20px; border: 1px solid #00FFFF; background: rgba(255,255,255,0.1); color: #00FFFF; cursor: pointer; border-radius: 5px; margin-left: 10px; margin-top: 20px;">Next</button>
  </div>
</div>
  <!-- ================= SCATTER MAHJONG ================= -->
<div class="container">
    <div class="scatter-section" style="margin-top: 40px;">
        <h3 class="judul-glow">💫 LINE TOGEL 💫</h3>
        <h2>💣 DATA SCATTER MAHJONG</h2>

        <textarea id="scatterTextarea" class="input-textarea" 
                  onpaste="setTimeout(hitungScatter, 50)" oninput="hitungScatter()"
                  placeholder="Tempelkan data transaksi di sini..."></textarea>

        <div class="button-group">
            <button onclick="hapusScatter()" class="btn danger">🧹 Hapus</button>
        </div>

        <div id="hasilScatter" class="hasil-wrapper">
            <div class="hasil-item"><label>User ID :</label><div class="hasil-text" id="hasilUserID">-</div><button onclick="copyText('hasilUserID')" class="copy-btn">💫</button></div>
            <div class="hasil-item"><label>Kode Tiket :</label><div class="hasil-text" id="hasilKodeTiket">-</div><button onclick="copyText('hasilKodeTiket')" class="copy-btn">💫</button></div>
            <div class="hasil-item"><label>Link Bukti :</label><div class="hasil-text" id="hasilLinkBukti">-</div><button onclick="copyText('hasilLinkBukti')" class="copy-btn">💫</button></div>
            <div class="hasil-item"><label>Bettingan :</label><div class="hasil-text" id="hasilBettingan">-</div><button onclick="copyText('hasilBettingan')" class="copy-btn">💫</button></div>
        </div>

        <div class="gambar-container">
            <div class="gambar-slot">
                <h4>Gambar 1</h4>
                <img id="gambar1" src="" style="display:none;" onclick="openLightbox()" /> 
                <div id="caption1">-</div>
            </div>
            <div class="gambar-slot">
                <h4>Gambar 2</h4>
                <img id="gambar2" src="" style="display:none;" onclick="openLightbox()" />
                <div id="caption2">-</div>
            </div>
            <div class="gambar-slot">
                <h4>Gambar 3</h4>
                <img id="gambar3" src="" style="display:none;" onclick="openLightbox()" />
                <div id="caption3">-</div>
            </div>
        </div>
    </div>
</div>

<div id="lightboxModal" class="lightbox-modal">
    <span class="close-btn" onclick="closeLightbox()">&times;</span>
    <div class="lightbox-content">
        <div id="imageLoader" class="loader"></div>
        <img id="lightboxImage" src="" style="width:100%; display:none;" onmousemove="zoomImage(event)" onmouseout="resetZoom()">
    </div>
    <div class="lightbox-caption">
        <div id="lightboxCaptionText">User ID: - | Status: Loading Gambar Gabungan...</div>
        <div class="zoom-display-container">
            <img id="zoomDisplay" src="">
        </div>
    </div>
</div>

</div>
<!-- === STICKY NOTE FAB & PANEL === -->
<div id="stickyFab" onclick="toggleStickyPanel()">💀</div>
<div id="stickyPanel">
  <textarea id="stickyInput" placeholder="Tulis Sticky Note..." oninput="autoResize(this)"></textarea>
<button id="addStickyBtn" onclick="addSticky()">➕ Tambah Sticky</button>
  <div id="stickyList"></div>
</div>

<!-- Modal pengaturan -->
<div id="pengaturanTab" class="tab-content">
  <h3>Pengaturan Togel</h3>
  <div id="contentPengaturan"></div>
</div>

<!-- Tab Hadiah Togel -->
<div id="cekhadiahTab" class="tab-content" style="display:none;">
  <h3>💎 HADIAH TOGEL</h3>
  <div id="hadiahContainer" class="hadiah-container"></div>
</div>

<div id="reportLineTab" class="tab-content" style="display: none;">
    
    <h3 class="judul-glow">💫 LINE TOGEL 💫</h3>
    
    <div class="report-controls-top">
        <input type="text" id="reportSearch" class="search-input-report" placeholder="🔍 Cari di semua kolom..." oninput="searchReportLine()" />
    </div>
    
    <div class="report-card-container" id="reportLineCardContainer">
        <p style="text-align:center; color:#00ffff;">⏳ Memuat data...</p>
    </div>
    
    <div class="report-controls-bottom">
        <button onclick="addNewReportRow()" class="btn-tambah-baris-bottom">➕ Tambah Baris Kosong</button>
    </div>
</div>

<!-- Toast -->
<div id="toastNotif" 
     style="position:fixed;bottom:20px;right:20px;z-index:9999;
            background:rgba(0,255,255,0.85);color:#003;
            padding:8px 14px;border-radius:8px;display:none;
            box-shadow:0 0 10px #00ffffaa;">
  Berhasil
</div>

</body>
<script>

function setBackground(type) {
    if (type) {
        document.body.className = type;
        localStorage.setItem('backgroundTheme', type);
    }
}

window.onload = function() {
    const saved = localStorage.getItem('backgroundTheme');
    if (saved) {
        setBackground(saved);
        const select = document.querySelector('select');
        if (select) select.value = saved;
    } else {
        setBackground('bg-default');
    }
};

// Mengambil elemen jam sekali saja untuk efisiensi
const clockElement = document.getElementById('clock');

/**
 * Memperbarui tampilan jam dan tanggal digital.
 */
function updateClock() {
    const now = new Date();

    // Opsi untuk Tanggal: Hari, Tanggal, Bulan (LENGKAP)
    const dateOptions = {
        weekday: 'long',  // Hari lengkap (misal: Senin)
        day: '2-digit',   // Tanggal (misal: 13)
        month: 'long',    // Bulan lengkap (misal: Oktober)
        year: 'numeric'   // Ditambahkan: Tahun (misal: 2025)
    };
    
    // Opsi untuk Waktu: Jam, Menit, Detik (24-jam format)
    const timeOptions = {
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
    };

    const dateStr = now.toLocaleDateString('id-ID', dateOptions);
    // Output: "16:38:56"
    const timeStr = now.toLocaleTimeString('id-ID', timeOptions);

    clockElement.innerHTML = `
        <span class="date-display">${dateStr}</span>
        <span class="time-display">${timeStr}</span>
    `;

    if (now.getSeconds() % 2 === 0) {
        clockElement.classList.add('active-glow');
    } else {
        clockElement.classList.remove('active-glow');
    }
}

updateClock();
setInterval(updateClock, 1000);

function showToast(msg) {
    const toast = document.createElement("div");
    toast.textContent = msg;
    toast.style.position = "fixed";
    toast.style.bottom = "100px";
    toast.style.right = "30px";
    toast.style.background = "#00ffff";
    toast.style.color = "#000";
    toast.style.padding = "8px 12px";
    toast.style.borderRadius = "6px";
    toast.style.boxShadow = "0 0 10px #00ffff";
    toast.style.fontWeight = "bold";
    toast.style.zIndex = 9999;
    toast.style.transition = "opacity 0.5s";
    toast.style.opacity = "1";

    document.body.appendChild(toast);

    setTimeout(() => {
        toast.style.opacity = "0";
        setTimeout(() => toast.remove(), 500);
    }, 2000);
}

function showTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
    const tab = document.getElementById(tabId);
    if (tab) tab.style.display = 'block';
}

function copyText(text) {
    navigator.clipboard.writeText(text).then(() => {
        showToast("✅ Disalin ");
    });
}

function copyToClipboard(text) {
    navigator.clipboard.writeText(text)
        .then(() => showToast("✅ Disalin"))
        .catch(() => showToast("Gagal menyalin catatan"));
}

function capitalize(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
}

// ===================================
// === MANAJEMEN TAB ===
// ===================================
function hideAllTabs() {
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });
}

function showTab(tabName) {
    const tabs = document.querySelectorAll(".tab-content");
    const buttons = document.querySelectorAll(".neon-button");

    tabs.forEach(tab => tab.style.display = "none");
    buttons.forEach(btn => btn.classList.remove("active"));

    const tabMap = {
        catatan: "catatanTab",
        prediksiGabung: "prediksiGabungTab",
        cekbonusevent: "cekBonusEventTab",
        pengaturan: "pengaturanTab",
        cekhadiah: "cekhadiahTab"
    };

    const tabId = tabMap[tabName];
    if (tabId) {
        const tabElement = document.getElementById(tabId);
        if (tabElement) {
            tabElement.style.display = "block";
        }

        buttons.forEach(btn => {
            if (btn.getAttribute("onclick") ?.includes(tabName)) {
                btn.classList.add("active");
            }
        });
    }
}

// ===================================
// === FUNGSI CATATAN & FOTO ===
// ===================================
let currentFolder = 'DEPOSIT';
let allNotes = [];

function renderNotesList(filteredNotes) {
    const container = document.getElementById('notesList');
    if (!filteredNotes || filteredNotes.length === 0) {
        container.innerHTML = '<i>Tidak ada catatan ditemukan.</i>';
        renderNoteDetail(null);
        return;
    }

    container.innerHTML = '';

    filteredNotes.forEach(note => {
        const div = document.createElement('div');
        div.className = 'note-item';

        const title = document.createElement('h3');
        title.className = 'note-title';
        title.textContent = note.judul || note.title || 'Tanpa Judul';

        const preview = document.createElement('div');
        preview.className = 'note-content-preview';
        const contentText = note.content || note.content1 || '';
        preview.textContent = contentText.length > 100 ? contentText.substring(0, 100) + '...' : contentText;

        div.onclick = () => renderNoteDetail(note);

        div.appendChild(title);
        div.appendChild(preview);
        container.appendChild(div);
    });
}

function loadNotes(folder) {
    currentFolder = folder;

    document.querySelectorAll('.folder-content').forEach(el => {
        el.style.display = 'none';
    });

    const folderContent = document.getElementById(folder + 'Content');
    if (folderContent) {
        folderContent.style.display = 'block';
    }

    document.getElementById('judulCatatan').textContent = `💫======: ${folder}`;
    document.getElementById('notesHeader').innerHTML = `Menampilkan folder: ${folder}`;
    document.getElementById('notesList').innerHTML = 'Memuat catatan...';

    showTab('catatanTab');

    google.script.run.withSuccessHandler(renderNotes).getNotes(folder);
}

function addNoteToSticky(contents) {
    let stickies = JSON.parse(localStorage.getItem("stickies") || "[]");
    let addedCount = 0;

    contents.forEach(content => {
        // Hanya tambahkan konten yang tidak kosong
        if (content && content.trim() !== '') {
            stickies.push({
                text: content.trim(),
                image: null
            });
            addedCount++;
        }
    });

    if (addedCount > 0) {
        localStorage.setItem("stickies", JSON.stringify(stickies));
        showToast(`✅ ${addedCount} catatan ditambahkan ke Sticky Notes!`);
    } else {
        showToast("❗ Tidak ada catatan yang bisa ditambahkan.");
    }
}

// Fungsi untuk menyalin gambar dari URL ke clipboard
async function copyPhotoFromLightbox() {
    const lightboxImg = document.getElementById('lightboxImg');
    if (!lightboxImg || !lightboxImg.src) {
        showToast('❗ Gagal: Gambar tidak ditemukan.');
        return;
    }
    const url = lightboxImg.src;

    try {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error(`Gagal mengambil gambar: ${response.statusText}`);
        }
        const blob = await response.blob();
        await navigator.clipboard.write([
            new ClipboardItem({
                [blob.type]: blob
            })
        ]);
        showToast('✅ Foto berhasil disalin!');
    } catch (err) {
        console.error('Gagal menyalin foto:', err);
        showToast('❗ Gagal menyalin foto. Pastikan URL valid dan browser Anda mendukung fitur ini.');
    }
}

// Fungsi untuk menampilkan lightbox (mode zoom)
function showLightbox(src) {
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightboxImg');
    if (!lightbox || !lightboxImg) {
        console.error('Elemen lightbox tidak ditemukan di HTML.');
        return;
    }

    lightboxImg.src = src;
    lightbox.style.display = 'flex'; 
}

// Fungsi untuk menyembunyikan lightbox (mode zoom)
function hideLightbox() {
    const lightbox = document.getElementById('lightbox');
    if (lightbox) {
        lightbox.style.display = 'none';
    }
}

// Perbarui fungsi renderNotes
function renderNotes(notes) {
    allNotes = notes;
    const container = document.getElementById('notesList');
    container.innerHTML = '';
    container.className = '';

    if (notes.length === 0) {
        container.innerHTML = '<p><i>Tidak ada catatan.</i></p>';
        return;
    }

    if (currentFolder === "FOTO") {
        container.className = 'foto-gallery';
        container.innerHTML = '';

        notes.forEach(note => {
            const card = document.createElement('div');
            card.className = 'foto-card';

            const img = document.createElement('img');
            img.src = note.content;
            img.alt = note.title;
            img.onclick = () => showLightbox(note.content);
            img.onerror = () => img.style.display = 'none';

            const title = document.createElement('div');
            title.className = 'foto-title';
            title.textContent = note.title;

            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-button';
            copyBtn.textContent = 'Copy Foto';
            copyBtn.onclick = (event) => {
                event.stopPropagation();
                copyImageToClipboardFromURL(note.content);
            };

            card.appendChild(img);
            card.appendChild(title);
            card.appendChild(copyBtn);
            container.appendChild(card);
        });
        return;
    }

    notes.forEach(note => {
        const div = document.createElement('div');
        div.className = 'note-card';
        
        const imageUrlMatch = note.title.match(/(https?:\/\/[^\s]+\.(jpeg|jpg|png|gif|webp))/i);
        const imageUrl = imageUrlMatch ? imageUrlMatch[1] : null;

        const title = document.createElement('h3');
        title.className = 'note-title clickable-title';
        if (imageUrl) {
            title.textContent = note.title.replace(imageUrl, '').trim() || "Catatan Foto";
        } else {
            title.textContent = note.title;
        }

        const detail = document.createElement('div');
        detail.className = 'note-detail';
        detail.style.display = 'none';

        if (imageUrl) {
            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = note.title;
            img.style.marginTop = '10px';
            img.style.maxHeight = '200px';
            img.style.objectFit = 'contain';
            img.onclick = () => showLightbox(imageUrl);
            img.onerror = () => img.style.display = 'none';
            detail.appendChild(img);

            const copyBtn = document.createElement('button');
            copyBtn.className = 'copy-button';
            copyBtn.textContent = 'Copy Foto';
            copyBtn.onclick = (event) => {
                event.stopPropagation();
                copyImageToClipboardFromURL(imageUrl);
            };
            detail.appendChild(copyBtn);
            detail.appendChild(document.createElement('hr'));
        }

        const contentsToAdd = [
            note.content,
            note.content2,
            note.content3
        ];
        
        const stickyAllBtn = document.createElement('button');
        stickyAllBtn.textContent = 'Tambahkan Sticky Notes';
        stickyAllBtn.className = 'sticky-add-button';
        stickyAllBtn.onclick = (event) => {
            event.stopPropagation();
            addNoteToSticky(contentsToAdd);
        };
        detail.appendChild(stickyAllBtn);

        const fields = [
            { label: '========', content: note.content },
            { label: '========', content: note.content2 },
            { label: '========', content: note.content3 },
        ];

        fields.forEach(({ label, content }) => {
            if (content && content.trim() !== '') {
                const p = document.createElement('p');
                p.innerHTML = `<strong>${label}:</strong><br>${content}`;

                const copyBtn = document.createElement('button');
                copyBtn.textContent = 'Copy';
                copyBtn.className = 'copy-button';
                copyBtn.onclick = (event) => {
                    event.stopPropagation();
                    copyToClipboard(content);
                };

                const stickyBtn = document.createElement('button');
                stickyBtn.textContent = 'Tambah Sticky';
                stickyBtn.className = 'copy-button';
                stickyBtn.onclick = (event) => {
                    event.stopPropagation();
                    addNoteToSticky([content]);
                };
                
                p.appendChild(document.createElement('br'));
                p.appendChild(copyBtn);
                p.appendChild(stickyBtn);

                const urls = content.match(/https?:\/\/[^\s]+/gi);
                if (urls) {
                    urls.forEach((url, index) => {
                        const linkBtn = document.createElement('button');
                        linkBtn.textContent = `Buka Link ${index + 1}`;
                        linkBtn.className = 'copy-button';
                        linkBtn.onclick = (event) => {
                            event.stopPropagation();
                            window.open(url, '_blank');
                        };
                        p.appendChild(linkBtn);
                    });
                }
                detail.appendChild(p);
            }
        });

        title.onclick = () => {
            detail.style.display = detail.style.display === 'none' ? 'block' : 'none';
        };

        div.appendChild(title);
        div.appendChild(detail);
        container.appendChild(div);
    });
}

function searchNotes() {
    const query = document.getElementById("searchInput").value.trim().toLowerCase();
    const allCards = document.querySelectorAll(".note-card, .foto-card, .promo-card");

    allCards.forEach(card => {
        const title = card.querySelector(".note-title, .foto-title, .promo-title");
        const content = card.querySelector(".note-content, .foto-content, .promo-content");

        const titleText = title ? title.textContent.toLowerCase() : "";
        const contentText = content ? content.textContent.toLowerCase() : "";

        if (titleText.includes(query) || contentText.includes(query)) {
            card.style.display = "block";
        } else {
            card.style.display = "none";
        }
    });
}

async function copyImageToClipboardFromURL(imageUrl) {
    // 1. Validasi URL: Pastikan URL ada dan merupakan string.
    if (!imageUrl || typeof imageUrl !== 'string' || imageUrl.trim() === '') {
        showToast("❗ URL gambar tidak valid.");
        console.error("URL gambar tidak valid:", imageUrl);
        return;
    }

    // 2. Gunakan try-catch untuk penanganan error yang efektif.
    try {
        // Mengambil data gambar dari URL.
        const response = await fetch(imageUrl);

        // Memeriksa apakah respons berhasil (status 200-299).
        if (!response.ok) {
            throw new Error(`Gagal mengambil gambar. Status: ${response.status}`);
        }

        // Mengubah respons menjadi Blob (data biner).
        const blob = await response.blob();

        // Membuat ClipboardItem dari Blob.
        const item = new ClipboardItem({
            [blob.type]: blob
        });

        // Menyalin item ke clipboard.
        await navigator.clipboard.write([item]);

        // Memberi tahu pengguna bahwa operasi berhasil.
        showToast("✅ Foto Disalin!");

    } catch (err) {
        // Menangani error dan memberi tahu pengguna.
        console.error("Gagal menyalin gambar:", err);
        showToast(`❗ Gagal menyalin. ${err.message || 'Cek konsol untuk detail.'}`);
    }
}

let lightboxImages = [];
let lightboxIndex = 0;
let zoomLevel = 1;
let offsetX = 0,
    offsetY = 0;
let isDragging = false;
let startX = 0,
    startY = 0;

const lightboxEl = document.getElementById('lightbox');
const imgEl = document.getElementById('lightboxImg');
const zoomSlider = document.getElementById('zoomSlider');

function showLightbox(url) {
    lightboxImages = Array.from(document.querySelectorAll('.foto-gallery img')).map(img => img.src);
    lightboxIndex = lightboxImages.indexOf(url);
    lightboxEl.style.display = 'flex';
    imgEl.src = url;
    resetZoomAndPosition();
}

function hideLightbox() {
    lightboxEl.style.display = 'none';
}

function changeLightbox(direction) {
    lightboxIndex += direction;
    if (lightboxIndex < 0) lightboxIndex = lightboxImages.length - 1;
    if (lightboxIndex >= lightboxImages.length) lightboxIndex = 0;
    imgEl.src = lightboxImages[lightboxIndex];
    resetZoomAndPosition();
}

function resetZoomAndPosition() {
    zoomLevel = 1;
    offsetX = 0;
    offsetY = 0;
    applyTransform();
    if (zoomSlider) zoomSlider.value = zoomLevel;
}

function applyTransform() {
    imgEl.style.transform = `scale(${zoomLevel}) translate(${offsetX}px, ${offsetY}px)`;
}

function zoomLightbox(factor) {
    zoomLevel *= factor;
    zoomLevel = Math.min(Math.max(zoomLevel, 0.5), 5);
    applyTransform();
    if (zoomSlider) zoomSlider.value = zoomLevel;
}

// Event Listeners untuk lightbox
if (zoomSlider) {
    zoomSlider.addEventListener('input', () => {
        zoomLevel = parseFloat(zoomSlider.value);
        applyTransform();
    });
}

lightboxEl.addEventListener('wheel', e => {
    e.preventDefault();
    zoomLightbox(e.deltaY < 0 ? 1.1 : 0.9);
});

function startDrag(clientX, clientY) {
    if (zoomLevel <= 1) return;
    isDragging = true;
    startX = clientX - offsetX;
    startY = clientY - offsetY;
    imgEl.style.cursor = 'grabbing';
}

function moveDrag(clientX, clientY) {
    if (!isDragging) return;
    offsetX = clientX - startX;
    offsetY = clientY - startY;
    applyTransform();
}

function endDrag() {
    isDragging = false;
    imgEl.style.cursor = 'grab';
}

imgEl.addEventListener('mousedown', e => {
    startDrag(e.clientX, e.clientY);
    e.preventDefault();
});
window.addEventListener('mousemove', e => moveDrag(e.clientX, e.clientY));
window.addEventListener('mouseup', endDrag);
imgEl.addEventListener('touchstart', e => startDrag(e.touches[0].clientX, e.touches[0].clientY));
imgEl.addEventListener('touchmove', e => {
    moveDrag(e.touches[0].clientX, e.touches[0].clientY);
    e.preventDefault();
});
imgEl.addEventListener('touchend', endDrag);

lightboxEl.addEventListener('click', e => {
    if (e.target === lightboxEl) hideLightbox();
});

document.addEventListener('keydown', e => {
    if (lightboxEl.style.display === 'flex') {
        switch (e.key) {
            case 'ArrowLeft':
                changeLightbox(-1);
                break;
            case 'ArrowRight':
                changeLightbox(1);
                break;
            case 'Escape':
                hideLightbox();
                break;
            case '+':
                zoomLightbox(1.2);
                break;
            case '-':
                zoomLightbox(0.8);
                break;
        }
    }
});

imgEl.addEventListener('dblclick', resetZoomAndPosition);

// ===================================
// === PASARAN TOGEL ===
// ===================================
function renderPasaran(data) {
    const tbody = document.getElementById("pasaranBody");
    tbody.innerHTML = "";
    data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td style="border: 1px solid #00bfff; padding: 8px; cursor: pointer;" onclick="copyToClipboard('${row[0]}')">${row[0]}</td>
            <td style="border: 1px solid #00bfff; padding: 8px; cursor: pointer;" onclick="copyToClipboard('${row[1]}')">${row[1]}</td>
        `;
        tbody.appendChild(tr);
    });
}

function searchPasaran() {
    const input = document.getElementById("searchPasaran").value.toLowerCase();
    const rows = document.getElementById("pasaranBody").getElementsByTagName("tr");

    for (let i = 0; i < rows.length; i++) {
        const [col1, col2] = rows[i].getElementsByTagName("td");
        const text1 = col1.textContent.toLowerCase();
        const text2 = col2.textContent.toLowerCase();

        rows[i].style.display = (text1.includes(input) || text2.includes(input)) ? "" : "none";
    }
}

function loadPasaranTogel() {
    google.script.run.withSuccessHandler(renderPasaran).getPasaranList();
}

let allPasaranList = [];
let lastPrediksiIndex = "";
let lastJadwalIndex = "";

function renderPasaran(list) {
    allPasaranList = list;
    const dropdownPrediksi = document.getElementById("dropdownPrediksi");
    const dropdownJadwal = document.getElementById("dropdownJadwal");
    dropdownPrediksi.innerHTML = '<option value="">Pilih Prediksi...</option>';
    dropdownJadwal.innerHTML = '<option value="">Pilih Jadwal...</option>';

    list.forEach(([prediksi, jadwal], index) => {
        dropdownPrediksi.add(new Option(prediksi.split('\n')[0], index));
        dropdownJadwal.add(new Option(jadwal.split('\n')[0], index));
    });

    if (lastPrediksiIndex !== "" && dropdownPrediksi.options[lastPrediksiIndex]) {
        dropdownPrediksi.value = lastPrediksiIndex;
        showDetailWithAnimation('prediksi');
    }
    if (lastJadwalIndex !== "" && dropdownJadwal.options[lastJadwalIndex]) {
        dropdownJadwal.value = lastJadwalIndex;
        showDetailWithAnimation('jadwal');
    }
}

function showDetailWithAnimation(type) {
    const selectId = (type === 'prediksi') ? "dropdownPrediksi" : "dropdownJadwal";
    const detailId = "detail" + capitalize(type);
    const index = document.getElementById(selectId).value;

    const detailEl = document.getElementById(detailId);
    if (index === "") {
        detailEl.innerText = "";
        detailEl.style.opacity = 0;
        return;
    }

    const data = allPasaranList[parseInt(index)][type === 'prediksi' ? 0 : 1];

    detailEl.style.transition = "opacity 0.5s";
    detailEl.style.opacity = 0;
    setTimeout(() => {
        detailEl.innerText = data;
        detailEl.style.opacity = 1;
    }, 500);

    if (type === 'prediksi') lastPrediksiIndex = index;
    else lastJadwalIndex = index;
}

document.getElementById("dropdownPrediksi").addEventListener("change", () => {
    lastPrediksiIndex = document.getElementById("dropdownPrediksi").value;
    showDetailWithAnimation('prediksi');
});
document.getElementById("dropdownJadwal").addEventListener("change", () => {
    lastJadwalIndex = document.getElementById("dropdownJadwal").value;
    showDetailWithAnimation('jadwal');
});

function searchDropdowns() {
    const query = document.getElementById("searchPasaran").value.toLowerCase();
    const dropdownPrediksi = document.getElementById("dropdownPrediksi");
    const dropdownJadwal = document.getElementById("dropdownJadwal");

    dropdownPrediksi.innerHTML = '<option value="">Pilih Prediksi...</option>';
    dropdownJadwal.innerHTML = '<option value="">Pilih Jadwal...</option>';

    allPasaranList.forEach(([prediksi, jadwal], index) => {
        if (prediksi.toLowerCase().includes(query) || jadwal.toLowerCase().includes(query)) {
            dropdownPrediksi.add(new Option(prediksi.split('\n')[0], index));
            dropdownJadwal.add(new Option(jadwal.split('\n')[0], index));
        }
    });
}

function copyToClipboardDetail(div) {
    const text = div.innerText;
    if (!text) return;
    navigator.clipboard.writeText(text)
        .then(() => showToast("✅ Disalin"))
        .catch(() => showToast("❗ Gagal menyalin"));
}

function simpanTanggalPasaran() {
    const tanggalInput = document.getElementById("tanggalPasaran").value;
    if (!tanggalInput) {
        showToast("❗ Silakan pilih tanggal terlebih dahulu.");
        return;
    }

    const [year, month, day] = tanggalInput.split("-");
    const formattedDate = `${month}/${day}/${year}`;

    google.script.run
        .withSuccessHandler(() => {
            showToast("✅ Tanggal berhasil disimpan!");
            loadPasaranTogel();
        })
        .setTanggalPasaran(formattedDate);
}

function initTanggalPasaran() {
    google.script.run.withSuccessHandler(dateStr => {
        if (!dateStr) return;
        const parts = dateStr.split("/");
        if (parts.length !== 3) return;

        const formattedForInput = `${parts[2]}-${parts[1].padStart(2, "0")}-${parts[0].padStart(2, "0")}`;
        document.getElementById("tanggalPasaran").value = formattedForInput;

        document.getElementById("tanggalTerpilihDisplay").textContent = dateStr;

        loadPasaranTogel();
    }).getTanggalPasaran();
}

document.addEventListener("DOMContentLoaded", initTanggalPasaran);

document.getElementById("btnToggleTanggal").addEventListener("click", () => {
    const form = document.getElementById("formTanggal");
    form.style.display = form.style.display === "none" ? "block" : "none";
});

// ===================================
// === FUNGSI CARA HITUNG TOGEL ===
// ===================================
let kelompokData = {};

function loadCaraHitungTogel() {
    lastKelompok = document.getElementById("kelompokDropdown") ?.value || "";
    lastLabel = document.getElementById("labelDropdown") ?.value || "";

    const allTabs = ['caraHitungSection', 'pasaranTab', 'cekBonusEventTab', 'catatanTab'];
    allTabs.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
    });

    const caraHitung = document.getElementById("caraHitungSection");
    if (caraHitung) caraHitung.style.display = "block";

    const kelompokDropdown = document.getElementById("kelompokDropdown");
    kelompokDropdown.innerHTML = `<option value="">-- Pilih Tipe Hitungan --</option>`;

    google.script.run.withSuccessHandler((res) => {
        kelompokData = res.kelompok || {};

        for (const kelompok in kelompokData) {
            const opt = document.createElement("option");
            opt.value = kelompok;
            opt.textContent = kelompok;
            kelompokDropdown.appendChild(opt);
        }

        if (lastKelompok && kelompokData[lastKelompok]) {
            kelompokDropdown.value = lastKelompok;
            isiDropdownLabel();

            if (lastLabel) {
                const labelDropdown = document.getElementById("labelDropdown");
                labelDropdown.value = lastLabel;

                if ([...labelDropdown.options].some(opt => opt.value === lastLabel)) {
                    tampilkanValueHitungan(true);
                }
            }
        }
    }).getHitunganTogel();
}

function isiDropdownLabel() {
    const selectedKelompok = document.getElementById("kelompokDropdown").value;
    const labelDropdown = document.getElementById("labelDropdown");
    const detail = document.getElementById("detailHitunganDropdown");

    labelDropdown.innerHTML = `<option value="">-- Pilih Label --</option>`;
    detail.innerHTML = "";

    if (!selectedKelompok || !kelompokData[selectedKelompok]) return;

    kelompokData[selectedKelompok].forEach(item => {
        const opt = document.createElement("option");
        opt.value = item.label;
        opt.textContent = item.label;
        labelDropdown.appendChild(opt);
    });
}

function tampilkanValueHitungan(withAnimation = false) {
    const kelompok = document.getElementById("kelompokDropdown").value;
    const label = document.getElementById("labelDropdown").value;
    const detail = document.getElementById("detailHitunganDropdown");
    detail.innerHTML = "";

    if (!kelompok || !label || !kelompokData[kelompok]) return;

    const item = kelompokData[kelompok].find(i => i.label === label);
    if (!item) return;

    const div = document.createElement("div");
    div.className = "hitungan-value";
    div.textContent = item.value;
    div.title = "Klik untuk salin";

    if (withAnimation) {
        div.style.opacity = "0";
        div.style.transform = "scale(0.9)";
        setTimeout(() => {
            div.style.transition = "all 0.3s ease";
            div.style.opacity = "1";
            div.style.transform = "scale(1)";
        }, 10);
    }

    div.addEventListener("click", () => {
        navigator.clipboard.writeText(item.value || "").then(() => {
            showToast("✅ Disalin");
        }).catch(() => {
            showToast("❌ Gagal menyalin");
        });
    });

    detail.appendChild(div);
}

function updateNominalTogel() {
    const nominal = document.getElementById("nominalInput").value.trim();
    if (!nominal) {
        return showToast("❌ Nominal tidak boleh kosong");
    }

    google.script.run
        .withSuccessHandler(() => {
            showToast("✅ Nominal diperbarui");
            loadCaraHitungTogel();
        })
        .withFailureHandler(err => {
            showToast("❌ Gagal memperbarui nominal: " + err.message);
        })
        .updateNominalTogel(nominal);
}

// ===================================
// === FUNGSI STICKY NOTES ===
// ===================================
let editIndex = null;

function toggleStickyPanel() {
    const panel = document.getElementById("stickyPanel");
    panel.style.display = panel.style.display === "block" ? "none" : "block";
    loadStickyNotes();
}

function autoResize(el) {
    el.style.height = "auto";
    el.style.height = el.scrollHeight + "px";
}

async function addSticky() {
    const input = document.getElementById("stickyInput");
    const text = input.value.trim();
    const image = input.dataset.image || null;
    if (!text && !image) return;

    let stickies = JSON.parse(localStorage.getItem("stickies") || "[]");
    if (editIndex !== null) {
        stickies[editIndex] = {
            text,
            image
        };
        editIndex = null;
        document.querySelector("#stickyPanel button").textContent = "➕ Tambah Sticky";
    } else stickies.push({
        text,
        image
    });
    localStorage.setItem("stickies", JSON.stringify(stickies));

    input.value = "";
    input.dataset.image = "";
    autoResize(input);
    loadStickyNotes();
}

document.getElementById("stickyInput").addEventListener("paste", async e => {
    for (let item of e.clipboardData.items) {
        if (item.type.startsWith("image/")) {
            const blob = item.getAsFile();
            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById("stickyInput").dataset.image = e.target.result;
                document.getElementById("stickyInput").value = "📷 Gambar siap tempel!";
                autoResize(document.getElementById("stickyInput"));
            };
            reader.readAsDataURL(blob);
        }
    }
});

function loadStickyNotes() {
    const list = document.getElementById("stickyList");
    list.innerHTML = "";
    const stickies = JSON.parse(localStorage.getItem("stickies") || "[]");

    stickies.forEach((note, i) => {
        const div = document.createElement("div");
        div.className = "sticky-card";
        div.dataset.index = i;

        if (note.text) {
            const p = document.createElement("p");
            p.textContent = note.text;
            div.appendChild(p);
        }
        if (note.image) {
            const img = document.createElement("img");
            img.src = note.image;
            div.appendChild(img);
        }

        div.onclick = async() => {
            try {
                const items = {};
                if (note.text) items["text/plain"] = new Blob([note.text], {
                    type: "text/plain"
                });
                if (note.image) {
                    const resp = await fetch(note.image);
                    const blob = await resp.blob();
                    items[blob.type] = blob;
                }
                await navigator.clipboard.write([new ClipboardItem(items)]);
                showToast("✅ Teks + Gambar disalin!");
            } catch {
                showToast("⚠ Gagal menyalin");
            }
        };

        const del = document.createElement("span");
        del.textContent = "✖";
        del.className = "sticky-delete";
        del.onclick = e => {
            e.stopPropagation();
            deleteSticky(i);
        };
        const edit = document.createElement("span");
        edit.textContent = "✏️";
        edit.className = "sticky-edit";
        edit.onclick = e => {
            e.stopPropagation();
            editSticky(i);
        };
        div.appendChild(del);
        div.appendChild(edit);

        div.setAttribute("draggable", true);
        div.ondragstart = e => e.dataTransfer.setData("text/plain", i);
        div.ondragover = e => {
            e.preventDefault();
            div.style.border = "2px dashed #00ffff";
        };
        div.ondragleave = () => div.style.border = "1px solid #00ffff";
        div.ondrop = e => {
            e.preventDefault();
            div.style.border = "1px solid #00ffff";
            reorderSticky(e.dataTransfer.getData("text/plain"), i);
        };

        list.appendChild(div);
    });
}

function reorderSticky(from, to) {
    let stickies = JSON.parse(localStorage.getItem("stickies") || "[]");
    const moved = stickies.splice(from, 1)[0];
    stickies.splice(to, 0, moved);
    localStorage.setItem("stickies", JSON.stringify(stickies));
    loadStickyNotes();
}

function deleteSticky(i) {
    let stickies = JSON.parse(localStorage.getItem("stickies") || "[]");
    stickies.splice(i, 1);
    localStorage.setItem("stickies", JSON.stringify(stickies));
    loadStickyNotes();
}

function editSticky(i) {
    const stickies = JSON.parse(localStorage.getItem("stickies") || "[]");
    const input = document.getElementById("stickyInput");
    input.value = stickies[i].text || "";
    input.dataset.image = stickies[i].image || "";
    autoResize(input);
    editIndex = i;
    document.querySelector("#stickyPanel button").textContent = "Simpan Perubahan";
}

function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

/**
 * Menyalin teks dari elemen dengan ID tertentu ke clipboard dan menampilkan notifikasi.
 * @param {string} id - ID dari elemen yang berisi teks untuk disalin.
 */
function copyText(id) {
    const elem = document.getElementById(id);
    if (!elem) return;

    const text = elem.innerText || elem.textContent;
    if (!text || text.trim() === "-") {
        showToast("❗ Tidak ada data untuk disalin!");
        return;
    }

    navigator.clipboard.writeText(text)
        .then(() => showToast("✅ Disalin!"))
        .catch(() => showToast("❗ Gagal menyalin teks"));
}

function copyWithFeedback(button, text) {
    navigator.clipboard.writeText(text).then(() => {
        button.textContent = "✔ Copied!";
        button.style.background = "#00ff66";
        button.style.color = "#000";

        setTimeout(() => {
            button.textContent = "Copy";
            button.style.background = "cyan";
            button.style.color = "#000";
        }, 1500);
    });
}

async function copyPhotoFromLightbox() {
    const imgElement = document.getElementById('lightboxImage');
    if (!imgElement || !imgElement.src) {
        showToast('❗ Gagal: Gambar tidak ditemukan.');
        return;
    }
    try {
        const response = await fetch(imgElement.src);
        const blob = await response.blob();
        await navigator.clipboard.write([
            new ClipboardItem({
                [blob.type]: blob
            })
        ]);
        showToast('✅ Foto berhasil disalin!');
    } catch (err) {
        console.error('Gagal menyalin foto:', err);
        showToast('❗ Gagal menyalin foto. Pastikan URL valid.');
    }
}

// =========================================================
//                   Fungsi Lightbox
// =========================================================

let imageList = [];
let currentImageIndex = 0;

/**
 * Membuka lightbox untuk menampilkan gambar yang diklik.
 * @param {HTMLImageElement} imgElement - Elemen gambar yang diklik.
 */
function openLightbox(imgElement) {
    imageList = Array.from(document.querySelectorAll(".gambar-slot img"))
        .filter(img => img.style.display !== "none")
        .map(img => img.src);

    currentImageIndex = imageList.indexOf(imgElement.src);
    document.getElementById("lightboxImage").src = imgElement.src;
    document.getElementById("lightboxModal").style.display = "flex";
}

/**
 * Menutup lightbox.
 */
function closeLightbox() {
    document.getElementById("lightboxModal").style.display = "none";
}

/**
 * Navigasi ke gambar berikutnya di lightbox.
 */
function nextImage() {
    if (imageList.length === 0) return;
    currentImageIndex = (currentImageIndex + 1) % imageList.length;
    document.getElementById("lightboxImage").src = imageList[currentImageIndex];
}

/**
 * Navigasi ke gambar sebelumnya di lightbox.
 */
function prevImage() {
    if (imageList.length === 0) return;
    currentImageIndex = (currentImageIndex - 1 + imageList.length) % imageList.length;
    document.getElementById("lightboxImage").src = imageList[currentImageIndex];
}

// =========================================================
//               Fungsi Zoom & OCR
// =========================================================

const imageInput = document.getElementById('imageUrl');
const modal = document.getElementById('zoomModal');
const kodeOutput = document.getElementById('kodeHasilZoom');
const zoomedImage = document.getElementById('zoomedImage');

/**
 * Menutup modal zoom dan mereset isinya.
 */
function closeZoom() {
    document.getElementById('zoomModal').style.display = 'none';
    document.getElementById('zoomedImage').src = '';
    document.getElementById('imageUrl').value = '';
    document.getElementById('kodeHasilZoom').innerHTML = '';
}

/**
 * Memindai gambar dari URL untuk mendapatkan teks.
 * @param {string} url - URL gambar yang akan dipindai.
 */
function zoomAndScan(url = null) {
    const imageUrl = url || document.getElementById('imageUrlZoom').value.trim();
    if (!imageUrl) return;

    const zoomedImage = document.getElementById('zoomedImage');
    const kodeOutput = document.getElementById('kodeHasilZoom');
    const modal = document.getElementById('zoomModal');

    zoomedImage.src = imageUrl;
    modal.style.display = "flex";
    kodeOutput.innerHTML = `<span style="color:gray;">⏳ Memindai gambar...</span>`;

    document.getElementById('imageUrlZoom').value = "";

    Tesseract.recognize(imageUrl, 'eng', {
        logger: m => console.log(m)
    }).then(({
        data: {
            text
        }
    }) => {
        const rawLines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
        let hasilGabung = [],
            hasilLangsung = [];

        for (let i = 0; i < rawLines.length; i++) {
            const line = rawLines[i];
            const match = line.match(/\b\d{9,10}\b/);
            if (match) {
                if (i + 1 < rawLines.length) {
                    const nextLine = rawLines[i + 1].trim();
                    const nextMatch = nextLine.match(/\b\d{8,}\b/);
                    if (nextMatch) {
                        hasilGabung.push(match[0] + nextMatch[0]);
                        i++;
                        continue;
                    }
                }
                hasilGabung.push(match[0]);
            }
        }

        for (const line of rawLines) {
            const matches = line.match(/\d{8,}/g);
            if (matches) matches.forEach(m => hasilLangsung.push(m));
        }

        hasilGabung = [...new Set(hasilGabung)];
        hasilLangsung = [...new Set(hasilLangsung)];

        if (hasilGabung.length === 0 && hasilLangsung.length === 0) {
            kodeOutput.innerHTML = `<span style="color:orange;">❌ Tidak ditemukan angka panjang.</span>`;
        } else {
            kodeOutput.innerHTML = "";
            if (hasilGabung.length > 0) {
                const title1 = document.createElement("div");
                title1.innerHTML = `<b style="color:deepskyblue;">📘 Hasil Gabungan Baris:</b>`;
                title1.style.margin = "12px 0 4px";
                kodeOutput.appendChild(title1);
                hasilGabung.forEach(kode => {
                    const div = document.createElement("div");
                    div.style = `
                        margin-bottom: 10px;
                        padding: 10px;
                        background: rgba(0,150,255,0.2);
                        border: 1px solid deepskyblue;
                        border-radius: 8px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    `;
                    div.innerHTML = `
                        <span style="word-break: break-all;">${kode}</span>
                        <button onclick="copyWithFeedback(this, '${kode}')" style="background: deepskyblue; color: #00FFFF; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold;">Copy</button>
                    `;
                    kodeOutput.appendChild(div);
                });
            }
            if (hasilLangsung.length > 0) {
                const title2 = document.createElement("div");
                title2.innerHTML = `<b style="color:limegreen;">📗 Hasil Angka Per Baris:</b>`;
                title2.style.margin = "12px 0 4px";
                kodeOutput.appendChild(title2);
                hasilLangsung.forEach(kode => {
                    const div = document.createElement("div");
                    div.style = `
                        margin-bottom: 10px;
                        padding: 10px;
                        background: rgba(0,255,0,0.15);
                        border: 1px solid limegreen;
                        border-radius: 8px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                    `;
                    div.innerHTML = `
                        <span style="word-break: break-all;">${kode}</span>
                        <button onclick="copyWithFeedback(this, '${kode}')" style="background: limegreen; color: #00FFFF; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-size: 12px; font-weight: bold;">Copy</button>
                    `;
                    kodeOutput.appendChild(div);
                });
            }
        }
    }).catch(err => {
        console.error(err);
        kodeOutput.innerHTML = `<span style="color:red;">❗ Gagal membaca gambar.</span>`;
    });
}

function membacaIsiFoto_ocr(src) {
    Tesseract.recognize(
        src, 'eng', {
            logger: m => console.log(m)
        }
    ).then(({
        data: {
            text
        }
    }) => {
        document.getElementById("membacaIsiFoto_hasil").innerText = text.trim() || "Teks tidak terbaca.";
    }).catch(err => {
        document.getElementById("membacaIsiFoto_hasil").innerText = "Gagal membaca gambar.";
    });
}

function membacaIsiFoto_prosesLink() {
    const link = document.getElementById("membacaIsiFoto_input").value.trim();
    if (link) {
        document.getElementById("membacaIsiFoto_modal").style.display = "flex";
        document.getElementById("membacaIsiFoto_gambar").src = link;
        document.getElementById("membacaIsiFoto_hasil").innerHTML = "<i>Memproses gambar...</i>";
        membacaIsiFoto_ocr(link);
    }
}

function membacaIsiFoto_tutup() {
    document.getElementById("membacaIsiFoto_modal").style.display = "none";
    document.getElementById("membacaIsiFoto_gambar").src = "";
    document.getElementById("membacaIsiFoto_hasil").innerText = "";
    document.getElementById("membacaIsiFoto_input").value = "";
}

// =========================================================
//               Fungsi Bonus dan Scatter
// =========================================================

function hitungBonusEvent() {
    const isi = document.getElementById("bonusTextarea").value.trim();
    const patokanRaw = document.getElementById("bonusPatokan").value;
    const surplusRaw = document.getElementById("bonusSurplus").value;

    const patokan = parseInt(patokanRaw.replace(/[^\d]/g, '')) || 0;
    const surplus = parseInt(surplusRaw.replace(/[^\d]/g, '')) || 0;

    if (!isi) {
        showToast("❗ Tempelkan data terlebih dahulu.");
        return;
    }

    const lines = isi.split("\n");
    let total = 0;

    for (let i = 0; i < lines.length; i++) {
        if (lines[i].trim() === 'Credit') {
            const amountLine = lines[i + 1] ? lines[i + 1].trim() : '';
            const amountMatch = amountLine.match(/IDR\s([\d,]+)/i);

            if (amountMatch) {
                const amountStr = amountMatch[1].replace(/,/g, '');
                const amount = parseFloat(amountStr);

                if (!isNaN(amount)) {
                    total += amount;
                }
            }
        }
    }

    const hasilDiv = document.getElementById("bonusHasil");
    let output = `💰 Total Hitungan: <span class="bonus-angka">IDR ${total.toLocaleString("en-US")}</span>`;

    if (patokan || surplus) {
        const totalPengurang = patokan + surplus;
        const selisih = total - totalPengurang;
        const selisihColor = selisih === 0 ? '#00ff88' : '#ff6666';

        output += `<br>📦 Patokan: <span class="bonus-angka">IDR ${patokan.toLocaleString("en-US")}</span>`;
        output += `<br>📌 Surplus: <span class="bonus-angka">IDR ${surplus.toLocaleString("en-US")}</span>`;
        output += `<br>➖ Total Dikurang: <span class="bonus-angka">IDR ${totalPengurang.toLocaleString("en-US")}</span>`;
        output += `<br>📏 Selisih: <span class="bonus-angka" style="color:${selisihColor}">IDR ${Math.abs(selisih).toLocaleString("en-US")}</span>`;
    }

    hasilDiv.innerHTML = output;
}

window.gambarLinks = []; 

    function hapusScatter() {
        document.getElementById("scatterTextarea").value = "";
        ["UserID", "KodeTiket", "LinkBukti", "Bettingan"].forEach(id =>
            document.getElementById("hasil" + id).innerText = "-"
        );
        for (let i = 1; i <= 3; i++) {
            document.getElementById(`gambar${i}`).src = "";
            document.getElementById(`gambar${i}`).style.display = "none";
            document.getElementById(`caption${i}`).innerText = "-";
            document.getElementById(`gambar${i}`).removeAttribute("onclick"); // Hapus onclick
        }
        window.gambarLinks = []; // Bersihkan link gambar
    }

    // =========================================================
    // FUNGSI HITUNG SCATTER ASLI
    // =========================================================
    function hitungScatter() {
        const input = document.getElementById("scatterTextarea").value;
        const parts = input.split(/\t| +/);

        let userId = "-";
        // Logic mencari User ID setelah tahun
        for (let i = 0; i < parts.length; i++) {
            if (/^20\d{2}$/.test(parts[i]) && i + 1 < parts.length) {
                const calonUser = parts[i + 1].trim();
                if (calonUser.length >= 3 && !/^\d+$/.test(calonUser)) {
                    userId = calonUser;
                    break;
                }
            }
        }

        const regexGambar = /(https?:\/\/[^\s]+?\.(?:jpg|jpeg|png|gif|webp|bmp|svg)|https?:\/\/(?:prnt\.sc|imghostr\.com)\/[^\s]+)/gi;
        const gambarLinks = input.match(regexGambar) || [];
        window.gambarLinks = gambarLinks; // Simpan ke global

        const kodeTiketMatch = input.match(/\b\d{17,20}\b/);
        const kodeTiket = kodeTiketMatch ? kodeTiketMatch[0] : "-";

        const betMatch = input.match(/BET\s*([0-9.,]+)\s*-\s*([0-9.,]+)/i);
        let bettingan = "-";
        if (betMatch) {
            const betParts = betMatch[1].split("-");
            bettingan = betParts[0].trim().replace(/,/g, '');
        }

        document.getElementById("hasilUserID").innerText = userId;
        document.getElementById("hasilKodeTiket").innerText = kodeTiket;
        document.getElementById("hasilLinkBukti").innerText = gambarLinks.join(", ") || "-";
        document.getElementById("hasilBettingan").innerText = bettingan;

        // Tampilkan 3 gambar preview
        for (let i = 1; i <= 3; i++) {
            const img = document.getElementById(`gambar${i}`);
            const caption = document.getElementById(`caption${i}`);
            const link = gambarLinks[i - 1];

            if (link) {
                if (link.includes('prnt.sc') || link.includes('imghostr.com')) {
                    img.style.display = "none";
                    caption.innerHTML = `<a href="${link}" target="_blank">Lihat Gambar ${i}</a>`;
                    img.removeAttribute("onclick");
                } else {
                    img.src = link;
                    img.style.display = "block";
                    caption.innerText = `Link ${i}`;
                    img.setAttribute("onclick", "openLightbox()"); // Semua memanggil fungsi yang sama
                }
            } else {
                img.src = "";
                img.style.display = "none";
                caption.innerText = "-";
                img.removeAttribute("onclick");
            }
        }
    }

    function openLightbox() {
        const imageLinks = window.gambarLinks.slice(0, 3); // Ambil 3 link pertama
        const userId = document.getElementById("hasilUserID").innerText;

        if (imageLinks.length === 0) {
            alert("Tidak ada link gambar yang valid untuk ditampilkan.");
            return;
        }

        document.getElementById('lightboxModal').style.display = 'flex';
        document.getElementById('lightboxImage').style.display = 'none'; 
        document.getElementById('imageLoader').style.display = 'block'; 
        
        // Update caption awal
        document.getElementById('lightboxCaptionText').innerHTML = `User ID: <strong>${userId}</strong> | Status: **Memuat Gambar Gabungan...**`;

        // Panggil fungsi penggabungan
        combineImages(imageLinks, userId).then(combinedImageUrl => {
            document.getElementById('imageLoader').style.display = 'none'; 
            if (combinedImageUrl) {
                document.getElementById('lightboxImage').src = combinedImageUrl;
                document.getElementById('zoomDisplay').src = combinedImageUrl;
                document.getElementById('lightboxImage').style.display = 'block'; 
                
                // Update caption sukses
                document.getElementById('lightboxCaptionText').innerHTML = `
                    User ID: <strong>${userId}</strong><br>
                    <span style="font-size: 0.9em;">(Geser mouse di atas gambar untuk Zoom)</span>
                `;
            } else {
                // Handle error
                document.getElementById('lightboxImage').src = '';
                document.getElementById('lightboxImage').style.display = 'none';
                document.getElementById('zoomDisplay').src = '';
                document.getElementById('lightboxCaptionText').innerHTML = `
                    User ID: <strong>${userId}</strong><br>
                    <span style="color: var(--color-danger);">❌ Gagal menggabungkan/memuat gambar (masalah CORS).</span>
                    <br><a href="${imageLinks[0]}" target="_blank" style="color:var(--color-primary);">Coba Lihat Link Asli</a>
                `;
            }
        });
    }

    async function combineImages(imageLinks, userId) {
        const images = [];
        for (const link of imageLinks) { 
            try {
                const img = new Image();
                img.crossOrigin = "Anonymous"; // Kunci untuk mengatasi CORS
                img.src = link;
                await new Promise(resolve => {
                    img.onload = () => resolve(img);
                    img.onerror = () => {
                        console.warn(`Gagal memuat gambar (CORS/link tidak valid): ${link}`);
                        resolve(null);
                    };
                });
                if (img.complete && img.naturalHeight !== 0) {
                    images.push(img);
                }
            } catch (error) {
                console.error(`Error loading image ${link}:`, error);
            }
        }

        if (images.length === 0) return null; 

        // 1. Hitung dimensi Canvas
        let totalWidth = 0;
        let maxHeight = 0;
        const padding = 10; 
        images.forEach(img => {
            totalWidth += img.naturalWidth + padding;
            if (img.naturalHeight > maxHeight) maxHeight = img.naturalHeight;
        });
        totalWidth -= padding; 
        
        // 2. Tentukan Canvas
        const canvas = document.createElement('canvas');
        canvas.width = totalWidth;
        canvas.height = maxHeight; 

        const ctx = canvas.getContext('2d');
        ctx.fillStyle = 'black'; 
        ctx.fillRect(0, 0, canvas.width, canvas.height); 

        // 3. Gambar semua gambar ke Canvas
        let currentX = 0;
        images.forEach(img => {
            ctx.drawImage(img, currentX, (maxHeight - img.naturalHeight) / 2);
            currentX += img.naturalWidth + padding;
        });

        return canvas.toDataURL('image/jpeg', 0.9); // Mengembalikan Data URL
    }


    function closeLightbox() {
        document.getElementById('lightboxModal').style.display = 'none';
        document.getElementById('lightboxImage').style.transform = '';
        document.getElementById('zoomDisplay').style.left = '0';
        document.getElementById('zoomDisplay').style.top = '0';
        document.getElementById('lightboxImage').style.display = 'none';
        document.getElementById('lightboxImage').src = '';
        document.getElementById('zoomDisplay').src = '';
    }

    function zoomImage(event) {
        const img = document.getElementById('lightboxImage');
        const zoomDisplay = document.getElementById('zoomDisplay');
        const container = document.querySelector('.zoom-display-container');

        if (!img.src || img.style.display === 'none') return;

        const rect = img.getBoundingClientRect();
        const x = event.clientX - rect.left; 
        const y = event.clientY - rect.top; 

        const zoomLevel = 2; 
        const containerW = container.offsetWidth;
        const containerH = container.offsetHeight;
        
        const xPercent = (x / rect.width);
        const yPercent = (y / rect.height);
        
        // Hitung perpindahan piksel untuk gambar zoomDisplay
        const dx = (xPercent * (img.naturalWidth * zoomLevel)) - (containerW / 2);
        const dy = (yPercent * (img.naturalHeight * zoomLevel)) - (containerH / 2);

        zoomDisplay.style.transform = `scale(${zoomLevel})`;
        zoomDisplay.style.left = `-${dx}px`;
        zoomDisplay.style.top = `-${dy}px`;
    }

    function resetZoom() {
        const zoomDisplay = document.getElementById('zoomDisplay');
        zoomDisplay.style.left = '0px';
        zoomDisplay.style.top = '0px';
        zoomDisplay.style.transform = 'scale(1)'; 
    }

    // Panggil hitungScatter saat DOMContentLoaded untuk memproses data
    document.addEventListener("DOMContentLoaded", hitungScatter);

        document.addEventListener("DOMContentLoaded", () => {
    const scatterTextarea = document.getElementById("scatterTextarea");
    if (scatterTextarea) {
        scatterTextarea.addEventListener("paste", () => {
            setTimeout(hitungScatter, 50);
        });
        scatterTextarea.addEventListener("input", hitungScatter);
    }
});

const imageInputUrl = document.getElementById('imageUrl');
if (imageInputUrl) {
    imageInputUrl.addEventListener('input', () => {
        const url = imageInputUrl.value.trim();
        if (url && url.startsWith("http")) {
            zoomAndScan(url);
        }
    });
}

const imageUrlZoomInput = document.getElementById('imageUrlZoom');
if (imageUrlZoomInput) {
    imageUrlZoomInput.addEventListener('input', function() {
        const link = this.value.trim();
        if (link) zoomAndScan(link);
    });
}

const modalElement = document.getElementById('zoomModal');
if (modalElement) {
    // Cegah klik modal tertutup
    modalElement.addEventListener('click', function(e) {
        e.stopPropagation();
    });

    // Deteksi klik di luar modal → tutup dan reset
    document.addEventListener("click", (e) => {
        const insideModal = modalElement.contains(e.target) || imageInput.contains(e.target);
        if (modalElement.style.display === "flex" && !insideModal) {
            closeZoom();
        }
    });
}

function showToast(msg) {
  const toast = document.getElementById("toastNotif");
  toast.innerText = msg;
  toast.style.display = "block";
  setTimeout(() => { toast.style.display = "none"; }, 2500);
}

function loadHadiahTogel() {
  google.script.run.withSuccessHandler(res => {
    const container = document.getElementById("hadiahContainer");
    container.innerHTML = "";

    res.data.forEach(group => {
      const box = document.createElement("div");
      box.className = "hadiah-box";

      // setiap box pakai details sendiri
      let html = `<details>
                    <summary>${group.judul}</summary>
                    <table>
                      <thead>
                        <tr>
                          <th>Nama</th>
                          <th>Hadiah</th>
                          <th>Diskon</th>
                        </tr>
                      </thead>
                      <tbody>`;

      group.items.forEach(it => {
        if (it.hadiah && it.hadiah.trim() !== "") {
          let diskonVal = "";
          if (it.diskon !== undefined && it.diskon !== "") {
            if (typeof it.diskon === "string" && it.diskon.includes("%")) {
              diskonVal = it.diskon;
            }
          }

          html += `<tr>
                     <td>${it.nama}</td>
                     <td>${it.hadiah}</td>
                     <td>${diskonVal}</td>
                   </tr>`;
        }
      });

      html += `</tbody></table>
               </details>`;

      box.innerHTML = html;
      container.appendChild(box);
    });
  }).getPengaturanTogelLengkap();
}

// Panggil fungsi saat tab Hadiah dibuka
function showHadiahTab() {
  showTab('cekhadiah'); // fungsi tab utama yang sudah ada
  loadHadiahTogel();
}

function showTab(tabId, button) {
    // Sembunyikan semua tab content
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });

    // Hapus class 'active' dari semua tombol
    document.querySelectorAll('.neon-button').forEach(btn => {
        btn.classList.remove('active');
    });

    // Tampilkan tab yang sesuai dengan ID
    const activeTab = document.getElementById(tabId);
    if (activeTab) {
        activeTab.style.display = 'block';
    }

    // Tambahkan class 'active' ke tombol yang diklik
    if (button) {
        button.classList.add('active');
    }
}

function attachAccordionListeners() {
  document.querySelectorAll("#contentPengaturan .accordion").forEach(a => {
    a.onclick = function() {
      const panel = this.nextElementSibling;
      panel.style.display = (panel.style.display === "block") ? "none" : "block";
    };
  });
}

function openPengaturanAfterSave(panelKey, groupIndex) {
  google.script.run
    .withSuccessHandler(res => {
      if (res.status === "error") {
        document.getElementById("contentPengaturan").innerHTML = `<p>${res.message}</p>`;
        return;
      }

      let html = "";
      
      // === Bagian 1: Pengaturan Hadiah dan Diskon ===
      res.data.forEach((k, currentGroupIndex) => {
        const isPanelOpen = panelKey === 'normal' && groupIndex === currentGroupIndex;
        html += `
          <h4 class="accordion"
            data-col-nama="${k.colNama}"
            data-col-hadiah="${k.colHadiah}"
            data-col-diskon="${k.colDiskon}">
            ${k.judul}
          </h4>
          <div class="panel" style="display:${isPanelOpen ? "block" : "none"};">
            <table border="0" cellpadding="4">
              <thead>
                <tr>
                  <th>Jenis Bet</th>
                  <th>Hadiah</th>
                  <th>Diskon</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody>
        `;
        k.items.forEach((it, i) => {
          const diskonVal = (it.diskon && String(it.diskon).includes("%")) ? it.diskon : "NO DISCOUNT";
          const barisSheet = k.startRow + i;
          html += `
                <tr>
                  <td>${it.nama}</td>
                  <td><div contenteditable="true" class="editable-cell">${it.hadiah ?? ""}</div></td>
                  <td><div contenteditable="true" class="editable-cell">${diskonVal}</div></td>
                  <td>
                    <button class="row-save-btn"
                            data-row="${barisSheet}"
                            onclick="simpanBaris(${currentGroupIndex}, ${i}, this)">
                      💾 Simpan
                    </button>
                  </td>
                </tr>
          `;
        });
        html += `
              </tbody>
            </table>
          </div>
          <br/>
        `;
      });
      
      // === Bagian 2: Pengaturan Link Live ===
      const isLinkLiveOpen = panelKey === 'linkLive';
      html += `
        <h4 class="accordion">LINK LIVE PASARAN</h4>
        <div class="panel" style="display:${isLinkLiveOpen ? "block" : "none"};">
          <table border="0" cellpadding="4">
            <thead>
              <tr>
                <th>Link</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody>
      `;
      res.linkLive.forEach((l, i) => {
        html += `
            <tr>
                <td>
                    <div contenteditable="true" class="link-live-item editable-cell">${l}</div>
                </td>
                <td>
                    <button class="row-save-btn" onclick="simpanLink(${i}, this)">
                        💾 Simpan
                    </button>
                </td>
            </tr>
        `;
      });
      html += `
              </tbody>
            </table>
          </div>
      `;
      
      // === Bagian 3: Pengaturan Jadwal Pasaran ===
      const isJadwalPasaranOpen = panelKey === 'jadwalPasaran';
      html += `
        <h4 class="accordion">JAM JADWAL PASARAN</h4>
        <div class="panel" style="display:${isJadwalPasaranOpen ? "block" : "none"};">
          <table border="0" cellpadding="4">
            <thead>
              <tr>
                <th>Jam Tutup</th>
                <th>Nama Pasaran</th>
                <th>Diskon</th>
                <th>Jam Result</th>
                <th>Link resmi</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody>
      `;
      res.jadwalPasaran.forEach((j, i) => {
        const diskonValJadwal = (j.diskon && String(j.diskon).includes("%")) ? j.diskon : "NO DISCOUNT";
        html += `
              <tr>
                <td><div contenteditable="true" class="editable-cell">${j.jamTutup}</div></td>
                <td><div contenteditable="true" class="editable-cell">${j.namaPasaran}</div></td>
                <td><div contenteditable="true" class="editable-cell">${diskonValJadwal}</div></td>
                <td><div contenteditable="true" class="editable-cell">${j.jamResult}</div></td>
                <td><div contenteditable="true" class="editable-cell">${j.link}</div></td>
                <td>
                  <button class="row-save-btn" onclick="simpanJadwal(${i}, this)">
                    💾 Simpan
                  </button>
                </td>
              </tr>
        `;
      });
      html += `
              </tbody>
            </table>
          </div>
      `;
      
      // === Bagian 4: Pengaturan Kendala All ===
      const isKendalaAllOpen = panelKey === 'kendalaAll';
      html += `
        <h4 class="accordion">KENDALA ALL</h4>
        <div class="panel" style="display:${isKendalaAllOpen ? "block" : "none"};">
          <div id="kendalaList">
      `;
      res.kendalaAllData.forEach(item => {
        html += `
          <h5 class="kendala-accordion" data-row-index="${item.rowIndex}">
            <span>${item.judul}</span>
          </h5>
          <div class="kendala-panel">
            <table border="0" cellpadding="4">
              <tbody>
                <tr><td>Judul:</td><td><div contenteditable="true" class="editable-cell">${item.judul}</div></td></tr>
                <tr><td>Jawaban 1:</td><td><div contenteditable="true" class="editable-cell">${item.jawaban1}</div></td></tr>
                <tr><td>Jawaban 2:</td><td><div contenteditable="true" class="editable-cell">${item.jawaban2}</div></td></tr>
                <tr><td>Jawaban 3:</td><td><div contenteditable="true" class="editable-cell">${item.jawaban3}</div></td></tr>
              </tbody>
            </table>
            <div style="text-align: right; padding: 10px 0;">
                <button class="row-save-btn" onclick="updateKendalaAllRow(${item.rowIndex}, this)">
                    💾 Simpan
                </button>
            </div>
          </div>
        `;
      });
      html += `
          </div>
          <button class="row-save-btn" style="margin-top:20px;" onclick="tambahKendalaAllRow()">
              ➕ Tambah Baris
          </button>
        </div>
        <br/>
      `;

      // Render HTML ke dalam DOM
      document.getElementById("contentPengaturan").innerHTML = html;

      // Menambahkan event listener untuk accordion utama
      document.querySelectorAll("#contentPengaturan .accordion").forEach(a => {
        a.onclick = function() {
          const panel = this.nextElementSibling;
          panel.style.display = (panel.style.display === "block") ? "none" : "block";
        };
      });

      // Menambahkan event listener untuk accordion kendala
      document.querySelectorAll(".kendala-accordion").forEach(a => {
        a.onclick = function() {
          const panel = this.nextElementSibling;
          panel.style.display = (panel.style.display === "block") ? "none" : "block";
        };
      });
    })
    .getPengaturanTogelLengkap();
}

// FUNGSI JS UTAMA YANG SUDAH ADA (TIDAK PERLU DIUBAH)
function simpanBaris(groupIndex, indexItem, btn) {
  const h = document.querySelectorAll("#contentPengaturan h4")[groupIndex];
  const colNama = h.dataset.colNama;
  const colHadiah = h.dataset.colHadiah;
  const colDiskon = h.dataset.colDiskon;
  const rowNumber = btn.dataset.row;

  const row = btn.closest('tr');
  const nama = row.cells[0].innerText.trim();
  const hadiah = row.cells[1].querySelector('.editable-cell').innerText.trim();
  let diskon = row.cells[2].querySelector('.editable-cell').innerText.trim();
  if (diskon.toUpperCase() === "NO DISCOUNT") diskon = "";

  const payload = {
    nama,
    hadiah,
    diskon,
    rangeNama: `${colNama}${rowNumber}`,
    rangeHadiah: `${colHadiah}${rowNumber}`,
    rangeDiskon: `${colDiskon}${rowNumber}`
  };

  google.script.run
    .withSuccessHandler(res => {
      showToast(res.message);
      openPengaturanAfterSave('normal', groupIndex);
    })
    .withFailureHandler(err => showToast("Gagal simpan: " + err.message))
    .updatePengaturanTogelBaris(payload);
}

function simpanLink(index, btn) {
    const row = btn.closest('tr');
    // Ambil nilai dari textContent, bukan value
    const link = row.cells[0].querySelector('.link-live-item').textContent.trim();
    
    const payload = {
        index,
        link
    };
    
    // Panggil fungsi Apps Script untuk menyimpan
    google.script.run
        .withSuccessHandler(res => {
            showToast(res.message);
            openPengaturanAfterSave('jadwalPasaran');
        })
        .withFailureHandler(err => showToast("Gagal simpan: " + err.message))
        .updateLinkPasaran(payload);
}

function simpanJadwal(index, btn) {
    const row = btn.closest('tr');
    
    // Perbaikan: Ubah indeks sel agar dimulai dari 0
    const jamTutup = row.cells[0].querySelector('.editable-cell').textContent.trim();
    const namaPasaran = row.cells[1].querySelector('.editable-cell').textContent.trim();
    const diskon = row.cells[2].querySelector('.editable-cell').textContent.trim();
    const jamResult = row.cells[3].querySelector('.editable-cell').textContent.trim();
    const link = row.cells[4].querySelector('.editable-cell').textContent.trim();

    const payload = {
        index,
        jamTutup,
        namaPasaran,
        diskon,
        jamResult,
        link
    };

    google.script.run.withSuccessHandler(res => {
        showToast(res.message);
        openPengaturanAfterSave('jadwalPasaran');
    }).updateJadwalPasaran(payload);
}

function openPengaturan(panelKey, groupIndex) {
            google.script.run
                .withSuccessHandler(res => {
                    if (res.status === "error") {
                        document.getElementById("contentPengaturan").innerHTML = `<p>${res.message}</p>`;
                        return;
                    }

                    let html = "";
                    
                    res.data.forEach((k, currentGroupIndex) => {
                        const isPanelOpen = panelKey === 'normal' && groupIndex === currentGroupIndex;
                        html += `
                            <h4 class="accordion" data-col-nama="${k.colNama}" data-col-hadiah="${k.colHadiah}" data-col-diskon="${k.colDiskon}">
                                ${k.judul}
                            </h4>
                            <div class="panel" style="display:${isPanelOpen ? "block" : "none"};">
                                <table border="0" cellpadding="4">
                                    <thead><tr><th>Jenis Bet</th><th>Hadiah</th><th>Diskon</th><th>Aksi</th></tr></thead>
                                    <tbody>
                        `;
                        k.items.forEach((it, i) => {
                            const diskonVal = (it.diskon && String(it.diskon).includes("%")) ? it.diskon : "NO DISCOUNT";
                            const barisSheet = k.startRow + i;
                            html += `
                                <tr>
                                    <td>${it.nama}</td>
                                    <td><div contenteditable="true" class="editable-cell">${it.hadiah ?? ""}</div></td>
                                    <td><div contenteditable="true" class="editable-cell">${diskonVal}</div></td>
                                    <td><button class="row-save-btn" data-row="${barisSheet}" onclick="simpanBaris(${currentGroupIndex}, ${i}, this)">💾 Simpan</button></td>
                                </tr>
                            `;
                        });
                        html += `
                                    </tbody>
                                </table>
                            </div><br/>
                        `;
                    });
                    
                    const isLinkLiveOpen = panelKey === 'linkLive';
                    html += `
                        <h4 class="accordion">LINK LIVE PASARAN</h4>
                        <div class="panel" style="display:${isLinkLiveOpen ? "block" : "none"};">
                            <table border="0" cellpadding="4">
                                <thead><tr><th>Link</th><th>Aksi</th></tr></thead>
                                <tbody>
                    `;
                    res.linkLive.forEach((l, i) => {
                        html += `
                            <tr>
                                <td><div contenteditable="true" class="link-live-item editable-cell">${l}</div></td>
                                <td><button class="row-save-btn" onclick="simpanLink(${i}, this)">💾 Simpan</button></td>
                            </tr>
                        `;
                    });
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    const isJadwalPasaranOpen = panelKey === 'jadwalPasaran';
                    html += `
                        <h4 class="accordion">JAM JADWAL PASARAN</h4>
                        <div class="panel" style="display:${isJadwalPasaranOpen ? "block" : "none"};">
                            <table border="0" cellpadding="4">
                                <thead><tr><th>Jam Tutup</th><th>Nama Pasaran</th><th>Diskon</th><th>Jam Result</th><th>Link resmi</th><th>Aksi</th></tr></thead>
                                <tbody>
                    `;
                    res.jadwalPasaran.forEach((j, i) => {
                        const diskonValJadwal = (j.diskon && String(j.diskon).includes("%")) ? j.diskon : "NO DISCOUNT";
                        html += `
                            <tr>
                                <td><div contenteditable="true" class="editable-cell">${j.jamTutup}</div></td>
                                <td><div contenteditable="true" class="editable-cell">${j.namaPasaran}</div></td>
                                <td><div contenteditable="true" class="editable-cell">${diskonValJadwal}</div></td>
                                <td><div contenteditable="true" class="editable-cell">${j.jamResult}</div></td>
                                <td><div contenteditable="true" class="editable-cell">${j.link}</div></td>
                                <td><button class="row-save-btn" onclick="simpanJadwal(${i}, this)">💾 Simpan</button></td>
                            </tr>
                        `;
                    });
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                    
                    const isKendalaAllOpen = panelKey === 'kendalaAll';
                    html += `
                        <h4 class="accordion">KENDALA ALL</h4>
                        <div class="panel" style="display:${isKendalaAllOpen ? "block" : "none"};">
                            <div id="kendalaList">
                    `;
                    res.kendalaAllData.forEach(item => {
                        html += `
                            <h5 class="kendala-accordion" data-row-index="${item.rowIndex}">
                                <span>${item.judul}</span>
                            </h5>
                            <div class="kendala-panel">
                                <table border="0" cellpadding="4">
                                    <tbody>
                                        <tr><td>Judul:</td><td><div contenteditable="true" class="editable-cell">${item.judul}</div></td></tr>
                                        <tr><td>Jawaban 1:</td><td><div contenteditable="true" class="editable-cell">${item.jawaban1}</div></td></tr>
                                        <tr><td>Jawaban 2:</td><td><div contenteditable="true" class="editable-cell">${item.jawaban2}</div></td></tr>
                                        <tr><td>Jawaban 3:</td><td><div contenteditable="true" class="editable-cell">${item.jawaban3}</div></td></tr>
                                    </tbody>
                                </table>
                                <div style="text-align: right; padding: 10px 0;">
                                    <button class="row-save-btn" onclick="updateKendalaAllRow(${item.rowIndex}, this)">💾 Simpan</button>
                                </div>
                            </div>
                        `;
                    });
                    html += `
                            </div>
                            <button class="row-save-btn" style="margin-top:20px;" onclick="tambahKendalaAllRow()">
                                ➕ Tambah Baris
                            </button>
                        </div><br/>
                    `;

                    document.getElementById("contentPengaturan").innerHTML = html;

                    document.querySelectorAll("#contentPengaturan .accordion").forEach(a => {
                        a.onclick = function() {
                            const panel = this.nextElementSibling;
                            panel.style.display = (panel.style.display === "block") ? "none" : "block";
                        };
                    });

                    document.querySelectorAll(".kendala-accordion").forEach(a => {
                        a.onclick = function() {
                            const panel = this.nextElementSibling;
                            panel.style.display = (panel.style.display === "block") ? "none" : "block";
                        };
                    });
                })
                .getPengaturanTogelLengkap();
        }

function tambahKendalaAllRow() {
    const kendalaList = document.getElementById("kendalaList");
    
    const newKendalaHtml = `
        <h5 class="kendala-accordion">
            <span>BARIS BARU (BELUM DISIMPAN)</span>
        </h5>
        <div class="kendala-panel" style="display:block;">
            <table border="0" cellpadding="4">
                <tbody>
                    <tr><td>Judul:</td><td><div contenteditable="true" class="editable-cell"></div></td></tr>
                    <tr><td>Jawaban 1:</td><td><div contenteditable="true" class="editable-cell"></div></td></tr>
                    <tr><td>Jawaban 2:</td><td><div contenteditable="true" class="editable-cell"></div></td></tr>
                    <tr><td>Jawaban 3:</td><td><div contenteditable="true" class="editable-cell"></div></td></tr>
                </tbody>
            </table>
            <div style="text-align: right; padding: 10px 0;">
                <button class="row-save-btn" onclick="updateKendalaAllRow(-1, this)">
                    💾 Simpan
                </button>
            </div>
        </div>
    `;

    kendalaList.insertAdjacentHTML('beforeend', newKendalaHtml);

    const newAccordion = kendalaList.querySelector('.kendala-accordion:last-child');
    if (newAccordion) {
        newAccordion.onclick = function() {
            const panel = this.nextElementSibling;
            panel.style.display = (panel.style.display === "block") ? "none" : "block";
        };
    }
    
    showToast("Baris kosong berhasil ditambahkan.");
}

function updateKendalaAllRow(rowIndex, btn) {
    const parent = btn.closest('.kendala-panel');
    const editableCells = parent.querySelectorAll('.editable-cell');
    
    const payload = { 
        judul: editableCells[0].innerText.trim(),
        jawaban1: editableCells[1].innerText.trim(),
        jawaban2: editableCells[2].innerText.trim(),
        jawaban3: editableCells[3].innerText.trim()
    };

    if (rowIndex === -1) {
        google.script.run
            .withSuccessHandler(res => {
                showToast(res.message);
                openPengaturan('kendalaAll'); 
            })
            .withFailureHandler(err => showToast("Gagal simpan: " + err.message))
            .addNewKendala(payload);
    } else {
        payload.rowIndex = rowIndex;
        google.script.run
            .withSuccessHandler(res => {
                showToast(res.message);
                openPengaturan('kendalaAll');
            })
            .withFailureHandler(err => showToast("Gagal simpan: " + err.message))
            .updateKendalaAll(payload);
    }
}

function attachAccordionListeners() {
  document.querySelectorAll("#contentPengaturan .accordion").forEach(a => {
    a.onclick = function() {
      const panel = this.nextElementSibling;
      panel.style.display = (panel.style.display === "block") ? "none" : "block";
    };
  });
}

let reportData = []; 
let focusRowIndex = null; 

// =========================================================
//            FUNGSI HELPER (Auto Resize)
// =========================================================

/**
 * Mengubah tinggi textarea secara otomatis agar sesuai dengan isinya.
 */
function autoResizeTextarea(element) {
    if (element) {
        element.style.height = 'auto'; 
        element.style.height = (element.scrollHeight + 5) + 'px'; 
    }
}

// =========================================================
//            FUNGSI UTAMA MUAT DAN TAMPILKAN DATA
// =========================================================

/**
 * Memuat data dari Google Sheet dan menampilkannya.
 */
async function loadReportLineData() {
    const container = document.getElementById('reportLineCardContainer');
    container.innerHTML = `<p style="text-align:center; color:#00ffff;">⏳ Sedang memuat data dari Google Sheet...</p>`;
    
    google.script.run
        .withSuccessHandler((response) => {
            if (response.status === "error") {
                container.innerHTML = `<p style="text-align:center; color:#ff4d4d;">❗ Gagal memuat data: ${response.message}</p>`;
                showError("Gagal memuat data: " + response.message); 
                return;
            }

            reportData = response.data;
            displayReportLineData(reportData);
            
            if (focusRowIndex !== null) {
                setTimeout(() => {
                    restoreFocusAndScroll(focusRowIndex);
                    focusRowIndex = null;
                }, 100); 
            }
        })
        .withFailureHandler((error) => {
            container.innerHTML = `<p style="text-align:center; color:#ff4d4d;">❌ Error koneksi: ${error.message || 'Unknown error'}</p>`;
            showError("Error koneksi: " + error);
        })
        .getReportLineData();
}

/**
 * Menampilkan data ke dalam kontainer card.
 */
function displayReportLineData(data) {
    const container = document.getElementById('reportLineCardContainer');
    container.innerHTML = ''; 

    if (data.length === 0) {
        container.innerHTML = `<p style="text-align:center; color:#ffc107;">Tidak ada catatan yang ditemukan.</p>`;
        return;
    }

    data.forEach((item) => {
        const rowIndex = item.rowIndex;
        const isNewRow = item.isNew || false; 
        
        const urlPattern = /^(http|https):\/\/[^ "]+$/;
        const isLink = urlPattern.test(item.colB);

        const card = document.createElement('div');
        card.id = `report-row-${rowIndex}`;
        card.className = 'report-card';
        
        // --- JUDUL ACCORDION (Kolom A) ---
        const accordionTitle = document.createElement('h4');
        accordionTitle.className = 'card-accordion-title';
        
        const titleTextSpan = document.createElement('span');
        titleTextSpan.id = `title-text-${rowIndex}`;
        titleTextSpan.textContent = item.colA || `[Baris Kosong ${rowIndex}]`;
        accordionTitle.appendChild(titleTextSpan);

        // Ikon Copy Judul di samping Judul Accordion sudah DIHILANGKAN.

        accordionTitle.onclick = function() {
            const content = document.getElementById(`content-${rowIndex}`);
            const isVisible = content.style.display === "block";
            
            document.querySelectorAll('.card-content-panel').forEach(panel => {
                 panel.style.display = "none";
            });

            content.style.display = isVisible ? "none" : "block";

            if (!isVisible) {
                card.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        };
        card.appendChild(accordionTitle);

        // --- KONTEN DETAIL CARD (A, B, C, D) ---
        const contentDiv = document.createElement('div');
        contentDiv.id = `content-${rowIndex}`;
        contentDiv.className = 'card-content-panel';
        contentDiv.style.display = isNewRow ? 'block' : 'none';

        
        contentDiv.innerHTML = `
            <div class="report-field-group field-colA">
                <label>ALL KENDALA REPORT (Judul)</label>
                <div class="field-controls">
                    <div class="report-display-value wide-input" id="display-colA-${rowIndex}">${item.colA}</div>
                    <textarea class="report-edit-input wide-input" id="input-colA-${rowIndex}" style="display:none;">${item.colA}</textarea>
                    
                    <button class="btn-action btn-copy-small" 
                            onclick="copyReportCell('${rowIndex}', 'colA')"
                            style="margin-right: 5px; margin-top: 5px;">
                            💫 Copy Judul
                    </button>
                </div>
            </div>

            <hr class="neon-divider">

            <div class="report-field-group">
                <label>MEMO/REPORT</label>
                <div class="field-controls">
                    <div class="report-display-value wide-input" id="display-colB-${rowIndex}">${item.colB}</div>
                    <textarea class="report-edit-input wide-input" id="input-colB-${rowIndex}" style="display:none;">${item.colB}</textarea>
                    
                    <div class="action-buttons-group">
                        <button class="btn-action btn-copy-large" 
                                onclick="copyReportCell('${rowIndex}', 'colB')"
                                style="margin-right: 5px;">
                                💫 Copy Catatan
                        </button>
                        
                        ${isLink ? `
                            <button class="btn-action btn-link" 
                                    onclick="window.open('${item.colB}', '_blank')">
                                    🔗 Buka Link
                            </button>
                        ` : ''}
                    </div>
                </div>
            </div>

            <hr class="neon-divider">

            <div class="report-field-group">
                <label>POST/MEMO KE ADMIN,WA,FB</label>
                <div class="field-controls">
                    <div class="report-display-value wide-input small-field" id="display-colC-${rowIndex}">${item.colC}</div>
                    <textarea class="report-edit-input wide-input small-field" id="input-colC-${rowIndex}" style="display:none;">${item.colC}</textarea>
                    
                    </div>
            </div>

            <hr class="neon-divider">

            <div class="report-field-group">
                <label>REPORT KE LINE/TELE</label>
                <div class="field-controls">
                    <div class="report-display-value wide-input small-field" id="display-colD-${rowIndex}">${item.colD}</div>
                    <textarea class="report-edit-input wide-input small-field" id="input-colD-${rowIndex}" style="display:none;">${item.colD}</textarea>
                    
                    </div>
            </div>

            <hr class="neon-divider">

            <div class="card-actions-bottom">
                <button class="btn-action btn-cancel" 
                        onclick="toggleCancelEdit(${rowIndex}, ${isNewRow})" 
                        style="display:${isNewRow ? 'inline-block' : 'none'};">❌ Batal</button>

                <button class="btn-action btn-edit" onclick="toggleEditMode(${rowIndex}, true)" style="display:${isNewRow ? 'none' : 'inline-block'};">✏️ Edit</button>
                <button class="btn-action btn-save" onclick="saveReportRow(${rowIndex})" style="display:${isNewRow ? 'inline-block' : 'none'};">💾 Simpan</button>
            </div>
        `;
        card.appendChild(contentDiv);
        container.appendChild(card);
        
        // --- AUTO RESIZE INTEGRATION (untuk A, B, C, D) ---
        const inputColA = document.getElementById(`input-colA-${rowIndex}`);
        const inputColB = document.getElementById(`input-colB-${rowIndex}`);
        const inputColC = document.getElementById(`input-colC-${rowIndex}`); 
        const inputColD = document.getElementById(`input-colD-${rowIndex}`); 
        
        if (inputColA) {
            autoResizeTextarea(inputColA); 
            inputColA.addEventListener('input', () => autoResizeTextarea(inputColA));
        }

        if (inputColB) {
            autoResizeTextarea(inputColB); 
            inputColB.addEventListener('input', () => autoResizeTextarea(inputColB));
        }

        if (inputColC) { 
            autoResizeTextarea(inputColC); 
            inputColC.addEventListener('input', () => autoResizeTextarea(inputColC));
        }
        
        if (inputColD) { 
            autoResizeTextarea(inputColD); 
            inputColD.addEventListener('input', () => autoResizeTextarea(inputColD));
        }
    });
}

function restoreFocusAndScroll(rowIndex) {
    const card = document.getElementById(`report-row-${rowIndex}`);
    const content = document.getElementById(`content-${rowIndex}`);
    
    if (card && content) {
        card.style.display = 'block';
        content.style.display = 'block'; 
        card.scrollIntoView({ behavior: 'smooth', block: 'start' });

        toggleEditMode(rowIndex, false); 
    }
}

// =========================================================
//            FUNGSI AKSI BARIS (EDIT, SAVE, CANCEL)
// =========================================================

/**
 * Mengubah mode tampilan baris menjadi mode edit atau sebaliknya.
 */
function toggleEditMode(rowIndex, isEditMode) {
    const card = document.getElementById(`report-row-${rowIndex}`);
    const content = document.getElementById(`content-${rowIndex}`);
    const saveBtn = card.querySelector('.btn-save');
    const editBtn = card.querySelector('.btn-edit');
    const cancelBtn = card.querySelector('.btn-cancel');
    const title = card.querySelector('.card-accordion-title');
    
    // Hanya mencari tombol copy yang tersisa (di A dan B)
    const copyBtns = card.querySelectorAll('.btn-copy-large, .btn-copy-small'); 

    content.style.display = 'block'; 

    // Daftar Kolom yang Dapat Diedit (A, B, C, D)
    const editableCols = ['colA', 'colB', 'colC', 'colD']; 

    editableCols.forEach(colKey => {
        const display = document.getElementById(`display-${colKey}-${rowIndex}`);
        const input = document.getElementById(`input-${colKey}-${rowIndex}`);
        
        if (display && input) {
            if (isEditMode) {
                display.style.display = 'none';
                input.style.display = 'block';
                input.value = display.textContent.trim();
                autoResizeTextarea(input); 
            } else {
                display.textContent = input.value.trim();
                display.style.display = 'block';
                input.style.display = 'none';
            }
        }
    });

    if (isEditMode) {
        editBtn.style.display = 'none';
        saveBtn.style.display = 'inline-block';
        cancelBtn.style.display = 'inline-block';
        
        title.style.display = 'none';
        
        // Sembunyikan tombol copy di dalam detail saat edit
        copyBtns.forEach(btn => btn.style.display = 'none');

        document.getElementById(`input-colA-${rowIndex}`).focus();
    } else {
        editBtn.style.display = 'inline-block';
        saveBtn.style.display = 'none';
        cancelBtn.style.display = 'none';
        
        // Tampilkan tombol copy di dalam detail saat mode tampilan
        copyBtns.forEach(btn => btn.style.display = 'inline-block');

        title.style.display = 'flex';

        const newTitle = document.getElementById(`input-colA-${rowIndex}`).value.trim();
        const titleTextElement = document.getElementById(`title-text-${rowIndex}`);

        if (titleTextElement) {
            titleTextElement.textContent = newTitle || `[Baris Kosong ${rowIndex}]`;
        }
    }
}

/**
 * Menyimpan perubahan ke Google Sheet (Termasuk C dan D).
 */
async function saveReportRow(rowIndex) {
    const card = document.getElementById(`report-row-${rowIndex}`);
    const saveBtn = card.querySelector('.btn-save');
    
    // Payload LENGKAP dengan Kolom C dan D
    const payload = {
        rowIndex: rowIndex,
        colA: document.getElementById(`input-colA-${rowIndex}`).value.trim(),
        colB: document.getElementById(`input-colB-${rowIndex}`).value.trim(),
        colC: document.getElementById(`input-colC-${rowIndex}`).value.trim(),
        colD: document.getElementById(`input-colD-${rowIndex}`).value.trim()
    };
    
    focusRowIndex = rowIndex; 
    saveBtn.innerHTML = '...'; 
    saveBtn.disabled = true;

    google.script.run
        .withSuccessHandler((result) => {
            if (result.status === "success") {
                loadReportLineData(); 
                showToast(result.message); 
            } else {
                showError(result.message); 
                loadReportLineData(); 
            }
        })
        .withFailureHandler((error) => {
            showError("Gagal menyimpan: " + error);
            loadReportLineData();
        })
        .updateReportLineData(payload); 
}

function toggleCancelEdit(rowIndex, isNewRow) {
    if (isNewRow) {
        focusRowIndex = null; 
        loadReportLineData();
        showToast("❌ Pembuatan baris dibatalkan.", false);
    } else {
        focusRowIndex = rowIndex; 
        loadReportLineData(); 
        showToast("❌ Perubahan dibatalkan, kembali ke versi tersimpan.", false);
    }
}

// =========================================================
//            FUNGSI LAIN-LAIN (COPY, SEARCH, DETAIL)
// =========================================================

function searchReportLine() {
    const input = document.getElementById('reportSearch').value.toLowerCase();
    const allCards = document.querySelectorAll('#reportLineCardContainer .report-card');

    allCards.forEach(card => {
        const textContent = card.textContent.toLowerCase();
        card.style.display = textContent.includes(input) ? 'block' : 'none';
    });
}

function addNewReportRow() {
    const lastItem = reportData[reportData.length - 1];
    const newIndex = lastItem ? lastItem.rowIndex + 1 : 2; 

    if (newIndex > 450) {
        showError("Batas maksimum baris (200) telah tercapai.");
        return;
    }
    
    const newRowItem = {
        rowIndex: newIndex,
        colA: '', colB: '', colC: '', colD: '',
        isNew: true 
    };
    
    reportData.push(newRowItem);
    displayReportLineData(reportData);
    
    const row = document.getElementById(`report-row-${newIndex}`);
    if (row) {
        row.scrollIntoView({ behavior: 'smooth', block: 'end' });
        toggleEditMode(newIndex, true); 
        document.getElementById(`input-colA-${newIndex}`).focus();
    }
    
    showToast(`Baris kosong di baris ${newIndex} ditambahkan. Silakan isi dan Simpan.`);
}

/**
 * Menyalin teks judul (Kolom A) dari card ke clipboard.
 */
function copyReportTitle(rowIndex) {
    const textToCopy = document.getElementById(`title-text-${rowIndex}`).textContent.trim();
    
    navigator.clipboard.writeText(textToCopy).then(() => {
        showToast("Berhasil disalin"); 
    }).catch(err => {
        showError("Gagal menyalin teks.");
    });
}

/**
 * Menyalin konten dari kolom detail (A, atau B) ke clipboard.
 */
function copyReportCell(rowIndex, colKey) {
    const textToCopy = document.getElementById(`display-${colKey}-${rowIndex}`).textContent.trim();
    
    navigator.clipboard.writeText(textToCopy).then(() => {
        showToast("Berhasil disalin"); 
    }).catch(err => {
        showError("Gagal menyalin teks.");
    });
}

function viewReportDetail(rowIndex) {
    // Fungsi ini tidak lagi digunakan, tetapi disimpan sebagai placeholder.
    const content = document.getElementById(`display-colB-${rowIndex}`).textContent.trim();
    showToast(`Detail Kolom B: ${content.substring(0, 50)}...`);
}

</script>
</body>
</html>
