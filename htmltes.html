<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scatter Mahjong</title>
  <style>
body {
    margin: 0;
    padding: 30px;
    transition: background 0.8s ease-in-out;
    background-attachment: fixed;
    background-size: cover;
    font-family: 'Orbitron', 'Segoe UI', sans-serif;
    font-weight: bold;
}

.scatter-section {
  padding: 25px;
  max-width: 900px;
  margin: 40px auto;
  border-radius: 16px;
  border: 2px solid #00f7ff;
  box-shadow: 0 0 25px #00f7ff33;
  background: linear-gradient(145deg, #000a1f, #001a33);
  color: #00f7ff;
}

.scatter-section h2,
.scatter-section h3 {
  color: #00f7ff;
  text-shadow: 0 0 10px #00f7ff;
}

/* ================== BUTTON GROUP ================== */
.button-group {
  margin: 15px 0;
}

.btn {
  background-color: #1a1a1a;
  color: #00f7ff;
  border: 1px solid #00f7ff;
  padding: 10px 18px;
  margin-right: 10px;
  border-radius: 8px;
  cursor: pointer;
  transition: 0.3s;
}

.btn:hover {
  background-color: #00f7ff;
  color: #00FFFF;
}

.btn.danger {
  border-color: #ff4d4d;
  color: #ff4d4d;
}

.btn.danger:hover {
  background-color: #ff4d4d;
  color: #00FFFF;
}

/* ================= FREESPIN / BUYSPIN ================= */
.freespin-section {
  background: rgba(0, 20, 40, 0.9);
  padding: 30px;
  border-radius: 20px;
  max-width: 750px;
  margin: 40px auto;
  border: 1px solid #00f7ff44;
  box-shadow: 0 0 30px #00f7ff33;
  transition: all 0.3s ease;
}

.freespin-title {
  text-align: center;
  font-size: 22px;
  font-weight: bold;
  color: #00ffff;
  text-shadow: 0 0 10px #00ffffaa, 0 0 20px #00ffff66;
  margin-bottom: 20px;
}

.freespin-textarea {
  width: 100%;
  min-height: 150px;
  background: #00122b;
  color: #00f7ff;
  border: 1.5px solid #00f7ff;
  border-radius: 14px;
  padding: 15px;
  font-family: monospace;
  font-size: 15px;
  box-shadow: inset 0 0 12px #00f7ff33;
  resize: vertical;
  transition: all 0.3s ease;
}

.freespin-textarea:focus {
  border-color: #00d4ff;
  box-shadow: 0 0 20px #00d4ff;
  outline: none;
}

.freespin-button-group {
  display: flex;
  justify-content: center;
  margin: 20px 0;
}

.freespin-btn {
  padding: 12px 22px;
  border-radius: 12px;
  font-weight: bold;
  font-size: 14px;
  cursor: pointer;
  border: none;
  background-color: #00ffff;
  color: #00FFFF;
  box-shadow: 0 0 12px #00ffff77;
  transition: all 0.3s ease;
}

.freespin-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 20px #00ffffaa;
}

.freespin-btn.danger {
  background-color: #ff4444;
  color: #00FFFF;
  box-shadow: 0 0 12px #ff4444aa;
}

.freespin-btn.danger:hover {
  background-color: #cc0000;
  box-shadow: 0 0 20px #ff4444aa;
}

.freespin-result {
  margin-top: 25px;
  padding: 20px;
  background: radial-gradient(circle at top left, rgba(0, 255, 255, 0.1), rgba(0, 20, 40, 0.9));
  border-radius: 16px;
  border: 2px solid #00ffff;
  box-shadow: inset 0 0 15px rgba(0, 255, 255, 0.15), 0 0 20px rgba(0, 255, 255, 0.25);
}

.freespin-result .hasil-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 14px;
}

.freespin-result label {
  width: 140px;
  font-weight: 600;
  color: #00ffffcc;
}

.freespin-result .hasil-text {
  flex: 1;
  background: #001528;
  color: #00f7ff;
  padding: 8px 12px;
  border-radius: 8px;
  border: 1px solid #00f7ff44;
  font-family: monospace;
  font-size: 15px;
  box-shadow: inset 0 0 6px #00f7ff33;
}

.freespin-image-preview {
  display: flex;
  gap: 20px;
  margin-top: 25px;
  padding: 16px;
  background: #00122b;
  border-radius: 16px;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
}

.gambar-slot {
  flex: 0 0 auto;
  width: 160px;
  text-align: center;
  background: #000c1f;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #00f7ff33;
  box-shadow: 0 0 12px #00f7ff33;
  scroll-snap-align: start;
}

.gambar-slot img {
  width: 100%;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 0 10px #00f7ff33;
}

.gambar-slot img:hover {
  transform: scale(1.08);
  box-shadow: 0 0 20px #00ffffaa;
}

.freespin-caption {
  font-size: 13px;
  color: #00f7ff;
  background: #001e2a;
  padding: 6px 10px;
  border-radius: 8px;
  text-shadow: 0 0 6px #00f7ff88;
  box-shadow: inset 0 0 6px #00f7ff22;
}
/* ================== HASIL WRAPPER ================== */
.hasil-wrapper,
.freespin-result {
  margin-top: 20px;
  padding: 15px;
  background: #000f22;
  border-radius: 12px;
  box-shadow: inset 0 0 10px #00f7ff22;
}

.hasil-item {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
}

.hasil-item label {
  flex: 0 0 130px;
  color: #00FFFFcc;
  font-weight: 600;
}

.hasil-text {
  flex: 1;
  background: #001e2a;
  color: #00f7ff;
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid #00f7ff44;
  font-family: monospace;
  font-size: 15px;
  box-shadow: inset 0 0 5px #00f7ff;
  word-break: break-word;
}

/* ================== COPY BUTTON ================== */
.copy-btn {
  background-color: #222;
  border: 1px solid #00f7ff;
  color: #00f7ff;
  border-radius: 6px;
  cursor: pointer;
  padding: 5px 10px;
  font-size: 14px;
  transition: 0.3s;
}

.copy-btn:hover {
  background-color: #00f7ff;
  color: #00FFFF;
}

/* ================== GAMBAR SLOT ================== */
.gambar-container,
.freespin-image-preview {
  display: flex;
  gap: 18px;
  margin-top: 25px;
  padding: 14px;
  background: var(--bg-input-dark);
  border-radius: 12px;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  box-shadow: 0 0 18px #00f7ff22;
}

.gambar-slot {
  flex: 0 0 auto;
  width: 150px;
  text-align: center;
  background: #00FFFF;
  padding: 10px;
  border: 1.5px solid #00f7ff55;
  border-radius: 10px;
  box-shadow: 0 0 10px #00f7ff33;
  scroll-snap-align: start;
}

.gambar-slot h4 {
  margin-bottom: 5px;
  font-size: 15px;
  color: #00f7ff;
}

.gambar-slot img {
  width: 100%;
  border-radius: 8px;
  display: block;
  margin-bottom: 6px;
  cursor: pointer;
  box-shadow: 0 0 10px #00f7ff33;
  transition: 0.3s;
}

.gambar-slot img:hover {
  transform: scale(1.05);
  box-shadow: 0 0 16px #00f7ffcc;
}

.freespin-caption,
#caption1, #caption2, #caption3 {
  font-size: 13px;
  background: #001e2a;
  color: #00f7ff;
  padding: 5px 8px;
  border-radius: 6px;
  text-shadow: 0 0 6px #00f7ff88;
  box-shadow: inset 0 0 4px #00f7ff22;
}

.nav-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  font-size: 32px;
  color: #00f7ff;
  background: none;
  border: none;
  cursor: pointer;
  padding: 10px;
}

 .lightbox-caption {
            color: #ccc;
            font-size: 1.2em;
            text-align: center;
            padding: 10px 0;
            height: 150px; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; 
        }
  </style>
</head>
<body>

<div class="scatter-section">
  <h3 class="judul-glow">ðŸ’« LINE TOGEL ðŸ’«</h3>
  <h2>ðŸ’£ DATA SCATTER MAHJONG</h2>

  <!-- Tombol TS ON/OFF -->
  <div class="button-group" style="margin: 10px 0;">
    <button id="tsToggleBtn" onclick="toggleTSMode()" class="ts-toggle">TS: OFF</button>
  </div>

  <textarea id="scatterTextarea" class="input-textarea" placeholder="Tempelkan 1â€“7 baris data (satu baris = satu transaksi)..."></textarea>

  <div class="button-group">
    <button onclick="hapusScatter()" class="btn danger">ðŸ§¹ Hapus</button>
  </div>

  <!-- Wadah hasil multi-transaksi -->
  <div id="hasilScatterContainer"></div>
</div>

<!-- Modal Zoom Lightbox -->
        <div id="hasilScatter" class="hasil-wrapper">
            <div class="hasil-item"><label>User ID :</label><div class="hasil-text" id="hasilUserID">-</div><button onclick="copyText('hasilUserID')" class="copy-btn">ðŸ’«</button></div>
            <div class="hasil-item"><label>Kode Tiket :</label><div class="hasil-text" id="hasilKodeTiket">-</div><button onclick="copyText('hasilKodeTiket')" class="copy-btn">ðŸ’«</button></div>
            <div class="hasil-item"><label>Link Bukti :</label><div class="hasil-text" id="hasilLinkBukti">-</div><button onclick="copyText('hasilLinkBukti')" class="copy-btn">ðŸ’«</button></div>
            <div class="hasil-item"><label>Bettingan :</label><div class="hasil-text" id="hasilBettingan">-</div><button onclick="copyText('hasilBettingan')" class="copy-btn">ðŸ’«</button></div>
        </div>

        <div class="gambar-container">
            <div class="gambar-slot">
                <h4>Gambar 1</h4>
                <img id="gambar1" src="" style="display:none;" onclick="openLightbox()" /> 
                <div id="caption1">-</div>
            </div>
            <div class="gambar-slot">
                <h4>Gambar 2</h4>
                <img id="gambar2" src="" style="display:none;" onclick="openLightbox()" />
                <div id="caption2">-</div>
            </div>
            <div class="gambar-slot">
                <h4>Gambar 3</h4>
                <img id="gambar3" src="" style="display:none;" onclick="openLightbox()" />
                <div id="caption3">-</div>
            </div>
        </div>
    </div>
</div>

<div id="lightboxModal" class="lightbox-modal">
    <span class="close-btn" onclick="closeLightbox()">&times;</span>
    <div class="lightbox-content">
        <div id="imageLoader" class="loader"></div>
        <img id="lightboxImage" src="" style="width:100%; display:none;" onmousemove="zoomImage(event)" onmouseout="resetZoom()">
    </div>
    <div class="lightbox-caption">
        <div id="lightboxCaptionText">User ID: - | Status: Loading Gambar Gabungan...</div>
        <div class="zoom-display-container">
            <img id="zoomDisplay" src="">
        </div>
    </div>
</div>

<script>
// Mode TS global
let tsModeActive = false;

function toggleTSMode() {
  tsModeActive = !tsModeActive;
  const btn = document.getElementById("tsToggleBtn");
  if (tsModeActive) {
    btn.textContent = "TS: ON";
    btn.classList.add("on");
  } else {
    btn.textContent = "TS: OFF";
    btn.classList.remove("on");
  }
  if (document.getElementById("scatterTextarea").value.trim()) {
    hitungScatter();
  }
}

// Ekstrak data dari satu baris
function extractFromLine(line) {
  let userId = "-";

  // Parsing User ID
  const parts = line.split(/\s+/);
  for (let i = 0; i < parts.length; i++) {
    if (/^20\d{2}$/.test(parts[i]) && i + 1 < parts.length) {
      const calon = parts[i + 1].trim();
      if (calon.length >= 3 && !/^\d+$/.test(calon)) {
        userId = calon;
        break;
      }
    }
  }

  // Jika mode TS aktif, tambahkan " TS" di akhir
  if (tsModeActive && userId !== "-") {
    userId += " TS";
  }

  const gambarRegex = /(https?:\/\/[^\s]+?\.(?:jpg|jpeg|png|gif|webp|bmp|svg)|https?:\/\/(?:prnt\.sc|imghostr\.com)\/[^\s]+)/gi;
  const gambarLinks = line.match(gambarRegex) || [];

  const kodeTiketMatch = line.match(/\b\d{17,20}\b/);
  const kodeTiket = kodeTiketMatch ? kodeTiketMatch[0] : "-";

  const betMatch = line.match(/BET\s+([0-9.,\- ]+)/i);
  let bettingan = "-";
  if (betMatch) {
    const parts = betMatch[1].split("-");
    bettingan = parts[0].trim();
  }

  return { userId, kodeTiket, gambarLinks, bettingan };
}

// Render semua hasil
function renderHasil(transaksiList) {
  const container = document.getElementById("hasilScatterContainer");
  container.innerHTML = "";

  transaksiList.forEach((trans, idx) => {
    const { userId, kodeTiket, gambarLinks, bettingan } = trans;
    const prefix = `t${idx}_`;

    let gambarHTML = '';
    for (let i = 1; i <= 3; i++) {
      const link = gambarLinks[i - 1];
      let content = '<div>-</div>';
      if (link) {
        if (link.includes('prnt.sc') || link.includes('imghostr.com')) {
          content = `<a href="${link}" target="_blank" style="color:#ffcc00;">Lihat Gambar ${i}</a>`;
        } else {
          content = `<img src="${link}" onclick="openLightbox('${link}', '${userId}')" />`;
        }
      }
      gambarHTML += `
        <div class="gambar-slot-multi">
          <h4 style="margin:4px 0;font-size:14px;">Gambar ${i}</h4>
          ${content}
          <div class="userid-label">User ID: ${userId}</div>
        </div>
      `;
    }

    const block = document.createElement("div");
    block.className = "hasil-transaksi";
    block.innerHTML = `
      <div class="hasil-item" id="${prefix}uidItem">
        <label>User ID:</label>
        <div class="hasil-text" id="${prefix}uid">${userId}</div>
        <button class="copy-btn" onclick="copyText('${prefix}uid', '${prefix}uidItem')">ðŸ’«</button>
      </div>
      <div class="hasil-item" id="${prefix}ktItem">
        <label>Kode Tiket:</label>
        <div class="hasil-text" id="${prefix}kt">${kodeTiket}</div>
        <button class="copy-btn" onclick="copyText('${prefix}kt', '${prefix}ktItem')">ðŸ’«</button>
      </div>
      <div class="hasil-item" id="${prefix}lbItem">
        <label>Link Bukti:</label>
        <div class="hasil-text" id="${prefix}lb">${gambarLinks.join(", ") || "-"}</div>
        <button class="copy-btn" onclick="copyText('${prefix}lb', '${prefix}lbItem')">ðŸ’«</button>
      </div>
      <div class="hasil-item" id="${prefix}betItem">
        <label>Bettingan:</label>
        <div class="hasil-text" id="${prefix}bet">${bettingan}</div>
        <button class="copy-btn" onclick="copyText('${prefix}bet', '${prefix}betItem')">ðŸ’«</button>
      </div>
      <div class="gambar-container-multi">
        ${gambarHTML}
      </div>
    `;
    container.appendChild(block);
  });
}

// Fungsi utama
function hitungScatter() {
  const input = document.getElementById("scatterTextarea").value.trim();
  if (!input) {
    document.getElementById("hasilScatterContainer").innerHTML = "";
    return;
  }

  const lines = input.split("\n").slice(0, 7); // Ambil maks 7 baris
  const transList = lines.map(line => extractFromLine(line.trim()));
  renderHasil(transList);
}

function hapusScatter() {
  document.getElementById("scatterTextarea").value = "";
  document.getElementById("hasilScatterContainer").innerHTML = "";
}

// Copy dengan efek background merah
function copyText(elementId, itemContainerId) {
  const el = document.getElementById(elementId);
  const container = document.getElementById(itemContainerId);
  if (!el || el.innerText === "-") return;

  navigator.clipboard.writeText(el.innerText).then(() => {
    container.classList.add("red-bg");
    setTimeout(() => {
      container.classList.remove("red-bg");
    }, 1000);
  }).catch(err => {
    console.warn("Gagal menyalin:", err);
  });
}

// === LIGHTBOX DENGAN NAVIGASI ===
let currentLightboxIndex = 0;
let currentLightboxImages = [];
let currentLightboxUserId = "";

function openLightbox(imgUrl, userId) {
  const modal = document.getElementById("lightboxModal");
  const img = document.getElementById("lightboxImg");
  const caption = document.getElementById("lightboxCaption");

  currentLightboxImages = getCurrentTransaksiImages(userId);
  currentLightboxUserId = userId;
  currentLightboxIndex = currentLightboxImages.findIndex(img => img === imgUrl);
  if (currentLightboxIndex === -1) currentLightboxIndex = 0;

  img.src = currentLightboxImages[currentLightboxIndex];
  caption.innerText = `User ID: ${userId}`;
  modal.style.display = "flex";

  updateNavButtons();
}

function getCurrentTransaksiImages(userId) {
  const allItems = document.querySelectorAll('.hasil-transaksi');
  for (let item of allItems) {
    const uidEl = item.querySelector('.hasil-text[id$="uid"]');
    if (uidEl && uidEl.innerText === userId) {
      const imgEls = item.querySelectorAll('.gambar-slot-multi img');
      return Array.from(imgEls).map(el => el.src).filter(src => src);
    }
  }
  return [];
}

function prevImage() {
  if (currentLightboxImages.length <= 1) return;
  currentLightboxIndex = (currentLightboxIndex - 1 + currentLightboxImages.length) % currentLightboxImages.length;
  updateLightboxImage();
}

function nextImage() {
  if (currentLightboxImages.length <= 1) return;
  currentLightboxIndex = (currentLightboxIndex + 1) % currentLightboxImages.length;
  updateLightboxImage();
}

function updateLightboxImage() {
  const img = document.getElementById("lightboxImg");
  const caption = document.getElementById("lightboxCaption");
  img.src = currentLightboxImages[currentLightboxIndex];
  caption.innerText = `User ID: ${currentLightboxUserId}`;
  updateNavButtons();
}

function updateNavButtons() {
  const prevBtn = document.querySelector('.prev');
  const nextBtn = document.querySelector('.next');

  if (currentLightboxImages.length <= 1) {
    prevBtn.style.opacity = '0.3';
    nextBtn.style.opacity = '0.3';
    prevBtn.style.pointerEvents = 'none';
    nextBtn.style.pointerEvents = 'none';
  } else {
    prevBtn.style.opacity = '1';
    nextBtn.style.opacity = '1';
    prevBtn.style.pointerEvents = 'auto';
    nextBtn.style.pointerEvents = 'auto';
  }
}

function closeLightbox() {
  document.getElementById("lightboxModal").style.display = "none";
  currentLightboxImages = [];
  currentLightboxUserId = "";
  currentLightboxIndex = 0;
}

// Navigasi keyboard
document.addEventListener('keydown', (e) => {
  const lightbox = document.getElementById('lightboxModal');
  if (lightbox.style.display !== 'flex') return;

  if (e.key === 'ArrowLeft') {
    prevImage();
  } else if (e.key === 'ArrowRight') {
    nextImage();
  } else if (e.key === 'Escape') {
    closeLightbox();
  }
});

// Event listener input
document.addEventListener("DOMContentLoaded", () => {
  const ta = document.getElementById("scatterTextarea");
  if (ta) {
    ta.addEventListener("paste", () => setTimeout(hitungScatter, 50));
    ta.addEventListener("input", hitungScatter);
  }
});
</script>

</body>

</html>
