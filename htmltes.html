<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Scatter Mahjong</title>
  <style>
    body {
      background: #111;
      color: white;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .scatter-section {
      max-width: 900px;
      margin: 0 auto;
    }
    .judul-glow {
      text-align: center;
      color: #ffcc00;
      text-shadow: 0 0 10px #ffcc00, 0 0 20px #ffcc00;
    }
    h2 {
      text-align: center;
      color: #ff5555;
    }
    .input-textarea {
      width: 100%;
      height: 100px;
      background: #222;
      color: white;
      border: 1px solid #444;
      border-radius: 6px;
      padding: 10px;
      margin: 10px 0;
      resize: vertical;
    }
    .button-group {
      text-align: center;
      margin: 10px 0;
    }
    .btn {
      padding: 8px 16px;
      margin: 0 5px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    .btn.danger {
      background: #ff4444;
      color: white;
    }
    .ts-toggle {
      background: #555;
      color: white;
      border: 1px solid #777;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    .ts-toggle.on {
      background: #2a802a;
      color: white;
      border-color: #4caf50;
    }

    .hasil-transaksi {
      border: 1px solid #444;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
      background: #222;
    }

    .hasil-item {
      display: flex;
      align-items: center;
      margin: 6px 0;
      padding: 6px;
      border-radius: 4px;
    }
    .hasil-item label {
      width: 110px;
      color: #ffcc00;
      font-weight: bold;
    }
    .hasil-text {
      flex: 1;
      color: white;
      word-break: break-all;
    }
    .copy-btn {
      margin-left: 8px;
      padding: 4px 8px;
      background: #444;
      color: #ffcc00;
      border: 1px solid #666;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }

    .gambar-container-multi {
      margin-top: 12px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .gambar-slot-multi {
      text-align: center;
      width: 110px;
    }
    .gambar-slot-multi img {
      max-width: 100%;
      border-radius: 4px;
      cursor: pointer;
      border: 1px solid #444;
    }
    .userid-label {
      margin-top: 6px;
      font-size: 12px;
      color: #aaa;
    }

    /* Efek background merah setelah copy */
    .hasil-item.red-bg {
      background: #ff6666;
      transition: background 0.3s;
    }

    /* Lightbox Modal */
    .lightbox-modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      justify-content: center;
      align-items: center;
      flex-direction: column;
      padding: 20px;
    }
    .lightbox-modal img {
      max-width: 90%;
      max-height: 80vh;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(255,255,255,0.5);
    }
    .lightbox-caption {
      margin-top: 10px;
      color: white;
      font-size: 14px;
      background: rgba(0,0,0,0.7);
      padding: 8px 12px;
      border-radius: 4px;
    }
    .close {
      position: absolute;
      top: 20px;
      right: 30px;
      font-size: 30px;
      color: white;
      cursor: pointer;
      z-index: 10000;
    }

    /* Tombol navigasi di lightbox */
    .nav-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 40px;
      color: white;
      cursor: pointer;
      z-index: 10000;
      background: rgba(0,0,0,0.5);
      padding: 10px 15px;
      border-radius: 50%;
      user-select: none;
    }
    .prev {
      left: 20px;
    }
    .next {
      right: 20px;
    }
    .nav-btn:hover {
      background: rgba(255,255,255,0.2);
    }
  </style>
</head>
<body>

<div class="scatter-section">
  <h3 class="judul-glow">ðŸ’« LINE TOGEL ðŸ’«</h3>
  <h2>ðŸ’£ DATA SCATTER MAHJONG</h2>

  <!-- Tombol TS ON/OFF -->
  <div class="button-group" style="margin: 10px 0;">
    <button id="tsToggleBtn" onclick="toggleTSMode()" class="ts-toggle">TS: OFF</button>
  </div>

  <textarea id="scatterTextarea" class="input-textarea" placeholder="Tempelkan 1â€“7 baris data (satu baris = satu transaksi)..."></textarea>

  <div class="button-group">
    <button onclick="hapusScatter()" class="btn danger">ðŸ§¹ Hapus</button>
  </div>

  <!-- Wadah hasil multi-transaksi -->
  <div id="hasilScatterContainer"></div>
</div>

<!-- Modal Zoom Lightbox -->
<div id="lightboxModal" class="lightbox-modal" style="display:none;">
  <span class="close" onclick="closeLightbox()">&times;</span>
  <span class="nav-btn prev" onclick="prevImage()">&lsaquo;</span>
  <span class="nav-btn next" onclick="nextImage()">&rsaquo;</span>
  <img id="lightboxImg" src="" alt="Zoomed Image" />
  <div id="lightboxCaption" class="lightbox-caption">User ID: -</div>
</div>

<script>
// Mode TS global
let tsModeActive = false;

function toggleTSMode() {
  tsModeActive = !tsModeActive;
  const btn = document.getElementById("tsToggleBtn");
  if (tsModeActive) {
    btn.textContent = "TS: ON";
    btn.classList.add("on");
  } else {
    btn.textContent = "TS: OFF";
    btn.classList.remove("on");
  }
  if (document.getElementById("scatterTextarea").value.trim()) {
    hitungScatter();
  }
}

// Ekstrak data dari satu baris
function extractFromLine(line) {
  let userId = "-";

  // Parsing User ID
  const parts = line.split(/\s+/);
  for (let i = 0; i < parts.length; i++) {
    if (/^20\d{2}$/.test(parts[i]) && i + 1 < parts.length) {
      const calon = parts[i + 1].trim();
      if (calon.length >= 3 && !/^\d+$/.test(calon)) {
        userId = calon;
        break;
      }
    }
  }

  // Jika mode TS aktif, tambahkan " TS" di akhir
  if (tsModeActive && userId !== "-") {
    userId += " TS";
  }

  const gambarRegex = /(https?:\/\/[^\s]+?\.(?:jpg|jpeg|png|gif|webp|bmp|svg)|https?:\/\/(?:prnt\.sc|imghostr\.com)\/[^\s]+)/gi;
  const gambarLinks = line.match(gambarRegex) || [];

  const kodeTiketMatch = line.match(/\b\d{17,20}\b/);
  const kodeTiket = kodeTiketMatch ? kodeTiketMatch[0] : "-";

  const betMatch = line.match(/BET\s+([0-9.,\- ]+)/i);
  let bettingan = "-";
  if (betMatch) {
    const parts = betMatch[1].split("-");
    bettingan = parts[0].trim();
  }

  return { userId, kodeTiket, gambarLinks, bettingan };
}

// Render semua hasil
function renderHasil(transaksiList) {
  const container = document.getElementById("hasilScatterContainer");
  container.innerHTML = "";

  transaksiList.forEach((trans, idx) => {
    const { userId, kodeTiket, gambarLinks, bettingan } = trans;
    const prefix = `t${idx}_`;

    let gambarHTML = '';
    for (let i = 1; i <= 3; i++) {
      const link = gambarLinks[i - 1];
      let content = '<div>-</div>';
      if (link) {
        if (link.includes('prnt.sc') || link.includes('imghostr.com')) {
          content = `<a href="${link}" target="_blank" style="color:#ffcc00;">Lihat Gambar ${i}</a>`;
        } else {
          content = `<img src="${link}" onclick="openLightbox('${link}', '${userId}')" />`;
        }
      }
      gambarHTML += `
        <div class="gambar-slot-multi">
          <h4 style="margin:4px 0;font-size:14px;">Gambar ${i}</h4>
          ${content}
          <div class="userid-label">User ID: ${userId}</div>
        </div>
      `;
    }

    const block = document.createElement("div");
    block.className = "hasil-transaksi";
    block.innerHTML = `
      <div class="hasil-item" id="${prefix}uidItem">
        <label>User ID:</label>
        <div class="hasil-text" id="${prefix}uid">${userId}</div>
        <button class="copy-btn" onclick="copyText('${prefix}uid', '${prefix}uidItem')">ðŸ’«</button>
      </div>
      <div class="hasil-item" id="${prefix}ktItem">
        <label>Kode Tiket:</label>
        <div class="hasil-text" id="${prefix}kt">${kodeTiket}</div>
        <button class="copy-btn" onclick="copyText('${prefix}kt', '${prefix}ktItem')">ðŸ’«</button>
      </div>
      <div class="hasil-item" id="${prefix}lbItem">
        <label>Link Bukti:</label>
        <div class="hasil-text" id="${prefix}lb">${gambarLinks.join(", ") || "-"}</div>
        <button class="copy-btn" onclick="copyText('${prefix}lb', '${prefix}lbItem')">ðŸ’«</button>
      </div>
      <div class="hasil-item" id="${prefix}betItem">
        <label>Bettingan:</label>
        <div class="hasil-text" id="${prefix}bet">${bettingan}</div>
        <button class="copy-btn" onclick="copyText('${prefix}bet', '${prefix}betItem')">ðŸ’«</button>
      </div>
      <div class="gambar-container-multi">
        ${gambarHTML}
      </div>
    `;
    container.appendChild(block);
  });
}

// Fungsi utama
function hitungScatter() {
  const input = document.getElementById("scatterTextarea").value.trim();
  if (!input) {
    document.getElementById("hasilScatterContainer").innerHTML = "";
    return;
  }

  const lines = input.split("\n").slice(0, 7); // Ambil maks 7 baris
  const transList = lines.map(line => extractFromLine(line.trim()));
  renderHasil(transList);
}

function hapusScatter() {
  document.getElementById("scatterTextarea").value = "";
  document.getElementById("hasilScatterContainer").innerHTML = "";
}

// Copy dengan efek background merah
function copyText(elementId, itemContainerId) {
  const el = document.getElementById(elementId);
  const container = document.getElementById(itemContainerId);
  if (!el || el.innerText === "-") return;

  navigator.clipboard.writeText(el.innerText).then(() => {
    container.classList.add("red-bg");
    setTimeout(() => {
      container.classList.remove("red-bg");
    }, 1000);
  }).catch(err => {
    console.warn("Gagal menyalin:", err);
  });
}

// === LIGHTBOX DENGAN NAVIGASI ===
let currentLightboxIndex = 0;
let currentLightboxImages = [];
let currentLightboxUserId = "";

function openLightbox(imgUrl, userId) {
  const modal = document.getElementById("lightboxModal");
  const img = document.getElementById("lightboxImg");
  const caption = document.getElementById("lightboxCaption");

  currentLightboxImages = getCurrentTransaksiImages(userId);
  currentLightboxUserId = userId;
  currentLightboxIndex = currentLightboxImages.findIndex(img => img === imgUrl);
  if (currentLightboxIndex === -1) currentLightboxIndex = 0;

  img.src = currentLightboxImages[currentLightboxIndex];
  caption.innerText = `User ID: ${userId}`;
  modal.style.display = "flex";

  updateNavButtons();
}

function getCurrentTransaksiImages(userId) {
  const allItems = document.querySelectorAll('.hasil-transaksi');
  for (let item of allItems) {
    const uidEl = item.querySelector('.hasil-text[id$="uid"]');
    if (uidEl && uidEl.innerText === userId) {
      const imgEls = item.querySelectorAll('.gambar-slot-multi img');
      return Array.from(imgEls).map(el => el.src).filter(src => src);
    }
  }
  return [];
}

function prevImage() {
  if (currentLightboxImages.length <= 1) return;
  currentLightboxIndex = (currentLightboxIndex - 1 + currentLightboxImages.length) % currentLightboxImages.length;
  updateLightboxImage();
}

function nextImage() {
  if (currentLightboxImages.length <= 1) return;
  currentLightboxIndex = (currentLightboxIndex + 1) % currentLightboxImages.length;
  updateLightboxImage();
}

function updateLightboxImage() {
  const img = document.getElementById("lightboxImg");
  const caption = document.getElementById("lightboxCaption");
  img.src = currentLightboxImages[currentLightboxIndex];
  caption.innerText = `User ID: ${currentLightboxUserId}`;
  updateNavButtons();
}

function updateNavButtons() {
  const prevBtn = document.querySelector('.prev');
  const nextBtn = document.querySelector('.next');

  if (currentLightboxImages.length <= 1) {
    prevBtn.style.opacity = '0.3';
    nextBtn.style.opacity = '0.3';
    prevBtn.style.pointerEvents = 'none';
    nextBtn.style.pointerEvents = 'none';
  } else {
    prevBtn.style.opacity = '1';
    nextBtn.style.opacity = '1';
    prevBtn.style.pointerEvents = 'auto';
    nextBtn.style.pointerEvents = 'auto';
  }
}

function closeLightbox() {
  document.getElementById("lightboxModal").style.display = "none";
  currentLightboxImages = [];
  currentLightboxUserId = "";
  currentLightboxIndex = 0;
}

// Navigasi keyboard
document.addEventListener('keydown', (e) => {
  const lightbox = document.getElementById('lightboxModal');
  if (lightbox.style.display !== 'flex') return;

  if (e.key === 'ArrowLeft') {
    prevImage();
  } else if (e.key === 'ArrowRight') {
    nextImage();
  } else if (e.key === 'Escape') {
    closeLightbox();
  }
});

// Event listener input
document.addEventListener("DOMContentLoaded", () => {
  const ta = document.getElementById("scatterTextarea");
  if (ta) {
    ta.addEventListener("paste", () => setTimeout(hitungScatter, 50));
    ta.addEventListener("input", hitungScatter);
  }
});
</script>

</body>
</html>