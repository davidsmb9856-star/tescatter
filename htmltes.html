<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galeri Keyboard Navigasi & Zoom Otomatis</title>
    <style>
:root {
    --neon-blue: #00ffff; /* Biru Neon Cerah */
    --dark-background: #121212; /* Latar Belakang Sangat Gelap */
    --card-background: #1e1e1e; /* Latar Belakang Card Gelap */
    --input-background: #2a2a2a; /* Latar Belakang Input Gelap */
    --border-color: #00bfff; /* Biru Neon Sekunder untuk batas */
    --text-color: #e0f7fa; /* Teks Putih Kebiruan */
    --secondary-neon: #00bfff; /* Biru Neon Sekunder untuk highlight */
    --danger-color: #ff4d4d; /* Merah Neon untuk bahaya */
    --success-color: #39ff14; /* Hijau Neon untuk sukses */
    --warning-color: #f1c40f; /* Kuning Neon untuk peringatan/caption */
    --primary-button: #00bfff; /* Warna utama tombol */
    --primary-button-hover: #00e5ff;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--dark-background);
    color: var(--text-color);
    padding: 20px;
    margin: 0;
    line-height: 1.6;
}

.container, 
.scatter-section {
    max-width: 960px;
    margin: 20px auto;
    background: var(--card-background); 
    padding: 30px;
    border-radius: 12px;
    /* Efek glow biru neon */
    box-shadow: 0 0 20px rgba(0, 255, 255, 0.2), 0 0 10px rgba(0, 255, 255, 0.1); 
    border: 1px solid var(--secondary-neon);
}

.scatter-section {
    padding: 20px;
    margin-bottom: 25px;
}

h1 {
    text-align: center;
    color: var(--neon-blue);
    margin-bottom: 25px;
    /* Efek neon */
    text-shadow: 0 0 8px var(--neon-blue), 0 0 15px var(--secondary-neon); 
    font-size: 2.5em;
}

h2 {
    text-align: center;
    color: var(--secondary-neon);
    margin-top: 20px;
    text-shadow: 0 0 5px rgba(0, 191, 255, 0.7);
}

.judul-glow {
    text-align: center;
    color: var(--success-color); /* Menggunakan warna sukses neon */
    text-shadow: 0 0 10px var(--success-color), 0 0 20px var(--success-color);
    margin-bottom: 20px;
    font-size: 2.5em; /* Konsisten dengan h1 */
}

/* * --- Form, Input & Tombol --- 
 */
textarea {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border: 1px solid var(--secondary-neon); /* Border neon */
    box-sizing: border-box;
    background-color: var(--input-background); /* Latar belakang gelap */
    color: var(--text-color);
    border-radius: 6px;
    resize: vertical;
    /* Efek glow ringan saat fokus */
    transition: box-shadow 0.3s;
}

textarea:focus {
    outline: none;
    box-shadow: 0 0 8px rgba(0, 191, 255, 0.8);
}

/* Style untuk semua button yang tidak spesifik */
button,
.btn {
    padding: 10px 18px;
    color: var(--dark-background);
    background-color: var(--primary-button); /* Biru neon sebagai warna primer */
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s, box-shadow 0.3s;
    font-weight: bold;
    margin-right: 10px;
    /* Efek neon ringan */
    box-shadow: 0 0 5px rgba(0, 191, 255, 0.5);
}

button:hover,
.btn:hover {
    background-color: var(--primary-button-hover);
    box-shadow: 0 0 10px var(--primary-button-hover);
}

/* Tombol Danger */
#clearDataBtn,
.btn.danger {
    background-color: var(--danger-color); /* Merah Neon */
    color: var(--text-color);
    box-shadow: 0 0 5px var(--danger-color);
}
#clearDataBtn:hover,
.btn.danger:hover {
    background-color: #ff8080; /* Merah yang lebih terang saat hover */
    box-shadow: 0 0 10px var(--danger-color);
}

.button-group {
    display: flex;
    justify-content: flex-end; /* Posisikan tombol Hapus di kanan */
    margin-bottom: 15px;
    margin-top: 10px; /* Diperbarui agar lebih konsisten */
    text-align: unset; /* override center dari style lama */
}

/* * --- Galeri dan Slot Gambar Utama --- 
 */
.gallery-container {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 20px;
}

/* ----- Tampilan Gabungan (Slot) ----- */
.combined-image-slot {
    flex-grow: 0;
    width: 80%;
    max-width: 700px;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    border: 2px solid var(--secondary-neon);
    padding: 5px;
    border-radius: 8px;
    cursor: pointer;
    transition: transform 0.3s, box-shadow 0.3s, opacity 0.3s;
    background-color: var(--input-background);
    min-height: 200px;
}

.combined-image-slot:hover {
    transform: scale(1.03);
    /* Efek glow saat hover */
    box-shadow: 0 0 15px rgba(0, 191, 255, 0.8), 0 0 20px rgba(0, 191, 255, 0.4); 
}

.combined-image-slot img {
    max-width: 33.33%; 
    height: 180px; 
    object-fit: contain; 
    display: block;
    margin: 0;
    border-radius: 4px; 
}
 
.combined-image-slot .caption-userid {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--warning-color);
    font-size: 1.5em;
    font-weight: bold;
    background-color: rgba(0,0,0,0.8); /* Background yang lebih gelap untuk kontras */
    padding: 5px 10px;
    border-radius: 5px;
    display: none; 
    pointer-events: none; 
    z-index: 10;
}
.combined-image-slot:hover .caption-userid {
    display: block;
}

.package-info {
    text-align: center;
    margin-top: 20px;
    font-weight: bold;
    font-size: 1.1em;
    color: var(--neon-blue); /* Warna neon yang konsisten */
    text-shadow: 0 0 5px var(--neon-blue);
}

/* * --- Galeri Multi Gambar (Thumbnail) ---
 */
.gambar-container-multi {
    margin-top: 12px;
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    justify-content: center; /* Dipusatkan agar rapi */
}
.gambar-slot-multi {
    text-align: center;
    width: 110px;
    transition: transform 0.2s;
}
.gambar-slot-multi:hover {
    transform: translateY(-3px);
}
.gambar-slot-multi img {
    max-width: 100%;
    height: auto; /* Agar tidak terpotong */
    border-radius: 4px;
    cursor: pointer;
    border: 1px solid var(--secondary-neon);
    box-shadow: 0 0 5px rgba(0, 191, 255, 0.3);
    transition: border 0.3s, box-shadow 0.3s;
}
.gambar-slot-multi img:hover {
    border: 1px solid var(--neon-blue);
    box-shadow: 0 0 10px var(--neon-blue);
}
.userid-label {
    margin-top: 6px;
    font-size: 12px;
    color: var(--warning-color); /* Kuning neon */
}

.modal,
.lightbox-modal {
    display: none;
    position: fixed; 
    z-index: 9999;
    left: 0;
    top: 0;
    width: 100%; 
    height: 100%; 
    overflow: auto; 
    background-color: rgba(0,0,0,0.95);
    justify-content: center;
    align-items: center;
    flex-direction: column;
    padding: 20px;
}

.zoomed-content-area {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
}

.zoom-nav-button,
.nav-btn {
    background-color: transparent;
    color: var(--secondary-neon);
    border: none;
    font-size: 3em;
    padding: 0 20px;
    cursor: pointer;
    transition: color 0.3s, background-color 0.3s;
    z-index: 10000;
    user-select: none;
}

.zoom-nav-button:hover:not(:disabled),
.nav-btn:hover {
    color: var(--neon-blue);
    background: rgba(0, 191, 255, 0.1); /* Efek hover ringan */
}
/* Nav button spesifik untuk lightbox */
.nav-btn {
    position: absolute;
    top: 20%;
    transform: translateY(-50%);
    font-size: 40px;
    padding: 10px 15px;
    border-radius: 20%;
    background: rgba(0,0,0,0.5);
}
.prev { left: 20px; }
.next { right: 20px; }

.zoomed-content-wrapper {
    display: flex; 
    justify-content: center;
    align-items: center;
    gap: 10px; /* Jarak yang lebih besar agar jelas */
    width: 90%;
    max-width: 1200px; 
    max-height: 80vh;
    margin: 10px 0;
    overflow: hidden; 
}

.zoomed-content-wrapper img,
.lightbox-modal img {
    max-width: calc(33.33% - 10px); /* Disesuaikan dengan gap */
    height: auto;
    max-height: 80vh;
    border-radius: 8px;
    /* Efek glow yang lebih menonjol untuk gambar utama */
    box-shadow: 0 0 15px rgba(0, 191, 255, 0.8), 0 0 25px rgba(0, 191, 255, 0.5); 
    object-fit: contain;
    min-width: 0;
}
.lightbox-modal img {
    max-width: 90%;
    box-shadow: 0 0 20px rgba(255,255,255,0.5), 0 0 30px var(--neon-blue);
}

.zoomed-userid {
    display: block;
    text-align: center;
    color: var(--warning-color);
    font-size: 2.2em;
    font-weight: bold;
    margin-bottom: 15px;
    text-shadow: 0 0 10px var(--warning-color);
}
 
.zoom-link-input-area { display: none; } /* Tetap disembunyikan */

.close-btn,
.close {
    position: absolute;
    top: 20px;
    right: 35px;
    color: var(--danger-color);
    font-size: 45px;
    font-weight: bold;
    transition: 0.3s;
    cursor: pointer;
    text-shadow: 0 0 10px var(--danger-color);
    z-index: 10000;
}

.close-btn:hover,
.close-btn:focus,
.close:hover {
    color: #ff8080; /* Merah terang saat hover */
    text-decoration: none;
}

.lightbox-caption {
    margin-top: 10px;
    color: var(--text-color);
    font-size: 14px;
    background: rgba(0,0,0,0.7);
    padding: 8px 12px;
    border-radius: 4px;
    text-shadow: 0 0 5px var(--warning-color);
}

.scatter-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .input-group, .controls-group { margin-bottom: 15px; padding: 10px; border: 1px solid #444; border-radius: 8px; background: #3a3a3a; }
        .input-group label { display: block; margin-bottom: 5px; color: #ccc; }
        .column-input-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px; }
        .column-input { background: #444; border-radius: 8px; padding: 15px; border: 1px solid #555; transition: all 0.3s; }
        .column-input.minimized textarea { height: 0; padding: 0 10px; opacity: 0; transition: all 0.3s; }
        .column-input h3 { display: flex; justify-content: space-between; align-items: center; margin-top: 0; color: #00ffff; font-size: 16px; }
        .column-input textarea { width: 100%; height: 100px; padding: 10px; border: 1px solid #666; background: #2c2c2c; color: #fff; resize: vertical; border-radius: 4px; }
        .clear-col-btn { background: #f00; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; transition: background 0.3s; }
        .clear-col-btn:hover { background: #c00; }
        .indicator { width: 10px; height: 10px; border-radius: 50%; background-color: #555; margin-left: 10px; display: inline-block; }

        /* Hasil Scatter */
        .scatter-results { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 20px; }
        .result-block { background: #2c2c2c; padding: 15px; border-radius: 8px; border: 1px solid #555; }
        .result-block h4 { color: #00ffff; margin-top: 0; border-bottom: 1px dotted #444; padding-bottom: 5px; }
        .result-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; font-size: 14px; }
        .result-item label { color: #aaa; flex-basis: 35%; }
        .result-item .data-text { flex-basis: 60%; font-weight: bold; overflow-wrap: break-word; }
        .copy-btn { background: #007bff; color: white; border: none; padding: 3px 8px; margin-left: 5px; border-radius: 4px; cursor: pointer; transition: background 0.3s; }
        .copy-btn:hover { background: #0056b3; }
        .link-group, .action-group { margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap; }
        .view-image-btn, .cancel-btn, .undo-btn { padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; border: none; transition: opacity 0.3s; }
        .view-image-btn { background: #28a745; color: white; }
        .view-image-btn.no-link { opacity: 0.5; cursor: default; background: #6c757d; }
        .cancel-btn { background: #dc3545; color: white; }
        .undo-btn { background: #ffc107; color: #212529; }

        /* Modal Zoom */
        #imageModal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.95); }
        .modal-content { position: relative; margin: auto; padding: 20px; width: 80%; max-width: 1200px; background: #1a1a1a; border-radius: 10px; top: 50%; transform: translateY(-50%); }
        .close-btn { color: #fff; font-size: 40px; font-weight: bold; position: absolute; top: 10px; right: 25px; cursor: pointer; transition: color 0.3s; }
        .close-btn:hover { color: #00ffff; }
        #imagesContainer { display: flex; flex-direction: column; align-items: center; gap: 15px; max-height: 70vh; overflow-y: auto; padding: 10px; border: 1px solid #333; border-radius: 8px; transition: transform 0.3s ease-out; }
        #imagesContainer img { max-width: 100%; height: auto; border-radius: 6px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); }
        .modal-info { color: #aaa; margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 10px; }

        /* Modal Controls & Nav */
        .modal-controls { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; }
        #modalNavigation { display: flex; gap: 5px; }
        .nav-btn { padding: 8px 12px; background: #555; color: white; border: none; border-radius: 5px; cursor: pointer; transition: background 0.3s; }
        .nav-btn:hover { background: #777; }
        .nav-btn.active-col { background: #00ffff; color: #111; font-weight: bold; }
        .zoom-controls button { background: #555; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; margin-left: 5px; }
        #zoomIndicator { margin-left: 10px; font-weight: bold; color: #00ffff; }
        
        /* Credit Calculator */
        #creditCalculatorTab textarea { width: 100%; height: 200px; background: #2c2c2c; color: #fff; border: 1px solid #666; padding: 10px; margin-bottom: 15px; border-radius: 4px; resize: vertical; }
        .credit-result-box { background: #444; padding: 15px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; font-size: 18px; font-weight: bold; color: #fff; }
        #creditTotal { color: #ffc107; font-size: 24px; }
        
        /* Toast Notification */
        #toast { visibility: hidden; min-width: 250px; background-color: #333; color: #fff; text-align: center; border-radius: 2px; padding: 10px; position: fixed; z-index: 1001; left: 50%; bottom: 30px; transform: translateX(-50%); box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); }
        #toast.show { visibility: visible; -webkit-animation: fadein 0.5s, fadeout 0.5s 2s; animation: fadein 0.5s, fadeout 0.5s 2s; }

        @-webkit-keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @-webkit-keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
</style>
</head>
<body>

    <div class="container">
        <h1>📸 Galeri Gambar Otomatis & Zoom Navigasi</h1>
        <p style="text-align: center; color: #3498db;">**Tempel/Ketik** data. Format: **USERID link_gambar1 link_gambar2 link_gambar3**</p>

        <textarea id="linkInput" 
                  placeholder="Tempelkan data paket di sini. Setiap baris adalah satu paket." 
                  rows="8" 
                  oninput="handleInput()"
                  onpaste="handleInput()"></textarea>
        
        <div class="button-group">
            <button id="clearDataBtn" onclick="clearAllData()">🗑️ Hapus Semua Data</button>
        </div>

        <hr>

        <div class="gallery-container">
            
            <div class="combined-image-slot" id="combinedImageSlot" onclick="openZoom()">
                
                <p class="caption-userid" id="combinedSlotUserid">USER ID</p>
                
                <img id="imgSlot1" data-link="" src="https://via.placeholder.com/200x180/2c3e50/ffffff?text=Slot+1" alt="Slot 1">
                <img id="imgSlot2" data-link="" src="https://via.placeholder.com/200x180/2c3e50/ffffff?text=Slot+2" alt="Slot 2">
                <img id="imgSlot3" data-link="" src="https://via.placeholder.com/200x180/2c3e50/ffffff?text=Slot+3" alt="Slot 3">
            </div>
            
        </div>

        <p class="package-info">
            Paket: <span id="currentPackageNum">0</span> / <span id="maxPackageNum">0</span>
        </p>

    </div>

    <div id="zoomModal" class="modal" onclick="closeZoom(event)">
        <span class="close-btn">&times;</span>
        <span id="zoomedUserid" class="zoomed-userid"></span> 
        
        <div class="zoomed-content-area">
            
            <button class="zoom-nav-button" id="prevZoomBtn" onclick="navigatePackage('prev')">&#9664;</button>
            
            <div class="zoomed-content-wrapper" id="zoomedContentWrapper">
                </div>

            <button class="zoom-nav-button" id="nextZoomBtn" onclick="navigatePackage('next')">&#9654;</button>
        </div>
        
        <textarea id="zoomLinkInput" class="zoom-link-input-area"></textarea>
               
        <div id="caption">Geser paket menggunakan tombol navigasi (&#9664; / &#9654;) atau tombol panah Kiri/Kanan pada keyboard.</div>
    </div>
<div class="container">
    <h1>Analisis & Kalkulasi Transaksi</h1>

    <div class="tab-buttons">
        <button class="tab-button active" data-tab="scatterTab"><i class="fas fa-th-large"></i> Scatter 6 Kolom</button>
        <button class="tab-button" data-tab="creditCalculatorTab"><i class="fas fa-calculator"></i> Kalkulator Credit</button>
        <button class="tab-button" data-tab="cekBonusEventTab"><i class="fas fa-gift"></i> Cek Bonus Event</button>
    </div>

    <div id="scatterTab" class="tab-content active">

        <div class="scatter-controls">
            <div class="input-group" style="flex: 2;">
                <label for="autoInput">Input Otomatis (Tempel Semua Data):</label>
                <textarea id="autoInput" placeholder="Tempel semua data (maks 6 baris pertama akan diproses)"></textarea>
                <div class="controls-group">
                    <span id="dataCount" style="margin-right: 10px; color: #ccc;">Data: 0 baris</span>
                    <button id="autoDeleteBtn" class="cancel-btn"><i class="fas fa-trash"></i> Hapus Input Otomatis</button>
                    <span id="autoInputWarning" style="color: yellow; margin-left: 10px; display: none;"></span>
                    <span id="autoInputError" style="color: red; margin-left: 10px; display: none;"></span>
                </div>
            </div>
            
            <div class="input-group" style="flex: 1; margin-left: 20px;">
                <button id="globalMinimizeBtn" class="copy-btn" style="width: 100%; margin-bottom: 10px;"><i class="fas fa-chevron-down"></i> Buka Semua Kolom</button>
                <div style="display: flex; align-items: center; margin-bottom: 10px;">
                    <input type="checkbox" id="tsToggle" style="margin-right: 5px;">
                    <label for="tsToggle" style="color: #ffc107;">Mode TS (Tambahkan 'TS' di User ID)</label>
                </div>
                <button id="clearScatter6Btn" class="cancel-btn" style="width: 100%;"><i class="fas fa-broom"></i> Hapus Semua Kolom & Input</button>
            </div>
        </div>

        <div class="column-input-grid">
            <div class="column-input minimized">
                <h3>Kolom 1 <span class="indicator" id="indicator1"></span> <button class="clear-col-btn" data-col="1">Hapus</button></h3>
                <textarea id="inputCol1" placeholder="Data Kolom 1..."></textarea>
            </div>
            <div class="column-input minimized">
                <h3>Kolom 2 <span class="indicator" id="indicator2"></span> <button class="clear-col-btn" data-col="2">Hapus</button></h3>
                <textarea id="inputCol2" placeholder="Data Kolom 2..."></textarea>
            </div>
            <div class="column-input minimized">
                <h3>Kolom 3 <span class="indicator" id="indicator3"></span> <button class="clear-col-btn" data-col="3">Hapus</button></h3>
                <textarea id="inputCol3" placeholder="Data Kolom 3..."></textarea>
            </div>
            <div class="column-input minimized">
                <h3>Kolom 4 <span class="indicator" id="indicator4"></span> <button class="clear-col-btn" data-col="4">Hapus</button></h3>
                <textarea id="inputCol4" placeholder="Data Kolom 4..."></textarea>
            </div>
            <div class="column-input minimized">
                <h3>Kolom 5 <span class="indicator" id="indicator5"></span> <button class="clear-col-btn" data-col="5">Hapus</button></h3>
                <textarea id="inputCol5" placeholder="Data Kolom 5..."></textarea>
            </div>
            <div class="column-input minimized">
                <h3>Kolom 6 <span class="indicator" id="indicator6"></span> <button class="clear-col-btn" data-col="6">Hapus</button></h3>
                <textarea id="inputCol6" placeholder="Data Kolom 6..."></textarea>
            </div>
        </div>

        <div class="input-group">
            <label style="color: #00ffff; font-size: 18px; font-weight: bold;">💎 Hasil Scatter</label>
            <div id="scatter6Results" class="scatter-results">
                </div>
        </div>

    </div>

    <div id="creditCalculatorTab" class="tab-content">
        <div class="input-group">
            <label for="creditData" style="font-size: 16px;">Tempelkan Data Transaksi Credit (Satu baris satu transaksi):</label>
            <textarea id="creditData" placeholder="Contoh: 10000000 | deposit 5000000 | 500000"></textarea>
        </div>
        
        <div class="credit-result-box">
            <span>TOTAL CREDIT TERKUMPUL (Rp):</span>
            <span id="creditTotal">0</span>
            <div>
                <button id="copyCreditBtn" class="copy-btn"><i class="fas fa-copy"></i> Salin Total</button>
                <button id="clearCreditBtn" class="cancel-btn"><i class="fas fa-trash"></i> Hapus Data</button>
            </div>
        </div>
    </div>
    
    <div id="cekBonusEventTab" class="tab-content">
        <p style="text-align: center; color: #aaa;">Konten untuk Cek Bonus Event...</p>
        </div>


</div>

<div id="imageModal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        
        <div class="modal-info">
            <h3 id="imageInfo" style="margin-top: 0; color: #fff;">Kolom X / User ID: N/A</h3>
            <span id="colInfo">Kolom: N/A</span> | 
            <span id="userIdInfo">User ID: N/A</span> | 
            <span id="ticketInfo">Kode Tiket: N/A</span>
        </div>

        <div class="modal-controls">
            <div id="modalNavigation">
                <button class="nav-btn" data-col="1">K1</button>
                <button class="nav-btn" data-col="2">K2</button>
                <button class="nav-btn" data-col="3">K3</button>
                <button class="nav-btn" data-col="4">K4</button>
                <button class="nav-btn" data-col="5">K5</button>
                <button class="nav-btn" data-col="6">K6</button>
            </div>
            <div class="zoom-controls">
                <button id="zoomInBtn"><i class="fas fa-search-plus"></i> Zoom In</button>
                <button id="zoomOutBtn"><i class="fas fa-search-minus"></i> Zoom Out</button>
                <button id="zoomResetBtn"><i class="fas fa-redo-alt"></i> Reset</button>
                <span id="zoomIndicator">100%</span>
            </div>
        </div>

        <div id="imagesContainer">
            </div>

    </div>
</div>

<div id="toast">
    <div id="toastMessage"></div>
</div>

<!-- Modal Zoom Lightbox -->
<div id="lightboxModal" class="lightbox-modal" style="display:none;">
  <span class="close" onclick="closeLightbox()">&times;</span>
  <span class="nav-btn prev" onclick="prevImage()">&lsaquo;</span>
  <span class="nav-btn next" onclick="nextImage()">&rsaquo;</span>
  <img id="lightboxImg" src="" alt="Zoomed Image" />
  <div id="lightboxCaption" class="lightbox-caption">User ID: -</div>
</div>
    
    <script>
        /* ======================== JAVASCRIPT ======================== */
        let allPackagesData = []; 
        let currentPackageIndex = 0; 
        const packageSize = 3; 
        const placeholderImage = "https://via.placeholder.com/200x180/2c3e50/ffffff?text=Kosong"; 
        let isZoomOpen = false;

        // Data contoh (tetap dipertahankan untuk inisialisasi awal yang mudah)
        const initialData = [
        ];
        
        // --- Handler Input Utama Otomatis ---
        let inputTimeout;
        function handleInput() {
            clearTimeout(inputTimeout);
            inputTimeout = setTimeout(() => {
                loadImages();
            }, 50);
        }

        // --- Fungsi Utama untuk Memuat Gambar (dari Textarea) ---
        function loadImages() {
            const inputArea = document.getElementById('linkInput');
            
            const rawLines = inputArea.value
                .split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0);
            
            allPackagesData = [];
            const urlRegex = /(https?:\/\/[^\s]+)/g;

            rawLines.forEach((line) => {
                const urls = line.match(urlRegex) || [];
                
                const words = line.split(/\s+/).filter(w => w.length > 0);
                let userid = 'N/A';
                
                if (words.length > 0 && !words[0].startsWith('http')) {
                    userid = words[0];
                }

                if (urls.length >= 1) { 
                    const links = urls.slice(0, packageSize); 
                    
                    while (links.length < packageSize) {
                        links.push(""); 
                    }
                    
                    allPackagesData.push({ userid: userid, links: links });
                }
            });

            if (allPackagesData.length === 0) {
                 // Tidak melakukan apa-apa, biarkan updateGallery(-1) membersihkan
            }
            
            document.getElementById('maxPackageNum').textContent = allPackagesData.length;
            
            if (allPackagesData.length > 0) {
                currentPackageIndex = Math.min(currentPackageIndex, allPackagesData.length - 1);
                currentPackageIndex = Math.max(0, currentPackageIndex);
                updateGallery(currentPackageIndex);
            } else {
                currentPackageIndex = 0;
                document.getElementById('currentPackageNum').textContent = 0;
                updateGallery(-1); // Bersihkan tampilan
            }
        }

        // --- Fungsi untuk Mengupdate Tampilan Galeri ---
        function updateGallery(index) {
            const imgSlots = [
                document.getElementById('imgSlot1'),
                document.getElementById('imgSlot2'),
                document.getElementById('imgSlot3')
            ];
            
            const combinedSlot = document.getElementById('combinedImageSlot');
            const useridCaption = document.getElementById('combinedSlotUserid');
            const validPackages = allPackagesData.length;
            
            let currentPackage = { userid: 'N/A', links: ["", "", ""] };
            
            if (index >= 0 && index < validPackages) {
                currentPackage = allPackagesData[index];
                combinedSlot.style.pointerEvents = 'auto'; // Dapat diklik
            } else {
                combinedSlot.style.pointerEvents = 'none'; // Tidak dapat diklik
                currentPackage.userid = 'N/A'; // Pastikan kondisi default saat kosong
            }

            combinedSlot.setAttribute('data-userid', currentPackage.userid);
            useridCaption.textContent = currentPackage.userid === 'N/A' ? 'Belum Ada Data' : `USER ID: ${currentPackage.userid}`;

            let validLinkCount = 0;
            for (let i = 0; i < packageSize; i++) {
                const link = currentPackage.links[i] || "";

                if (link) {
                    imgSlots[i].src = link;
                    imgSlots[i].style.display = 'block'; 
                    imgSlots[i].setAttribute('data-link', link);
                    validLinkCount++;
                } else {
                    imgSlots[i].src = placeholderImage;
                    // Tampilkan placeholder tengah saja jika tidak ada data sama sekali
                    imgSlots[i].style.display = (index === -1 && i === 1) ? 'block' : 'none'; 
                    imgSlots[i].setAttribute('data-link', "");
                }
            }
            
            if (validLinkCount > 0) {
                combinedSlot.style.opacity = 1;
            } else {
                combinedSlot.style.opacity = 0.5;
            }

            document.getElementById('currentPackageNum').textContent = validPackages > 0 ? index + 1 : 0;
            
            if (isZoomOpen) {
                updateZoomDisplay(currentPackage.userid, currentPackage.links);
                updateZoomNavButtons();
            }
        }

        // --- Fungsi Navigasi (Untuk Tombol Fisik & Keyboard) ---
        function navigatePackage(direction) {
            let newIndex = currentPackageIndex;
            if (direction === 'next' && currentPackageIndex < allPackagesData.length - 1) {
                newIndex++;
            } else if (direction === 'prev' && currentPackageIndex > 0) {
                newIndex--;
            }
            
            if (newIndex !== currentPackageIndex) {
                currentPackageIndex = newIndex;
                updateGallery(currentPackageIndex); 
            }
        }
        
        // --- Update Tampilan Zoom ---
        function updateZoomDisplay(userid, links) {
            const wrapper = document.getElementById("zoomedContentWrapper");
            const zoomedUserid = document.getElementById("zoomedUserid");
            
            wrapper.innerHTML = '';
            
            links.forEach(link => {
                if (link) {
                    const img = document.createElement('img');
                    img.src = link;
                    img.alt = 'Zoomed Image';
                    wrapper.appendChild(img);
                }
            });
            
            zoomedUserid.textContent = userid; 
        }
        
        // --- Update Status Tombol Navigasi Zoom ---
        function updateZoomNavButtons() {
            const prevBtn = document.getElementById('prevZoomBtn');
            const nextBtn = document.getElementById('nextZoomBtn');
            
            if (allPackagesData.length <= 1) {
                prevBtn.disabled = true;
                nextBtn.disabled = true;
            } else {
                prevBtn.disabled = (currentPackageIndex === 0);
                nextBtn.disabled = (currentPackageIndex >= allPackagesData.length - 1);
            }
        }

        // --- Fungsi Zoom Gambar ---
        function openZoom() {
            if (allPackagesData.length === 0 || allPackagesData[currentPackageIndex].links.filter(l => l.length > 0).length === 0) {
                 return;
            }
            
            isZoomOpen = true;
            
            const currentPackage = allPackagesData[currentPackageIndex];
            updateZoomDisplay(currentPackage.userid, currentPackage.links);
            updateZoomNavButtons();
            
            document.getElementById("zoomModal").style.display = "flex"; 
        }
        
        // --- Fungsi Tutup Zoom ---
        function closeZoom(event) {
            const modal = document.getElementById("zoomModal");
            
            if (event.target.classList.contains('zoom-nav-button') || event.target.tagName === 'IMG') {
                event.stopPropagation();
                return;
            }
            
            if (event.target === modal || event.target.classList.contains('close-btn')) {
                modal.style.display = "none";
                isZoomOpen = false;
            }
        }
        
        // --- Fungsi Hapus Semua Data (TANPA NOTIFIKASI) ---
        function clearAllData() {
            // 1. Kosongkan array data utama
            allPackagesData = [];
            // 2. Kosongkan Textarea
            document.getElementById('linkInput').value = '';
            // 3. Reset status tampilan
            currentPackageIndex = 0;
            document.getElementById('maxPackageNum').textContent = 0;
            // 4. Perbarui galeri ke kondisi kosong
            updateGallery(-1); 
            
            // Tambahkan notifikasi cepat (opsional) atau biarkan tanpa notif sama sekali
            console.log("Semua data berhasil dihapus.");
        }

        // --- Event Listener Keyboard (Untuk Navigasi Zoom) ---
        document.addEventListener('keydown', (event) => {
            if (isZoomOpen) {
                if (event.key === "ArrowLeft" || event.key === "ArrowRight") {
                    event.preventDefault(); 
                }

                if (event.key === "ArrowLeft") {
                    navigatePackage('prev');
                } else if (event.key === "ArrowRight") {
                    navigatePackage('next');
                } else if (event.key === "Escape") {
                    closeZoom({ target: document.getElementById("zoomModal") });
                }
            }
        });

        // Inisialisasi: Muat data contoh saat halaman dimuat
        document.addEventListener('DOMContentLoaded', () => {
            // Isi Textarea dengan contoh data
            const initialText = initialData.map(p => 
                `${p.userid} ${p.links.join(' ')}`
            ).join('\n');
            
            document.getElementById('linkInput').value = initialText;
            
            loadImages(); 
        });

let currentLightboxIndex = 0;
let currentLightboxImages = [];
let currentLightboxUserId = "";

function openLightbox(imgUrl, userId) {
  const modal = document.getElementById("lightboxModal");
  const img = document.getElementById("lightboxImg");
  const caption = document.getElementById("lightboxCaption");
  currentLightboxImages = getCurrentTransaksiImages(userId);
  currentLightboxUserId = userId;
  currentLightboxIndex = currentLightboxImages.findIndex(img => img === imgUrl);
  if (currentLightboxIndex === -1) currentLightboxIndex = 0;
  img.src = currentLightboxImages[currentLightboxIndex];
  caption.innerText = `User ID: ${userId}`;
  modal.style.display = "flex";
  updateNavButtons();
}

function prevImage() {
  if (currentLightboxImages.length <= 1) return;
  currentLightboxIndex = (currentLightboxIndex - 1 + currentLightboxImages.length) % currentLightboxImages.length;
  updateLightboxImage();
}

function nextImage() {
  if (currentLightboxImages.length <= 1) return;
  currentLightboxIndex = (currentLightboxIndex + 1) % currentLightboxImages.length;
  updateLightboxImage();
}

function updateLightboxImage() {
  const img = document.getElementById("lightboxImg");
  const caption = document.getElementById("lightboxCaption");
  img.src = currentLightboxImages[currentLightboxIndex];
  caption.innerText = `User ID: ${currentLightboxUserId}`;
  updateNavButtons();
}

function updateNavButtons() {
  const prevBtn = document.querySelector('.prev');
  const nextBtn = document.querySelector('.next');

  if (currentLightboxImages.length <= 1) {
    prevBtn.style.opacity = '0.3';
    nextBtn.style.opacity = '0.3';
    prevBtn.style.pointerEvents = 'none';
    nextBtn.style.pointerEvents = 'none';
  } else {
    prevBtn.style.opacity = '1';
    nextBtn.style.opacity = '1';
    prevBtn.style.pointerEvents = 'auto';
    nextBtn.style.pointerEvents = 'auto';
  }
}

function closeLightbox() {
  document.getElementById("lightboxModal").style.display = "none";
  currentLightboxImages = [];
  currentLightboxUserId = "";
  currentLightboxIndex = 0;
}

document.addEventListener('keydown', (e) => {
  const lightbox = document.getElementById('lightboxModal');
  if (lightbox.style.display !== 'flex') return;

  if (e.key === 'ArrowLeft') {
    prevImage();
  } else if (e.key === 'ArrowRight') {
    nextImage();
  } else if (e.key === 'Escape') {
    closeLightbox();
  }
});

document.addEventListener('DOMContentLoaded', function() {
    // ==========================================================
    // 🚀 CACHE ELEMENT DOM UTAMA & VARIABEL GLOBAL
    // ==========================================================

    // --- Tab & Global ---
    const DOM = {
        tabButtons: document.querySelectorAll('.tab-button'),
        tabContents: document.querySelectorAll('.tab-content'),
        toast: document.getElementById('toast'),
        toastMessage: document.getElementById('toastMessage')
    };

    // --- Scatter 6 Kolom ---
    const SCATTER = {
        inputCols: [1, 2, 3, 4, 5, 6].map(i => document.getElementById(`inputCol${i}`)),
        indicators: [1, 2, 3, 4, 5, 6].map(i => document.getElementById(`indicator${i}`)),
        autoInput: document.getElementById('autoInput'),
        autoDeleteBtn: document.getElementById('autoDeleteBtn'),
        dataCount: document.getElementById('dataCount'),
        clearScatter6Btn: document.getElementById('clearScatter6Btn'),
        clearColBtns: document.querySelectorAll('.clear-col-btn'),
        tsToggle: document.getElementById('tsToggle'),
        globalMinimizeBtn: document.getElementById('globalMinimizeBtn'),
        scatter6Results: document.getElementById('scatter6Results'),
        modal: document.getElementById('imageModal'),
        closeBtn: document.querySelector('#imageModal .close-btn'), // Spesifikkan
        modalNavigation: document.getElementById('modalNavigation'),
        imagesContainer: document.getElementById('imagesContainer'),
        zoomInBtn: document.getElementById('zoomInBtn'),
        zoomOutBtn: document.getElementById('zoomOutBtn'),
        zoomResetBtn: document.getElementById('zoomResetBtn'),
        zoomIndicator: document.getElementById('zoomIndicator'),
        resultInfos: { // Cache elemen info di modal
            imageInfo: document.getElementById('imageInfo'),
            colInfo: document.getElementById('colInfo'),
            userIdInfo: document.getElementById('userIdInfo'),
            ticketInfo: document.getElementById('ticketInfo')
        }
    };

    // --- Credit Calculator ---
    const CREDIT = {
        data: document.getElementById('creditData'),
        total: document.getElementById('creditTotal'),
        clearBtn: document.getElementById('clearCreditBtn'),
        copyBtn: document.getElementById('copyCreditBtn'),
    };

    // --- Variabel State Global ---
    let scatterResults = [null, null, null, null, null, null];
    let undoData = [null, null, null, null, null, null];
    let isAllMinimized = true;
    let currentModalColumn = 1;
    let currentZoomLevel = 1;
    const ZOOM_STEP = 0.2;
    const MIN_ZOOM = 0.5;
    const MAX_ZOOM = 3;


    // ==========================================================
    // 🧠 FUNGSI UTILITAS & UX
    // ==========================================================

    /** Menampilkan Toast Notification yang keren */
    function showToast(message, duration = 2000) {
        DOM.toastMessage.textContent = message;
        DOM.toast.classList.add('show');
        setTimeout(() => {
            DOM.toast.classList.remove('show');
        }, duration);
    }

    /** Menyalin teks menggunakan Clipboard API modern */
    async function copyToClipboard(text, notificationMessage) {
        try {
            await navigator.clipboard.writeText(text);
            showToast(notificationMessage || `✅ Berhasil menyalin: ${text.substring(0, 20)}...`);
        } catch (err) {
            console.error('Gagal menyalin:', err);
            showToast('❌ Gagal menyalin. Silakan salin manual.', 3000);
        }
    }

    /** Menampilkan indikator loading kolom */
    function showProcessingIndicator(index) {
        SCATTER.indicators[index].style.backgroundColor = 'yellow';
    }

    /** Menyembunyikan indikator loading kolom */
    function hideProcessingIndicator(index) {
        SCATTER.indicators[index].style.backgroundColor = '';
    }

    // ==========================================================
    // ⚙️ FUNGSI SCATTER 6 KOLOM UTAMA
    // ==========================================================

    /** Parsing input teks untuk mendapatkan link gambar, User ID, dan Kode Tiket */
    function parseInput(text, isTS) {
        if (!text) return null;

        const lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
        
        // Asumsi kita hanya memproses baris pertama sebagai data utama
        const line = lines[0];
        
        const urlRegex = /(https?:\/\/[^\s]+)/g;
        const ticketRegex = /\b\d{17,20}\b/;
        
        const links = (line.match(urlRegex) || []).slice(0, 3); // Ambil maks 3 link
        const ticket = (line.match(ticketRegex) || [])[0] || 'N/A';
        
        let userId = 'N/A';
        const words = line.split(/\s+/).filter(w => w.length > 0);
        
        // Logika sederhana: ambil kata pertama yang bukan link
        for (const word of words) {
            if (!word.startsWith('http') && !ticketRegex.test(word)) {
                userId = word;
                break;
            }
        }

        if (isTS && userId !== 'N/A') {
            userId += ' TS';
        }

        // Return object yang rapi
        return { userId, ticket, links };
    }

    /** Memproses semua data kolom dan merender hasilnya */
    function processScatter6Data() {
        const isTS = SCATTER.tsToggle.checked;

        SCATTER.inputCols.forEach((input, index) => {
            scatterResults[index] = parseInput(input.value, isTS);
        });

        renderScatterResults();
    }

    /** Merender hasil ke dalam kolom output HTML */
    function renderScatterResults() {
        SCATTER.scatter6Results.innerHTML = '';
        
        scatterResults.forEach((result, index) => {
            const colNum = index + 1;
            const hasData = result && (result.userId !== 'N/A' || result.links.length > 0);

            const resultBlock = document.createElement('div');
            resultBlock.className = 'result-block';
            if (hasData) {
                resultBlock.classList.add('has-data');
            }

            const linksHTML = result ? result.links.map((link, i) => 
                link 
                ? `<button class="view-image-btn" data-col="${colNum}" data-index="${i}" data-link="${link}">
                     🔗 Bukti ${i + 1}
                   </button>` 
                : `<button class="view-image-btn no-link" disabled>
                     Bukti ${i + 1} (Kosong)
                   </button>`
            ).join('') : '';

            const userId = result ? result.userId : 'N/A';
            const ticket = result ? result.ticket : 'N/A';

            // Tombol Undo
            const undoBtnHTML = undoData[index] ? 
                `<button class="undo-btn" data-col="${colNum}">↩️ Undo Cancel</button>` : '';

            resultBlock.innerHTML = `
                <h4>Kolom ${colNum}</h4>
                <div class="result-item">
                    <label>User ID:</label>
                    <span id="uidCol${colNum}" class="data-text">${userId}</span>
                    <button class="copy-btn" data-text="${userId}">📋</button>
                </div>
                <div class="result-item">
                    <label>Kode Tiket:</label>
                    <span id="ticketCol${colNum}" class="data-text">${ticket}</span>
                    <button class="copy-btn" data-text="${ticket}">📋</button>
                </div>
                <div class="link-group">${linksHTML}</div>
                <div class="action-group">
                    <button class="cancel-btn danger" data-col="${colNum}">❌ Cancel</button>
                    ${undoBtnHTML}
                </div>
            `;
            SCATTER.scatter6Results.appendChild(resultBlock);
        });
    }

    /** Memproses input dari textarea otomatis */
    function processAutoInput() {
        const text = SCATTER.autoInput.value;
        const lines = text.split('\n').map(line => line.trim()).filter(line => line.length > 0);
        
        if (lines.length > 6) {
            SCATTER.autoInputWarning.textContent = `⚠️ Terdeteksi ${lines.length} baris. Hanya 6 baris pertama yang akan diproses.`;
            SCATTER.autoInputWarning.style.display = 'block';
        } else {
            SCATTER.autoInputWarning.style.display = 'none';
        }

        // Distribusikan data ke 6 kolom input
        SCATTER.inputCols.forEach((input, index) => {
            input.value = lines[index] || '';
        });

        processScatter6Data();
    }
    
    // ==========================================================
    // 🖼️ FUNGSI MODAL ZOOM & NAVIGASI
    // ==========================================================

    /** Memuat data kolom ke modal zoom */
    function loadModalContent(colIndex) {
        const result = scatterResults[colIndex - 1];
        
        if (!result) return;
        
        currentModalColumn = colIndex;
        
        // Update info teks di modal
        SCATTER.resultInfos.imageInfo.textContent = `Kolom ${colIndex} / User ID: ${result.userId}`;
        SCATTER.resultInfos.colInfo.textContent = `Kolom ${colIndex}`;
        SCATTER.resultInfos.userIdInfo.textContent = `User ID: ${result.userId}`;
        SCATTER.resultInfos.ticketInfo.textContent = `Kode Tiket: ${result.ticket}`;

        // Render gambar
        SCATTER.imagesContainer.innerHTML = '';
        result.links.forEach(link => {
            if (link) {
                const img = document.createElement('img');
                img.src = link;
                img.alt = 'Bukti Transaksi';
                SCATTER.imagesContainer.appendChild(img);
            }
        });

        // Update tampilan navigasi modal
        updateModalNavigationButtons();
    }

    /** Membuka modal zoom */
    function openModal(colIndex) {
        loadModalContent(colIndex);
        SCATTER.modal.style.display = 'block';
        resetZoom(); // Reset zoom saat modal dibuka
    }

    /** Menutup modal zoom */
    function closeModal() {
        SCATTER.modal.style.display = 'none';
    }

    /** Navigasi ke kolom lain di dalam modal */
    function navigateToColumn(targetCol) {
        if (targetCol >= 1 && targetCol <= 6) {
            loadModalContent(targetCol);
        }
    }

    /** Update status tombol navigasi di modal */
    function updateModalNavigationButtons() {
        const navButtons = SCATTER.modalNavigation.querySelectorAll('.nav-btn');
        navButtons.forEach(btn => {
            const btnCol = parseInt(btn.getAttribute('data-col'));
            btn.classList.remove('active-col');
            btn.disabled = scatterResults[btnCol - 1] === null;

            if (btnCol === currentModalColumn) {
                btn.classList.add('active-col');
            }
        });
    }

    // --- Logika Zoom ---
    function applyZoom() {
        SCATTER.imagesContainer.style.transform = `scale(${currentZoomLevel})`;
        SCATTER.zoomIndicator.textContent = `${Math.round(currentZoomLevel * 100)}%`;
        
        // Atur posisi agar zoom di tengah
        const translateX = (1 - currentZoomLevel) * 50;
        const translateY = (1 - currentZoomLevel) * 50;
        SCATTER.imagesContainer.style.transformOrigin = 'center center';
    }

    function zoomIn() {
        currentZoomLevel = Math.min(MAX_ZOOM, currentZoomLevel + ZOOM_STEP);
        applyZoom();
    }

    function zoomOut() {
        currentZoomLevel = Math.max(MIN_ZOOM, currentZoomLevel - ZOOM_STEP);
        applyZoom();
    }

    function resetZoom() {
        currentZoomLevel = 1;
        applyZoom();
    }

    // ==========================================================
    // 💰 FUNGSI CREDIT CALCULATOR
    // ==========================================================

    /** Memproses data credit dan menghitung total */
    function processCreditData() {
        const text = CREDIT.data.value;
        const lines = text.split('\n');
        let totalCredit = 0;

        // Regex untuk mencari angka di awal baris, mengabaikan tanda (./,)
        const numberRegex = /^\s*(\-?\d[\d\.,]*)/;

        lines.forEach(line => {
            const match = line.match(numberRegex);
            if (match) {
                // Hapus semua karakter non-digit kecuali tanda minus di awal
                let numStr = match[1].replace(/,/g, '').replace(/\./g, '');
                
                // Cek apakah ada tanda minus di awal
                const isNegative = numStr.startsWith('-');
                if(isNegative) {
                    numStr = numStr.substring(1);
                }

                const value = parseInt(numStr, 10);
                if (!isNaN(value)) {
                    totalCredit += isNegative ? -value : value;
                }
            }
        });

        // Format hasil ke rupiah (misal: 10.000.000)
        CREDIT.total.textContent = totalCredit.toLocaleString('id-ID');
    }


    // ==========================================================
    // 🔗 DELEGASI EVENT LISTENER & INISIALISASI
    // ==========================================================

    // --- Inisialisasi Tab ---
    if (DOM.tabButtons.length > 0) {
        DOM.tabButtons[0].click(); // Aktifkan tab pertama secara default
    }

    // --- Event Listener Global Scatter ---

    // Delegasi event untuk tombol di hasil render (Copy, View Image, Cancel, Undo)
    SCATTER.scatter6Results.addEventListener('click', function(e) {
        const copyBtn = e.target.closest('.copy-btn');
        const viewBtn = e.target.closest('.view-image-btn');
        const cancelBtn = e.target.closest('.cancel-btn');
        const undoBtn = e.target.closest('.undo-btn');

        if (copyBtn) {
            const textToCopy = copyBtn.getAttribute('data-text') || copyBtn.previousElementSibling.textContent;
            copyToClipboard(textToCopy);
        } 
        else if (viewBtn && !viewBtn.disabled) {
            const colNum = parseInt(viewBtn.getAttribute('data-col'));
            openModal(colNum);
        } 
        else if (cancelBtn) {
            const colNum = parseInt(cancelBtn.getAttribute('data-col'));
            const colIndex = colNum - 1;
            
            // Logika Cancel (Simpan data lama untuk undo, lalu hapus input & proses ulang)
            undoData[colIndex] = SCATTER.inputCols[colIndex].value;
            SCATTER.inputCols[colIndex].value = '';
            processScatter6Data();
            showToast(`Kolom ${colNum} Dibatalkan. Klik 'Undo Cancel' untuk mengembalikan.`);
        } 
        else if (undoBtn) {
            const colNum = parseInt(undoBtn.getAttribute('data-col'));
            const colIndex = colNum - 1;
            
            // Logika Undo (Kembalikan data dari undoData)
            SCATTER.inputCols[colIndex].value = undoData[colIndex];
            undoData[colIndex] = null; // Reset undo
            processScatter6Data();
            showToast(`Kolom ${colNum} berhasil dikembalikan.`);
        }
    });

    // --- Scatter General Events ---
    SCATTER.autoInput.addEventListener('input', function() {
        // updateDataCount(); // FUNGSI INI PERLU DIBUAT JIKA DIPERLUKAN
        processAutoInput();
    });

    SCATTER.autoDeleteBtn.addEventListener('click', function() {
        SCATTER.autoInput.value = '';
        // updateDataCount();
        processAutoInput();
    });

    SCATTER.tsToggle.addEventListener('change', processScatter6Data);

    // --- Credit Calculator Events ---
    CREDIT.data.addEventListener('input', processCreditData);
    CREDIT.clearBtn.addEventListener('click', function() {
        CREDIT.data.value = '';
        processCreditData(); // Memastikan total menjadi 0
        showToast('Data Credit Dihapus.');
    });
    CREDIT.copyBtn.addEventListener('click', function() {
        copyToClipboard(CREDIT.total.textContent, '✅ Total Credit berhasil disalin!');
    });

    // --- Modal Navigation Keyboard Events (Panah Kiri/Kanan) ---
    document.addEventListener('keydown', function(e) {
        if (SCATTER.modal.style.display === 'block') {
            if (e.key === "ArrowRight") {
                e.preventDefault();
                navigateToColumn(currentModalColumn < 6 ? currentModalColumn + 1 : 1);
            } else if (e.key === "ArrowLeft") {
                e.preventDefault();
                navigateToColumn(currentModalColumn > 1 ? currentModalColumn - 1 : 6);
            }
        }
    });

    // --- Modal Zoom Events ---
    SCATTER.zoomInBtn.addEventListener('click', zoomIn);
    SCATTER.zoomOutBtn.addEventListener('click', zoomOut);
    SCATTER.zoomResetBtn.addEventListener('click', resetZoom);

    // Inisialisasi Credit Calculator
    processCreditData(); 
});
</script>
</body>
</html>






